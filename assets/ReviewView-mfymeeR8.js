import{g as f,d as R,c,F as k,h as S,o as a,i as v,w as $,b as m,t as j,u as r,_ as T,f as h,e as _,a as g,j as L,k as N,n as V,l as K,m as D,p as P,q}from"./index-uL2dLKam.js";import{W as A,b as W,l as I,u as B}from"./index-Bk94BvIa.js";import{u as F,a as M}from"./WordWritingSelect-R_mn7F66.js";import{p as Q,K as z,a as E,b as G,c as H,d as J}from"./KanjiWordList-D2UF5rRu.js";import{A as b}from"./AppButton-niJYO7_s.js";import{f as O,m as U}from"./index-v4MgLGDb.js";import{u as X,i as Y,a as Z,r as x}from"./cards-BUWV1I5q.js";import{u as ee,d as ae,l as re}from"./db-ywXYyXbd.js";import"./decks-huPVwMnz.js";function se(){return f(()=>{const l=W();return A(l)})}const ne={class:"rate-buttons"},te={class:"rate-button-content"},ie={class:"rating"},oe={class:"next-review-time"},de=R({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(l,{emit:n}){const i=l,t=n,d=f(()=>s.value.repeat(i.fsrs,new Date));function e(w){var u;const C=((u=w.last_review)==null?void 0:u.getTime())??Date.now(),o=w.due.getTime();return O(o-C)}const s=se();function p(w){w!==I.Manual&&t("rate",s.value.next(i.fsrs,new Date,w))}return(w,C)=>(a(),c("div",ne,[(a(!0),c(k,null,S(d.value,({log:o,card:u})=>(a(),v(b,{class:"rating-button",key:o.rating,"data-rating":r(I)[o.rating],onClick:y=>p(o.rating)},{default:$(()=>[m("span",te,[m("span",ie,j(r(I)[o.rating]),1),m("small",oe,j(e(u)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),ue=T(de,[["__scopeId","data-v-4210a69b"]]),ce={key:0},le={class:"advance-buttons"},pe=R({__name:"KanjiReview",props:{progress:{},answered:{type:Boolean}},emits:["answer","rate"],setup(l){const n=l,i=F(()=>n.progress.cardId),t=M(()=>n.progress.cardId);Q(()=>n.progress.cardId.toString(16).padStart(5,"0"));const d=f(()=>n.progress.fsrs.state===B.New);return(e,s)=>r(i)?(a(),c("section",ce,[h(z,{class:"title",kanji:r(i),"hide-literal":!e.answered&&e.progress.cardType==="kanji-write"&&!d.value,"hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.answered||e.progress.cardType==="kanji-write"?(a(),v(E,{key:0,class:"readings",kanji:r(i)},null,8,["kanji"])):_("",!0),h(G,{class:"strokes",kanji:r(i),"auto-hint":!e.answered&&e.progress.cardType==="kanji-write"&&d.value,"practice-mode":!e.answered&&e.progress.cardType==="kanji-write","practice-review":e.progress.cardType==="kanji-write",onPracticeDone:s[0]||(s[0]=p=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode","practice-review"]),m("div",le,[e.answered?(a(),v(ue,{key:0,fsrs:e.progress.fsrs,onRate:s[1]||(s[1]=p=>e.$emit("rate",p))},null,8,["fsrs"])):(a(),v(b,{key:1,onClick:s[2]||(s[2]=p=>e.$emit("answer")),filled:""},{default:$(()=>[s[3]||(s[3]=g(" Show ")),e.progress.cardType==="kanji-read"?(a(),c(k,{key:0},[g(" Reading")],64)):(a(),c(k,{key:1},[g(" Writing")],64))]),_:1}))]),e.answered||e.progress.cardType==="kanji-write"&&d.value?(a(),v(J,{key:1,class:"components"})):_("",!0),r(t)?(a(),v(H,{key:2,class:"words","kanji-vocab":r(t),"hide-kanji":!e.answered&&e.progress.cardType==="kanji-write"&&!d.value,"hide-reading":!e.answered&&e.progress.cardType==="kanji-read","hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):_("",!0)])):_("",!0)}}),me=T(pe,[["__scopeId","data-v-249adc66"]]),ve={key:0,class:"review-remaining-count"},we={class:"review-count"},ye={class:"new-count"},ke={class:"learning-count"},ge=R({__name:"ReviewRemainCount",setup(l){const n=X();return(i,t)=>r(n)?(a(),c("div",ve,[m("span",we,j(r(n).due),1),m("span",ye,"(+ "+j(r(n).new)+")",1),m("span",ke,j(r(n).learning),1)])):_("",!0)}}),fe=T(ge,[["__scopeId","data-v-def2b4ab"]]),_e={class:"card-value"},je=R({__name:"ReviewSummaryItem",props:{cardId:{},reviews:{}},setup(l){const n=l,i=f(()=>String.fromCharCode(n.cardId)),t=f(()=>n.reviews.at(0)),d=f(()=>t.value?t.value.cardType==="kanji-write"&&t.value.log.state===B.New:!1);return(e,s)=>{const p=L("RouterLink");return a(),v(p,{to:r(N)(i.value),class:V(["review-summary-item",{"is-new":d.value}])},{default:$(()=>[m("strong",_e,j(i.value),1)]),_:1},8,["to","class"])}}}),Re=T(je,[["__scopeId","data-v-be38f85b"]]),Te={class:"review-summary"},he={key:0,class:"review-summary-list"},Ce=R({__name:"ReviewSummary",setup(l){const{result:n}=ee(async()=>{const i=new Map,t=(await ae).transaction("reviews").store.index("review");for await(const d of t.iterate(IDBKeyRange.lowerBound(U()))){const e=d.value;let s=i.get(e.cardId);s||(s=[],i.set(e.cardId,s)),s.push(e)}return i});return(i,t)=>(a(),c("section",Te,[r(n)?(a(),c("ul",he,[(a(!0),c(k,null,S(r(n),([d,e])=>(a(),c("li",null,[h(Re,{"card-id":d,reviews:e},null,8,["card-id","reviews"])]))),256))])):_("",!0),h(b,{onClick:t[0]||(t[0]=d=>r(Y)())},{default:$(()=>t[1]||(t[1]=[g("Continue Review")])),_:1})]))}}),$e=T(Ce,[["__scopeId","data-v-7e788300"]]);function Ie(l){return l==="kanji-read"||l==="kanji-write"}const be={class:"header"},Ke={class:"title"},Se={key:0},Be=R({__name:"ReviewView",setup(l){const n=P(),i=q(),t=f(()=>{const{kanji:o,"card-type":u}=n.query;if(typeof o!="string"||typeof u!="string")return null;const y=o.codePointAt(0);return!y||!Ie(u)?null:{cardId:y,cardType:u}}),d=K(null),{result:e,loading:s}=Z(t),p=K(!0);D(s,o=>{o||(p.value=!1)});const w=f(()=>p.value?!0:!e.value||!d.value?!1:s.value&&e.value.cardId===d.value.cardId&&e.value.cardType===e.value.cardType);async function C(o,u){try{d.value={cardId:o.cardId,cardType:o.cardType},await x(o.cardId,o.cardType,u),re.postMessage("card-review"),i.replace({query:{kanji:void 0,"card-type":void 0}})}catch(y){console.error(y)}}return(o,u)=>(a(),c("article",null,[m("header",be,[m("strong",Ke,[r(e)?(a(),c(k,{key:0},[r(e).cardType==="kanji-read"?(a(),c(k,{key:0},[g(" Reading ")],64)):(a(),c(k,{key:1},[g("Writing")],64)),u[2]||(u[2]=g(" Review "))],64)):p.value?_("",!0):(a(),c(k,{key:1},[g("Review Summary")],64))]),h(fe,{class:"counts"})]),w.value?(a(),c("p",Se,"Loading next card...")):r(e)?(a(),v(me,{key:1,progress:r(e),answered:t.value!=null,onAnswer:u[0]||(u[0]=y=>o.$router.replace({query:{kanji:String.fromCodePoint(r(e).cardId),"card-type":r(e).cardType}})),onRate:u[1]||(u[1]=y=>C(r(e),y))},null,8,["progress","answered"])):(a(),v($e,{key:2}))]))}}),Me=T(Be,[["__scopeId","data-v-4ad28858"]]);export{Me as default};
