{"version":3,"file":"WordListItem-9iMVk-v2.js","sources":["../../src/components/VocabularyWord.vue","../../src/components/WordListItem.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, ref, watch } from \"vue\";\nimport { pipe } from \"yta\";\nimport { groupBy } from \"yta/sync\";\n\nimport { hasKanjiRE } from \"../helpers/text.ts\";\nimport { useWordFurigana } from \"../helpers/words.ts\";\nimport { wordRoute } from \"../router.ts\";\nimport { Furigana, Word, WordSentenceIndex } from \"../types.ts\";\nimport VocabularyWordFurigana from \"./VocabularyWordFurigana.vue\";\nimport VocabularyWordMeaning from \"./VocabularyWordMeaning.vue\";\nimport VocabularyWordMeaningSentences from \"./VocabularyWordMeaningSentences.vue\";\nimport WordWritingSelect from \"./WordWritingSelect.vue\";\n\nconst props = withDefaults(\n  defineProps<{\n    word: Word;\n    kanji?: string | null;\n    hideKanji?: boolean;\n    hideReading?: boolean;\n    hideMeaning?: boolean;\n    sentenceIndex?: WordSentenceIndex | null;\n  }>(),\n  {\n    kanji: null,\n    hideKanji: false,\n    hideReading: false,\n    hideMeaning: false,\n    sentenceIndex: null,\n  },\n);\n\nconst meanings = computed(() => {\n  const { kanji, word } = props;\n\n  if (!word.meanings) {\n    return [];\n  }\n\n  if (!kanji) {\n    return word.meanings;\n  }\n\n  return word.meanings.filter((meaning) => {\n    if (\n      meaning.info &&\n      meaning.info.startsWith(\"esp. \") &&\n      hasKanjiRE.test(meaning.info)\n    ) {\n      return meaning.info.includes(kanji);\n    }\n\n    if (!meaning.useWithWriting) {\n      return true;\n    }\n\n    return meaning.useWithWriting.some((writing) => writing.includes(kanji));\n  });\n});\n\nconst furigana = useWordFurigana(() => props.word, {\n  kanji: () => props.kanji,\n  // writing practice, prevent hiding furigana for proficient reading.\n  forceReading: () => props.hideKanji,\n});\n\nconst meaning = computed(() => meanings.value.at(0));\nconst selectedFurigana = ref<Furigana | string | null>(null);\n\nconst additionalMeanings = computed(() => meanings.value.slice(1));\nconst additionalMeaningsToggledOnce = ref(false);\n\nconst meaningSentenceMap = computed(() => {\n  if (!props.sentenceIndex) {\n    return null;\n  }\n\n  return pipe(\n    props.sentenceIndex,\n    groupBy(\n      (entry) => entry.meaning,\n      (entry) => entry.sentence,\n    ),\n  );\n});\n\nwatch(\n  () => props.word.id,\n  (newId, oldId) => {\n    if (newId !== oldId) {\n      selectedFurigana.value = null;\n    }\n  },\n);\n</script>\n\n<template>\n  <div class=\"vocabulary-word\">\n    <p class=\"word\" lang=\"ja\">\n      <RouterLink :to=\"wordRoute(word.id)\" class=\"word-link\">\n        <template v-if=\"typeof selectedFurigana === 'string'\">\n          {{ selectedFurigana }}\n        </template>\n\n        <VocabularyWordFurigana\n          v-else\n          :furigana=\"selectedFurigana || furigana\"\n          :hide-kanji=\"hideKanji\"\n          :hide-reading=\"hideReading\"\n          :kanji=\"kanji\"\n        />\n      </RouterLink>\n    </p>\n\n    <div class=\"meaning\">\n      <VocabularyWordMeaning\n        v-if=\"meaning && !hideMeaning\"\n        :meaning=\"meaning\"\n      />\n    </div>\n\n    <div class=\"extra\">\n      <VocabularyWordMeaningSentences\n        :sentence-ids=\"meaningSentenceMap?.get(1)\"\n        :kanji=\"kanji\"\n        :hide-kanji=\"hideKanji\"\n        :hide-reading=\"hideReading\"\n        :hide-meaning=\"hideMeaning\"\n      />\n\n      <details\n        v-if=\"additionalMeanings.length > 0\"\n        class=\"additional-meanings-details\"\n        @toggle=\"additionalMeaningsToggledOnce = true\"\n      >\n        <summary>{{ additionalMeanings.length }} more</summary>\n\n        <ul class=\"additional-meanings\">\n          <li\n            v-for=\"(additionalMeaning, i) of additionalMeanings\"\n            :key=\"i\"\n            class=\"additional-meaning-item\"\n          >\n            <VocabularyWordMeaning\n              v-if=\"!hideMeaning\"\n              :meaning=\"additionalMeaning\"\n            />\n            <VocabularyWordMeaningSentences\n              v-if=\"additionalMeaningsToggledOnce\"\n              :sentence-ids=\"meaningSentenceMap?.get(i + 2)\"\n              :kanji=\"kanji\"\n              :hide-kanji=\"hideKanji\"\n              :hide-reading=\"hideReading\"\n              :hide-meaning=\"hideMeaning\"\n            />\n          </li>\n        </ul>\n      </details>\n    </div>\n\n    <div class=\"actions\">\n      <WordWritingSelect\n        v-if=\"!hideKanji && !hideReading\"\n        v-model=\"selectedFurigana\"\n        :word=\"word\"\n        :default-furigana=\"furigana\"\n      />\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.vocabulary-word {\n  column-gap: 1em;\n  display: grid;\n  grid-template:\n    \"word meaning actions\"\n    \"extra extra extra\"\n    / fit-content(50%) 1fr auto;\n\n  @media screen and (max-width: 60ch) {\n    column-gap: 0.5ex;\n    grid-template:\n      \"word actions\"\n      \"meaning meaning\"\n      \"extra extra\"\n      / 1fr auto;\n  }\n}\n\n.word {\n  font-size: 2em;\n  grid-area: word;\n  margin: 0;\n  max-inline-size: 75vw;\n}\n\n.word-link {\n  color: inherit;\n  text-decoration: none;\n}\n\n.meaning {\n  grid-area: meaning;\n}\n\n.actions {\n  grid-area: actions;\n}\n\n.extra {\n  grid-area: extra;\n}\n\n.additional-meanings-details summary {\n  color: var(--text-light);\n  cursor: pointer;\n  inline-size: max-content;\n}\n\n.additional-meanings {\n  list-style: none;\n  padding-inline: 1ex;\n  margin-inline: 1ex;\n}\n\n.additional-meaning-item:not(:first-child) {\n  margin-block-start: 1ex;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { useWord, useWordSetenceIndex } from \"../helpers/words.ts\";\nimport BookmarkWordButton from \"./BookmarkWordButton.vue\";\nimport VocabularyWord from \"./VocabularyWord.vue\";\n\nconst props = defineProps<{\n  word: number;\n  kanji?: string;\n  hideKanji?: boolean;\n  hideReading?: boolean;\n  hideMeaning?: boolean;\n}>();\n\nconst wordInfo = useWord(() => props.word);\nconst sentenceIndex = useWordSetenceIndex(() => props.word);\n</script>\n\n<template>\n  <article class=\"word-list-item\">\n    <aside class=\"bullet\">\n      <BookmarkWordButton\n        :word-id=\"word\"\n        :reading=\"wordInfo?.readings?.at(0)?.text\"\n        class=\"bookmark-button\"\n      />\n    </aside>\n\n    <VocabularyWord\n      v-if=\"wordInfo\"\n      :word=\"wordInfo\"\n      :kanji=\"kanji\"\n      :hide-kanji=\"hideKanji\"\n      :hide-reading=\"hideReading\"\n      :hide-meaning=\"hideMeaning\"\n      :sentence-index=\"sentenceIndex\"\n      class=\"word-section\"\n    />\n  </article>\n</template>\n\n<style scoped>\n.word-list-item {\n  display: grid;\n  grid-template:\n    \"bullet . word\"\n    / auto 0.5ex 1fr;\n  margin-block-start: 2em;\n  justify-content: start;\n\n  & .bullet {\n    display: flex;\n    grid-area: bullet;\n    flex-direction: column;\n  }\n\n  & .word-section {\n    grid-area: word;\n  }\n}\n\n.bookmark-button {\n  margin-block-start: 0.9ex;\n\n  .word-list-item:has(.word-section ruby rt) & {\n    margin-block-start: 0.9em;\n  }\n}\n</style>\n"],"names":["props","__props","meanings","computed","kanji","word","meaning","hasKanjiRE","writing","furigana","useWordFurigana","selectedFurigana","ref","additionalMeanings","additionalMeaningsToggledOnce","meaningSentenceMap","pipe","groupBy","entry","watch","newId","oldId","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_RouterLink","_unref","wordRoute","_Fragment","_createBlock","VocabularyWordFurigana","hideKanji","hideReading","_hoisted_3","hideMeaning","VocabularyWordMeaning","_hoisted_4","VocabularyWordMeaningSentences","_toDisplayString","_hoisted_5","_renderList","additionalMeaning","i","_hoisted_6","WordWritingSelect","$event","wordInfo","useWord","sentenceIndex","useWordSetenceIndex","BookmarkWordButton","VocabularyWord"],"mappings":"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"}