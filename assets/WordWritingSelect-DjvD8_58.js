import{c as D}from"./fsrs-BAHU2VgB.js";import{d as N,g as q}from"./reviews-BjQG9Nhh.js";import{q as K,I as P,c as b,W as I,d as L,i as R,w as E,u as w,A as Y,b as S,J as Q,o as t,_ as W,a,F as o,l as B,h as r,t as $,m as J,z as X,e as l,g as C,U as Z,C as c,p as h,V as x,K as _,L as ee}from"./index-sZE7bAWT.js";import{u as ne,d as F,l as O}from"./db-CaAx7W_9.js";function*te(...d){const n=d.map(e=>e[Symbol.iterator]());try{let e=n.map(i=>i.next());for(;!e.some(({done:i})=>i);)yield e.map(({value:i})=>i),e=n.map(i=>i.next())}finally{n.forEach(e=>{typeof e.return=="function"&&e.return()})}}function Ee(d,n){return e=>{const i=new Map;for(const s of e){const f=d(s);let g=i.get(f);g||(g=[],i.set(f,g)),g.push(n?n(s):s)}return i}}function qe(d){const n=K(null);return P(()=>I(d),async e=>{if(!e){n.value=null;return}const i=await fetch(`/data/words-v1/${e}.json`);if(!i.ok||!i.headers.get("Content-Type")?.startsWith("application/json")){console.error("failed getting word:",d);return}try{const s=await i.json();n.value=s}catch{console.error("failed getting word:",d)}},{immediate:!0}),n}function Fe(d){const n=K([]);return P(()=>I(d),async e=>{if(!e){n.value=[];return}const i=await fetch(`/data/words-sentences-v2/${e}.json`);if(!i.ok||!i.headers.get("Content-Type")?.startsWith("application/json")){console.error("failed getting sentences for word:",e);return}try{const s=await i.json();n.value=s}catch{console.error("failed getting sentences for word:",e)}},{immediate:!0}),n}function ae(d,n={}){return b(()=>{const e=I(n.kanji),{writings:i}=I(d)??{};if(!i)return null;let s=null;for(const f of i){if(!s){s=f;continue}if(e){if(!f.text.includes(e))continue;if(!s?.text.includes(e)){s=f;continue}}f.priority?.freq&&f.priority.freq<(s.priority?.freq??Number.POSITIVE_INFINITY)&&(s=f)}return s?.text})}function re(d){return b(()=>{const{readings:n}=I(d)??{};if(!n)return null;let e=null;for(const i of n){if(!e){e=i;continue}i.priority?.freq&&i.priority.freq<(e.priority?.freq??Number.POSITIVE_INFINITY)&&(e=i)}return e?.text})}function Oe(d,n={}){const e=ae(d,n),i=re(d),s=D(()=>I(d)?.writings?.map(({text:g})=>g).join("")),f=b(()=>{const g=I(n.forceReading),k=I(n.kanji);return p=>{if(g&&k&&p.includes(k))return!1;for(const j of p)if(N(j)&&!s.has(j))return!1;return!0}});return b(()=>{const{furigana:g}=I(d)??{};let k;!i.value||!e.value?k=g?.at(0):k=g?.find(v=>v.writing===e.value&&v.reading===i.value),k||(k=g?.at(0));const p=k?.furigana??[{ruby:e.value??i.value??""}];let j=!1;return p.map(({ruby:v,rt:G})=>{const T=j;return j=!1,G?v==="々"&&T?{ruby:v}:f.value(v)?(j=!0,{ruby:v}):{ruby:v,rt:G}:{ruby:v}})})}const oe=L({__name:"BookmarkWordButton",props:{wordId:{},reading:{}},setup(d){const n=d,{result:e}=ne(b(()=>{const s=n.wordId;return async()=>await(await F).count("bookmarked-words",s)>0}));async function i(){const s=await F;if(e.value){await s.delete("bookmarked-words",n.wordId),O.postMessage("word-unbookmarked"),q([{store:"bookmarked-words",op:"delete",key:n.wordId}]);return}const f={wordId:n.wordId,reading:n.reading,bookmarkedAt:new Date};await s.add("bookmarked-words",f),O.postMessage("word-bookmarked"),q([{store:"bookmarked-words",op:"add",key:n.wordId}])}return(s,f)=>(t(),R(Y,{"aria-pressed":w(e),class:"bookmark-button",onClick:f[0]||(f[0]=g=>i())},{default:E(()=>[S(Q,{icon:w(e)?"star-filled":"star"},null,8,["icon"])]),_:1},8,["aria-pressed"]))}}),Ae=W(oe,[["__scopeId","data-v-36e09a23"]]),ie={key:0,class:"placeholder"},se=L({__name:"MaybeHideKanji",props:{str:{},kanji:{default:null},hide:{type:Boolean,default:!1},link:{type:Boolean,default:!1}},setup(d){return(n,e)=>{const i=X("RouterLink");return n.link?(t(!0),a(o,{key:0},B(n.str,s=>(t(),a(o,{key:s},[w(N)(s)?(t(),R(i,{key:0,to:w(J)(s),class:"link"},{default:E(()=>[r($(s),1)]),_:2},1032,["to"])):(t(),a(o,{key:1},[r($(s),1)],64))],64))),128)):!n.kanji||!n.hide?(t(),a(o,{key:1},[r($(n.str),1)],64)):(t(!0),a(o,{key:2},B(n.str,s=>(t(),a(o,{key:s},[s===n.kanji?(t(),a("span",ie,"◌")):(t(),a(o,{key:1},[r($(s),1)],64))],64))),128))}}}),A=W(se,[["__scopeId","data-v-dd465f3e"]]),le={key:0},ue={key:0},de={key:1},M=L({__name:"VocabularyWordFurigana",props:{furigana:{},kanji:{},hideKanji:{type:Boolean},hideReading:{type:Boolean},linkKanji:{type:Boolean}},setup(d){const n=d;function e(i,s){return!n.hideReading||!n.kanji?!1:i==="々"&&n.furigana.at(s-1)?.ruby===n.kanji?!0:i.includes(n.kanji)}return(i,s)=>(t(!0),a(o,null,B(i.furigana,({ruby:f,rt:g},k)=>(t(),a(o,{key:k},[g?(t(),a("ruby",le,[S(A,{hide:i.hideKanji,kanji:i.kanji,str:f,link:i.linkKanji},null,8,["hide","kanji","str","link"]),s[0]||(s[0]=l("rp",null,"(",-1)),e(f,k)?(t(),a("rt",ue,"◌")):(t(),a("rt",de,$(g),1)),s[1]||(s[1]=l("rp",null,")",-1))])):(t(),R(A,{key:1,hide:i.hideKanji,kanji:i.kanji,str:f,link:i.linkKanji},null,8,["hide","kanji","str","link"]))],64))),128))}}),ge={class:"pos-tag"},fe=L({__name:"PartOfSpeechTag",props:{tag:{}},setup(d){return(n,e)=>(t(),a("span",ge,[n.tag==="adj-f"?(t(),a(o,{key:0},[r(" noun or prenominal verb")],64)):n.tag==="adj-i"?(t(),a(o,{key:1},[e[0]||(e[0]=l("i",{lang:"ja-Latn"},"i",-1)),e[1]||(e[1]=r(" adjective",-1))],64)):n.tag==="adj-ix"?(t(),a(o,{key:2},[e[2]||(e[2]=r(" adjective – ",-1)),e[3]||(e[3]=l("i",{lang:"ja-Latn"},"yoi",-1)),e[4]||(e[4]=r("/",-1)),e[5]||(e[5]=l("i",{lang:"ja-Latn"},"ii",-1)),e[6]||(e[6]=r(" class",-1))],64)):n.tag==="adj-na"?(t(),a(o,{key:3},[r(" na adjective")],64)):n.tag==="adj-nari"?(t(),a(o,{key:4},[e[7]||(e[7]=r(" formal ",-1)),e[8]||(e[8]=l("i",{lang:"ja-Latn"},"na",-1)),e[9]||(e[9]=r("-adjective",-1))],64)):n.tag==="adj-no"?(t(),a(o,{key:5},[e[10]||(e[10]=r(" noun w. ",-1)),e[11]||(e[11]=l("i",null,"no",-1)),e[12]||(e[12]=r(" particle",-1))],64)):n.tag==="adj-pn"?(t(),a(o,{key:6},[r(" pre-noun adjectival")],64)):n.tag==="adj-t"?(t(),a(o,{key:7},[e[13]||(e[13]=l("i",{lang:"ja-Latn"},"taru",-1)),e[14]||(e[14]=r(" adjective",-1))],64)):n.tag==="adv"?(t(),a(o,{key:8},[r(" adverb")],64)):n.tag==="adv-to"?(t(),a(o,{key:9},[e[15]||(e[15]=r(" adverb w. ",-1)),e[16]||(e[16]=l("i",{lang:"ja-Latn"},"to",-1)),e[17]||(e[17]=r(" particle",-1))],64)):n.tag==="aux"?(t(),a(o,{key:10},[r(" auxiliary")],64)):n.tag==="aux-adj"?(t(),a(o,{key:11},[r(" auxiliary adjective")],64)):n.tag==="aux-v"?(t(),a(o,{key:12},[r(" auxiliary verb")],64)):n.tag==="conj"?(t(),a(o,{key:13},[r(" conjunction")],64)):n.tag==="cop"?(t(),a(o,{key:14},[r(" copula")],64)):n.tag==="ctr"?(t(),a(o,{key:15},[r(" counter")],64)):n.tag==="exp"?(t(),a(o,{key:16},[r(" expressions")],64)):n.tag==="int"?(t(),a(o,{key:17},[r(" interjection")],64)):n.tag==="n"?(t(),a(o,{key:18},[r(" noun")],64)):n.tag==="n-adv"?(t(),a(o,{key:19},[r(" adverbial noun")],64)):n.tag==="n-pr"?(t(),a(o,{key:20},[r(" proper noun")],64)):n.tag==="n-pref"?(t(),a(o,{key:21},[r(" noun, used as a prefix")],64)):n.tag==="n-suf"?(t(),a(o,{key:22},[r(" noun, used as a suffix")],64)):n.tag==="n-t"?(t(),a(o,{key:23},[r(" noun (temporal)")],64)):n.tag==="num"?(t(),a(o,{key:24},[r(" numeric")],64)):n.tag==="pn"?(t(),a(o,{key:25},[r(" pronoun")],64)):n.tag==="pref"?(t(),a(o,{key:26},[r(" prefix")],64)):n.tag==="prt"?(t(),a(o,{key:27},[r(" particle")],64)):n.tag==="suf"?(t(),a(o,{key:28},[r(" suffix")],64)):n.tag==="uk"?(t(),a(o,{key:29},[r(" Usually written with kana")],64)):n.tag==="v-unspec"?(t(),a(o,{key:30},[r(" verb")],64)):n.tag==="v1"?(t(),a(o,{key:31},[r(" Ichidan verb")],64)):n.tag==="v1-s"?(t(),a(o,{key:32},[e[18]||(e[18]=r(" Ichidan verb – ",-1)),e[19]||(e[19]=l("i",{lang:"ja-Latn"},"kureru",-1))],64)):n.tag==="v5aru"?(t(),a(o,{key:33},[e[20]||(e[20]=r(" Godan verb – ",-1)),e[21]||(e[21]=l("i",{lang:"ja-Latn"},"-aru",-1))],64)):n.tag==="v5b"?(t(),a(o,{key:34},[r(" Godan verb")],64)):n.tag==="v5g"?(t(),a(o,{key:35},[r(" Godan verb")],64)):n.tag==="v5k"?(t(),a(o,{key:36},[r(" Godan verb")],64)):n.tag==="v5k-s"?(t(),a(o,{key:37},[e[22]||(e[22]=r(" Godan verb – ",-1)),e[23]||(e[23]=l("i",{lang:"ja-Latn"},"iku",-1)),e[24]||(e[24]=r("/",-1)),e[25]||(e[25]=l("i",{lang:"ja-Latn"},"yuku",-1))],64)):n.tag==="v5m"?(t(),a(o,{key:38},[r(" Godan verb")],64)):n.tag==="v5n"?(t(),a(o,{key:39},[r(" Godan verb")],64)):n.tag==="v5r"?(t(),a(o,{key:40},[e[26]||(e[26]=r(" Godan verb with ",-1)),e[27]||(e[27]=l("i",{lang:"ja-Latn"},"ru",-1)),e[28]||(e[28]=r(" ending",-1))],64)):n.tag==="v5r-i"?(t(),a(o,{key:41},[e[29]||(e[29]=r(" Godan verb with ",-1)),e[30]||(e[30]=l("i",{lang:"ja-Latn"},"ru",-1)),e[31]||(e[31]=r(" ending (irregular)",-1))],64)):n.tag==="v5s"?(t(),a(o,{key:42},[r(" Godan verb")],64)):n.tag==="v5t"?(t(),a(o,{key:43},[r(" Godan verb")],64)):n.tag==="v5u"?(t(),a(o,{key:44},[r(" Godan verb")],64)):n.tag==="v5u-s"?(t(),a(o,{key:45},[e[32]||(e[32]=r(" Godan verb with ",-1)),e[33]||(e[33]=l("i",{lang:"ja-Latn"},"u",-1)),e[34]||(e[34]=r(" ending (special class)",-1))],64)):n.tag==="v5uru"?(t(),a(o,{key:46},[e[35]||(e[35]=r(" Godan verb – ",-1)),e[36]||(e[36]=l("i",{lang:"ja-Latn"},"Uru",-1)),e[37]||(e[37]=r(" old class verb",-1))],64)):n.tag==="vi"?(t(),a(o,{key:47},[r(" intransitive verb")],64)):n.tag==="vk"?(t(),a(o,{key:48},[e[38]||(e[38]=l("i",{lang:"ja-Latn"},"Kuru",-1)),e[39]||(e[39]=r(" verb",-1))],64)):n.tag==="vn"?(t(),a(o,{key:49},[e[40]||(e[40]=r(" irregular ",-1)),e[41]||(e[41]=l("i",{lang:"ja-Latn"},"nu",-1)),e[42]||(e[42]=r(" verb",-1))],64)):n.tag==="vr"?(t(),a(o,{key:50},[e[43]||(e[43]=r(" irregular ",-1)),e[44]||(e[44]=l("i",{lang:"ja-Latn"},"ru",-1)),e[45]||(e[45]=r(" verb",-1))],64)):n.tag==="vs"?(t(),a(o,{key:51},[e[46]||(e[46]=l("i",{lang:"ja-Latn"},"suru",-1)),e[47]||(e[47]=r(" verb",-1))],64)):n.tag==="vs-c"?(t(),a(o,{key:52},[e[48]||(e[48]=l("i",{lang:"ja-Latn"},"su",-1)),e[49]||(e[49]=r(" verb—precursor to the modern ",-1)),e[50]||(e[50]=l("i",{lang:"ja-Latn"},"suru",-1))],64)):n.tag==="vs-i"?(t(),a(o,{key:53},[e[51]||(e[51]=l("i",{lang:"ja-Latn"},"suru",-1)),e[52]||(e[52]=r(" verb – included",-1))],64)):n.tag==="vs-s"?(t(),a(o,{key:54},[e[53]||(e[53]=l("i",{lang:"ja-Latn"},"suru",-1)),e[54]||(e[54]=r(" verb – special class",-1))],64)):n.tag==="vt"?(t(),a(o,{key:55},[r(" transitive verb")],64)):n.tag==="vz"?(t(),a(o,{key:56},[e[55]||(e[55]=r(" Ichidan verb – ",-1)),e[56]||(e[56]=l("i",{lang:"ja-Latn"},"zuru",-1)),e[57]||(e[57]=r(" verb",-1))],64)):C("",!0)]))}}),z=W(fe,[["__scopeId","data-v-ee320153"]]),ke={class:"vocabulary-word-meaning"},pe={class:"meaning-pos"},ye={class:"glossary"},ve=L({__name:"VocabularyWordMeaning",props:{meaning:{}},setup(d){return(n,e)=>(t(),a("div",ke,[l("div",pe,[(t(!0),a(o,null,B(n.meaning.pos,i=>(t(),R(z,{key:i,tag:i},null,8,["tag"]))),128)),n.meaning.kanaPreferred?(t(),R(z,{key:0,tag:"uk"})):C("",!0)]),l("div",ye,[(t(!0),a(o,null,B(n.meaning.glossary,i=>(t(),a("span",{key:i,class:"glossary-word"},$(i),1))),128))])]))}}),ze=W(ve,[["__scopeId","data-v-9dd3a484"]]);function me(d){const n=K(null);return P(()=>I(d),async e=>{const i=await fetch(`/data/sentences-v1/${e}.json`);if(!i.ok||!i.headers.get("Content-Type")?.startsWith("application/json")){console.error("failed getting sentence:",d);return}try{const s=await i.json();n.value=s}catch{console.error("failed getting sentence:",d)}},{immediate:!0}),n}const je={key:0,class:"vocabulary-sentence"},be={lang:"ja",class:"sentence"},we=L({__name:"VocabularySentence",props:{sentenceId:{},kanji:{},hideKanji:{type:Boolean},hideReading:{type:Boolean},hideMeaning:{type:Boolean}},setup(d){const n=d,e=me(()=>n.sentenceId),i=D(()=>e.value?.sentence),s=b(()=>g=>{if(n.kanji&&n.hideKanji&&g.includes(n.kanji))return!1;for(const k of g)if(N(k)&&!i.has(k))return!1;return!0}),f=b(()=>g=>{let k=!1;return g.furigana.map(({ruby:p,rt:j})=>{const v=k;return k=!1,j?p==="々"&&v?{ruby:p}:s.value(p)?(k=!0,{ruby:p}):{ruby:p,rt:j}:{ruby:p}})});return(g,k)=>w(e)?(t(),a("div",je,[l("p",be,[(t(!0),a(o,null,B(w(e).words,p=>(t(),R(h(p.word?"RouterLink":"span"),{key:p.word,to:w(c)(p.word),class:"word"},{default:E(()=>[S(M,{furigana:f.value(p),"hide-kanji":g.hideKanji,"hide-reading":g.hideReading,kanji:g.kanji},null,8,["furigana","hide-kanji","hide-reading","kanji"])]),_:2},1032,["to"]))),128))]),Z(l("p",{lang:"en",class:"translation"},$(w(e).meaning),513),[[x,!g.hideMeaning]])])):C("",!0)}}),Ie=W(we,[["__scopeId","data-v-856f392e"]]),$e={key:0,class:"sentence-list"},Be=L({__name:"VocabularyWordMeaningSentences",props:{sentenceIds:{default:()=>[]},kanji:{default:null},hideKanji:{type:Boolean},hideReading:{type:Boolean},hideMeaning:{type:Boolean}},setup(d){return(n,e)=>n.sentenceIds.length>0?(t(),a("ul",$e,[(t(!0),a(o,null,B(n.sentenceIds,i=>(t(),a("li",{key:i,class:"sentence-item"},[S(Ie,{"sentence-id":i,kanji:n.kanji,"hide-kanji":n.hideKanji,"hide-reading":n.hideReading,"hide-meaning":n.hideMeaning},null,8,["sentence-id","kanji","hide-kanji","hide-reading","hide-meaning"])]))),128))])):C("",!0)}}),De=W(Be,[["__scopeId","data-v-2fff9b9f"]]),Le={key:0,class:"word-writing-details popover-container"},We=["popovertarget"],Ve={class:"writing-select-count"},Ke=["id"],Re=["disabled"],Se=["disabled","onClick"],Ce=["disabled","onClick"],Ge=L({__name:"WordWritingSelect",props:{word:{},defaultFurigana:{},modelValue:{}},emits:["update:modelValue"],setup(d){ee(u=>({ae632862:w(i)}));const n=d,e=_(),i=`--${e}`.replace(":","-anchor-"),s=b(()=>n.word.writings?.filter(u=>u.irregular||u.outdated||u.searchOnly).map(({text:u})=>u)??[]),f=b(()=>n.word.readings?.filter(u=>u.irregular||u.outdated||u.searchOnly).map(({text:u})=>u)??[]);function g(u,m){if(u.length!==m.length)return!1;for(const[y,V]of te(u,m))if(y.ruby!==V.ruby||y.rt!==V.rt)return!1;return!0}const k=b(()=>n.word.furigana?.filter(u=>!g(n.defaultFurigana,u.furigana)&&!s.value.includes(u.writing)&&!f.value.includes(u.reading))??[]),p=b(()=>n.word.readings?.filter(u=>!u.irregular&&!u.outdated&&!u.searchOnly&&!n.word.furigana?.some(m=>u.text===m.reading))??[]),j=K(null),v=K(null),G=K(!1);function T(u){G.value=u.newState==="open"}function H(u){if(u.newState==="open"&&!("anchorName"in document.documentElement.style)){const m=j.value?.getBoundingClientRect(),y=v.value?.style;y&&m&&(y.insetBlockStart=`${m.bottom+window.scrollY}px`,y.insetInlineEnd=`calc(100% - ${m.right}px)`)}}return(u,m)=>k.value.length+p.value.length>0?(t(),a("div",Le,[l("button",{ref_key:"toggleButton",ref:j,title:"Additional Writings",class:"toggle-button",popovertarget:w(e)},[m[1]||(m[1]=l("span",{class:"writing-select-icon"},"か",-1)),l("small",Ve,"(+"+$(k.value.length+p.value.length+1)+")",1)],8,We),l("ul",{id:w(e),ref_key:"popoverEl",ref:v,class:"writing-list popover",popover:"",onBeforetoggle:H,onToggle:T},[l("li",null,[l("button",{class:"select-button",disabled:u.modelValue===null,onClick:m[0]||(m[0]=y=>u.$emit("update:modelValue",null))},[S(M,{furigana:u.defaultFurigana},null,8,["furigana"])],8,Re)]),(t(!0),a(o,null,B(k.value,(y,V)=>(t(),a("li",{key:V,class:"additional-writing"},[l("button",{class:"select-button",disabled:u.modelValue===y.furigana,onClick:U=>u.$emit("update:modelValue",y.furigana)},[S(M,{furigana:y.furigana},null,8,["furigana"])],8,Se)]))),128)),(t(!0),a(o,null,B(p.value,(y,V)=>(t(),a("li",{key:V},[l("button",{class:"select-button",disabled:u.modelValue===y.text,onClick:U=>u.$emit("update:modelValue",y.text)},$(y.text),9,Ce)]))),128))],40,Ke)])):C("",!0)}}),He=W(Ge,[["__scopeId","data-v-c6ac4536"]]);export{Ae as B,ze as V,He as W,M as _,Oe as a,Fe as b,De as c,Ee as g,qe as u};
//# sourceMappingURL=WordWritingSelect-DjvD8_58.js.map
