import{d as C,c as _,a as u,F as j,l as A,i as y,w as q,e as m,t as h,u as i,A as K,o as n,_ as b,m as V,n as B,g as w,b as T,h as R,p as N,q as S,k as D,j as I}from"./index-C4O8d0Wk.js";import{A as P}from"./AppLoading-ocLeESRM.js";import{R as $,S as E}from"./index-CZZIk45U.js";import{d as L}from"./db-D-l1LJxU.js";import{u as F,a as W}from"./kanji-BN7PpHVt.js";import{p as G,K as M,a as Q,b as z,c as H,d as J}from"./KanjiWordList-DGwJyQrZ.js";import{u as O}from"./fsrs-C9LDqAL5.js";import{b as U,u as X,c as Y}from"./reviews-Cd2z_uA7.js";import"./kanji-components-DVwhWaYJ.js";import"./decks-CfOZF5PQ.js";import"./formats-CxjEYhKc.js";import"./index-CmLlYKEn.js";import"./WordListItem-DtE82M4G.js";import"./WordWritingSelect-BUFE0g2S.js";const Z={class:"rate-buttons"},x={class:"rate-button-content"},ee={class:"rating"},ae={class:"next-review-time"},ne=C({__name:"RateButtons",props:{progress:{}},emits:["rate"],setup(k,{emit:d}){const s=k,l=d,t=O(),c=_(()=>t.value.repeat(s.progress,new Date));function f(o){const r=o.last_review?.getTime()??Date.now(),a=o.due.getTime();return U(a-r)}function g(o){o!==$.Manual&&l("rate",t.value.next(s.progress,new Date,o))}return(o,r)=>(n(),u("div",Z,[(n(!0),u(j,null,A(c.value,({log:a,card:e})=>(n(),y(K,{key:a.rating,class:"rating-button","data-rating":i($)[a.rating],onClick:p=>g(a.rating)},{default:q(()=>[m("span",x,[m("span",ee,h(i($)[a.rating]),1),m("small",ae,h(f(e)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),te=b(ne,[["__scopeId","data-v-8b639bb2"]]),re={key:0},se={class:"advance-buttons"},ie=C({__name:"KanjiReview",props:{card:{},isRating:{type:Boolean}},emits:["answer","rate"],setup(k,{emit:d}){const s=k,l=d,t=F(()=>s.card.cardId),c=W(()=>s.card.cardId),f=V(null);G(()=>s.card.cardId.toString(16).padStart(5,"0"));const g=B(async()=>{const{cardId:e,cardType:p,fsrs:v}=s.card;return v||(await(await L).get("progress",[e,p]))?.fsrs},s.card.fsrs),o=_(()=>g.value?.state===E.New);function r(){l("answer"),s.card.cardType==="kanji-write"&&f.value?.maybeShowAnswer()}function a(e){g.value&&(f.value?.clearPracticeStrokes(),l("rate",{progress:{...s.card,fsrs:g.value},next:e}))}return(e,p)=>i(t)&&i(g)?(n(),u("section",re,[T(M,{class:"title",kanji:i(t),"hide-literal":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.isRating||e.card.cardType==="kanji-write"?(n(),y(Q,{key:0,class:"readings",kanji:i(t)},null,8,["kanji"])):w("",!0),T(z,{ref_key:"kanjiStrokesEl",ref:f,class:"strokes",kanji:i(t),"auto-hint":!e.isRating&&e.card.cardType==="kanji-write"&&o.value,"practice-mode":!e.isRating&&e.card.cardType==="kanji-write",onPracticeDone:p[0]||(p[0]=v=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),m("div",se,[e.isRating?(n(),y(te,{key:0,progress:i(g),onRate:a},null,8,["progress"])):(n(),y(K,{key:1,filled:"",onClick:p[1]||(p[1]=v=>r())},{default:q(()=>[p[2]||(p[2]=R(" Show ")),e.card.cardType==="kanji-read"?(n(),u(j,{key:0},[R(" Reading ")],64)):(n(),u(j,{key:1},[R(" Writing ")],64))]),_:1,__:[2]}))]),e.isRating||e.card.cardType==="kanji-write"&&o.value?(n(),y(H,{key:1,class:"components"})):w("",!0),i(c)?(n(),y(J,{key:2,class:"words","kanji-vocab":i(c),"hide-kanji":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-reading":!e.isRating&&e.card.cardType==="kanji-read","hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):w("",!0)])):w("",!0)}}),oe=b(ie,[["__scopeId","data-v-d341b3c0"]]),de={key:0,class:"review-remaining-count"},ce={class:"review-count"},ue={class:"new-count"},le={class:"learning-count"},pe=C({__name:"ReviewRemainCount",setup(k){const d=X();return(s,l)=>i(d)?(n(),u("div",de,[m("span",ce,h(i(d).due),1),m("span",ue,"(+ "+h(i(d).new)+")",1),m("span",le,h(i(d).learning),1)])):w("",!0)}}),me=b(pe,[["__scopeId","data-v-adc21f06"]]);function ge(k){return k==="kanji-read"||k==="kanji-write"}const ke={class:"header"},fe={class:"title"},ve={key:0,class:"loading"},ye=C({__name:"ReviewView",setup(k){const d=V(null),s=N(),l=D(),t=Y(),c=_(()=>{const{kanji:r,"card-type":a}=s.query;if(typeof r!="string"||typeof a!="string")return null;const e=r.codePointAt(0);return!e||!ge(a)?null:t.queue.find(v=>v.cardId===e&&v.cardType===a)??{cardId:e,cardType:a}}),f=_(()=>"rating"in s.query),g=_(()=>!c.value&&t.refreshing);t.refreshQueues(),S(()=>{t.queue.length===0&&!t.refreshing&&l.replace(I)}),S(()=>{if(c.value)return;const[r]=t.queue;r&&l.replace({query:{kanji:String.fromCodePoint(r.cardId),"card-type":r.cardType,rating:void 0}})});function o({progress:r,next:a}){t.rateCard(r,a);const[e]=t.queue;e?(l.replace({query:{kanji:String.fromCodePoint(e.cardId),"card-type":e.cardType,rating:void 0}}),d.value?.scrollIntoView({behavior:"instant",block:"start"})):l.replace(I)}return(r,a)=>(n(),u("article",{ref_key:"el",ref:d},[m("header",ke,[m("strong",fe,[c.value?(n(),u(j,{key:0},[c.value.cardType==="kanji-read"?(n(),u(j,{key:0},[R(" Reading ")],64)):(n(),u(j,{key:1},[R("Writing")],64)),a[2]||(a[2]=R(" Review "))],64)):w("",!0)]),T(me,{class:"counts"})]),g.value?(n(),u("section",ve,[a[3]||(a[3]=m("p",null,"Loading next cardâ€¦",-1)),T(P,{class:"loading-icon"})])):c.value?(n(),y(oe,{key:1,card:c.value,"is-rating":f.value,onAnswer:a[0]||(a[0]=e=>r.$router.replace({query:{...r.$route.query,rating:""}})),onRate:a[1]||(a[1]=e=>o(e))},null,8,["card","is-rating"])):w("",!0)],512))}}),Be=b(ye,[["__scopeId","data-v-16039238"]]);export{Be as default};
