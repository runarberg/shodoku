import{u as oa,d as G,l as ua,a as Xa}from"./db-DFxFyH6D.js";import{y as ae,G as Za,a5 as ue,a6 as ca,a7 as Qa,S as ei,a8 as ti,m as Jt,a9 as ri,W as ni,B as j,a1 as la,V as Kt,p as ai,c as Xt,u as ii}from"./index-DyCUo9BM.js";function si(t){return async e=>{const r=new Map;for await(const n of e){const a=t(n);let i=r.get(a);i||(i=[],r.set(a,i)),i.push(n)}return r}}function fa(t,...e){return e.reduce((r,n)=>n(r),t)}function oi(t){return async function*(e){for await(const r of e)yield t(r)}}function ui(t){return function*(e){const r=e[Symbol.iterator]();let n=r.next();for(;!n.done&&t(n.value);)n=r.next();try{for(;!n.done;)yield n.value,n=r.next()}finally{typeof r.return=="function"&&r.return()}}}class he extends Error{constructor(e,r){super(e),this.name="DevalueError",this.path=r.join("")}}function dr(t){return Object(t)!==t}const ci=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function li(t){const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null||Object.getOwnPropertyNames(e).sort().join("\0")===ci}function fi(t){return Object.prototype.toString.call(t).slice(8,-1)}function di(t){switch(t){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t<" "?`\\u${t.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function J(t){let e="",r=0;const n=t.length;for(let a=0;a<n;a+=1){const i=t[a],s=di(i);s&&(e+=t.slice(r,a)+s,r=a+1)}return`"${r===0?t:e+t.slice(r)}"`}function hi(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.getOwnPropertyDescriptor(t,e).enumerable)}const yi=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function hr(t){return yi.test(t)?"."+t:"["+JSON.stringify(t)+"]"}function yr(t){const e=new DataView(t);let r="";for(let n=0;n<t.byteLength;n++)r+=String.fromCharCode(e.getUint8(n));return pi(r)}function vr(t){const e=vi(t),r=new ArrayBuffer(e.length),n=new DataView(r);for(let a=0;a<r.byteLength;a++)n.setUint8(a,e.charCodeAt(a));return r}const da="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function vi(t){t.length%4===0&&(t=t.replace(/==?$/,""));let e="",r=0,n=0;for(let a=0;a<t.length;a++)r<<=6,r|=da.indexOf(t[a]),n+=6,n===24&&(e+=String.fromCharCode((r&16711680)>>16),e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255),r=n=0);return n===12?(r>>=4,e+=String.fromCharCode(r)):n===18&&(r>>=2,e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255)),e}function pi(t){let e="";for(let r=0;r<t.length;r+=3){const n=[void 0,void 0,void 0,void 0];n[0]=t.charCodeAt(r)>>2,n[1]=(t.charCodeAt(r)&3)<<4,t.length>r+1&&(n[1]|=t.charCodeAt(r+1)>>4,n[2]=(t.charCodeAt(r+1)&15)<<2),t.length>r+2&&(n[2]|=t.charCodeAt(r+2)>>6,n[3]=t.charCodeAt(r+2)&63);for(let a=0;a<n.length;a++)typeof n[a]>"u"?e+="=":e+=da[n[a]]}return e}const Zt=-1,ha=-2,ya=-3,va=-4,pa=-5,Qt=-6;function ye(t,e){return gi(JSON.parse(t))}function gi(t,e){if(typeof t=="number")return a(t,!0);if(!Array.isArray(t)||t.length===0)throw new Error("Invalid input");const r=t,n=Array(r.length);function a(i,s=!1){if(i===Zt)return;if(i===ya)return NaN;if(i===va)return 1/0;if(i===pa)return-1/0;if(i===Qt)return-0;if(s)throw new Error("Invalid input");if(i in n)return n[i];const o=r[i];if(!o||typeof o!="object")n[i]=o;else if(Array.isArray(o))if(typeof o[0]=="string"){const c=o[0];switch(c){case"Date":n[i]=new Date(o[1]);break;case"Set":const u=new Set;n[i]=u;for(let d=1;d<o.length;d+=1)u.add(a(o[d]));break;case"Map":const f=new Map;n[i]=f;for(let d=1;d<o.length;d+=2)f.set(a(o[d]),a(o[d+1]));break;case"RegExp":n[i]=new RegExp(o[1],o[2]);break;case"Object":n[i]=Object(o[1]);break;case"BigInt":n[i]=BigInt(o[1]);break;case"null":const l=Object.create(null);n[i]=l;for(let d=1;d<o.length;d+=2)l[o[d]]=a(o[d+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const d=globalThis[c],y=o[1],v=vr(y),w=new d(v);n[i]=w;break}case"ArrayBuffer":{const d=o[1],y=vr(d);n[i]=y;break}default:throw new Error(`Unknown type ${c}`)}}else{const c=new Array(o.length);n[i]=c;for(let u=0;u<o.length;u+=1){const f=o[u];f!==ha&&(c[u]=a(f))}}else{const c={};n[i]=c;for(const u in o){const f=o[u];c[u]=a(f)}}return n[i]}return a(0)}function re(t,e){const r=[],n=new Map,a=[],i=[];let s=0;function o(u){if(typeof u=="function")throw new he("Cannot stringify a function",i);if(n.has(u))return n.get(u);if(u===void 0)return Zt;if(Number.isNaN(u))return ya;if(u===1/0)return va;if(u===-1/0)return pa;if(u===0&&1/u<0)return Qt;const f=s++;n.set(u,f);for(const{key:d,fn:y}of a){const v=y(u);if(v)return r[f]=`["${d}",${o(v)}]`,f}let l="";if(dr(u))l=ve(u);else{const d=fi(u);switch(d){case"Number":case"String":case"Boolean":l=`["Object",${ve(u)}]`;break;case"BigInt":l=`["BigInt",${u}]`;break;case"Date":l=`["Date","${!isNaN(u.getDate())?u.toISOString():""}"]`;break;case"RegExp":const{source:v,flags:w}=u;l=w?`["RegExp",${J(v)},"${w}"]`:`["RegExp",${J(v)}]`;break;case"Array":l="[";for(let h=0;h<u.length;h+=1)h>0&&(l+=","),h in u?(i.push(`[${h}]`),l+=o(u[h]),i.pop()):l+=ha;l+="]";break;case"Set":l='["Set"';for(const h of u)l+=`,${o(h)}`;l+="]";break;case"Map":l='["Map"';for(const[h,b]of u)i.push(`.get(${dr(h)?ve(h):"..."})`),l+=`,${o(h)},${o(b)}`,i.pop();l+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const b=yr(u.buffer);l='["'+d+'","'+b+'"]';break}case"ArrayBuffer":{l=`["ArrayBuffer","${yr(u)}"]`;break}default:if(!li(u))throw new he("Cannot stringify arbitrary non-POJOs",i);if(hi(u).length>0)throw new he("Cannot stringify POJOs with symbolic keys",i);if(Object.getPrototypeOf(u)===null){l='["null"';for(const h in u)i.push(hr(h)),l+=`,${J(h)},${o(u[h])}`,i.pop();l+="]"}else{l="{";let h=!1;for(const b in u)h&&(l+=","),h=!0,i.push(hr(b)),l+=`${J(b)}:${o(u[b])}`,i.pop();l+="}"}}}return r[f]=l,f}const c=o(t);return c<0?`${c}`:`[${r.join(",")}]`}function ve(t){const e=typeof t;return e==="string"?J(t):t instanceof String?J(t.toString()):t===void 0?Zt.toString():t===0&&1/t<0?Qt.toString():e==="bigint"?`["BigInt","${t}"]`:String(t)}function mi(t){return Qa()?(ei(t),!0):!1}const ga=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Po=t=>t!=null,bi=Object.prototype.toString,wi=t=>bi.call(t)==="[object Object]",ce=()=>{},jo=_i();function _i(){var t,e;return ga&&((t=window?.navigator)==null?void 0:t.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((e=window?.navigator)==null?void 0:e.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function Si(...t){if(t.length!==1)return ti(...t);const e=t[0];return typeof e=="function"?ca(ri(()=>({get:e,set:ce}))):Jt(e)}function Ai(t,e){function r(...n){return new Promise((a,i)=>{Promise.resolve(t(()=>e.apply(this,n),{fn:e,thisArg:this,args:n})).then(a).catch(i)})}return r}const ma=t=>t();function Oi(t,e={}){let r,n,a=ce;const i=c=>{clearTimeout(c),a(),a=ce};let s;return c=>{const u=j(t),f=j(e.maxWait);return r&&i(r),u<=0||f!==void 0&&f<=0?(n&&(i(n),n=void 0),Promise.resolve(c())):new Promise((l,d)=>{a=e.rejectOnCancel?d:l,s=c,f&&!n&&(n=setTimeout(()=>{r&&i(r),n=void 0,l(s())},f)),r=setTimeout(()=>{n&&i(n),n=void 0,l(c())},u)})}}function Ei(t=ma,e={}){const{initialState:r="active"}=e,n=Si(r==="active");function a(){n.value=!1}function i(){n.value=!0}const s=(...o)=>{n.value&&t(...o)};return{isActive:ca(n),pause:a,resume:i,eventFilter:s}}function pr(t,e=!1,r="Timeout"){return new Promise((n,a)=>{setTimeout(e?()=>a(r):n,t)})}function pe(t){return Array.isArray(t)?t:[t]}function Ii(t){return ni()}function ba(t,e,r={}){const{eventFilter:n=ma,...a}=r;return ae(t,Ai(n,e),a)}function Ti(t,e,r={}){const{eventFilter:n,initialState:a="active",...i}=r,{eventFilter:s,pause:o,resume:c,isActive:u}=Ei(n,{initialState:a});return{stop:ba(t,e,{...i,eventFilter:s}),pause:o,resume:c,isActive:u}}function Ri(t,e=!0,r){Ii()?Za(t,r):e?t():ue(t)}function Ht(t,e=!1){function r(l,{flush:d="sync",deep:y=!1,timeout:v,throwOnTimeout:w}={}){let h=null;const m=[new Promise(g=>{h=ae(t,S=>{l(S)!==e&&(h?h():ue(()=>h?.()),g(S))},{flush:d,deep:y,immediate:!0})})];return v!=null&&m.push(pr(v,w).then(()=>j(t)).finally(()=>h?.())),Promise.race(m)}function n(l,d){if(!la(l))return r(S=>S===l,d);const{flush:y="sync",deep:v=!1,timeout:w,throwOnTimeout:h}=d??{};let b=null;const g=[new Promise(S=>{b=ae([t,l],([E,I])=>{e!==(E===I)&&(b?b():ue(()=>b?.()),S(E))},{flush:y,deep:v,immediate:!0})})];return w!=null&&g.push(pr(w,h).then(()=>j(t)).finally(()=>(b?.(),j(t)))),Promise.race(g)}function a(l){return r(d=>!!d,l)}function i(l){return n(null,l)}function s(l){return n(void 0,l)}function o(l){return r(Number.isNaN,l)}function c(l,d){return r(y=>{const v=Array.from(y);return v.includes(l)||v.includes(j(l))},d)}function u(l){return f(1,l)}function f(l=1,d){let y=-1;return r(()=>(y+=1,y>=l),d)}return Array.isArray(j(t))?{toMatch:r,toContains:c,changed:u,changedTimes:f,get not(){return Ht(t,!e)}}:{toMatch:r,toBe:n,toBeTruthy:a,toBeNull:i,toBeNaN:o,toBeUndefined:s,changed:u,changedTimes:f,get not(){return Ht(t,!e)}}}function Co(t){return Ht(t)}function Do(t,e,r={}){const{debounce:n=0,maxWait:a=void 0,...i}=r;return ba(t,e,{...i,eventFilter:Oi(n,{maxWait:a})})}function xi(t,e,r){return ae(t,e,{...r,immediate:!0})}function No(t,e,r){let n;la(r)?n={evaluating:r}:n={};const{lazy:a=!1,flush:i="pre",evaluating:s=void 0,shallow:o=!0,onError:c=ce}=n,u=Kt(!a),f=o?Kt(e):Jt(e);let l=0;return ai(async d=>{if(!u.value)return;l++;const y=l;let v=!1;s&&Promise.resolve().then(()=>{s.value=!0});try{const w=await t(h=>{d(()=>{s&&(s.value=!1),v||h()})});y===l&&(f.value=w)}catch(w){c(w)}finally{s&&y===l&&(s.value=!1),v=!0}},{flush:i}),a?Xt(()=>(u.value=!0,f.value)):f}const le=ga?window:void 0;function Mi(t){var e;const r=j(t);return(e=r?.$el)!=null?e:r}function gr(...t){const e=[],r=()=>{e.forEach(o=>o()),e.length=0},n=(o,c,u,f)=>(o.addEventListener(c,u,f),()=>o.removeEventListener(c,u,f)),a=Xt(()=>{const o=pe(j(t[0])).filter(c=>c!=null);return o.every(c=>typeof c!="string")?o:void 0}),i=xi(()=>{var o,c;return[(c=(o=a.value)==null?void 0:o.map(u=>Mi(u)))!=null?c:[le].filter(u=>u!=null),pe(j(a.value?t[1]:t[0])),pe(ii(a.value?t[2]:t[1])),j(a.value?t[3]:t[2])]},([o,c,u,f])=>{if(r(),!o?.length||!c?.length||!u?.length)return;const l=wi(f)?{...f}:f;e.push(...o.flatMap(d=>c.flatMap(y=>u.map(v=>n(d,y,v,l)))))},{flush:"post"}),s=()=>{i(),r()};return mi(r),s}const ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},se="__vueuse_ssr_handlers__",qi=Pi();function Pi(){return se in ie||(ie[se]=ie[se]||{}),ie[se]}function ji(t,e){return qi[t]||e}function Ci(t){return t==null?"any":t instanceof Set?"set":t instanceof Map?"map":t instanceof Date?"date":typeof t=="boolean"?"boolean":typeof t=="string"?"string":typeof t=="object"?"object":Number.isNaN(t)?"any":"number"}const Di={boolean:{read:t=>t==="true",write:t=>String(t)},object:{read:t=>JSON.parse(t),write:t=>JSON.stringify(t)},number:{read:t=>Number.parseFloat(t),write:t=>String(t)},any:{read:t=>t,write:t=>String(t)},string:{read:t=>t,write:t=>String(t)},map:{read:t=>new Map(JSON.parse(t)),write:t=>JSON.stringify(Array.from(t.entries()))},set:{read:t=>new Set(JSON.parse(t)),write:t=>JSON.stringify(Array.from(t))},date:{read:t=>new Date(t),write:t=>t.toISOString()}},mr="vueuse-storage";function Ni(t,e,r,n={}){var a;const{flush:i="pre",deep:s=!0,listenToStorageChanges:o=!0,writeDefaults:c=!0,mergeDefaults:u=!1,shallow:f,window:l=le,eventFilter:d,onError:y=O=>{console.error(O)},initOnMounted:v}=n,w=(f?Kt:Jt)(typeof e=="function"?e():e),h=Xt(()=>j(t));if(!r)try{r=ji("getDefaultStorage",()=>{var O;return(O=le)==null?void 0:O.localStorage})()}catch(O){y(O)}if(!r)return w;const b=j(e),m=Ci(b),g=(a=n.serializer)!=null?a:Di[m],{pause:S,resume:E}=Ti(w,()=>T(w.value),{flush:i,deep:s,eventFilter:d});ae(h,()=>U(),{flush:i});let I=!1;const P=O=>{v&&!I||U(O)},Y=O=>{v&&!I||Ja(O)};l&&o&&(r instanceof Storage?gr(l,"storage",P,{passive:!0}):gr(l,mr,Y)),v?Ri(()=>{I=!0,U()}):U();function x(O,M){if(l){const D={key:h.value,oldValue:O,newValue:M,storageArea:r};l.dispatchEvent(r instanceof Storage?new StorageEvent("storage",D):new CustomEvent(mr,{detail:D}))}}function T(O){try{const M=r.getItem(h.value);if(O==null)x(M,null),r.removeItem(h.value);else{const D=g.write(O);M!==D&&(r.setItem(h.value,D),x(M,D))}}catch(M){y(M)}}function Q(O){const M=O?O.newValue:r.getItem(h.value);if(M==null)return c&&b!=null&&r.setItem(h.value,g.write(b)),b;if(!O&&u){const D=g.read(M);return typeof u=="function"?u(D,b):m==="object"&&!Array.isArray(D)?{...b,...D}:D}else return typeof M!="string"?M:g.read(M)}function U(O){if(!(O&&O.storageArea!==r)){if(O&&O.key==null){w.value=b;return}if(!(O&&O.key!==h.value)){S();try{O?.newValue!==g.write(w.value)&&(w.value=Q(O))}catch(M){y(M)}finally{O?ue(E):E()}}}}function Ja(O){U(O.detail)}return w}function V(t,e,r={}){const{window:n=le}=r;return Ni(t,e,n?.localStorage,r)}const z="shodoku.app.config.sync.remote",Fi=V(`${z}.fetch.method`,"GET"),Bi=V(`${z}.fetch.url`,""),$i=V(`${z}.fetch.headers`,[]),Li=V(`${z}.push.method`,"PUT"),Ui=V(`${z}.push.url`,""),ki=V(`${z}.push.headers`,[]),wa=V(`${z}.push.body`,void 0);function Fo(){return oa(async()=>await(await G).count("syncs")>0)}function Bo(){return oa(async()=>await(await G).count("sync.staging.stores")>0)}function _a(t){return typeof t!="object"?typeof t:t===null?"null":t.constructor.name}function er(t,e){return`Expected "${t}" but got "${_a(e)}"`}function tr(t,e,r){return`Expected key "${t}" to be "${e}" but is "${_a(r)}"`}class $ extends Error{name="AssertationError";code="ERR_ASSERTION";actual;constructor(e={}){if(e.message)super(e.message);else{let r;"actual"in e&&(r=`Assertion failed with "${e.actual}"`),super(r||"Assertion failed")}this.actual=e.actual}}function Sa(t){if(typeof t!="string")throw new $({message:er("String",t),actual:t})}function ne(t){if(!Array.isArray(t))throw new $({message:er("Array",t),actual:t})}function Aa(t){if(typeof t!="object"||t==null)throw new $({message:er("Object",t),actual:t})}function rr(t,e){if(!(t in e))throw new $({message:`Expected object to have key "${String(t)}" but none found`,actual:e})}function k(t,e,{optional:r=!1,nullable:n=!1}={}){if(!(r&&!(t in e))&&(rr(t,e),typeof e[t]!="string")){if(n&&e[t]===null||r&&typeof e[t]>"u")return;throw new $({message:tr(String(t),"String",e[t]),actual:e})}}function br(t,e,{optional:r=!1,nullable:n=!1}={}){if(!(r&&!(t in e))&&(rr(t,e),typeof e[t]!="number")){if(n&&e[t]===null||r&&typeof e[t]>"u")return;throw new $({message:tr(String(t),"Number",e[t]),actual:e})}}function fe(t,e,{optional:r=!1,nullable:n=!1}={}){if(!(r&&!(t in e))&&(rr(t,e),!Array.isArray(e[t]))){if(n&&e[t]===null||r&&typeof e[t]>"u")return;throw new $({message:tr(String(t),"Array",e[t]),actual:e})}}function ge(t,e,{optional:r=!1,nullable:n=!1}={}){fe(t,e,{optional:r,nullable:n});const a=e[t];if(a)for(const i of a)Sa(i)}var wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_r={},Sr={},ee,Ar;function R(){if(Ar)return ee;Ar=1;var t=function(e){return e&&e.Math===Math&&e};return ee=t(typeof globalThis=="object"&&globalThis)||t(typeof window=="object"&&window)||t(typeof self=="object"&&self)||t(typeof wr=="object"&&wr)||t(typeof ee=="object"&&ee)||function(){return this}()||Function("return this")(),ee}var me={},be,Or;function K(){return Or||(Or=1,be=function(t){try{return!!t()}catch{return!0}}),be}var we,Er;function W(){if(Er)return we;Er=1;var t=K();return we=!t(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),we}var _e,Ir;function Oa(){if(Ir)return _e;Ir=1;var t=K();return _e=!t(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),_e}var Se,Tr;function nr(){if(Tr)return Se;Tr=1;var t=Oa(),e=Function.prototype.call;return Se=t?e.bind(e):function(){return e.apply(e,arguments)},Se}var Ae={},Rr;function Gi(){if(Rr)return Ae;Rr=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,r=e&&!t.call({1:2},1);return Ae.f=r?function(a){var i=e(this,a);return!!i&&i.enumerable}:t,Ae}var Oe,xr;function Ea(){return xr||(xr=1,Oe=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}}),Oe}var Ee,Mr;function C(){if(Mr)return Ee;Mr=1;var t=Oa(),e=Function.prototype,r=e.call,n=t&&e.bind.bind(r,r);return Ee=t?n:function(a){return function(){return r.apply(a,arguments)}},Ee}var Ie,qr;function ar(){if(qr)return Ie;qr=1;var t=C(),e=t({}.toString),r=t("".slice);return Ie=function(n){return r(e(n),8,-1)},Ie}var Te,Pr;function Ki(){if(Pr)return Te;Pr=1;var t=C(),e=K(),r=ar(),n=Object,a=t("".split);return Te=e(function(){return!n("z").propertyIsEnumerable(0)})?function(i){return r(i)==="String"?a(i,""):n(i)}:n,Te}var Re,jr;function Ia(){return jr||(jr=1,Re=function(t){return t==null}),Re}var xe,Cr;function Ta(){if(Cr)return xe;Cr=1;var t=Ia(),e=TypeError;return xe=function(r){if(t(r))throw new e("Can't call method on "+r);return r},xe}var Me,Dr;function ir(){if(Dr)return Me;Dr=1;var t=Ki(),e=Ta();return Me=function(r){return t(e(r))},Me}var qe,Nr;function B(){if(Nr)return qe;Nr=1;var t=typeof document=="object"&&document.all;return qe=typeof t>"u"&&t!==void 0?function(e){return typeof e=="function"||e===t}:function(e){return typeof e=="function"},qe}var Pe,Fr;function Z(){if(Fr)return Pe;Fr=1;var t=B();return Pe=function(e){return typeof e=="object"?e!==null:t(e)},Pe}var je,Br;function Ra(){if(Br)return je;Br=1;var t=R(),e=B(),r=function(n){return e(n)?n:void 0};return je=function(n,a){return arguments.length<2?r(t[n]):t[n]&&t[n][a]},je}var Ce,$r;function Hi(){if($r)return Ce;$r=1;var t=C();return Ce=t({}.isPrototypeOf),Ce}var De,Lr;function Vi(){if(Lr)return De;Lr=1;var t=R(),e=t.navigator,r=e&&e.userAgent;return De=r?String(r):"",De}var Ne,Ur;function zi(){if(Ur)return Ne;Ur=1;var t=R(),e=Vi(),r=t.process,n=t.Deno,a=r&&r.versions||n&&n.version,i=a&&a.v8,s,o;return i&&(s=i.split("."),o=s[0]>0&&s[0]<4?1:+(s[0]+s[1])),!o&&e&&(s=e.match(/Edge\/(\d+)/),(!s||s[1]>=74)&&(s=e.match(/Chrome\/(\d+)/),s&&(o=+s[1]))),Ne=o,Ne}var Fe,kr;function xa(){if(kr)return Fe;kr=1;var t=zi(),e=K(),r=R(),n=r.String;return Fe=!!Object.getOwnPropertySymbols&&!e(function(){var a=Symbol("symbol detection");return!n(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&t&&t<41}),Fe}var Be,Gr;function Ma(){if(Gr)return Be;Gr=1;var t=xa();return Be=t&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Be}var $e,Kr;function qa(){if(Kr)return $e;Kr=1;var t=Ra(),e=B(),r=Hi(),n=Ma(),a=Object;return $e=n?function(i){return typeof i=="symbol"}:function(i){var s=t("Symbol");return e(s)&&r(s.prototype,a(i))},$e}var Le,Hr;function Wi(){if(Hr)return Le;Hr=1;var t=String;return Le=function(e){try{return t(e)}catch{return"Object"}},Le}var Ue,Vr;function Pa(){if(Vr)return Ue;Vr=1;var t=B(),e=Wi(),r=TypeError;return Ue=function(n){if(t(n))return n;throw new r(e(n)+" is not a function")},Ue}var ke,zr;function Yi(){if(zr)return ke;zr=1;var t=Pa(),e=Ia();return ke=function(r,n){var a=r[n];return e(a)?void 0:t(a)},ke}var Ge,Wr;function Ji(){if(Wr)return Ge;Wr=1;var t=nr(),e=B(),r=Z(),n=TypeError;return Ge=function(a,i){var s,o;if(i==="string"&&e(s=a.toString)&&!r(o=t(s,a))||e(s=a.valueOf)&&!r(o=t(s,a))||i!=="string"&&e(s=a.toString)&&!r(o=t(s,a)))return o;throw new n("Can't convert object to primitive value")},Ge}var Ke={exports:{}},He,Yr;function Xi(){return Yr||(Yr=1,He=!1),He}var Ve,Jr;function sr(){if(Jr)return Ve;Jr=1;var t=R(),e=Object.defineProperty;return Ve=function(r,n){try{e(t,r,{value:n,configurable:!0,writable:!0})}catch{t[r]=n}return n},Ve}var Xr;function or(){if(Xr)return Ke.exports;Xr=1;var t=Xi(),e=R(),r=sr(),n="__core-js_shared__",a=Ke.exports=e[n]||r(n,{});return(a.versions||(a.versions=[])).push({version:"3.44.0",mode:t?"pure":"global",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.44.0/LICENSE",source:"https://github.com/zloirock/core-js"}),Ke.exports}var ze,Zr;function ja(){if(Zr)return ze;Zr=1;var t=or();return ze=function(e,r){return t[e]||(t[e]=r||{})},ze}var We,Qr;function Zi(){if(Qr)return We;Qr=1;var t=Ta(),e=Object;return We=function(r){return e(t(r))},We}var Ye,en;function H(){if(en)return Ye;en=1;var t=C(),e=Zi(),r=t({}.hasOwnProperty);return Ye=Object.hasOwn||function(a,i){return r(e(a),i)},Ye}var Je,tn;function Ca(){if(tn)return Je;tn=1;var t=C(),e=0,r=Math.random(),n=t(1.1.toString);return Je=function(a){return"Symbol("+(a===void 0?"":a)+")_"+n(++e+r,36)},Je}var Xe,rn;function ur(){if(rn)return Xe;rn=1;var t=R(),e=ja(),r=H(),n=Ca(),a=xa(),i=Ma(),s=t.Symbol,o=e("wks"),c=i?s.for||s:s&&s.withoutSetter||n;return Xe=function(u){return r(o,u)||(o[u]=a&&r(s,u)?s[u]:c("Symbol."+u)),o[u]},Xe}var Ze,nn;function Qi(){if(nn)return Ze;nn=1;var t=nr(),e=Z(),r=qa(),n=Yi(),a=Ji(),i=ur(),s=TypeError,o=i("toPrimitive");return Ze=function(c,u){if(!e(c)||r(c))return c;var f=n(c,o),l;if(f){if(u===void 0&&(u="default"),l=t(f,c,u),!e(l)||r(l))return l;throw new s("Can't convert object to primitive value")}return u===void 0&&(u="number"),a(c,u)},Ze}var Qe,an;function Da(){if(an)return Qe;an=1;var t=Qi(),e=qa();return Qe=function(r){var n=t(r,"string");return e(n)?n:n+""},Qe}var et,sn;function es(){if(sn)return et;sn=1;var t=R(),e=Z(),r=t.document,n=e(r)&&e(r.createElement);return et=function(a){return n?r.createElement(a):{}},et}var tt,on;function Na(){if(on)return tt;on=1;var t=W(),e=K(),r=es();return tt=!t&&!e(function(){return Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a!==7}),tt}var un;function Fa(){if(un)return me;un=1;var t=W(),e=nr(),r=Gi(),n=Ea(),a=ir(),i=Da(),s=H(),o=Na(),c=Object.getOwnPropertyDescriptor;return me.f=t?c:function(f,l){if(f=a(f),l=i(l),o)try{return c(f,l)}catch{}if(s(f,l))return n(!e(r.f,f,l),f[l])},me}var rt={},nt,cn;function ts(){if(cn)return nt;cn=1;var t=W(),e=K();return nt=t&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),nt}var at,ln;function Ba(){if(ln)return at;ln=1;var t=Z(),e=String,r=TypeError;return at=function(n){if(t(n))return n;throw new r(e(n)+" is not an object")},at}var fn;function cr(){if(fn)return rt;fn=1;var t=W(),e=Na(),r=ts(),n=Ba(),a=Da(),i=TypeError,s=Object.defineProperty,o=Object.getOwnPropertyDescriptor,c="enumerable",u="configurable",f="writable";return rt.f=t?r?function(d,y,v){if(n(d),y=a(y),n(v),typeof d=="function"&&y==="prototype"&&"value"in v&&f in v&&!v[f]){var w=o(d,y);w&&w[f]&&(d[y]=v.value,v={configurable:u in v?v[u]:w[u],enumerable:c in v?v[c]:w[c],writable:!1})}return s(d,y,v)}:s:function(d,y,v){if(n(d),y=a(y),n(v),e)try{return s(d,y,v)}catch{}if("get"in v||"set"in v)throw new i("Accessors not supported");return"value"in v&&(d[y]=v.value),d},rt}var it,dn;function $a(){if(dn)return it;dn=1;var t=W(),e=cr(),r=Ea();return it=t?function(n,a,i){return e.f(n,a,r(1,i))}:function(n,a,i){return n[a]=i,n},it}var st={exports:{}},ot,hn;function rs(){if(hn)return ot;hn=1;var t=W(),e=H(),r=Function.prototype,n=t&&Object.getOwnPropertyDescriptor,a=e(r,"name"),i=a&&(function(){}).name==="something",s=a&&(!t||t&&n(r,"name").configurable);return ot={EXISTS:a,PROPER:i,CONFIGURABLE:s},ot}var ut,yn;function ns(){if(yn)return ut;yn=1;var t=C(),e=B(),r=or(),n=t(Function.toString);return e(r.inspectSource)||(r.inspectSource=function(a){return n(a)}),ut=r.inspectSource,ut}var ct,vn;function as(){if(vn)return ct;vn=1;var t=R(),e=B(),r=t.WeakMap;return ct=e(r)&&/native code/.test(String(r)),ct}var lt,pn;function is(){if(pn)return lt;pn=1;var t=ja(),e=Ca(),r=t("keys");return lt=function(n){return r[n]||(r[n]=e(n))},lt}var ft,gn;function La(){return gn||(gn=1,ft={}),ft}var dt,mn;function ss(){if(mn)return dt;mn=1;var t=as(),e=R(),r=Z(),n=$a(),a=H(),i=or(),s=is(),o=La(),c="Object already initialized",u=e.TypeError,f=e.WeakMap,l,d,y,v=function(m){return y(m)?d(m):l(m,{})},w=function(m){return function(g){var S;if(!r(g)||(S=d(g)).type!==m)throw new u("Incompatible receiver, "+m+" required");return S}};if(t||i.state){var h=i.state||(i.state=new f);h.get=h.get,h.has=h.has,h.set=h.set,l=function(m,g){if(h.has(m))throw new u(c);return g.facade=m,h.set(m,g),g},d=function(m){return h.get(m)||{}},y=function(m){return h.has(m)}}else{var b=s("state");o[b]=!0,l=function(m,g){if(a(m,b))throw new u(c);return g.facade=m,n(m,b,g),g},d=function(m){return a(m,b)?m[b]:{}},y=function(m){return a(m,b)}}return dt={set:l,get:d,has:y,enforce:v,getterFor:w},dt}var bn;function os(){if(bn)return st.exports;bn=1;var t=C(),e=K(),r=B(),n=H(),a=W(),i=rs().CONFIGURABLE,s=ns(),o=ss(),c=o.enforce,u=o.get,f=String,l=Object.defineProperty,d=t("".slice),y=t("".replace),v=t([].join),w=a&&!e(function(){return l(function(){},"length",{value:8}).length!==8}),h=String(String).split("String"),b=st.exports=function(m,g,S){d(f(g),0,7)==="Symbol("&&(g="["+y(f(g),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),S&&S.getter&&(g="get "+g),S&&S.setter&&(g="set "+g),(!n(m,"name")||i&&m.name!==g)&&(a?l(m,"name",{value:g,configurable:!0}):m.name=g),w&&S&&n(S,"arity")&&m.length!==S.arity&&l(m,"length",{value:S.arity});try{S&&n(S,"constructor")&&S.constructor?a&&l(m,"prototype",{writable:!1}):m.prototype&&(m.prototype=void 0)}catch{}var E=c(m);return n(E,"source")||(E.source=v(h,typeof g=="string"?g:"")),m};return Function.prototype.toString=b(function(){return r(this)&&u(this).source||s(this)},"toString"),st.exports}var ht,wn;function us(){if(wn)return ht;wn=1;var t=B(),e=cr(),r=os(),n=sr();return ht=function(a,i,s,o){o||(o={});var c=o.enumerable,u=o.name!==void 0?o.name:i;if(t(s)&&r(s,u,o),o.global)c?a[i]=s:n(i,s);else{try{o.unsafe?a[i]&&(c=!0):delete a[i]}catch{}c?a[i]=s:e.f(a,i,{value:s,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return a},ht}var yt={},vt,_n;function cs(){if(_n)return vt;_n=1;var t=Math.ceil,e=Math.floor;return vt=Math.trunc||function(n){var a=+n;return(a>0?e:t)(a)},vt}var pt,Sn;function Ua(){if(Sn)return pt;Sn=1;var t=cs();return pt=function(e){var r=+e;return r!==r||r===0?0:t(r)},pt}var gt,An;function ls(){if(An)return gt;An=1;var t=Ua(),e=Math.max,r=Math.min;return gt=function(n,a){var i=t(n);return i<0?e(i+a,0):r(i,a)},gt}var mt,On;function fs(){if(On)return mt;On=1;var t=Ua(),e=Math.min;return mt=function(r){var n=t(r);return n>0?e(n,9007199254740991):0},mt}var bt,En;function ka(){if(En)return bt;En=1;var t=fs();return bt=function(e){return t(e.length)},bt}var wt,In;function ds(){if(In)return wt;In=1;var t=ir(),e=ls(),r=ka(),n=function(a){return function(i,s,o){var c=t(i),u=r(c);if(u===0)return!a&&-1;var f=e(o,u),l;if(a&&s!==s){for(;u>f;)if(l=c[f++],l!==l)return!0}else for(;u>f;f++)if((a||f in c)&&c[f]===s)return a||f||0;return!a&&-1}};return wt={includes:n(!0),indexOf:n(!1)},wt}var _t,Tn;function hs(){if(Tn)return _t;Tn=1;var t=C(),e=H(),r=ir(),n=ds().indexOf,a=La(),i=t([].push);return _t=function(s,o){var c=r(s),u=0,f=[],l;for(l in c)!e(a,l)&&e(c,l)&&i(f,l);for(;o.length>u;)e(c,l=o[u++])&&(~n(f,l)||i(f,l));return f},_t}var St,Rn;function ys(){return Rn||(Rn=1,St=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),St}var xn;function vs(){if(xn)return yt;xn=1;var t=hs(),e=ys(),r=e.concat("length","prototype");return yt.f=Object.getOwnPropertyNames||function(a){return t(a,r)},yt}var At={},Mn;function ps(){return Mn||(Mn=1,At.f=Object.getOwnPropertySymbols),At}var Ot,qn;function gs(){if(qn)return Ot;qn=1;var t=Ra(),e=C(),r=vs(),n=ps(),a=Ba(),i=e([].concat);return Ot=t("Reflect","ownKeys")||function(o){var c=r.f(a(o)),u=n.f;return u?i(c,u(o)):c},Ot}var Et,Pn;function ms(){if(Pn)return Et;Pn=1;var t=H(),e=gs(),r=Fa(),n=cr();return Et=function(a,i,s){for(var o=e(i),c=n.f,u=r.f,f=0;f<o.length;f++){var l=o[f];!t(a,l)&&!(s&&t(s,l))&&c(a,l,u(i,l))}},Et}var It,jn;function bs(){if(jn)return It;jn=1;var t=K(),e=B(),r=/#|\.prototype\./,n=function(c,u){var f=i[a(c)];return f===o?!0:f===s?!1:e(u)?t(u):!!u},a=n.normalize=function(c){return String(c).replace(r,".").toLowerCase()},i=n.data={},s=n.NATIVE="N",o=n.POLYFILL="P";return It=n,It}var Tt,Cn;function Ga(){if(Cn)return Tt;Cn=1;var t=R(),e=Fa().f,r=$a(),n=us(),a=sr(),i=ms(),s=bs();return Tt=function(o,c){var u=o.target,f=o.global,l=o.stat,d,y,v,w,h,b;if(f?y=t:l?y=t[u]||a(u,{}):y=t[u]&&t[u].prototype,y)for(v in c){if(h=c[v],o.dontCallGetSet?(b=e(y,v),w=b&&b.value):w=y[v],d=s(f?v:u+(l?".":"#")+v,o.forced),!d&&w!==void 0){if(typeof h==typeof w)continue;i(h,w)}(o.sham||w&&w.sham)&&r(h,"sham",!0),n(y,v,h,o)}},Tt}var Rt,Dn;function ws(){if(Dn)return Rt;Dn=1;var t=ka();return Rt=function(e,r,n){for(var a=0,i=arguments.length>2?n:t(r),s=new e(i);i>a;)s[a]=r[a++];return s},Rt}var xt,Nn;function Ka(){if(Nn)return xt;Nn=1;var t=Z(),e=String,r=TypeError;return xt=function(n){if(n===void 0||t(n))return n;throw new r(e(n)+" is not an object or undefined")},xt}var Mt,Fn;function _s(){if(Fn)return Mt;Fn=1;var t=TypeError;return Mt=function(e){if(typeof e=="string")return e;throw new t("Argument is not a string")},Mt}var qt,Bn;function Ha(){if(Bn)return qt;Bn=1;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=t+"+/",r=t+"-_",n=function(a){for(var i={},s=0;s<64;s++)i[a.charAt(s)]=s;return i};return qt={i2c:e,c2i:n(e),i2cUrl:r,c2iUrl:n(r)},qt}var Pt,$n;function Va(){if($n)return Pt;$n=1;var t=TypeError;return Pt=function(e){var r=e&&e.alphabet;if(r===void 0||r==="base64"||r==="base64url")return r||"base64";throw new t("Incorrect `alphabet` option")},Pt}var jt,Ln;function Ss(){return Ln||(Ln=1,jt=typeof ArrayBuffer<"u"&&typeof DataView<"u"),jt}var Ct,Un;function As(){if(Un)return Ct;Un=1;var t=C(),e=Pa();return Ct=function(r,n,a){try{return t(e(Object.getOwnPropertyDescriptor(r,n)[a]))}catch{}},Ct}var Dt,kn;function Os(){if(kn)return Dt;kn=1;var t=R(),e=As(),r=ar(),n=t.ArrayBuffer,a=t.TypeError;return Dt=n&&e(n.prototype,"byteLength","get")||function(i){if(r(i)!=="ArrayBuffer")throw new a("ArrayBuffer expected");return i.byteLength},Dt}var Nt,Gn;function Es(){if(Gn)return Nt;Gn=1;var t=R(),e=Ss(),r=Os(),n=t.DataView;return Nt=function(a){if(!e||r(a)!==0)return!1;try{return new n(a),!1}catch{return!0}},Nt}var Ft,Kn;function za(){if(Kn)return Ft;Kn=1;var t=Es(),e=TypeError;return Ft=function(r){if(t(r))throw new e("ArrayBuffer is detached");return r},Ft}var Bt,Hn;function Is(){if(Hn)return Bt;Hn=1;var t=R(),e=C(),r=Ka(),n=_s(),a=H(),i=Ha(),s=Va(),o=za(),c=i.c2i,u=i.c2iUrl,f=t.SyntaxError,l=t.TypeError,d=e("".charAt),y=function(h,b){for(var m=h.length;b<m;b++){var g=d(h,b);if(g!==" "&&g!=="	"&&g!==`
`&&g!=="\f"&&g!=="\r")break}return b},v=function(h,b,m){var g=h.length;g<4&&(h+=g===2?"AA":"A");var S=(b[d(h,0)]<<18)+(b[d(h,1)]<<12)+(b[d(h,2)]<<6)+b[d(h,3)],E=[S>>16&255,S>>8&255,S&255];if(g===2){if(m&&E[1]!==0)throw new f("Extra bits");return[E[0]]}if(g===3){if(m&&E[2]!==0)throw new f("Extra bits");return[E[0],E[1]]}return E},w=function(h,b,m){for(var g=b.length,S=0;S<g;S++)h[m+S]=b[S];return m+g};return Bt=function(h,b,m,g){n(h),r(b);var S=s(b)==="base64"?c:u,E=b?b.lastChunkHandling:void 0;if(E===void 0&&(E="loose"),E!=="loose"&&E!=="strict"&&E!=="stop-before-partial")throw new l("Incorrect `lastChunkHandling` option");m&&o(m.buffer);var I=m||[],P=0,Y=0,x="",T=0;if(g)for(;;){if(T=y(h,T),T===h.length){if(x.length>0){if(E==="stop-before-partial")break;if(E==="loose"){if(x.length===1)throw new f("Malformed padding: exactly one additional character");P=w(I,v(x,S,!1),P)}else throw new f("Missing padding")}Y=h.length;break}var Q=d(h,T);if(++T,Q==="="){if(x.length<2)throw new f("Padding is too early");if(T=y(h,T),x.length===2){if(T===h.length){if(E==="stop-before-partial")break;throw new f("Malformed padding: only one =")}d(h,T)==="="&&(++T,T=y(h,T))}if(T<h.length)throw new f("Unexpected character after padding");P=w(I,v(x,S,E==="strict"),P),Y=h.length;break}if(!a(S,Q))throw new f("Unexpected character");var U=g-P;if(U===1&&x.length===2||U===2&&x.length===3||(x+=Q,x.length===4&&(P=w(I,v(x,S,!1),P),x="",Y=T,P===g)))break}return{bytes:I,read:Y,written:P}},Bt}var Vn;function Ts(){if(Vn)return Sr;Vn=1;var t=Ga(),e=R(),r=ws(),n=Is(),a=e.Uint8Array,i=!a||!a.fromBase64||!function(){try{a.fromBase64("",null)}catch{return!0}}();return a&&t({target:"Uint8Array",stat:!0,forced:i},{fromBase64:function(o){var c=n(o,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return r(a,c.bytes)}}),Sr}var zn;function Rs(){return zn||(zn=1,Ts()),_r}Rs();var Wn={},Yn={},$t,Jn;function xs(){if(Jn)return $t;Jn=1;var t=ur(),e=t("toStringTag"),r={};return r[e]="z",$t=String(r)==="[object z]",$t}var Lt,Xn;function Ms(){if(Xn)return Lt;Xn=1;var t=xs(),e=B(),r=ar(),n=ur(),a=n("toStringTag"),i=Object,s=r(function(){return arguments}())==="Arguments",o=function(c,u){try{return c[u]}catch{}};return Lt=t?r:function(c){var u,f,l;return c===void 0?"Undefined":c===null?"Null":typeof(f=o(u=i(c),a))=="string"?f:s?r(u):(l=r(u))==="Object"&&e(u.callee)?"Arguments":l},Lt}var Ut,Zn;function qs(){if(Zn)return Ut;Zn=1;var t=Ms(),e=TypeError;return Ut=function(r){if(t(r)==="Uint8Array")return r;throw new e("Argument is not an Uint8Array")},Ut}var Qn;function Ps(){if(Qn)return Yn;Qn=1;var t=Ga(),e=R(),r=C(),n=Ka(),a=qs(),i=za(),s=Ha(),o=Va(),c=s.i2c,u=s.i2cUrl,f=r("".charAt),l=e.Uint8Array,d=!l||!l.prototype.toBase64||!function(){try{var y=new l;y.toBase64(null)}catch{return!0}}();return l&&t({target:"Uint8Array",proto:!0,forced:d},{toBase64:function(){var v=a(this),w=arguments.length?n(arguments[0]):void 0,h=o(w)==="base64"?c:u,b=!!w&&!!w.omitPadding;i(this.buffer);for(var m="",g=0,S=v.length,E,I=function(P){return f(h,E>>6*P&63)};g+2<S;g+=3)E=(v[g]<<16)+(v[g+1]<<8)+v[g+2],m+=I(3)+I(2)+I(1)+I(0);return g+2===S?(E=(v[g]<<16)+(v[g+1]<<8),m+=I(3)+I(2)+I(1)+(b?"":"=")):g+1===S&&(E=v[g]<<16,m+=I(3)+I(2)+(b?"":"==")),m}}),Yn}var ea;function js(){return ea||(ea=1,Ps()),Wn}js();const Cs=new RegExp("\\p{Script=Han}","u"),Ds=new RegExp("^\\p{Script=Han}$","u"),Ns=/[\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}\u{2e80}-\u{2fd5}\u{3000}-\u{303f}\u{31f0}-\u{31ff}\u{3220}-\u{3243}\u{3280}-\u{337f}\u{ff5f}-\u{ff9f}\u{ff01}-\u{ff5e}]/u;function $o(t){return Ns.test(t)}function Lo(t){return Cs.test(t)}function Uo(t){return Ds.test(t)}function Fs(t){return new TextDecoder().decode(Uint8Array.fromBase64(t))}function Bs(t){return new TextEncoder().encode(t).toBase64()}const Vt=["bookmarked-words","cards","decks","progress","reviews"],$s="${PLACEHOLDER}";function Ls(t){if(!Vt.includes(t))throw new $({actual:t,message:`Expected "${t}" to be a store name`})}function Us(t,e){fe(t,e);for(const r of e[t]){Aa(r),k("name",r),Ls(r.name),ge("add",r,{optional:!0}),fe("set",r,{optional:!0});for(const n of r.set??[]){if(ne(n),n.length!==2)throw new $({actual:n,message:`Excpected a 2-tuple. Got ${n.length}-tuple`});Sa(n[0]),ne(n[1]);for(const a of n[1]){if(ne(a),a.length!==3)throw new $({actual:n,message:`Excpected a 3-tuple. Got ${a.length}-tuple`});k(0,a),ge(1,a),k(2,a)}}ge("delete",r,{optional:!0})}}function ks(t,e){fe(t,e);for(const r of e[t])ne(r),k(0,r),k(1,r,{nullable:!0})}async function Gs(){const t=Fi.value,e=URL.parse(Bi.value),r=new Headers($i.value);if(!e)throw new Error("Remote sync not set up");e.host==="gist.githubusercontent.com"&&e.searchParams.set("cachebuster",new Date().toISOString());const a=await fetch(e,{method:t,headers:r,mode:"cors"}),i=await a.text();if(!a.ok)throw new Error(`Error ${a.status} fetching sync: ${i}`);if(!i.trim())return[];const s=wa.value,o=JSON.parse(s?Fs(i):i);return ne(o),o.map(c=>(Aa(c),k("hash",c),k("parent",c,{nullable:!0}),k("syncedAt",c),br("dbVersion",c),br("patchVersion",c),Us("stores",c),ks("preferences",c),{...c,syncedAt:new Date(c.syncedAt)}))}async function Ks(t){const e=Li.value,r=URL.parse(Ui.value),n=new Headers(ki.value),a=wa.value;if(!r)throw new Error("Remote sync not set up");let i=JSON.stringify(t);a&&(i=a.replace($s,Bs(i)));const s=await fetch(r,{method:e,headers:n,body:i,mode:"cors"});if(!s.ok)throw new Error(`Error ${s.status} pushing sync: ${await s.text()}`)}const L="shodoku.app.sync.latest",Hs=1;async function Vs(t){const e=JSON.stringify(t),r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function zs(t){const e={...t,parent:localStorage.getItem(L)};return{...e,hash:await Vs(e)}}async function Ws(){const t=await G,e=t.transaction(Vt),r=[];for(const n of Vt){const a=e.objectStore(n),i=await a.getAll();if(i.length===0)continue;const s=i.map(o=>{if(a.autoIncrement&&typeof a.keyPath=="string"){const c=a.keyPath;delete o[c]}return re(o)});r.push({name:n,add:s})}return r.length===0?null:{syncedAt:new Date,dbVersion:t.version,patchVersion:Hs,stores:r,preferences:[]}}async function Ys(){const t=await G;if(await t.count("syncs")===0&&localStorage.getItem(L)&&localStorage.removeItem(L),!localStorage.getItem(L))return Ws();const e=t.transaction(t.objectStoreNames),r=await fa(e.objectStore("sync.staging.stores").iterate(),oi(a=>a.value),si(a=>a.store));if(r.size===0)return null;const n=[];for(const[a,i]of r){const s=[],o=[],c=[];for(const f of i)if(f.op==="add"){const l=e.objectStore(a),d=await l.get(f.key);if(!d)continue;if(l.autoIncrement&&typeof l.keyPath=="string"){const y=l.keyPath;delete d[y]}s.push(re(d))}else f.op==="put"?o.push(re(await e.objectStore(a).get(f.key))):c.push(re(f.key));const u={name:a};s.length>0&&(u.add=s),o.length>0&&(u.put=o),c.length>0&&(u.delete=c),(u.add||u.put||u.delete)&&n.push(u)}return{syncedAt:new Date,dbVersion:t.version,patchVersion:1,stores:n,preferences:[]}}function zt(t,e){if(Array.isArray(t))return t.map(n=>zt(n,e));let r=e;for(const n of t.split("."))r=r[n];return r}function Js(t,e){return t.updatedAt?e.updatedAt?t.updatedAt>e.updatedAt:!0:e.updatedAt?!1:t.createdAt>e.createdAt}function Xs(t,e){return t.fsrs.last_review?e.fsrs.last_review?t.fsrs.last_review>e.fsrs.last_review:!0:!1}function Zs(t,e){return t.log.review>e.log.review}function Qs(t,e){return t.bookmarkedAt>e.bookmarkedAt}function eo(t,e,r){return t==="decks"?Js(e,r):t==="progress"?Xs(e,r):t==="reviews"?Zs(e,r):t==="bookmarked-words"?Qs(e,r):!0}function to(t,e,r){if(!r)return;const n=r.stores.find(({name:i})=>i===t);if(!n?.add)return;const a=n.add.indexOf(e);a!==-1&&n.add.splice(a,1)}function ro(t,e,r){if(!r)return;const n=r.stores.find(({name:i})=>i===t);if(!n)return;let a=n.put;a||(a=[],n.put=a),a.push(e)}function ta(t){return t instanceof DOMException&&t.name==="ConstraintError"}async function no(t,e){const r=await G,n=r.transaction(r.objectStoreNames,"readwrite"),a=localStorage.getItem(L)??null;let i;for(const s of fa(t,ui(({parent:o})=>o!==a))){for(const o of s.stores){const c=n.objectStore(o.name);for(const u of o.add??[]){const f=ye(u),l=c.add(f),d=Xa(l);d.addEventListener("error",y=>{ta(d.error)&&(y.preventDefault(),y.stopPropagation())});try{await l}catch(y){if(ta(y)){const v=await c.get(zt(c.keyPath,f));if(v){const w=re(v);to(o.name,w,e),eo(o.name,v,f)?ro(o.name,w,e):c.put(f)}}else throw y}}for(const u of o.put??[]){const f=ye(u),l=await c.openCursor(zt(c.keyPath,f));l&&l.update(f)}for(const u of o.delete??[]){const f=ye(u);console.log(f),c.delete(f)}}n.objectStore("syncs").add(s),i=s.hash}await n.done,i&&localStorage.setItem(L,i)}async function ko(){const t=await Gs(),e=await Ys();if(await no(t,e),!e)return;const r=await zs(e),a=(await G).transaction(["sync.staging.preferences","sync.staging.stores","syncs"],"readwrite");a.objectStore("sync.staging.stores").clear(),a.objectStore("sync.staging.preferences").clear(),a.objectStore("syncs").add(r),await a.done,localStorage.setItem(L,r.hash),ua.postMessage("sync-enabled"),await Ks([...t,r])}function ao(){return localStorage.getItem(L)!=null}async function Go(){const e=(await G).transaction(["sync.staging.preferences","sync.staging.stores","syncs"],"readwrite");e.objectStore("sync.staging.stores").clear(),e.objectStore("sync.staging.preferences").clear(),e.objectStore("syncs").clear(),await e.done,localStorage.removeItem(L),ua.postMessage("sync-disabled")}async function Ko(t){if(!ao())return;const r=(await G).transaction("sync.staging.stores","readwrite");for(const n of t)r.store.add(n);await r.done}var A=(t=>(t[t.New=0]="New",t[t.Learning=1]="Learning",t[t.Review=2]="Review",t[t.Relearning=3]="Relearning",t))(A||{}),p=(t=>(t[t.Manual=0]="Manual",t[t.Again=1]="Again",t[t.Hard=2]="Hard",t[t.Good=3]="Good",t[t.Easy=4]="Easy",t))(p||{});class _{static card(e){return{...e,state:_.state(e.state),due:_.time(e.due),last_review:e.last_review?_.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){const r=e.charAt(0).toUpperCase(),n=e.slice(1).toLowerCase(),a=p[`${r}${n}`];if(a===void 0)throw new Error(`Invalid rating:[${e}]`);return a}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){const r=e.charAt(0).toUpperCase(),n=e.slice(1).toLowerCase(),a=A[`${r}${n}`];if(a===void 0)throw new Error(`Invalid state:[${e}]`);return a}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){const r=Date.parse(e);if(Number.isNaN(r))throw new Error(`Invalid date:[${e}]`);return new Date(r)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:_.time(e.due),rating:_.rating(e.rating),state:_.state(e.state),review:_.time(e.review)}}}Date.prototype.scheduler=function(t,e){return N(this,t,e)};Date.prototype.diff=function(t,e){return X(this,t,e)};Date.prototype.format=function(){return io(this)};Date.prototype.dueFormat=function(t,e,r){return so(this,t,e,r)};function N(t,e,r){return new Date(r?_.time(t).getTime()+e*24*60*60*1e3:_.time(t).getTime()+e*60*1e3)}function X(t,e,r){if(!t||!e)throw new Error("Invalid date");const n=_.time(t).getTime()-_.time(e).getTime();let a=0;switch(r){case"days":a=Math.floor(n/(24*60*60*1e3));break;case"minutes":a=Math.floor(n/(60*1e3));break}return a}function io(t){const e=_.time(t),r=e.getFullYear(),n=e.getMonth()+1,a=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds();return`${r}-${te(n)}-${te(a)} ${te(i)}:${te(s)}:${te(o)}`}function te(t){return t<10?`0${t}`:`${t}`}const kt=[60,60,24,31,12],Gt=["second","min","hour","day","month","year"];function so(t,e,r,n=Gt){t=_.time(t),e=_.time(e),n.length!==Gt.length&&(n=Gt);let a=t.getTime()-e.getTime(),i=0;for(a/=1e3,i=0;i<kt.length&&!(a<kt[i]);i++)a/=kt[i];return`${Math.floor(a)}${r?n[i]:""}`}const oo=Object.freeze([p.Again,p.Hard,p.Good,p.Easy]),uo=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function co(t,e,r){let n=1;for(const s of uo)n+=s.factor*Math.max(Math.min(t,s.end)-s.start,0);t=Math.min(t,r);let a=Math.max(2,Math.round(t-n));const i=Math.min(Math.round(t+n),r);return t>e&&(a=Math.max(a,e+1)),a=Math.min(a,i),{min_ivl:a,max_ivl:i}}function q(t,e,r){return Math.min(Math.max(t,e),r)}function lo(t,e){const r=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),n=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((n-r)/864e5)}const fo=t=>{const e=t.slice(-1),r=parseInt(t.slice(0,-1),10);if(Number.isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${t}`);switch(e){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${t}, expected m/h/d`)}},ho=(t,e,r)=>{const n=e===A.Relearning||e===A.Review?t.relearning_steps:t.learning_steps,a=n.length;if(a===0||r>=a)return{};const i=n[0],s=fo,o=()=>s(i),c=()=>{if(a===1)return Math.round(s(i)*1.5);const y=n[1];return Math.round((s(i)+s(y))/2)},u=y=>y<0||y>=a?null:n[y],f=y=>s(y),l={},d=u(Math.max(0,r));if(e===A.Review)return l[p.Again]={scheduled_minutes:s(d),next_step:0},l;{l[p.Again]={scheduled_minutes:o(),next_step:0},l[p.Hard]={scheduled_minutes:c(),next_step:r};const y=u(r+1);if(y){const v=f(y);v&&(l[p.Good]={scheduled_minutes:Math.round(v),next_step:r+1})}}return l};function yo(){const t=this.review_time.getTime(),e=this.current.reps,r=this.current.difficulty*this.current.stability;return`${t}_${e}_${r}`}var de=(t=>(t.SCHEDULER="Scheduler",t.LEARNING_STEPS="LearningSteps",t.SEED="Seed",t))(de||{});class Wa{last;current;review_time;next=new Map;algorithm;strategies;elapsed_days=0;constructor(e,r,n,a){this.algorithm=n,this.last=_.card(e),this.current=_.card(e),this.review_time=_.time(r),this.strategies=a,this.init()}checkGrade(e){if(!Number.isFinite(e)||e<0||e>4)throw new Error(`Invalid grade "${e}",expected 1-4`)}init(){const{state:e,last_review:r}=this.current;let n=0;e!==A.New&&r&&(n=lo(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=n,this.current.elapsed_days=n,this.current.reps+=1;let a=yo;if(this.strategies){const i=this.strategies.get(de.SEED);i&&(a=i)}this.algorithm.seed=a.call(this)}preview(){return{[p.Again]:this.review(p.Again),[p.Hard]:this.review(p.Hard),[p.Good]:this.review(p.Good),[p.Easy]:this.review(p.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const e of oo)yield this.review(e)}review(e){const{state:r}=this.last;let n;switch(this.checkGrade(e),r){case A.New:n=this.newState(e);break;case A.Learning:case A.Relearning:n=this.learningState(e);break;case A.Review:n=this.reviewState(e);break}return n}buildLog(e){const{last_review:r,due:n,elapsed_days:a}=this.last;return{rating:e,state:this.current.state,due:r||n,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:a,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class vo{c;s0;s1;s2;constructor(e){const r=po();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),e==null&&(e=Date.now()),this.s0-=r(e),this.s0<0&&(this.s0+=1),this.s1-=r(e),this.s1<0&&(this.s1+=1),this.s2-=r(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.c=e|0,this.s2=e-this.c,this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function po(){let t=4022871197;return function(r){r=String(r);for(let n=0;n<r.length;n++){t+=r.charCodeAt(n);let a=.02519603282416938*t;t=a>>>0,a-=t,a*=t,t=a>>>0,a-=t,t+=a*4294967296}return(t>>>0)*23283064365386963e-26}}function go(t){const e=new vo(t),r=()=>e.next();return r.int32=()=>e.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>e.state,r.importState=n=>(e.state=n,r),r}const mo=.9,bo=36500,wo=!1,_o=!0,So=Object.freeze(["1m","10m"]),Ao=Object.freeze(["10m"]),F=.001,oe=100,ra=.5,Oo=.1542,na=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,Oo]),Eo=2,Io=t=>[[F,oe],[F,oe],[F,oe],[F,oe],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,t],[0,t],[0,.8],[.1,.8]],lr=(t,e)=>{let r=Eo;if(Math.max(0,e)>1){const a=-(Math.log(t[11])+Math.log(Math.pow(2,t[13])-1)+t[14]*.3)/e;r=q(+a.toFixed(8),.01,2)}return Io(r).map(([a,i],s)=>q(t[s],a,i))},fr=t=>{if(t===void 0)return[...na];switch(t.length){case 21:return[...t];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...t,0,ra];case 17:{const e=[...t];return e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),e.concat([0,0,0,ra])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...na]}},aa=t=>{const e=Array.isArray(t?.learning_steps)?t.learning_steps:So,r=Array.isArray(t?.relearning_steps)?t.relearning_steps:Ao,n=lr(fr(t?.w),r.length);return{request_retention:t?.request_retention||mo,maximum_interval:t?.maximum_interval||bo,w:n,enable_fuzz:t?.enable_fuzz??wo,enable_short_term:t?.enable_short_term??_o,learning_steps:e,relearning_steps:r}};function Wt(t,e){return{due:t?_.time(t):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:A.New,last_review:void 0}}const Ya=t=>{const e=typeof t=="number"?-t:-t[20],r=Math.exp(Math.pow(e,-1)*Math.log(.9))-1;return{decay:e,factor:+r.toFixed(8)}};function Yt(t,e,r){const{decay:n,factor:a}=Ya(t);return+Math.pow(1+a*e/r,n).toFixed(8)}class To{param;intervalModifier;_seed;constructor(e){this.param=new Proxy(aa(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=Yt.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:n}=Ya(this.param.w);return+((Math.pow(e,1/r)-1)/n).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){const e=this;return{set:function(r,n,a){return n==="request_retention"&&Number.isFinite(a)?e.intervalModifier=e.calculate_interval_modifier(Number(a)):n==="w"&&(a=lr(fr(a),r.relearning_steps.length),e.forgetting_curve=Yt.bind(this,a),e.intervalModifier=e.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,n,a),!0}}}update_parameters(e){const r=aa(e);for(const n in r){const a=n;this.param[a]=r[a]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return+(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(e,r){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);const a=go(this._seed)(),{min_ivl:i,max_ivl:s}=co(e,r,this.param.maximum_interval);return Math.floor(a*(s-i+1)+i)}next_interval(e,r){const n=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(n,r)}linear_damping(e,r){return+(e*(10-r)/9).toFixed(8)}next_difficulty(e,r){const n=-this.param.w[6]*(r-3),a=e+this.linear_damping(n,e);return q(this.mean_reversion(this.init_difficulty(p.Easy),a),1,10)}mean_reversion(e,r){return+(this.param.w[7]*e+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(e,r,n,a){const i=p.Hard===a?this.param.w[15]:1,s=p.Easy===a?this.param.w[16]:1;return+q(r*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(r,-this.param.w[9])*(Math.exp((1-n)*this.param.w[10])-1)*i*s),F,36500).toFixed(8)}next_forget_stability(e,r,n){return+q(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-n)*this.param.w[14]),F,36500).toFixed(8)}next_short_term_stability(e,r){const n=Math.pow(e,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),a=r>=3?Math.max(n,1):n;return+q(e*a,F,36500).toFixed(8)}forgetting_curve;next_state(e,r,n){const{difficulty:a,stability:i}=e??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(n<0||n>4)throw new Error(`Invalid grade "${n}"`);if(a===0&&i===0)return{difficulty:q(this.init_difficulty(n),1,10),stability:this.init_stability(n)};if(n===0)return{difficulty:a,stability:i};if(a<1||i<F)throw new Error(`Invalid memory state { difficulty: ${a}, stability: ${i} }`);const s=this.forgetting_curve(r,i),o=this.next_recall_stability(a,i,s,n),c=this.next_forget_stability(a,i,s),u=this.next_short_term_stability(i,n);let f=o;if(n===1){let[d,y]=[0,0];this.param.enable_short_term&&(d=this.param.w[17],y=this.param.w[18]);const v=i/Math.exp(d*y);f=q(+v.toFixed(8),F,c)}return r===0&&this.param.enable_short_term&&(f=u),{difficulty:this.next_difficulty(a,n),stability:f}}}class ia extends Wa{learningStepsStrategy;constructor(e,r,n,a){super(e,r,n,a);let i=ho;if(this.strategies){const s=this.strategies.get(de.LEARNING_STEPS);s&&(i=s)}this.learningStepsStrategy=i}getLearningInfo(e,r){const n=this.algorithm.parameters;e.learning_steps=e.learning_steps||0;const a=this.learningStepsStrategy(n,e.state,this.current.state===A.Learning&&r!==p.Again&&r!==p.Hard?e.learning_steps+1:e.learning_steps),i=Math.max(0,a[r]?.scheduled_minutes??0),s=Math.max(0,a[r]?.next_step??0);return{scheduled_minutes:i,next_steps:s}}applyLearningSteps(e,r,n){const{scheduled_minutes:a,next_steps:i}=this.getLearningInfo(this.current,r);if(a>0&&a<1440)e.learning_steps=i,e.scheduled_days=0,e.state=n,e.due=N(this.review_time,Math.round(a),!1);else if(e.state=A.Review,a>=1440)e.learning_steps=i,e.due=N(this.review_time,Math.round(a),!1),e.scheduled_days=Math.floor(a/1440);else{e.learning_steps=0;const s=this.algorithm.next_interval(e.stability,this.elapsed_days);e.scheduled_days=s,e.due=N(this.review_time,s,!0)}}newState(e){const r=this.next.get(e);if(r)return r;const n=_.card(this.current);n.difficulty=q(this.algorithm.init_difficulty(e),1,10),n.stability=this.algorithm.init_stability(e),this.applyLearningSteps(n,e,A.Learning);const a={card:n,log:this.buildLog(e)};return this.next.set(e,a),a}learningState(e){const r=this.next.get(e);if(r)return r;const{state:n,difficulty:a,stability:i}=this.last,s=_.card(this.current);s.difficulty=this.algorithm.next_difficulty(a,e),s.stability=this.algorithm.next_short_term_stability(i,e),this.applyLearningSteps(s,e,n);const o={card:s,log:this.buildLog(e)};return this.next.set(e,o),o}reviewState(e){const r=this.next.get(e);if(r)return r;const n=this.elapsed_days,{difficulty:a,stability:i}=this.last,s=this.algorithm.forgetting_curve(n,i),o=_.card(this.current),c=_.card(this.current),u=_.card(this.current),f=_.card(this.current);this.next_ds(o,c,u,f,a,i,s),this.next_interval(c,u,f,n),this.next_state(c,u,f),this.applyLearningSteps(o,p.Again,A.Relearning),o.lapses+=1;const l={card:o,log:this.buildLog(p.Again)},d={card:c,log:super.buildLog(p.Hard)},y={card:u,log:super.buildLog(p.Good)},v={card:f,log:super.buildLog(p.Easy)};return this.next.set(p.Again,l),this.next.set(p.Hard,d),this.next.set(p.Good,y),this.next.set(p.Easy,v),this.next.get(e)}next_ds(e,r,n,a,i,s,o){e.difficulty=this.algorithm.next_difficulty(i,p.Again);const c=s/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),u=this.algorithm.next_forget_stability(i,s,o);e.stability=q(+c.toFixed(8),F,u),r.difficulty=this.algorithm.next_difficulty(i,p.Hard),r.stability=this.algorithm.next_recall_stability(i,s,o,p.Hard),n.difficulty=this.algorithm.next_difficulty(i,p.Good),n.stability=this.algorithm.next_recall_stability(i,s,o,p.Good),a.difficulty=this.algorithm.next_difficulty(i,p.Easy),a.stability=this.algorithm.next_recall_stability(i,s,o,p.Easy)}next_interval(e,r,n,a){let i,s;i=this.algorithm.next_interval(e.stability,a),s=this.algorithm.next_interval(r.stability,a),i=Math.min(i,s),s=Math.max(s,i+1);const o=Math.max(this.algorithm.next_interval(n.stability,a),s+1);e.scheduled_days=i,e.due=N(this.review_time,i,!0),r.scheduled_days=s,r.due=N(this.review_time,s,!0),n.scheduled_days=o,n.due=N(this.review_time,o,!0)}next_state(e,r,n){e.state=A.Review,e.learning_steps=0,r.state=A.Review,r.learning_steps=0,n.state=A.Review,n.learning_steps=0}}class sa extends Wa{newState(e){const r=this.next.get(e);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const n=_.card(this.current),a=_.card(this.current),i=_.card(this.current),s=_.card(this.current);return this.init_ds(n,a,i,s),this.next_interval(n,a,i,s,0),this.next_state(n,a,i,s),this.update_next(n,a,i,s),this.next.get(e)}init_ds(e,r,n,a){e.difficulty=q(this.algorithm.init_difficulty(p.Again),1,10),e.stability=this.algorithm.init_stability(p.Again),r.difficulty=q(this.algorithm.init_difficulty(p.Hard),1,10),r.stability=this.algorithm.init_stability(p.Hard),n.difficulty=q(this.algorithm.init_difficulty(p.Good),1,10),n.stability=this.algorithm.init_stability(p.Good),a.difficulty=q(this.algorithm.init_difficulty(p.Easy),1,10),a.stability=this.algorithm.init_stability(p.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){const r=this.next.get(e);if(r)return r;const n=this.elapsed_days,{difficulty:a,stability:i}=this.last,s=this.algorithm.forgetting_curve(n,i),o=_.card(this.current),c=_.card(this.current),u=_.card(this.current),f=_.card(this.current);return this.next_ds(o,c,u,f,a,i,s),this.next_interval(o,c,u,f,n),this.next_state(o,c,u,f),o.lapses+=1,this.update_next(o,c,u,f),this.next.get(e)}next_ds(e,r,n,a,i,s,o){e.difficulty=this.algorithm.next_difficulty(i,p.Again);const c=this.algorithm.next_forget_stability(i,s,o);e.stability=q(s,F,c),r.difficulty=this.algorithm.next_difficulty(i,p.Hard),r.stability=this.algorithm.next_recall_stability(i,s,o,p.Hard),n.difficulty=this.algorithm.next_difficulty(i,p.Good),n.stability=this.algorithm.next_recall_stability(i,s,o,p.Good),a.difficulty=this.algorithm.next_difficulty(i,p.Easy),a.stability=this.algorithm.next_recall_stability(i,s,o,p.Easy)}next_interval(e,r,n,a,i){let s,o,c,u;s=this.algorithm.next_interval(e.stability,i),o=this.algorithm.next_interval(r.stability,i),c=this.algorithm.next_interval(n.stability,i),u=this.algorithm.next_interval(a.stability,i),s=Math.min(s,o),o=Math.max(o,s+1),c=Math.max(c,o+1),u=Math.max(u,c+1),e.scheduled_days=s,e.due=N(this.review_time,s,!0),r.scheduled_days=o,r.due=N(this.review_time,o,!0),n.scheduled_days=c,n.due=N(this.review_time,c,!0),a.scheduled_days=u,a.due=N(this.review_time,u,!0)}next_state(e,r,n,a){e.state=A.Review,e.learning_steps=0,r.state=A.Review,r.learning_steps=0,n.state=A.Review,n.learning_steps=0,a.state=A.Review,a.learning_steps=0}update_next(e,r,n,a){const i={card:e,log:this.buildLog(p.Again)},s={card:r,log:super.buildLog(p.Hard)},o={card:n,log:super.buildLog(p.Good)},c={card:a,log:super.buildLog(p.Easy)};this.next.set(p.Again,i),this.next.set(p.Hard,s),this.next.set(p.Good,o),this.next.set(p.Easy,c)}}class Ro{fsrs;constructor(e){this.fsrs=e}replay(e,r,n){return this.fsrs.next(e,r,n)}handleManualRating(e,r,n,a,i,s,o){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let c,u;if(r===A.New)c={rating:p.Manual,state:r,due:o??n,stability:e.stability,difficulty:e.difficulty,elapsed_days:a,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:n},u=Wt(n),u.last_review=n;else{if(typeof o>"u")throw new Error("reschedule: due is required for manual rating");const f=X(o,n,"days");c={rating:p.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:a,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:n},u={...e,state:r,due:o,last_review:n,stability:i||e.stability,difficulty:s||e.difficulty,elapsed_days:a,scheduled_days:f,reps:e.reps+1}}return{card:u,log:c}}reschedule(e,r){const n=[];let a=Wt(e.due);for(const i of r){let s;if(i.review=_.time(i.review),i.rating===p.Manual){let o=0;a.state!==A.New&&a.last_review&&(o=X(i.review,a.last_review,"days")),s=this.handleManualRating(a,i.state,i.review,o,i.stability,i.difficulty,i.due?_.time(i.due):void 0)}else s=this.replay(a,i.review,i.rating);n.push(s),a=s.card}return n}calculateManualRecord(e,r,n,a){if(!n)return null;const{card:i,log:s}=n,o=_.card(e);return o.due.getTime()===i.due.getTime()?null:(o.scheduled_days=X(i.due,o.due,"days"),this.handleManualRating(o,i.state,_.time(r),s.elapsed_days,a?i.stability:void 0,a?i.difficulty:void 0,i.due))}}class xo extends To{strategyHandler=new Map;Scheduler;constructor(e){super(e);const{enable_short_term:r}=this.parameters;this.Scheduler=r?ia:sa}params_handler_proxy(){const e=this;return{set:function(r,n,a){return n==="request_retention"&&Number.isFinite(a)?e.intervalModifier=e.calculate_interval_modifier(Number(a)):n==="enable_short_term"?e.Scheduler=a===!0?ia:sa:n==="w"&&(a=lr(fr(a),r.relearning_steps.length),e.forgetting_curve=Yt.bind(this,a),e.intervalModifier=e.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,n,a),!0}}}useStrategy(e,r){return this.strategyHandler.set(e,r),this}clearStrategy(e){return e?this.strategyHandler.delete(e):this.strategyHandler.clear(),this}getScheduler(e,r){const a=this.strategyHandler.get(de.SCHEDULER)||this.Scheduler;return new a(e,r,this,this.strategyHandler)}repeat(e,r,n){const i=this.getScheduler(e,r).preview();return n&&typeof n=="function"?n(i):i}next(e,r,n,a){const i=this.getScheduler(e,r),s=_.rating(n);if(s===p.Manual)throw new Error("Cannot review a manual rating");const o=i.review(s);return a&&typeof a=="function"?a(o):o}get_retrievability(e,r,n=!0){const a=_.card(e);r=r?_.time(r):new Date;const i=a.state!==A.New?Math.max(X(r,a.last_review,"days"),0):0,s=a.state!==A.New?this.forgetting_curve(i,+a.stability.toFixed(8)):0;return n?`${(s*100).toFixed(2)}%`:s}rollback(e,r,n){const a=_.card(e),i=_.review_log(r);if(i.rating===p.Manual)throw new Error("Cannot rollback a manual rating");let s,o,c;switch(i.state){case A.New:s=i.due,o=void 0,c=0;break;case A.Learning:case A.Relearning:case A.Review:s=i.review,o=i.due,c=a.lapses-(i.rating===p.Again&&i.state===A.Review?1:0);break}const u={...a,due:s,stability:i.stability,difficulty:i.difficulty,elapsed_days:i.last_elapsed_days,scheduled_days:i.scheduled_days,reps:Math.max(0,a.reps-1),lapses:Math.max(0,c),learning_steps:i.learning_steps,state:i.state,last_review:o};return n&&typeof n=="function"?n(u):u}forget(e,r,n=!1,a){const i=_.card(e);r=_.time(r);const s=i.state===A.New?0:X(r,i.due,"days"),o={rating:p.Manual,state:i.state,due:i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:0,last_elapsed_days:i.elapsed_days,scheduled_days:s,learning_steps:i.learning_steps,review:r},u={card:{...i,due:r,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:n?0:i.reps,lapses:n?0:i.lapses,learning_steps:0,state:A.New,last_review:i.last_review},log:o};return a&&typeof a=="function"?a(u):u}reschedule(e,r=[],n={}){const{recordLogHandler:a,reviewsOrderBy:i,skipManual:s=!0,now:o=new Date,update_memory_state:c=!1}=n;i&&typeof i=="function"&&r.sort(i),s&&(r=r.filter(v=>v.rating!==p.Manual));const u=new Ro(this),f=u.reschedule(n.first_card||Wt(),r),l=f.length,d=_.card(e),y=u.calculateManualRecord(d,o,l?f[l-1]:void 0,c);return a&&typeof a=="function"?{collections:f.map(a),reschedule_item:y?a(y):null}:{collections:f,reschedule_item:y}}}const Ho=t=>new xo(t||{});export{Bi as A,Fi as B,$i as C,Fo as D,Go as E,xo as F,Bo as G,ko as H,V as I,$s as P,p as R,A as S,Ko as a,Wt as b,No as c,$o as d,ce as e,ga as f,aa as g,Lo as h,Uo as i,mi as j,Si as k,jo as l,oi as m,Po as n,xi as o,fa as p,wi as q,Cs as r,Ho as s,pe as t,Co as u,Ui as v,Do as w,Li as x,ki as y,wa as z};
