import{d as C,M as R,N as U,i as D,u as f,L as P,w as $,I as z,O as x,e as y,P as G,o as i,_ as V,Q as h,c as S,a as k,R as ee,b as v,A as B,h as g,t as M,S as O,T as Q,F as _,m as N,y as te,g as I,l as L,v as ae,s as K,G as le,U as oe}from"./index-DRXBIH1a.js";import{j as se,n as ie,g as re,b as ne}from"./decks-CfOZF5PQ.js";import{d as H,u as ce}from"./db-CSQ4qy-K.js";import{e as de,r as q,a as ue,c as J,d as pe,b as me,f as fe}from"./decks-C8jGcbQf.js";import{p as Y,m as ke}from"./index-BOsLoRk8.js";import{i as ye}from"./text-p0dDw4FE.js";import{A as W,a as ve}from"./AppNumberInput-B0vXfwrw.js";function ge(c,t){return async e=>{let a=t;for await(const n of e)a=c(a,n);return a}}function be(){return c=>[...c]}function De(c){return function*(t){for(const e of t)yield c(e)}}function $e(c){return function*(t){for(const e of t)c(e)&&(yield e)}}function we(){return function*(c){const t=new Set;for(const e of c)t.has(e)||(yield e,t.add(e))}}const Ce=["id"],Ae=C({__name:"AppInput",props:R({label:{},inline:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const t=U(c,"modelValue"),e=P();return(a,n)=>(i(),D(W,{control:f(e),label:a.label,inline:a.inline},{default:$(()=>[z(y("input",G({id:f(e),"onUpdate:modelValue":n[0]||(n[0]=l=>t.value=l)},a.$attrs,{class:"input"}),null,16,Ce),[[x,t.value]])]),_:1},8,["control","label","inline"]))}}),_e=V(Ae,[["__scopeId","data-v-4a8ba3a8"]]),Be=["id"],Ie=C({__name:"AppTextArea",props:R({label:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const t=U(c,"modelValue"),e=P();return(a,n)=>(i(),D(W,{control:f(e),label:a.label},{default:$(()=>[z(y("textarea",G({id:f(e),"onUpdate:modelValue":n[0]||(n[0]=l=>t.value=l)},a.$attrs,{class:"textarea"}),null,16,Be),[[h,t.value]])]),_:1},8,["control","label"]))}}),Ve=V(Ie,[["__scopeId","data-v-948e7413"]]),Te={class:"form-body"},je={class:"buttons"},Se=C({__name:"CustomDeckForm",props:R({labelFieldDisabled:{type:Boolean,default:!1},priorityFieldDisabled:{type:Boolean,default:!1},confirmIcon:{},confirmLabel:{default:"confirm"}},{label:{},labelModifiers:{},priority:{},priorityModifiers:{},cards:{},cardsModifiers:{}}),emits:R(["submit","reset"],["update:label","update:priority","update:cards"]),setup(c){const t=U(c,"label"),e=U(c,"priority"),a=U(c,"cards"),n=S({get(){return a.value?a.value.map(l=>String.fromCodePoint(l)).join(""):""},set(l){a.value=Y(l,$e(ye),De(o=>o.codePointAt(0)),we(),be())}});return(l,o)=>(i(),k("form",{onSubmit:o[3]||(o[3]=ee(s=>l.$emit("submit"),["prevent"])),onReset:o[4]||(o[4]=s=>l.$emit("reset"))},[y("div",Te,[v(_e,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value=s),class:"name-field",label:"Deck Name",disabled:l.labelFieldDisabled,required:""},null,8,["modelValue","disabled"]),v(ve,{modelValue:e.value,"onUpdate:modelValue":o[1]||(o[1]=s=>e.value=s),class:"priority-field",label:"Priority",min:"1",disabled:l.priorityFieldDisabled,required:""},null,8,["modelValue","disabled"]),v(Ve,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value=s),class:"kanji-field",label:"Kanji",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",placeholder:"Type or paste in your kanji here: 日月火時漢字読書"},null,8,["modelValue"])]),y("div",je,[v(B,{type:"reset"},{default:$(()=>o[5]||(o[5]=[g("Cancel")])),_:1}),v(B,{type:"submit","prefix-icon":l.confirmIcon,filled:""},{default:$(()=>[g(M(l.confirmLabel),1)]),_:1},8,["prefix-icon"])])],32))}}),X=V(Se,[["__scopeId","data-v-3dc0e575"]]),Me=C({__name:"CustomDeckEdit",props:{deck:{}},emits:["cancel","success"],setup(c,{emit:t}){const e=c,a=t,n=O({label:e.deck.label,priority:e.deck.priority,cards:e.deck.cards});async function l(){await de({...e.deck,label:n.label,priority:n.priority,cards:Q(n.cards)}),a("success")}return(o,s)=>(i(),D(X,{cards:n.cards,"onUpdate:cards":s[0]||(s[0]=d=>n.cards=d),label:n.label,"onUpdate:label":s[1]||(s[1]=d=>n.label=d),priority:n.priority,"onUpdate:priority":s[2]||(s[2]=d=>n.priority=d),"confirm-label":"Update","label-field-disabled":e.deck.category!=="custom","priority-field-disabled":e.deck.category!=="custom",onSubmit:l,onReset:s[3]||(s[3]=d=>o.$emit("cancel"))},null,8,["cards","label","priority","label-field-disabled","priority-field-disabled"]))}}),Ne=C({__name:"DeckActivateButton",props:{isActive:{type:Boolean,default:!1},toggling:{type:Boolean,default:!1}},emits:["activate","deactivate"],setup(c,{emit:t}){const e=c,a=t;function n(){e.isActive?a("deactivate"):a("activate")}return(l,o)=>(i(),D(B,{class:"activate-button",filled:l.isActive,disabled:l.toggling,"prefix-icon":l.toggling?void 0:l.isActive?"checkmark":"plus","aria-pressed":l.isActive,onClick:n},{default:$(()=>[l.toggling?(i(),k(_,{key:0},[o[0]||(o[0]=y("span",{class:"loading-icon"},"時",-1)),o[1]||(o[1]=g(" Loading "))],64)):l.isActive?(i(),k(_,{key:1},[g("Active")],64)):(i(),k(_,{key:2},[g("Add")],64))]),_:1},8,["filled","disabled","prefix-icon","aria-pressed"]))}}),Z=V(Ne,[["__scopeId","data-v-d238a2ea"]]),Fe=["aria-labelledby"],Ue={class:"controls"},Re=["id"],Le={class:"kanji-list"},Pe=C({__name:"DeckBrowserItem",props:{deck:{},template:{},category:{},togglingCategory:{type:Boolean,default:!1}},setup(c){const t=c,e=N(!1),a=N(!1),n=P(),l=N(null),o=S(()=>{var r;return(r=t.deck)==null?void 0:r.active});async function s(){var r;e.value=!0;try{t.deck?await ue(t.deck.name):await J({name:t.template.name,label:t.template.label,priority:t.template.priority,category:t.category,cards:((r=l.value)==null?void 0:r.map(u=>u.codePointAt(0)??NaN))??[]})}catch(u){console.error(u)}finally{e.value=!1}}async function d(){if(t.deck){e.value=!0;try{await pe(t.deck.name)}catch(r){console.error(r)}finally{e.value=!1}}}return te(()=>{var r;return(r=t.template)==null?void 0:r.content},async r=>{if(!r){l.value=null;return}const T=await(await fetch(r)).text();l.value=T.split(`
`).filter(j=>j)},{immediate:!0}),(r,u)=>{var j,p,m,b,A;const T=ae("RouterLink");return a.value&&r.deck?(i(),D(Me,{key:0,deck:r.deck,onCancel:u[0]||(u[0]=w=>a.value=!1),onSuccess:u[1]||(u[1]=w=>a.value=!1)},null,8,["deck"])):(i(),k("article",{key:1,"aria-labelledby":f(n)},[y("div",Ue,[y("strong",{id:f(n)},M(((j=r.deck)==null?void 0:j.label)??((p=r.template)==null?void 0:p.label)),9,Re),v(Z,{toggling:e.value||r.togglingCategory,"is-active":o.value,onActivate:s,onDeactivate:d},null,8,["toggling","is-active"]),(m=r.deck)!=null&&m.active||((b=r.deck)==null?void 0:b.category)==="custom"?(i(),D(B,{key:0,class:"edit-button",onClick:u[2]||(u[2]=w=>a.value=!0)},{default:$(()=>u[5]||(u[5]=[g(" Edit ")])),_:1})):r.deck&&!r.deck.active&&r.deck.category!=="custom"?(i(),D(B,{key:1,class:"edit-button",onClick:u[3]||(u[3]=w=>f(q)(r.deck.name))},{default:$(()=>u[6]||(u[6]=[g(" Reset ")])),_:1})):I("",!0),((A=r.deck)==null?void 0:A.category)==="custom"?(i(),D(B,{key:2,class:"delete-button",onClick:u[4]||(u[4]=w=>f(q)(r.deck.name))},{default:$(()=>u[7]||(u[7]=[g(" Delete ")])),_:1})):I("",!0)]),y("ol",Le,[r.deck?(i(!0),k(_,{key:0},L(r.deck.cards,w=>(i(),k("li",{key:w,class:"kanji"},[v(T,{to:f(K)(String.fromCodePoint(w))},{default:$(()=>[g(M(String.fromCodePoint(w)),1)]),_:2},1032,["to"])]))),128)):l.value?(i(!0),k(_,{key:1},L(l.value,w=>(i(),k("li",{key:w,class:"kanji"},[v(T,{to:f(K)(w)},{default:$(()=>[g(M(w),1)]),_:2},1032,["to"])]))),128)):I("",!0)])],8,Fe))}}}),E=V(Pe,[["__scopeId","data-v-d98778d7"]]),Ke=C({__name:"CustomDeckCreate",emits:["cancel","success"],setup(c,{emit:t}){const e=t,a=O({label:"",priority:1,cards:[]});async function n(){const o=await Y((await H).transaction("decks").store.index("category").iterate("custom"),ke(s=>s.value.cards.length),ge((s,d)=>s+d,0));o&&(a.priority=Math.ceil(o/12))}async function l(){const o=await J({category:"custom",label:a.label,priority:a.priority,cards:Q(a.cards)});e("success",o)}return le(()=>{n()}),(o,s)=>(i(),D(X,{cards:a.cards,"onUpdate:cards":s[0]||(s[0]=d=>a.cards=d),label:a.label,"onUpdate:label":s[1]||(s[1]=d=>a.label=d),priority:a.priority,"onUpdate:priority":s[2]||(s[2]=d=>a.priority=d),"confirm-icon":"plus","confirm-label":"Create",onSubmit:l,onReset:s[3]||(s[3]=d=>o.$emit("cancel"))},null,8,["cards","label","priority"]))}}),qe=["aria-labelledby"],Ee={class:"controls"},ze=["id"],Ge={key:2,class:"deck-list"},Oe=C({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(c){const t=c,e=N(!1),a=N(!1),n=P(),{result:l}=ce(S(()=>{const{category:p}=t;return async()=>{const m=new Map,b=(await H).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound([p,0],[p,Number.POSITIVE_INFINITY],!0,!0));for await(const A of b)m.set(A.primaryKey,A.value);return m}})),o=S(()=>{var p;return t.deckTemplates?t.deckTemplates.length:((p=l.value)==null?void 0:p.size)??0}),s=S(()=>{if(!l.value)return 0;let p=0;for(const[,{active:m}]of l.value)m&&(p+=1);return p}),d=N(!1),r=S(()=>t.deckTemplates?s.value>=t.deckTemplates.length:!0);async function u(p){d.value=!0;try{await me(t.category,p)}catch(m){console.error(m)}finally{d.value=!1}}async function T(){d.value=!0;try{await fe(t.category)}catch(p){console.error(p)}finally{d.value=!1}}function j(){a.value=!0,e.value=!1}return(p,m)=>(i(),k("article",{"aria-labelledby":f(n)},[y("div",Ee,[y("strong",{id:f(n),class:"title"},M(p.title),9,ze),p.deckTemplates?(i(),D(Z,{key:0,toggling:d.value,"is-active":r.value,onActivate:m[0]||(m[0]=b=>u(p.deckTemplates)),onDeactivate:T},null,8,["toggling","is-active"])):e.value?I("",!0):(i(),D(B,{key:1,class:"create-custom-button","prefix-icon":"plus",onClick:m[1]||(m[1]=b=>e.value=!0)},{default:$(()=>m[4]||(m[4]=[g(" Create New ")])),_:1}))]),o.value>0?(i(),D(B,{key:0,class:"expand-button","aria-pressed":a.value,onClick:m[2]||(m[2]=b=>a.value=!a.value)},{default:$(()=>[a.value?(i(),k(_,{key:0},[g("Hide ")],64)):(i(),k(_,{key:1},[g("Show ")],64)),g(" ("+M(o.value)+" decks) ",1)]),_:1},8,["aria-pressed"])):I("",!0),e.value?(i(),D(Ke,{key:1,class:"custom-deck-create",onCancel:m[3]||(m[3]=b=>e.value=!1),onSuccess:j})):I("",!0),a.value?(i(),k("ol",Ge,[p.deckTemplates?(i(!0),k(_,{key:0},L(p.deckTemplates,b=>{var A;return i(),k("li",{key:b.name},[v(E,{deck:(A=f(l))==null?void 0:A.get(b.name),template:b,category:p.category,"toggling-category":d.value},null,8,["deck","template","category","toggling-category"])])}),128)):f(l)?(i(!0),k(_,{key:1},L(f(l),([b,A])=>(i(),k("li",{key:b},[v(E,{deck:A},null,8,["deck"])]))),128)):I("",!0)])):I("",!0)],8,qe))}}),F=V(Oe,[["__scopeId","data-v-6735dcda"]]),Qe=C({__name:"DeckBrowserCustom",setup(c){return(t,e)=>(i(),D(F,{title:"Custom",category:"custom"}))}}),He={class:"categories"},Je=C({__name:"DeckBrowser",setup(c){return(t,e)=>(i(),k("ul",He,[y("li",null,[v(F,{title:"JLPT",category:"jlpt","deck-templates":f(se)},null,8,["deck-templates"])]),y("li",null,[v(F,{title:"News Frequency",category:"news","deck-templates":f(ie)},null,8,["deck-templates"])]),y("li",null,[v(F,{title:"Genki",category:"genki","deck-templates":f(re)},null,8,["deck-templates"])]),y("li",null,[v(F,{title:"Basic Kanji Book",category:"basic-kanji","deck-templates":f(ne)},null,8,["deck-templates"])]),y("li",null,[v(Qe)])]))}}),Ye=V(Je,[["__scopeId","data-v-346b37c3"]]),We={class:"article-header"},Xe={class:"actions"},Ze=C({__name:"DeckBrowserView",setup(c){return(t,e)=>(i(),k("article",null,[y("header",We,[e[1]||(e[1]=y("h2",{class:"title"},"Add Decks",-1)),y("div",Xe,[v(B,{to:f(oe),"prefix-icon":"arrow-left"},{default:$(()=>e[0]||(e[0]=[g(" Back to your decks ")])),_:1},8,["to"])])]),v(Ye)]))}}),st=V(Ze,[["__scopeId","data-v-a1e5f41b"]]);export{st as default};
