import{a as V,A as L}from"./AppButton-CAcjDJVM.js";import{d as f,l as I,u as F}from"./db-CvDPecAE.js";import{U as P}from"./index-guFvHVik.js";import{d as _,o as k,i as J,w as h,f as u,_ as b,E as T,n as B,g as D,p as E,C as M,c as p,b as y,u as g,t as j,F as w,h as C,a as v,D as K,e as O,H}from"./index-C9kKT1ht.js";import{a as Q}from"./decks-B3DTvknZ.js";function Y(e){return e!=null}async function N(e,t,a,o,s){const n=await e.get(a);if(n){if(n.decks.includes(s.name))return;n.decks.push(s.name),n.deckPositions.push({deck:s.name,priority:s.priority,order:o}),s.priority===n.position.priority?n.position.order=Math.min(o,n.position.order):s.priority<n.position.priority&&(n.position.priority=s.priority,n.position.order=o),await e.put(n)}else await e.add({id:a,value:String.fromCodePoint(a),types:["kanji-read","kanji-write"],decks:[s.name],position:{priority:s.priority,order:o},deckPositions:[{deck:s.name,priority:s.priority,order:o}]}),await t.add({cardId:a,cardType:"kanji-write",fsrs:P()}),await t.add({cardId:a,cardType:"kanji-read",fsrs:P()})}async function G(e){const t=(await f).transaction(["cards","decks","progress"],"readwrite");await t.objectStore("decks").add(e);const o=t.objectStore("cards"),s=t.objectStore("progress");let n=0;for(const l of e.cards)n+=1,await N(o,s,l,n,e);await t.done,I.postMessage("deck-added")}async function U(e,t){const a=await(await f).getAllKeysFromIndex("decks","category",e),o=await Promise.all(t.filter(({name:r})=>!a.includes(r)).map(async({name:r,label:i,priority:c,content:m})=>{const $=(await(await fetch(m)).text()).split(`
`).map(R=>R.codePointAt(0)).filter(Y);return{name:r,label:i,priority:c,category:e,cards:$}})),s=(await f).transaction(["cards","decks","progress"],"readwrite"),n=s.objectStore("decks"),l=s.objectStore("cards"),d=s.objectStore("progress");for(const r of o){await n.add(r);let i=0;for(const c of r.cards)i+=1,await N(l,d,c,i,r)}await s.done,I.postMessage("deck-category-added")}function q(e,t){const a=e.decks.indexOf(t);a!==-1&&e.decks.splice(a,1);const o=e.deckPositions.findIndex(s=>s.deck===t);if(o!==-1){const[s]=e.deckPositions.splice(o,1);if(s.priority===e.position.priority&&s.order===e.position.order){let n=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY;for(const d of e.deckPositions)d.priority<n&&(n=d.priority,l=d.order);e.position.priority=n,e.position.order=l}}}async function S(e){const t=(await f).transaction(["cards","decks"],"readwrite"),a=t.objectStore("decks"),o=t.objectStore("cards");await a.delete(e);const s=o.index("decks").iterate(IDBKeyRange.only(e));for await(const n of s){const l=n.value;q(n.value,e),n.update(l)}await t.done,I.postMessage("deck-removed")}async function z(e){const t=(await f).transaction(["cards","decks"],"readwrite"),a=await t.objectStore("decks").index("category").getAllKeys(e);for(const o of a)await S(o);await t.done}const W=_({__name:"DeckAddButton",props:{added:{type:Boolean,default:!1}},emits:["add","remove"],setup(e,{emit:t}){const a=e,o=t;function s(){a.added?o("remove"):o("add")}return(n,l)=>(k(),J(L,{"aria-label":n.added?"Remove Deck":"Add Deck",class:"add-button",filled:n.added,onClick:s},{default:h(()=>[u(V,{icon:"plus"})]),_:1},8,["aria-label","filled"]))}}),A=b(W,[["__scopeId","data-v-b7e526f3"]]),X=["aria-labelledby"],Z={class:"controls"},ee=["id"],te={class:"kanji-list"},ae=_({__name:"DeckBrowserItem",props:{deck:{},contentPath:{}},setup(e){const t=e,a=T(),o=B(null);async function s(){if(!o.value)return;const d=o.value.map(r=>r.codePointAt(0)??NaN);try{await G({...t.deck,cards:d})}catch(r){console.error(r)}}const n=Q(()=>t.deck.name),l=D(()=>n.value!=null);return E(()=>t.contentPath,async d=>{const i=await(await fetch(d)).text();o.value=i.split(`
`).filter(c=>c)},{immediate:!0}),(d,r)=>{const i=M("RouterLink");return k(),p("article",{"aria-labelledby":g(a)},[y("div",Z,[y("strong",{id:g(a)},j(d.deck.label),9,ee),u(A,{added:l.value,onAdd:s,onRemove:r[0]||(r[0]=c=>g(S)(d.deck.name))},null,8,["added"])]),y("ol",te,[(k(!0),p(w,null,C(o.value,c=>(k(),p("li",{key:c,class:"kanji"},[u(i,{to:g(K)(c)},{default:h(()=>[v(j(c),1)]),_:2},1032,["to"])]))),128))])],8,X)}}}),se=b(ae,[["__scopeId","data-v-1581c633"]]),ne=["aria-labelledby"],oe={class:"controls"},ie=["id"],re={key:0,class:"deck-list"},ce=_({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(e){const t=e,a=B(!1),o=T(),{value:s}=F(D(()=>{const{category:i}=t;return async()=>(await f).transaction("decks").store.index("category").count(i)})),n=D(()=>(s.value??0)>=t.deckTemplates.length);async function l(){try{await U(t.category,t.deckTemplates)}catch(i){console.error(i)}}async function d(){try{await z(t.category)}catch(i){console.error(i)}}function r({name:i,label:c,priority:m}){return{name:i,label:c,priority:m,category:t.category}}return(i,c)=>(k(),p("article",{"aria-labelledby":g(o)},[y("div",oe,[y("strong",{id:g(o),class:"title"},j(i.title),9,ie),u(A,{added:n.value,onAdd:l,onRemove:d},null,8,["added"])]),u(L,{class:"expand-button","aria-pressed":a.value,onClick:c[0]||(c[0]=m=>a.value=!a.value)},{default:h(()=>[a.value?(k(),p(w,{key:0},[v("Hide ")],64)):(k(),p(w,{key:1},[v("Show ")],64)),v(" ("+j(i.deckTemplates.length)+" decks) ",1)]),_:1},8,["aria-pressed"]),a.value?(k(),p("ol",re,[(k(!0),p(w,null,C(i.deckTemplates,m=>(k(),p("li",{key:m.name},[u(se,{deck:r(m),contentPath:m.content},null,8,["deck","contentPath"])]))),128))])):O("",!0)],8,ne))}}),x=b(ce,[["__scopeId","data-v-2978058b"]]),de={class:"categories"},le=_({__name:"DeckBrowser",setup(e){const t=[{name:"jlpt-n5",label:"JLPT N5",priority:5,content:"/data/kanji-lists/jlpt-n5.csv"},{name:"jlpt-n4",label:"JLPT N4",priority:15,content:"/data/kanji-lists/jlpt-n4.csv"},{name:"jlpt-n3",label:"JLPT N3",priority:30,content:"/data/kanji-lists/jlpt-n3.csv"},{name:"jlpt-n2",label:"JLPT N2",priority:50,content:"/data/kanji-lists/jlpt-n2.csv"},{name:"jlpt-n1",label:"JLPT N1",priority:100,content:"/data/kanji-lists/jlpt-n1.csv"}],a=[{name:"genki-03",label:"Leasson 3",priority:1,content:"/data/kanji-lists/genki-03.csv"},{name:"genki-04",label:"Leasson 4",priority:2,content:"/data/kanji-lists/genki-04.csv"},{name:"genki-05",label:"Leasson 5",priority:3,content:"/data/kanji-lists/genki-05.csv"},{name:"genki-06",label:"Leasson 6",priority:4,content:"/data/kanji-lists/genki-06.csv"},{name:"genki-07",label:"Leasson 7",priority:5,content:"/data/kanji-lists/genki-07.csv"},{name:"genki-08",label:"Leasson 8",priority:6,content:"/data/kanji-lists/genki-08.csv"},{name:"genki-09",label:"Leasson 9",priority:7,content:"/data/kanji-lists/genki-09.csv"},{name:"genki-10",label:"Leasson 10",priority:8,content:"/data/kanji-lists/genki-10.csv"},{name:"genki-11",label:"Leasson 11",priority:9,content:"/data/kanji-lists/genki-11.csv"},{name:"genki-12",label:"Leasson 12",priority:10,content:"/data/kanji-lists/genki-12.csv"},{name:"genki-13",label:"Leasson 13",priority:11,content:"/data/kanji-lists/genki-13.csv"},{name:"genki-14",label:"Leasson 14",priority:12,content:"/data/kanji-lists/genki-14.csv"},{name:"genki-15",label:"Leasson 15",priority:13,content:"/data/kanji-lists/genki-15.csv"},{name:"genki-16",label:"Leasson 16",priority:14,content:"/data/kanji-lists/genki-16.csv"},{name:"genki-17",label:"Leasson 17",priority:15,content:"/data/kanji-lists/genki-17.csv"},{name:"genki-18",label:"Leasson 18",priority:16,content:"/data/kanji-lists/genki-18.csv"},{name:"genki-19",label:"Leasson 19",priority:17,content:"/data/kanji-lists/genki-19.csv"},{name:"genki-20",label:"Leasson 20",priority:18,content:"/data/kanji-lists/genki-20.csv"},{name:"genki-21",label:"Leasson 21",priority:19,content:"/data/kanji-lists/genki-21.csv"},{name:"genki-22",label:"Leasson 22",priority:20,content:"/data/kanji-lists/genki-22.csv"},{name:"genki-23",label:"Leasson 23",priority:21,content:"/data/kanji-lists/genki-23.csv"}];return(o,s)=>(k(),p("ul",de,[y("li",null,[u(x,{title:"JLPT",category:"jlpt","deck-templates":t})]),y("li",null,[u(x,{title:"Genki",category:"genki","deck-templates":a})])]))}}),ke=b(le,[["__scopeId","data-v-bd179681"]]),pe={class:"article-header"},ue={class:"actions"},ye=_({__name:"DeckBrowserView",setup(e){return(t,a)=>(k(),p("article",null,[y("header",pe,[a[1]||(a[1]=y("h2",{class:"title"},"Add Decks",-1)),y("div",ue,[u(L,{to:g(H),"prefix-icon":"arrow-left"},{default:h(()=>a[0]||(a[0]=[v(" Back to your decks ")])),_:1},8,["to"])])]),u(ke)]))}}),je=b(ye,[["__scopeId","data-v-5a4e95e0"]]);export{je as default};
