(function(){"use strict";function l(a,...i){return i.reduce((t,e)=>e(t),a)}function*p(...a){const i=a.map(t=>t[Symbol.iterator]());try{let t=i.map(e=>e.next());for(;!t.some(({done:e})=>e);)yield t.map(({value:e})=>e),t=i.map(e=>e.next())}finally{i.forEach(t=>{typeof t.return=="function"&&t.return()})}}function h(a,i){return t=>{const e=new Map;for(const s of t){const r=a(s);let n=e.get(r);n||(n=[],e.set(r,n)),n.push(s)}return e}}function m(){return a=>[...a]}function*w(a,i,t=1){let e=a,s=i;typeof e>"u"&&(s=Number.POSITIVE_INFINITY,e=0),typeof s>"u"&&(s=e,e=0);const r=e<=s?(n,o)=>n<o:(n,o)=>o<n;for(let n=e;r(n,s);n+=t)yield n}function f(){return a=>p(w(),a)}const y="␟",g="␞",S=fetch("/data/index/kanji-radicals-v1.usv").then(a=>a.text()),d=fetch("/data/index/radicals-kanji-v1.usv").then(a=>a.text());function*u(a){const i=a[Symbol.iterator]();let t=0,e=i.next();function s(){e=i.next()}function*r(){let n=t;for(e.value===`
`&&(t+=1,n=t,e=i.next());!e.done;){const o=e.value;if(o===g){t+=o.length;return}o===y&&(yield a.slice(n,t),n=t+o.length),t+=o.length,s()}}for(;!e.done;)yield r(),s()}async function k(){const a=await d,i=new Map;for(const t of u(a)){let e="";for(const[s,r]of l(t,f()))if(s===0)e=r;else if(s===1){const n=Number.parseInt(r);let o=i.get(n);o||(o=[],i.set(n,o)),o.push(e)}}return i}async function b(a){let i=null;if(a.size===0)return new Set;let t=0,e=null;e:for(const s of u(await d))for(const[r,n]of l(s,f()))switch(r){case 0:a.has(n)?(e=n,t+=1):e=null;break;case 2:if(e){if(i){const o=new Set;for(const c of n)i.has(c)&&o.add(c);i=o}else{i=new Set;for(const o of n)i.add(o)}if(t===a.size)break e}}return i??new Set}async function I(a){const i=new Map,t=new Set;let e=0,s=null;e:for(const r of u(await S))for(const[n,o]of l(r,f()))switch(n){case 0:a.has(o)?(s=o,e+=1):s=null;break;case 1:s&&i.set(s,Number.parseInt(o));break;case 2:if(s){for(const c of o)t.add(c);if(e===a.size)break e}}return[i,t]}addEventListener("message",async a=>{if(a.data==="init"){const o={type:"all-radicals",allRadicals:await k()};self.postMessage(o);return}const i=await b(a.data),[t,e]=await I(i),r={type:"kanji-selection",kanjiSelection:l(i,h(n=>t.get(n)??NaN),m(),n=>new Map(n.sort(([o],[c])=>o-c))),filteredRadicals:e};self.postMessage(r)})})();
//# sourceMappingURL=component-picker.worker-BeQQggMa.js.map
