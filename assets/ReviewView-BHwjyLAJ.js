import{g as C,d as _,c as o,F as w,h as K,o as s,i as k,w as $,b as u,t as v,u as r,_ as R,f as T,e as f,a as g,j as I,k as B}from"./index-C9kKT1ht.js";import{u as V,a as S,p as A,K as D,b as F,c as N,d as q,e as P}from"./KanjiWordList-DIY1zJa7.js";import{A as b}from"./AppButton-CAcjDJVM.js";import{Q as W,w as L,l as h}from"./index-guFvHVik.js";import{f as M}from"./time-BmRGZSiE.js";import{u as Q,a as E,r as G}from"./cards-qhYptPgk.js";import{l as z}from"./db-CvDPecAE.js";function H(){return C(()=>{const p=L();return W(p)})}const J={class:"rate-buttons"},O={class:"rate-button-content"},U={class:"rating"},X={class:"next-review-time"},Y=_({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(p,{emit:t}){const d=p,l=t,e=C(()=>m.value.repeat(d.fsrs,new Date));function n(a){var j;const c=((j=a.last_review)==null?void 0:j.getTime())??Date.now(),y=a.due.getTime();return M(y-c)}const m=H();function i(a){a!==h.Manual&&l("rate",m.value.next(d.fsrs,new Date,a))}return(a,c)=>(s(),o("div",J,[(s(!0),o(w,null,K(e.value,({log:y,card:j})=>(s(),k(b,{class:"rating-button",key:y.rating,"data-rating":r(h)[y.rating],onClick:le=>i(y.rating)},{default:$(()=>[u("span",O,[u("span",U,v(r(h)[y.rating]),1),u("small",X,v(n(j)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),Z=R(Y,[["__scopeId","data-v-4210a69b"]]),x={key:0},ee={class:"advance-buttons"},ae=_({__name:"KanjiReview",props:{progress:{},answered:{type:Boolean}},emits:["answer","rate"],setup(p){const t=p,d=V(()=>t.progress.cardId),l=S(()=>t.progress.cardId);return A(()=>t.progress.cardId.toString(16).padStart(5,"0")),(e,n)=>r(d)?(s(),o("section",x,[T(D,{class:"title",kanji:r(d),"hide-literal":!e.answered&&e.progress.cardType==="kanji-write","hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.answered||e.progress.cardType==="kanji-write"?(s(),k(F,{key:0,class:"readings",kanji:r(d)},null,8,["kanji"])):f("",!0),T(N,{class:"strokes",kanji:r(d),"practice-mode":!e.answered&&e.progress.cardType==="kanji-write"},null,8,["kanji","practice-mode"]),u("div",ee,[e.answered?(s(),k(Z,{key:0,fsrs:e.progress.fsrs,onRate:n[0]||(n[0]=m=>e.$emit("rate",m))},null,8,["fsrs"])):(s(),k(b,{key:1,onClick:n[1]||(n[1]=m=>e.$emit("answer")),filled:""},{default:$(()=>[n[2]||(n[2]=g(" Show ")),e.progress.cardType==="kanji-read"?(s(),o(w,{key:0},[g(" Reading")],64)):(s(),o(w,{key:1},[g(" Writing")],64))]),_:1}))]),e.answered?(s(),k(P,{key:1,class:"components"})):f("",!0),r(l)?(s(),k(q,{key:2,class:"words","kanji-vocab":r(l),"hide-kanji":!e.answered&&e.progress.cardType==="kanji-write","hide-reading":!e.answered&&e.progress.cardType==="kanji-read","hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):f("",!0)])):f("",!0)}}),re=R(ae,[["__scopeId","data-v-993cd32c"]]),se={key:0,class:"review-remaining-count"},ne={class:"review-count"},te={class:"new-count"},ie={class:"learning-count"},oe=_({__name:"ReviewRemainCount",setup(p){const t=Q();return(d,l)=>r(t)?(s(),o("div",se,[u("span",ne,v(r(t).due),1),u("span",te,"(+ "+v(r(t).new)+")",1),u("span",ie,v(r(t).learning),1)])):f("",!0)}}),de=R(oe,[["__scopeId","data-v-def2b4ab"]]),ce={class:"header"},ue={class:"title"},pe=_({__name:"ReviewView",setup(p){const t=I(),d=B();function l(i){return i==="kanji-read"||i==="kanji-write"}const e=C(()=>{const{kanji:i,"card-type":a}=t.query;if(typeof i!="string"||typeof a!="string")return null;const c=i.codePointAt(0);return!c||!l(a)?null:{cardId:c,cardType:a}}),n=E(e);async function m(i,a){try{await G(i.cardId,i.cardType,a),z.postMessage("card-review"),d.replace({query:{kanji:void 0,"card-type":void 0}})}catch(c){console.error(c)}}return(i,a)=>(s(),o("article",null,[u("header",ce,[u("strong",ue,[r(n)?(s(),o(w,{key:0},[r(n).cardType==="kanji-read"?(s(),o(w,{key:0},[g(" Reading ")],64)):(s(),o(w,{key:1},[g("Writing")],64)),a[2]||(a[2]=g(" Review "))],64)):(s(),o(w,{key:1},[g("Finished Review")],64))]),T(de,{class:"counts"})]),r(n)?(s(),k(re,{key:0,progress:r(n),answered:e.value!=null,onAnswer:a[0]||(a[0]=c=>i.$router.replace({query:{kanji:String.fromCodePoint(r(n).cardId),"card-type":r(n).cardType}})),onRate:a[1]||(a[1]=c=>m(r(n),c))},null,8,["progress","answered"])):f("",!0)]))}}),je=R(pe,[["__scopeId","data-v-b10aac66"]]);export{je as default};
