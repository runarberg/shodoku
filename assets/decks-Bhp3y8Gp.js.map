{"version":3,"file":"decks-Bhp3y8Gp.js","sources":["../../src/helpers/formats.ts","../../src/store/decks.ts"],"sourcesContent":["const PERCENT_FORMAT = new Intl.NumberFormat(\"default\", { style: \"percent\" });\n\nexport function formatPercent(p: number): string {\n  return PERCENT_FORMAT.format(p);\n}\n","import { computed, ComputedRef, MaybeRefOrGetter, toValue } from \"vue\";\n\nimport { getDeckStatus } from \"../db/decks.ts\";\nimport { db as openingDb } from \"../db/index.ts\";\nimport { useLiveQuery } from \"../helpers/db.ts\";\nimport { useFsrs } from \"../helpers/fsrs.ts\";\nimport { Deck } from \"../types.ts\";\n\nexport function useDeck(\n  name: MaybeRefOrGetter<string>,\n): ComputedRef<Deck | undefined | null> {\n  const query = computed(() => {\n    const nameValue = toValue(name);\n\n    return async () => {\n      const db = await openingDb;\n      return db.get(\"decks\", nameValue);\n    };\n  });\n\n  const { result } = useLiveQuery(query);\n\n  return result;\n}\n\nexport function useDecks(): ComputedRef<Deck[] | null> {\n  const { result } = useLiveQuery(async () => {\n    const db = await openingDb;\n    const decks = await db\n      .transaction(\"decks\")\n      .store.index(\"category+priority\")\n      .getAll();\n\n    return decks.filter(({ active }) => active);\n  });\n\n  return result;\n}\n\nexport function useDecksContainingCard(\n  cardIdRef: MaybeRefOrGetter<number>,\n): ComputedRef<Deck[]> {\n  const query = computed(() => {\n    const cardId = toValue(cardIdRef);\n\n    return async () => {\n      const db = await openingDb;\n      const decks = await db\n        .transaction(\"decks\")\n        .store.index(\"cards\")\n        .getAll(IDBKeyRange.only(cardId));\n\n      return decks.filter(({ active }) => active);\n    };\n  });\n\n  const { result } = useLiveQuery(query, []);\n  return result;\n}\n\nexport function useDeckStatus(name: MaybeRefOrGetter<string>) {\n  const fsrs = useFsrs();\n\n  const query = computed(() => {\n    const nameValue = toValue(name);\n    return () => getDeckStatus(nameValue, fsrs.value);\n  });\n\n  const { result } = useLiveQuery(query);\n\n  return result;\n}\n"],"names":["PERCENT_FORMAT","formatPercent","p","useDecks","result","useLiveQuery","openingDb","active","useDecksContainingCard","cardIdRef","query","computed","cardId","toValue","useDeckStatus","name","fsrs","useFsrs","nameValue","getDeckStatus"],"mappings":"qKAAA,MAAMA,EAAiB,IAAI,KAAK,aAAa,UAAW,CAAE,MAAO,UAAW,EAErE,SAASC,EAAcC,EAAmB,CAC/C,OAAOF,EAAe,OAAOE,CAAC,CAChC,CCqBO,SAASC,GAAuC,CACrD,KAAM,CAAE,OAAAC,GAAWC,EAAa,UAEhB,MADH,MAAMC,GAEd,YAAY,OAAO,EACnB,MAAM,MAAM,mBAAmB,EAC/B,OAAA,GAEU,OAAO,CAAC,CAAE,OAAAC,CAAA,IAAaA,CAAM,CAC3C,EAED,OAAOH,CACT,CAEO,SAASI,EACdC,EACqB,CACrB,MAAMC,EAAQC,EAAS,IAAM,CAC3B,MAAMC,EAASC,EAAQJ,CAAS,EAEhC,MAAO,WAES,MADH,MAAMH,GAEd,YAAY,OAAO,EACnB,MAAM,MAAM,OAAO,EACnB,OAAO,YAAY,KAAKM,CAAM,CAAC,GAErB,OAAO,CAAC,CAAE,OAAAL,CAAA,IAAaA,CAAM,CAE9C,CAAC,EAEK,CAAE,OAAAH,CAAA,EAAWC,EAAaK,EAAO,CAAA,CAAE,EACzC,OAAON,CACT,CAEO,SAASU,EAAcC,EAAgC,CAC5D,MAAMC,EAAOC,EAAA,EAEPP,EAAQC,EAAS,IAAM,CAC3B,MAAMO,EAAYL,EAAQE,CAAI,EAC9B,MAAO,IAAMI,EAAcD,EAAWF,EAAK,KAAK,CAClD,CAAC,EAEK,CAAE,OAAAZ,CAAA,EAAWC,EAAaK,CAAK,EAErC,OAAON,CACT"}