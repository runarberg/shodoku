import{d as A,M,N as L,c as V,a as p,O as Y,e as g,b as f,A as _,w as C,h as b,t as j,o as r,_ as N,P as q,i as D,Q as E,F as $,m as T,y as W,u as v,L as z,g as B,l as R,v as X,s as U,D as Z,R as x}from"./index-Q1_umh3Q.js";import{j as h,n as ee,g as te,b as ae}from"./decks-CfOZF5PQ.js";import{d as O,u as se}from"./db-D0xdNwMV.js";import{e as oe,r as P,a as le,c as Q,d as re,b as ie,f as ne}from"./decks-BO7EJl2v.js";import{p as G,i as ce,m as de}from"./index-Rivd63qk.js";import{A as ue,a as pe,b as me}from"./AppTextArea-CyrxXHzg.js";import"./index-BH3SjzzP.js";function fe(n,t){return async e=>{let a=t;for await(const c of e)a=n(a,c);return a}}function ke(){return n=>[...n]}function ye(n){return function*(t){for(const e of t)yield n(e)}}function ve(n){return function*(t){for(const e of t)n(e)&&(yield e)}}function ge(){return function*(n){const t=new Set;for(const e of n)t.has(e)||(yield e,t.add(e))}}const be={class:"form-body"},De={class:"buttons"},we=A({__name:"CustomDeckForm",props:M({labelFieldDisabled:{type:Boolean,default:!1},priorityFieldDisabled:{type:Boolean,default:!1},confirmIcon:{},confirmLabel:{default:"confirm"}},{label:{},labelModifiers:{},priority:{},priorityModifiers:{},cards:{},cardsModifiers:{}}),emits:M(["submit","reset"],["update:label","update:priority","update:cards"]),setup(n){const t=L(n,"label"),e=L(n,"priority"),a=L(n,"cards"),c=V({get(){return a.value?a.value.map(s=>String.fromCodePoint(s)).join(""):""},set(s){a.value=G(s,ve(ce),ye(o=>o.codePointAt(0)),ge(),ke())}});return(s,o)=>(r(),p("form",{onSubmit:o[3]||(o[3]=Y(l=>s.$emit("submit"),["prevent"])),onReset:o[4]||(o[4]=l=>s.$emit("reset"))},[g("div",be,[f(ue,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=l=>t.value=l),class:"name-field",label:"Deck Name",disabled:s.labelFieldDisabled,required:""},null,8,["modelValue","disabled"]),f(pe,{modelValue:e.value,"onUpdate:modelValue":o[1]||(o[1]=l=>e.value=l),class:"priority-field",label:"Priority",min:"1",disabled:s.priorityFieldDisabled,required:""},null,8,["modelValue","disabled"]),f(me,{modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=l=>c.value=l),class:"kanji-field",label:"Kanji",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",placeholder:"Type or paste in your kanji here: 日月火時漢字読書"},null,8,["modelValue"])]),g("div",De,[f(_,{type:"reset"},{default:C(()=>o[5]||(o[5]=[b("Cancel")])),_:1,__:[5]}),f(_,{type:"submit","prefix-icon":s.confirmIcon,filled:""},{default:C(()=>[b(j(s.confirmLabel),1)]),_:1},8,["prefix-icon"])])],32))}}),H=N(we,[["__scopeId","data-v-3dc0e575"]]),Ce=A({__name:"CustomDeckEdit",props:{deck:{}},emits:["cancel","success"],setup(n,{emit:t}){const e=n,a=t,c=q({label:e.deck.label,priority:e.deck.priority,cards:e.deck.cards});async function s(){await oe({...e.deck,label:c.label,priority:c.priority,cards:E(c.cards)}),a("success")}return(o,l)=>(r(),D(H,{cards:c.cards,"onUpdate:cards":l[0]||(l[0]=d=>c.cards=d),label:c.label,"onUpdate:label":l[1]||(l[1]=d=>c.label=d),priority:c.priority,"onUpdate:priority":l[2]||(l[2]=d=>c.priority=d),"confirm-label":"Update","label-field-disabled":e.deck.category!=="custom","priority-field-disabled":e.deck.category!=="custom",onSubmit:s,onReset:l[3]||(l[3]=d=>o.$emit("cancel"))},null,8,["cards","label","priority","label-field-disabled","priority-field-disabled"]))}}),$e=A({__name:"DeckActivateButton",props:{isActive:{type:Boolean,default:!1},toggling:{type:Boolean,default:!1}},emits:["activate","deactivate"],setup(n,{emit:t}){const e=n,a=t;function c(){e.isActive?a("deactivate"):a("activate")}return(s,o)=>(r(),D(_,{class:"activate-button",filled:s.isActive,disabled:s.toggling,"prefix-icon":s.toggling?void 0:s.isActive?"checkmark":"plus","aria-pressed":s.isActive,onClick:c},{default:C(()=>[s.toggling?(r(),p($,{key:0},[o[0]||(o[0]=g("span",{class:"loading-icon"},"時",-1)),o[1]||(o[1]=b(" Loading "))],64)):s.isActive?(r(),p($,{key:1},[b("Active")],64)):(r(),p($,{key:2},[b("Add")],64))]),_:1},8,["filled","disabled","prefix-icon","aria-pressed"]))}}),J=N($e,[["__scopeId","data-v-d238a2ea"]]),_e=["aria-labelledby"],Ae={class:"controls"},Be=["id"],Ie={class:"kanji-list"},Ve=A({__name:"DeckBrowserItem",props:{deck:{},template:{},category:{},togglingCategory:{type:Boolean,default:!1}},setup(n){const t=n,e=T(!1),a=T(!1),c=z(),s=T(null),o=V(()=>t.deck?.active);async function l(){e.value=!0;try{t.deck?await le(t.deck.name):await Q({name:t.template.name,label:t.template.label,priority:t.template.priority,category:t.category,cards:s.value?.map(i=>i.codePointAt(0)??NaN)??[]})}catch(i){console.error(i)}finally{e.value=!1}}async function d(){if(t.deck){e.value=!0;try{await re(t.deck.name)}catch(i){console.error(i)}finally{e.value=!1}}}return W(()=>t.template?.content,async i=>{if(!i){s.value=null;return}const I=await(await fetch(i)).text();s.value=I.split(`
`).filter(k=>k)},{immediate:!0}),(i,u)=>{const I=X("RouterLink");return a.value&&i.deck?(r(),D(Ce,{key:0,deck:i.deck,onCancel:u[0]||(u[0]=k=>a.value=!1),onSuccess:u[1]||(u[1]=k=>a.value=!1)},null,8,["deck"])):(r(),p("article",{key:1,"aria-labelledby":v(c)},[g("div",Ae,[g("strong",{id:v(c)},j(i.deck?.label??i.template?.label),9,Be),f(J,{toggling:e.value||i.togglingCategory,"is-active":o.value,onActivate:l,onDeactivate:d},null,8,["toggling","is-active"]),i.deck?.active||i.deck?.category==="custom"?(r(),D(_,{key:0,class:"edit-button",onClick:u[2]||(u[2]=k=>a.value=!0)},{default:C(()=>u[5]||(u[5]=[b(" Edit ")])),_:1,__:[5]})):i.deck&&!i.deck.active&&i.deck.category!=="custom"?(r(),D(_,{key:1,class:"edit-button",onClick:u[3]||(u[3]=k=>v(P)(i.deck.name))},{default:C(()=>u[6]||(u[6]=[b(" Reset ")])),_:1,__:[6]})):B("",!0),i.deck?.category==="custom"?(r(),D(_,{key:2,class:"delete-button",onClick:u[4]||(u[4]=k=>v(P)(i.deck.name))},{default:C(()=>u[7]||(u[7]=[b(" Delete ")])),_:1,__:[7]})):B("",!0)]),g("ol",Ie,[i.deck?(r(!0),p($,{key:0},R(i.deck.cards,k=>(r(),p("li",{key:k,class:"kanji"},[f(I,{to:v(U)(String.fromCodePoint(k))},{default:C(()=>[b(j(String.fromCodePoint(k)),1)]),_:2},1032,["to"])]))),128)):s.value?(r(!0),p($,{key:1},R(s.value,k=>(r(),p("li",{key:k,class:"kanji"},[f(I,{to:v(U)(k)},{default:C(()=>[b(j(k),1)]),_:2},1032,["to"])]))),128)):B("",!0)])],8,_e))}}}),K=N(Ve,[["__scopeId","data-v-d98778d7"]]),je=A({__name:"CustomDeckCreate",emits:["cancel","success"],setup(n,{emit:t}){const e=t,a=q({label:"",priority:1,cards:[]});async function c(){const o=await G((await O).transaction("decks").store.index("category").iterate("custom"),de(l=>l.value.cards.length),fe((l,d)=>l+d,0));o&&(a.priority=Math.ceil(o/12))}async function s(){const o=await Q({category:"custom",label:a.label,priority:a.priority,cards:E(a.cards)});e("success",o)}return Z(()=>{c()}),(o,l)=>(r(),D(H,{cards:a.cards,"onUpdate:cards":l[0]||(l[0]=d=>a.cards=d),label:a.label,"onUpdate:label":l[1]||(l[1]=d=>a.label=d),priority:a.priority,"onUpdate:priority":l[2]||(l[2]=d=>a.priority=d),"confirm-icon":"plus","confirm-label":"Create",onSubmit:s,onReset:l[3]||(l[3]=d=>o.$emit("cancel"))},null,8,["cards","label","priority"]))}}),Te=["aria-labelledby"],Ne={class:"controls"},Se=["id"],Fe={key:2,class:"deck-list"},Re=A({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(n){const t=n,e=T(!1),a=T(!1),c=z(),{result:s}=se(V(()=>{const{category:y}=t;return async()=>{const m=new Map,w=(await O).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound([y,0],[y,Number.POSITIVE_INFINITY],!0,!0));for await(const F of w)m.set(F.primaryKey,F.value);return m}})),o=V(()=>t.deckTemplates?t.deckTemplates.length:s.value?.size??0),l=V(()=>{if(!s.value)return 0;let y=0;for(const[,{active:m}]of s.value)m&&(y+=1);return y}),d=T(!1),i=V(()=>t.deckTemplates?l.value>=t.deckTemplates.length:!0);async function u(y){d.value=!0;try{await ie(t.category,y)}catch(m){console.error(m)}finally{d.value=!1}}async function I(){d.value=!0;try{await ne(t.category)}catch(y){console.error(y)}finally{d.value=!1}}function k(){a.value=!0,e.value=!1}return(y,m)=>(r(),p("article",{"aria-labelledby":v(c)},[g("div",Ne,[g("strong",{id:v(c),class:"title"},j(y.title),9,Se),y.deckTemplates?(r(),D(J,{key:0,toggling:d.value,"is-active":i.value,onActivate:m[0]||(m[0]=w=>u(y.deckTemplates)),onDeactivate:I},null,8,["toggling","is-active"])):e.value?B("",!0):(r(),D(_,{key:1,class:"create-custom-button","prefix-icon":"plus",onClick:m[1]||(m[1]=w=>e.value=!0)},{default:C(()=>m[4]||(m[4]=[b(" Create New ")])),_:1,__:[4]}))]),o.value>0?(r(),D(_,{key:0,class:"expand-button","aria-pressed":a.value,onClick:m[2]||(m[2]=w=>a.value=!a.value)},{default:C(()=>[a.value?(r(),p($,{key:0},[b("Hide ")],64)):(r(),p($,{key:1},[b("Show ")],64)),b(" ("+j(o.value)+" decks) ",1)]),_:1},8,["aria-pressed"])):B("",!0),e.value?(r(),D(je,{key:1,class:"custom-deck-create",onCancel:m[3]||(m[3]=w=>e.value=!1),onSuccess:k})):B("",!0),a.value?(r(),p("ol",Fe,[y.deckTemplates?(r(!0),p($,{key:0},R(y.deckTemplates,w=>(r(),p("li",{key:w.name},[f(K,{deck:v(s)?.get(w.name),template:w,category:y.category,"toggling-category":d.value},null,8,["deck","template","category","toggling-category"])]))),128)):v(s)?(r(!0),p($,{key:1},R(v(s),([w,F])=>(r(),p("li",{key:w},[f(K,{deck:F},null,8,["deck"])]))),128)):B("",!0)])):B("",!0)],8,Te))}}),S=N(Re,[["__scopeId","data-v-6735dcda"]]),Le=A({__name:"DeckBrowserCustom",setup(n){return(t,e)=>(r(),D(S,{title:"Custom",category:"custom"}))}}),Me={class:"categories"},Ue=A({__name:"DeckBrowser",setup(n){return(t,e)=>(r(),p("ul",Me,[g("li",null,[f(S,{title:"JLPT",category:"jlpt","deck-templates":v(h)},null,8,["deck-templates"])]),g("li",null,[f(S,{title:"News Frequency",category:"news","deck-templates":v(ee)},null,8,["deck-templates"])]),g("li",null,[f(S,{title:"Genki",category:"genki","deck-templates":v(te)},null,8,["deck-templates"])]),g("li",null,[f(S,{title:"Basic Kanji Book",category:"basic-kanji","deck-templates":v(ae)},null,8,["deck-templates"])]),g("li",null,[f(Le)])]))}}),Pe=N(Ue,[["__scopeId","data-v-346b37c3"]]),Ke={class:"article-header"},qe={class:"actions"},Ee=A({__name:"DeckBrowserView",setup(n){return(t,e)=>(r(),p("article",null,[g("header",Ke,[e[1]||(e[1]=g("h2",{class:"title"},"Add Decks",-1)),g("div",qe,[f(_,{to:v(x),"prefix-icon":"arrow-left"},{default:C(()=>e[0]||(e[0]=[b(" Back to your decks ")])),_:1,__:[0]},8,["to"])])]),f(Pe)]))}}),We=N(Ee,[["__scopeId","data-v-a1e5f41b"]]);export{We as default};
