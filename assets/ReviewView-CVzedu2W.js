import{d as C,c as _,a as l,F as j,l as A,o as n,h as v,w as K,e as p,t as T,u as s,A as q,_ as $,m as V,b as h,g as y,f as R,n as I,p as B,i as N,k as S}from"./index-BciHhrDw.js";import{A as D}from"./AppLoading-CvFehA9L.js";import{l as b,f as E,c as L,b as P,u as F,d as W}from"./reviews-CJ8qnqBF.js";import{d as G}from"./db-DMt_gcjs.js";import{u as M,a as Q}from"./WordWritingSelect-BLW3x66_.js";import{p as z,K as H,a as J,b as O,c as U,d as X}from"./KanjiWordList-BufkSMR_.js";import{u as Y}from"./fsrs-agZMamPn.js";import"./decks-GrwULuka.js";import"./formats-CxjEYhKc.js";import"./WordListItem-txlm4nr4.js";const Z={class:"rate-buttons"},x={class:"rate-button-content"},ee={class:"rating"},ae={class:"next-review-time"},ne=C({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(f,{emit:d}){const i=f,m=d,r=_(()=>k.value.repeat(i.fsrs,new Date));function c(o){var a;const t=((a=o.last_review)==null?void 0:a.getTime())??Date.now(),e=o.due.getTime();return E(e-t)}const k=Y();function g(o){o!==b.Manual&&m("rate",k.value.next(i.fsrs,new Date,o))}return(o,t)=>(n(),l("div",Z,[(n(!0),l(j,null,A(r.value,({log:e,card:a})=>(n(),v(q,{class:"rating-button",key:e.rating,"data-rating":s(b)[e.rating],onClick:u=>g(e.rating)},{default:K(()=>[p("span",x,[p("span",ee,T(s(b)[e.rating]),1),p("small",ae,T(c(a)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),te=$(ne,[["__scopeId","data-v-4210a69b"]]),re={key:0},se={class:"advance-buttons"},ie=C({__name:"KanjiReview",props:{card:{},isRating:{type:Boolean}},emits:["answer","rate"],setup(f,{emit:d}){const i=f,m=d,r=M(()=>i.card.cardId),c=Q(()=>i.card.cardId),k=V(null);z(()=>i.card.cardId.toString(16).padStart(5,"0"));const g=L(async()=>{const{cardId:e,cardType:a,fsrs:u}=i.card;if(u)return u;const w=await(await G).get("progress",[e,a]);return w==null?void 0:w.fsrs},i.card.fsrs),o=_(()=>{var e;return((e=g.value)==null?void 0:e.state)===P.New});function t(){var e;m("answer"),i.card.cardType==="kanji-write"&&((e=k.value)==null||e.maybeShowAnswer())}return(e,a)=>s(r)&&s(g)?(n(),l("section",re,[h(H,{class:"title",kanji:s(r),"hide-literal":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.isRating||e.card.cardType==="kanji-write"?(n(),v(J,{key:0,class:"readings",kanji:s(r)},null,8,["kanji"])):y("",!0),h(O,{ref_key:"kanjiStrokesEl",ref:k,class:"strokes",kanji:s(r),"auto-hint":!e.isRating&&e.card.cardType==="kanji-write"&&o.value,"practice-mode":!e.isRating&&e.card.cardType==="kanji-write",onPracticeDone:a[0]||(a[0]=u=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),p("div",se,[e.isRating?(n(),v(te,{key:0,fsrs:s(g),onRate:a[1]||(a[1]=u=>e.$emit("rate",{progress:{...e.card,fsrs:s(g)},next:u}))},null,8,["fsrs"])):(n(),v(q,{key:1,onClick:a[2]||(a[2]=u=>t()),filled:""},{default:K(()=>[a[3]||(a[3]=R(" Show ")),e.card.cardType==="kanji-read"?(n(),l(j,{key:0},[R(" Reading")],64)):(n(),l(j,{key:1},[R(" Writing")],64))]),_:1}))]),e.isRating||e.card.cardType==="kanji-write"&&o.value?(n(),v(X,{key:1,class:"components"})):y("",!0),s(c)?(n(),v(U,{key:2,class:"words","kanji-vocab":s(c),"hide-kanji":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-reading":!e.isRating&&e.card.cardType==="kanji-read","hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):y("",!0)])):y("",!0)}}),oe=$(ie,[["__scopeId","data-v-78621863"]]),de={key:0,class:"review-remaining-count"},ce={class:"review-count"},ue={class:"new-count"},le={class:"learning-count"},pe=C({__name:"ReviewRemainCount",setup(f){const d=F();return(i,m)=>s(d)?(n(),l("div",de,[p("span",ce,T(s(d).due),1),p("span",ue,"(+ "+T(s(d).new)+")",1),p("span",le,T(s(d).learning),1)])):y("",!0)}}),me=$(pe,[["__scopeId","data-v-adc21f06"]]);function fe(f){return f==="kanji-read"||f==="kanji-write"}const ge={class:"header"},ke={class:"title"},ve={key:0,class:"loading"},ye=C({__name:"ReviewView",setup(f){const d=V(null),i=B(),m=N(),r=W(),c=_(()=>{const{kanji:t,"card-type":e}=i.query;if(typeof t!="string"||typeof e!="string")return null;const a=t.codePointAt(0);return!a||!fe(e)?null:r.queue.find(w=>w.cardId===a&&w.cardType===e)??{cardId:a,cardType:e}}),k=_(()=>"rating"in i.query),g=_(()=>!c.value&&r.refreshing);r.refreshQueues(),I(()=>{r.queue.length===0&&!r.refreshing&&m.replace(S)}),I(()=>{if(c.value)return;const[t]=r.queue;t&&m.replace({query:{kanji:String.fromCodePoint(t.cardId),"card-type":t.cardType,rating:void 0}})});function o({progress:t,next:e}){var u;r.rateCard(t,e);const[a]=r.queue;a?(m.replace({query:{kanji:String.fromCodePoint(a.cardId),"card-type":a.cardType,rating:void 0}}),(u=d.value)==null||u.scrollIntoView({behavior:"instant",block:"start"})):m.replace(S)}return(t,e)=>(n(),l("article",{ref_key:"el",ref:d},[p("header",ge,[p("strong",ke,[c.value?(n(),l(j,{key:0},[c.value.cardType==="kanji-read"?(n(),l(j,{key:0},[R(" Reading ")],64)):(n(),l(j,{key:1},[R("Writing")],64)),e[2]||(e[2]=R(" Review "))],64)):y("",!0)]),h(me,{class:"counts"})]),g.value?(n(),l("section",ve,[e[3]||(e[3]=p("p",null,"Loading next cardâ€¦",-1)),h(D,{class:"loading-icon"})])):c.value?(n(),v(oe,{key:1,card:c.value,"is-rating":k.value,onAnswer:e[0]||(e[0]=a=>t.$router.replace({query:{...t.$route.query,rating:""}})),onRate:e[1]||(e[1]=a=>o(a))},null,8,["card","is-rating"])):y("",!0)],512))}}),Se=$(ye,[["__scopeId","data-v-89301efa"]]);export{Se as default};
