import{c as R,d as T,a as o,F as k,i as B,o as r,b as g,w as b,f as m,t as j,u as s,_ as h,h as C,g as f,e as y,j as I,k as V,l as S,m as N}from"./index-CgdTuyLR.js";import{W as D,b as L,l as $,u as P}from"./index-Bk94BvIa.js";import{u as A,a as W}from"./WordWritingSelect-CMFaUaA8.js";import{p as q,K as F,a as M,b as E,c as G,d as Q}from"./KanjiWordList-meobQRyp.js";import{A as K}from"./AppButton-BT87rAPg.js";import{f as z}from"./time-BmRGZSiE.js";import{u as H,a as J,r as O,R as U}from"./cards-6aXkXgan.js";import{l as X}from"./db-CcU_202h.js";import"./index-Dy4zg_J2.js";import"./decks-huPVwMnz.js";import"./WordListItem-Bs5FhiIJ.js";function Y(){return R(()=>{const d=L();return D(d)})}const Z={class:"rate-buttons"},x={class:"rate-button-content"},ee={class:"rating"},ae={class:"next-review-time"},re=T({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(d,{emit:i}){const u=d,l=i,c=R(()=>t.value.repeat(u.fsrs,new Date));function e(v){var n;const _=((n=v.last_review)==null?void 0:n.getTime())??Date.now(),a=v.due.getTime();return z(a-_)}const t=Y();function p(v){v!==$.Manual&&l("rate",t.value.next(u.fsrs,new Date,v))}return(v,_)=>(r(),o("div",Z,[(r(!0),o(k,null,B(c.value,({log:a,card:n})=>(r(),g(K,{class:"rating-button",key:a.rating,"data-rating":s($)[a.rating],onClick:w=>p(a.rating)},{default:b(()=>[m("span",x,[m("span",ee,j(s($)[a.rating]),1),m("small",ae,j(e(n)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),se=h(re,[["__scopeId","data-v-4210a69b"]]),ne={key:0},te={class:"advance-buttons"},ie=T({__name:"KanjiReview",props:{progress:{},answered:{type:Boolean}},emits:["answer","rate"],setup(d){const i=d,u=A(()=>i.progress.cardId),l=W(()=>i.progress.cardId);q(()=>i.progress.cardId.toString(16).padStart(5,"0"));const c=R(()=>i.progress.fsrs.state===P.New);return(e,t)=>s(u)?(r(),o("section",ne,[C(F,{class:"title",kanji:s(u),"hide-literal":!e.answered&&e.progress.cardType==="kanji-write"&&!c.value,"hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.answered||e.progress.cardType==="kanji-write"?(r(),g(M,{key:0,class:"readings",kanji:s(u)},null,8,["kanji"])):f("",!0),C(E,{class:"strokes",kanji:s(u),"auto-hint":!e.answered&&e.progress.cardType==="kanji-write"&&c.value,"practice-mode":!e.answered&&e.progress.cardType==="kanji-write","practice-review":e.progress.cardType==="kanji-write",onPracticeDone:t[0]||(t[0]=p=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode","practice-review"]),m("div",te,[e.answered?(r(),g(se,{key:0,fsrs:e.progress.fsrs,onRate:t[1]||(t[1]=p=>e.$emit("rate",p))},null,8,["fsrs"])):(r(),g(K,{key:1,onClick:t[2]||(t[2]=p=>e.$emit("answer")),filled:""},{default:b(()=>[t[3]||(t[3]=y(" Show ")),e.progress.cardType==="kanji-read"?(r(),o(k,{key:0},[y(" Reading")],64)):(r(),o(k,{key:1},[y(" Writing")],64))]),_:1}))]),e.answered||e.progress.cardType==="kanji-write"&&c.value?(r(),g(Q,{key:1,class:"components"})):f("",!0),s(l)?(r(),g(G,{key:2,class:"words","kanji-vocab":s(l),"hide-kanji":!e.answered&&e.progress.cardType==="kanji-write"&&!c.value,"hide-reading":!e.answered&&e.progress.cardType==="kanji-read","hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):f("",!0)])):f("",!0)}}),oe=h(ie,[["__scopeId","data-v-249adc66"]]),de={key:0,class:"review-remaining-count"},ue={class:"review-count"},ce={class:"new-count"},le={class:"learning-count"},pe=T({__name:"ReviewRemainCount",setup(d){const i=H();return(u,l)=>s(i)?(r(),o("div",de,[m("span",ue,j(s(i).due),1),m("span",ce,"(+ "+j(s(i).new)+")",1),m("span",le,j(s(i).learning),1)])):f("",!0)}}),me=h(pe,[["__scopeId","data-v-def2b4ab"]]);function ve(d){return d==="kanji-read"||d==="kanji-write"}const we={class:"header"},ge={class:"title"},ke={key:0},ye=T({__name:"ReviewView",setup(d){const i=S(),u=N(),l=R(()=>{const{kanji:a,"card-type":n}=i.query;if(typeof a!="string"||typeof n!="string")return null;const w=a.codePointAt(0);return!w||!ve(n)?null:{cardId:w,cardType:n}}),c=I(null),{result:e,loading:t}=J(l),p=I(!0);V(t,a=>{a||(p.value=!1)});const v=R(()=>{var a;return p.value?!0:!e.value||!c.value||((a=l.value)==null?void 0:a.cardId)===e.value.cardId?!1:t.value&&e.value.cardId===c.value.cardId&&e.value.cardType===e.value.cardType});async function _(a,n){try{c.value={cardId:a.cardId,cardType:a.cardType},await O(a.cardId,a.cardType,n),X.postMessage("card-review"),u.replace({query:{kanji:void 0,"card-type":void 0}})}catch(w){console.error(w)}}return(a,n)=>(r(),o("article",null,[m("header",we,[m("strong",ge,[s(e)?(r(),o(k,{key:0},[s(e).cardType==="kanji-read"?(r(),o(k,{key:0},[y(" Reading ")],64)):(r(),o(k,{key:1},[y("Writing")],64)),n[2]||(n[2]=y(" Review "))],64)):p.value?f("",!0):(r(),o(k,{key:1},[y("Review Summary")],64))]),C(me,{class:"counts"})]),v.value?(r(),o("p",ke,"Loading next card...")):s(e)?(r(),g(oe,{key:1,progress:s(e),answered:l.value!=null,onAnswer:n[0]||(n[0]=w=>a.$router.replace({query:{kanji:String.fromCodePoint(s(e).cardId),"card-type":s(e).cardType}})),onRate:n[1]||(n[1]=w=>_(s(e),w))},null,8,["progress","answered"])):(r(),g(U,{key:2}))]))}}),Be=h(ye,[["__scopeId","data-v-c7a3f5a1"]]);export{Be as default};
