import{d as h,c as T,a as o,F as k,j as B,o as r,f as g,w as b,b as c,t as j,u as n,_ as $,e as _,h as f,g as y,k as I,l as V,m as S,n as N}from"./index-jUm0nxGk.js";import{A}from"./AppLoading-D_zhGJN7.js";import{l as C,A as K,u as L}from"./index-xwVy6i7n.js";import{u as D,a as P,b as q}from"./WordWritingSelect-C3Xn3wf5.js";import{p as F,K as W,a as M,b as E,c as G,d as Q}from"./KanjiWordList-BQfg8QuV.js";import{f as z}from"./time-BmRGZSiE.js";import{u as H,a as J,r as O,R as U}from"./cards-B6EeST8l.js";import{l as X}from"./db-C8CERaXs.js";import"./iterators-PeFxZeGd.js";import"./index-BNLyvoft.js";import"./decks-huPVwMnz.js";import"./formats-CxjEYhKc.js";import"./WordListItem-EeNwFwSj.js";const Y={class:"rate-buttons"},Z={class:"rate-button-content"},x={class:"rating"},ee={class:"next-review-time"},ae=h({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(m,{emit:i}){const d=m,l=i,u=T(()=>t.value.repeat(d.fsrs,new Date));function e(v){var s;const R=((s=v.last_review)==null?void 0:s.getTime())??Date.now(),a=v.due.getTime();return z(a-R)}const t=D();function p(v){v!==C.Manual&&l("rate",t.value.next(d.fsrs,new Date,v))}return(v,R)=>(r(),o("div",Y,[(r(!0),o(k,null,B(u.value,({log:a,card:s})=>(r(),g(K,{class:"rating-button",key:a.rating,"data-rating":n(C)[a.rating],onClick:w=>p(a.rating)},{default:b(()=>[c("span",Z,[c("span",x,j(n(C)[a.rating]),1),c("small",ee,j(e(s)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),re=$(ae,[["__scopeId","data-v-4210a69b"]]),se={key:0},ne={class:"advance-buttons"},te=h({__name:"KanjiReview",props:{progress:{},answered:{type:Boolean}},emits:["answer","rate"],setup(m){const i=m,d=P(()=>i.progress.cardId),l=q(()=>i.progress.cardId);F(()=>i.progress.cardId.toString(16).padStart(5,"0"));const u=T(()=>i.progress.fsrs.state===L.New);return(e,t)=>n(d)?(r(),o("section",se,[_(W,{class:"title",kanji:n(d),"hide-literal":!e.answered&&e.progress.cardType==="kanji-write"&&!u.value,"hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.answered||e.progress.cardType==="kanji-write"?(r(),g(M,{key:0,class:"readings",kanji:n(d)},null,8,["kanji"])):f("",!0),_(E,{class:"strokes",kanji:n(d),"auto-hint":!e.answered&&e.progress.cardType==="kanji-write"&&u.value,"practice-mode":!e.answered&&e.progress.cardType==="kanji-write","practice-review":e.progress.cardType==="kanji-write",onPracticeDone:t[0]||(t[0]=p=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode","practice-review"]),c("div",ne,[e.answered?(r(),g(re,{key:0,fsrs:e.progress.fsrs,onRate:t[1]||(t[1]=p=>e.$emit("rate",p))},null,8,["fsrs"])):(r(),g(K,{key:1,onClick:t[2]||(t[2]=p=>e.$emit("answer")),filled:""},{default:b(()=>[t[3]||(t[3]=y(" Show ")),e.progress.cardType==="kanji-read"?(r(),o(k,{key:0},[y(" Reading")],64)):(r(),o(k,{key:1},[y(" Writing")],64))]),_:1}))]),e.answered||e.progress.cardType==="kanji-write"&&u.value?(r(),g(Q,{key:1,class:"components"})):f("",!0),n(l)?(r(),g(G,{key:2,class:"words","kanji-vocab":n(l),"hide-kanji":!e.answered&&e.progress.cardType==="kanji-write"&&!u.value,"hide-reading":!e.answered&&e.progress.cardType==="kanji-read","hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):f("",!0)])):f("",!0)}}),ie=$(te,[["__scopeId","data-v-249adc66"]]),oe={key:0,class:"review-remaining-count"},de={class:"review-count"},ue={class:"new-count"},ce={class:"learning-count"},le=h({__name:"ReviewRemainCount",setup(m){const i=H();return(d,l)=>n(i)?(r(),o("div",oe,[c("span",de,j(n(i).due),1),c("span",ue,"(+ "+j(n(i).new)+")",1),c("span",ce,j(n(i).learning),1)])):f("",!0)}}),pe=$(le,[["__scopeId","data-v-def2b4ab"]]);function me(m){return m==="kanji-read"||m==="kanji-write"}const ve={class:"header"},we={class:"title"},ge={key:0,class:"loading"},ke=h({__name:"ReviewView",setup(m){const i=S(),d=N(),l=T(()=>{const{kanji:a,"card-type":s}=i.query;if(typeof a!="string"||typeof s!="string")return null;const w=a.codePointAt(0);return!w||!me(s)?null:{cardId:w,cardType:s}}),u=I(null),{result:e,loading:t}=J(l),p=I(!0);V(t,a=>{a||(p.value=!1)});const v=T(()=>{var a;return p.value?!0:!e.value||!u.value||((a=l.value)==null?void 0:a.cardId)===e.value.cardId?!1:t.value&&e.value.cardId===u.value.cardId&&e.value.cardType===e.value.cardType});async function R(a,s){try{u.value={cardId:a.cardId,cardType:a.cardType},await O(a.cardId,a.cardType,s),X.postMessage("card-review"),d.replace({query:{kanji:void 0,"card-type":void 0}})}catch(w){console.error(w)}}return(a,s)=>(r(),o("article",null,[c("header",ve,[c("strong",we,[n(e)?(r(),o(k,{key:0},[n(e).cardType==="kanji-read"?(r(),o(k,{key:0},[y(" Reading ")],64)):(r(),o(k,{key:1},[y("Writing")],64)),s[2]||(s[2]=y(" Review "))],64)):p.value?f("",!0):(r(),o(k,{key:1},[y("Review Summary")],64))]),_(pe,{class:"counts"})]),v.value?(r(),o("section",ge,[s[3]||(s[3]=c("p",null,"Loading next cardâ€¦",-1)),_(A,{class:"loading-icon"})])):n(e)?(r(),g(ie,{key:1,progress:n(e),answered:l.value!=null,onAnswer:s[0]||(s[0]=w=>a.$router.replace({query:{kanji:String.fromCodePoint(n(e).cardId),"card-type":n(e).cardType}})),onRate:s[1]||(s[1]=w=>R(n(e),w))},null,8,["progress","answered"])):(r(),g(U,{key:2}))]))}}),Ve=$(ke,[["__scopeId","data-v-2c29808f"]]);export{Ve as default};
