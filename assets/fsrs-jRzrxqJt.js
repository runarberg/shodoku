import{h as b,r as k,t as y,d as D,S as R,W as p,e as j,k as h}from"./reviews-DovQcjTA.js";import{u as z,d as w}from"./db-BhNzgzsk.js";import{c as l,C as d,H as K,z as P}from"./index-Q4noPGif.js";function m(){return l(()=>{const e=b({enable_fuzz:k.value});return y(e)})}function f(e,t,n=new Date){return e?e.fsrs.state===1?"learning":e.fsrs.state===3?"relearning":t.get_retrievability(e.fsrs,n,!1):null}function F(e){const t=m(),{result:n}=z(l(()=>{const a=d(e);return async()=>{const s=(await w).transaction("progress").store,o=await s.get([a,"kanji-read"]),u=await s.get([a,"kanji-write"]),r=new Date;return{read:f(o,t.value,r),write:f(u,t.value,r)}}}));return n}function H(e){const t=m(),n=K(new Set);return P([()=>d(e),j,h],async([a,s,o])=>{if(!a)return;const u=new Date,r=o/100,g=new Date(Date.now()+s*p);for(const c of a)if(D(c)){const v=c.codePointAt(0)??0,i=await(await w).get("progress",[v,"kanji-read"]);if(i){if(i.fsrs.state!==R.Review)continue;t.value.get_retrievability(i.fsrs,u,!1)>r&&i.fsrs.due>g&&n.add(c)}}},{immediate:!0}),n}export{F as a,H as b,m as u};
