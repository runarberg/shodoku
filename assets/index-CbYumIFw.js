import{u as ta,d as k,l as ra,a as Ua}from"./db-DOZG9NOu.js";import{a as ka,i as Ga,g as Ka,h as Ha,t as le,e as Va,b as za,f as Wa}from"./index-EEqkjwK5.js";import{a1 as Ya,V as Ut,m as na,p as Ja,c as Vt,B as J,y as Xa,u as Za,a6 as Qa}from"./index-gkm2TMQe.js";function ei(t){return async e=>{const r=new Map;for await(const n of e){const a=t(n);let i=r.get(a);i||(i=[],r.set(a,i)),i.push(n)}return r}}function aa(t,...e){return e.reduce((r,n)=>n(r),t)}function ti(t){return async function*(e){for await(const r of e)yield t(r)}}function ri(t){return function*(e){const r=e[Symbol.iterator]();let n=r.next();for(;!n.done&&t(n.value);)n=r.next();try{for(;!n.done;)yield n.value,n=r.next()}finally{typeof r.return=="function"&&r.return()}}}class fe extends Error{constructor(e,r){super(e),this.name="DevalueError",this.path=r.join("")}}function or(t){return Object(t)!==t}const ni=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ai(t){const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null||Object.getOwnPropertyNames(e).sort().join("\0")===ni}function ii(t){return Object.prototype.toString.call(t).slice(8,-1)}function si(t){switch(t){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t<" "?`\\u${t.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function Y(t){let e="",r=0;const n=t.length;for(let a=0;a<n;a+=1){const i=t[a],s=si(i);s&&(e+=t.slice(r,a)+s,r=a+1)}return`"${r===0?t:e+t.slice(r)}"`}function oi(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.getOwnPropertyDescriptor(t,e).enumerable)}const ui=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function ur(t){return ui.test(t)?"."+t:"["+JSON.stringify(t)+"]"}function cr(t){const e=new DataView(t);let r="";for(let n=0;n<t.byteLength;n++)r+=String.fromCharCode(e.getUint8(n));return li(r)}function lr(t){const e=ci(t),r=new ArrayBuffer(e.length),n=new DataView(r);for(let a=0;a<r.byteLength;a++)n.setUint8(a,e.charCodeAt(a));return r}const ia="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function ci(t){t.length%4===0&&(t=t.replace(/==?$/,""));let e="",r=0,n=0;for(let a=0;a<t.length;a++)r<<=6,r|=ia.indexOf(t[a]),n+=6,n===24&&(e+=String.fromCharCode((r&16711680)>>16),e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255),r=n=0);return n===12?(r>>=4,e+=String.fromCharCode(r)):n===18&&(r>>=2,e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255)),e}function li(t){let e="";for(let r=0;r<t.length;r+=3){const n=[void 0,void 0,void 0,void 0];n[0]=t.charCodeAt(r)>>2,n[1]=(t.charCodeAt(r)&3)<<4,t.length>r+1&&(n[1]|=t.charCodeAt(r+1)>>4,n[2]=(t.charCodeAt(r+1)&15)<<2),t.length>r+2&&(n[2]|=t.charCodeAt(r+2)>>6,n[3]=t.charCodeAt(r+2)&63);for(let a=0;a<n.length;a++)typeof n[a]>"u"?e+="=":e+=ia[n[a]]}return e}const zt=-1,sa=-2,oa=-3,ua=-4,ca=-5,Wt=-6;function de(t,e){return fi(JSON.parse(t))}function fi(t,e){if(typeof t=="number")return a(t,!0);if(!Array.isArray(t)||t.length===0)throw new Error("Invalid input");const r=t,n=Array(r.length);function a(i,s=!1){if(i===zt)return;if(i===oa)return NaN;if(i===ua)return 1/0;if(i===ca)return-1/0;if(i===Wt)return-0;if(s)throw new Error("Invalid input");if(i in n)return n[i];const o=r[i];if(!o||typeof o!="object")n[i]=o;else if(Array.isArray(o))if(typeof o[0]=="string"){const c=o[0];switch(c){case"Date":n[i]=new Date(o[1]);break;case"Set":const u=new Set;n[i]=u;for(let d=1;d<o.length;d+=1)u.add(a(o[d]));break;case"Map":const l=new Map;n[i]=l;for(let d=1;d<o.length;d+=2)l.set(a(o[d]),a(o[d+1]));break;case"RegExp":n[i]=new RegExp(o[1],o[2]);break;case"Object":n[i]=Object(o[1]);break;case"BigInt":n[i]=BigInt(o[1]);break;case"null":const f=Object.create(null);n[i]=f;for(let d=1;d<o.length;d+=2)f[o[d]]=a(o[d+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const d=globalThis[c],h=o[1],v=lr(h),w=new d(v);n[i]=w;break}case"ArrayBuffer":{const d=o[1],h=lr(d);n[i]=h;break}default:throw new Error(`Unknown type ${c}`)}}else{const c=new Array(o.length);n[i]=c;for(let u=0;u<o.length;u+=1){const l=o[u];l!==sa&&(c[u]=a(l))}}else{const c={};n[i]=c;for(const u in o){const l=o[u];c[u]=a(l)}}return n[i]}return a(0)}function re(t,e){const r=[],n=new Map,a=[],i=[];let s=0;function o(u){if(typeof u=="function")throw new fe("Cannot stringify a function",i);if(n.has(u))return n.get(u);if(u===void 0)return zt;if(Number.isNaN(u))return oa;if(u===1/0)return ua;if(u===-1/0)return ca;if(u===0&&1/u<0)return Wt;const l=s++;n.set(u,l);for(const{key:d,fn:h}of a){const v=h(u);if(v)return r[l]=`["${d}",${o(v)}]`,l}let f="";if(or(u))f=he(u);else{const d=ii(u);switch(d){case"Number":case"String":case"Boolean":f=`["Object",${he(u)}]`;break;case"BigInt":f=`["BigInt",${u}]`;break;case"Date":f=`["Date","${!isNaN(u.getDate())?u.toISOString():""}"]`;break;case"RegExp":const{source:v,flags:w}=u;f=w?`["RegExp",${Y(v)},"${w}"]`:`["RegExp",${Y(v)}]`;break;case"Array":f="[";for(let y=0;y<u.length;y+=1)y>0&&(f+=","),y in u?(i.push(`[${y}]`),f+=o(u[y]),i.pop()):f+=sa;f+="]";break;case"Set":f='["Set"';for(const y of u)f+=`,${o(y)}`;f+="]";break;case"Map":f='["Map"';for(const[y,b]of u)i.push(`.get(${or(y)?he(y):"..."})`),f+=`,${o(y)},${o(b)}`,i.pop();f+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const b=cr(u.buffer);f='["'+d+'","'+b+'"]';break}case"ArrayBuffer":{f=`["ArrayBuffer","${cr(u)}"]`;break}default:if(!ai(u))throw new fe("Cannot stringify arbitrary non-POJOs",i);if(oi(u).length>0)throw new fe("Cannot stringify POJOs with symbolic keys",i);if(Object.getPrototypeOf(u)===null){f='["null"';for(const y in u)i.push(ur(y)),f+=`,${Y(y)},${o(u[y])}`,i.pop();f+="]"}else{f="{";let y=!1;for(const b in u)y&&(f+=","),y=!0,i.push(ur(b)),f+=`${Y(b)}:${o(u[b])}`,i.pop();f+="}"}}}return r[l]=f,l}const c=o(t);return c<0?`${c}`:`[${r.join(",")}]`}function he(t){const e=typeof t;return e==="string"?Y(t):t instanceof String?Y(t.toString()):t===void 0?zt.toString():t===0&&1/t<0?Wt.toString():e==="bigint"?`["BigInt","${t}"]`:String(t)}function vo(t,e,r){let n;Ya(r)?n={evaluating:r}:n={};const{lazy:a=!1,flush:i="pre",evaluating:s=void 0,shallow:o=!0,onError:c=ka}=n,u=Ut(!a),l=o?Ut(e):na(e);let f=0;return Ja(async d=>{if(!u.value)return;f++;const h=f;let v=!1;s&&Promise.resolve().then(()=>{s.value=!0});try{const w=await t(y=>{d(()=>{s&&(s.value=!1),v||y()})});h===f&&(l.value=w)}catch(w){c(w)}finally{s&&h===f&&(s.value=!1),v=!0}},{flush:i}),a?Vt(()=>(u.value=!0,l.value)):l}const oe=Ga?window:void 0;function di(t){var e;const r=J(t);return(e=r?.$el)!=null?e:r}function fr(...t){const e=[],r=()=>{e.forEach(o=>o()),e.length=0},n=(o,c,u,l)=>(o.addEventListener(c,u,l),()=>o.removeEventListener(c,u,l)),a=Vt(()=>{const o=le(J(t[0])).filter(c=>c!=null);return o.every(c=>typeof c!="string")?o:void 0}),i=Va(()=>{var o,c;return[(c=(o=a.value)==null?void 0:o.map(u=>di(u)))!=null?c:[oe].filter(u=>u!=null),le(J(a.value?t[1]:t[0])),le(Za(a.value?t[2]:t[1])),J(a.value?t[3]:t[2])]},([o,c,u,l])=>{if(r(),!o?.length||!c?.length||!u?.length)return;const f=Wa(l)?{...l}:l;e.push(...o.flatMap(d=>c.flatMap(h=>u.map(v=>n(d,h,v,f)))))},{flush:"post"}),s=()=>{i(),r()};return za(r),s}const ae=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ie="__vueuse_ssr_handlers__",hi=yi();function yi(){return ie in ae||(ae[ie]=ae[ie]||{}),ae[ie]}function vi(t,e){return hi[t]||e}function pi(t){return t==null?"any":t instanceof Set?"set":t instanceof Map?"map":t instanceof Date?"date":typeof t=="boolean"?"boolean":typeof t=="string"?"string":typeof t=="object"?"object":Number.isNaN(t)?"any":"number"}const gi={boolean:{read:t=>t==="true",write:t=>String(t)},object:{read:t=>JSON.parse(t),write:t=>JSON.stringify(t)},number:{read:t=>Number.parseFloat(t),write:t=>String(t)},any:{read:t=>t,write:t=>String(t)},string:{read:t=>t,write:t=>String(t)},map:{read:t=>new Map(JSON.parse(t)),write:t=>JSON.stringify(Array.from(t.entries()))},set:{read:t=>new Set(JSON.parse(t)),write:t=>JSON.stringify(Array.from(t))},date:{read:t=>new Date(t),write:t=>t.toISOString()}},dr="vueuse-storage";function mi(t,e,r,n={}){var a;const{flush:i="pre",deep:s=!0,listenToStorageChanges:o=!0,writeDefaults:c=!0,mergeDefaults:u=!1,shallow:l,window:f=oe,eventFilter:d,onError:h=O=>{console.error(O)},initOnMounted:v}=n,w=(l?Ut:na)(typeof e=="function"?e():e),y=Vt(()=>J(t));if(!r)try{r=vi("getDefaultStorage",()=>{var O;return(O=oe)==null?void 0:O.localStorage})()}catch(O){h(O)}if(!r)return w;const b=J(e),m=pi(b),g=(a=n.serializer)!=null?a:gi[m],{pause:S,resume:E}=Ka(w,()=>R(w.value),{flush:i,deep:s,eventFilter:d});Xa(y,()=>L(),{flush:i});let I=!1;const j=O=>{v&&!I||L(O)},W=O=>{v&&!I||La(O)};f&&o&&(r instanceof Storage?fr(f,"storage",j,{passive:!0}):fr(f,dr,W)),v?Ha(()=>{I=!0,L()}):L();function x(O,q){if(f){const D={key:y.value,oldValue:O,newValue:q,storageArea:r};f.dispatchEvent(r instanceof Storage?new StorageEvent("storage",D):new CustomEvent(dr,{detail:D}))}}function R(O){try{const q=r.getItem(y.value);if(O==null)x(q,null),r.removeItem(y.value);else{const D=g.write(O);q!==D&&(r.setItem(y.value,D),x(q,D))}}catch(q){h(q)}}function Q(O){const q=O?O.newValue:r.getItem(y.value);if(q==null)return c&&b!=null&&r.setItem(y.value,g.write(b)),b;if(!O&&u){const D=g.read(q);return typeof u=="function"?u(D,b):m==="object"&&!Array.isArray(D)?{...b,...D}:D}else return typeof q!="string"?q:g.read(q)}function L(O){if(!(O&&O.storageArea!==r)){if(O&&O.key==null){w.value=b;return}if(!(O&&O.key!==y.value)){S();try{O?.newValue!==g.write(w.value)&&(w.value=Q(O))}catch(q){h(q)}finally{O?Qa(E):E()}}}}function La(O){L(O.detail)}return w}function H(t,e,r={}){const{window:n=oe}=r;return mi(t,e,n?.localStorage,r)}const V="shodoku.app.config.sync.remote",bi=H(`${V}.fetch.method`,"GET"),wi=H(`${V}.fetch.url`,""),_i=H(`${V}.fetch.headers`,[]),Si=H(`${V}.push.method`,"PUT"),Ai=H(`${V}.push.url`,""),Oi=H(`${V}.push.headers`,[]),la=H(`${V}.push.body`,void 0);function po(){return ta(async()=>await(await k).count("syncs")>0)}function go(){return ta(async()=>await(await k).count("sync.staging.stores")>0)}function fa(t){return typeof t!="object"?typeof t:t===null?"null":t.constructor.name}function Yt(t,e){return`Expected "${t}" but got "${fa(e)}"`}function Jt(t,e,r){return`Expected key "${t}" to be "${e}" but is "${fa(r)}"`}class F extends Error{name="AssertationError";code="ERR_ASSERTION";actual;constructor(e={}){if(e.message)super(e.message);else{let r;"actual"in e&&(r=`Assertion failed with "${e.actual}"`),super(r||"Assertion failed")}this.actual=e.actual}}function da(t){if(typeof t!="string")throw new F({message:Yt("String",t),actual:t})}function ne(t){if(!Array.isArray(t))throw new F({message:Yt("Array",t),actual:t})}function ha(t){if(typeof t!="object"||t==null)throw new F({message:Yt("Object",t),actual:t})}function Xt(t,e){if(!(t in e))throw new F({message:`Expected object to have key "${String(t)}" but none found`,actual:e})}function U(t,e,{optional:r=!1,nullable:n=!1}={}){if(!(r&&!(t in e))&&(Xt(t,e),typeof e[t]!="string")){if(n&&e[t]===null||r&&typeof e[t]>"u")return;throw new F({message:Jt(String(t),"String",e[t]),actual:e})}}function hr(t,e,{optional:r=!1,nullable:n=!1}={}){if(!(r&&!(t in e))&&(Xt(t,e),typeof e[t]!="number")){if(n&&e[t]===null||r&&typeof e[t]>"u")return;throw new F({message:Jt(String(t),"Number",e[t]),actual:e})}}function ue(t,e,{optional:r=!1,nullable:n=!1}={}){if(!(r&&!(t in e))&&(Xt(t,e),!Array.isArray(e[t]))){if(n&&e[t]===null||r&&typeof e[t]>"u")return;throw new F({message:Jt(String(t),"Array",e[t]),actual:e})}}function ye(t,e,{optional:r=!1,nullable:n=!1}={}){ue(t,e,{optional:r,nullable:n});const a=e[t];if(a)for(const i of a)da(i)}var yr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vr={},pr={},ee,gr;function T(){if(gr)return ee;gr=1;var t=function(e){return e&&e.Math===Math&&e};return ee=t(typeof globalThis=="object"&&globalThis)||t(typeof window=="object"&&window)||t(typeof self=="object"&&self)||t(typeof yr=="object"&&yr)||t(typeof ee=="object"&&ee)||function(){return this}()||Function("return this")(),ee}var ve={},pe,mr;function G(){return mr||(mr=1,pe=function(t){try{return!!t()}catch{return!0}}),pe}var ge,br;function z(){if(br)return ge;br=1;var t=G();return ge=!t(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ge}var me,wr;function ya(){if(wr)return me;wr=1;var t=G();return me=!t(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),me}var be,_r;function Zt(){if(_r)return be;_r=1;var t=ya(),e=Function.prototype.call;return be=t?e.bind(e):function(){return e.apply(e,arguments)},be}var we={},Sr;function Ei(){if(Sr)return we;Sr=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,r=e&&!t.call({1:2},1);return we.f=r?function(a){var i=e(this,a);return!!i&&i.enumerable}:t,we}var _e,Ar;function va(){return Ar||(Ar=1,_e=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}}),_e}var Se,Or;function P(){if(Or)return Se;Or=1;var t=ya(),e=Function.prototype,r=e.call,n=t&&e.bind.bind(r,r);return Se=t?n:function(a){return function(){return r.apply(a,arguments)}},Se}var Ae,Er;function Qt(){if(Er)return Ae;Er=1;var t=P(),e=t({}.toString),r=t("".slice);return Ae=function(n){return r(e(n),8,-1)},Ae}var Oe,Ir;function Ii(){if(Ir)return Oe;Ir=1;var t=P(),e=G(),r=Qt(),n=Object,a=t("".split);return Oe=e(function(){return!n("z").propertyIsEnumerable(0)})?function(i){return r(i)==="String"?a(i,""):n(i)}:n,Oe}var Ee,Rr;function pa(){return Rr||(Rr=1,Ee=function(t){return t==null}),Ee}var Ie,Tr;function ga(){if(Tr)return Ie;Tr=1;var t=pa(),e=TypeError;return Ie=function(r){if(t(r))throw new e("Can't call method on "+r);return r},Ie}var Re,xr;function er(){if(xr)return Re;xr=1;var t=Ii(),e=ga();return Re=function(r){return t(e(r))},Re}var Te,qr;function B(){if(qr)return Te;qr=1;var t=typeof document=="object"&&document.all;return Te=typeof t>"u"&&t!==void 0?function(e){return typeof e=="function"||e===t}:function(e){return typeof e=="function"},Te}var xe,Mr;function Z(){if(Mr)return xe;Mr=1;var t=B();return xe=function(e){return typeof e=="object"?e!==null:t(e)},xe}var qe,jr;function ma(){if(jr)return qe;jr=1;var t=T(),e=B(),r=function(n){return e(n)?n:void 0};return qe=function(n,a){return arguments.length<2?r(t[n]):t[n]&&t[n][a]},qe}var Me,Pr;function Ri(){if(Pr)return Me;Pr=1;var t=P();return Me=t({}.isPrototypeOf),Me}var je,Dr;function Ti(){if(Dr)return je;Dr=1;var t=T(),e=t.navigator,r=e&&e.userAgent;return je=r?String(r):"",je}var Pe,Cr;function xi(){if(Cr)return Pe;Cr=1;var t=T(),e=Ti(),r=t.process,n=t.Deno,a=r&&r.versions||n&&n.version,i=a&&a.v8,s,o;return i&&(s=i.split("."),o=s[0]>0&&s[0]<4?1:+(s[0]+s[1])),!o&&e&&(s=e.match(/Edge\/(\d+)/),(!s||s[1]>=74)&&(s=e.match(/Chrome\/(\d+)/),s&&(o=+s[1]))),Pe=o,Pe}var De,Nr;function ba(){if(Nr)return De;Nr=1;var t=xi(),e=G(),r=T(),n=r.String;return De=!!Object.getOwnPropertySymbols&&!e(function(){var a=Symbol("symbol detection");return!n(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&t&&t<41}),De}var Ce,Br;function wa(){if(Br)return Ce;Br=1;var t=ba();return Ce=t&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ce}var Ne,Fr;function _a(){if(Fr)return Ne;Fr=1;var t=ma(),e=B(),r=Ri(),n=wa(),a=Object;return Ne=n?function(i){return typeof i=="symbol"}:function(i){var s=t("Symbol");return e(s)&&r(s.prototype,a(i))},Ne}var Be,$r;function qi(){if($r)return Be;$r=1;var t=String;return Be=function(e){try{return t(e)}catch{return"Object"}},Be}var Fe,Lr;function Sa(){if(Lr)return Fe;Lr=1;var t=B(),e=qi(),r=TypeError;return Fe=function(n){if(t(n))return n;throw new r(e(n)+" is not a function")},Fe}var $e,Ur;function Mi(){if(Ur)return $e;Ur=1;var t=Sa(),e=pa();return $e=function(r,n){var a=r[n];return e(a)?void 0:t(a)},$e}var Le,kr;function ji(){if(kr)return Le;kr=1;var t=Zt(),e=B(),r=Z(),n=TypeError;return Le=function(a,i){var s,o;if(i==="string"&&e(s=a.toString)&&!r(o=t(s,a))||e(s=a.valueOf)&&!r(o=t(s,a))||i!=="string"&&e(s=a.toString)&&!r(o=t(s,a)))return o;throw new n("Can't convert object to primitive value")},Le}var Ue={exports:{}},ke,Gr;function Pi(){return Gr||(Gr=1,ke=!1),ke}var Ge,Kr;function tr(){if(Kr)return Ge;Kr=1;var t=T(),e=Object.defineProperty;return Ge=function(r,n){try{e(t,r,{value:n,configurable:!0,writable:!0})}catch{t[r]=n}return n},Ge}var Hr;function rr(){if(Hr)return Ue.exports;Hr=1;var t=Pi(),e=T(),r=tr(),n="__core-js_shared__",a=Ue.exports=e[n]||r(n,{});return(a.versions||(a.versions=[])).push({version:"3.44.0",mode:t?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.44.0/LICENSE",source:"https://github.com/zloirock/core-js"}),Ue.exports}var Ke,Vr;function Aa(){if(Vr)return Ke;Vr=1;var t=rr();return Ke=function(e,r){return t[e]||(t[e]=r||{})},Ke}var He,zr;function Di(){if(zr)return He;zr=1;var t=ga(),e=Object;return He=function(r){return e(t(r))},He}var Ve,Wr;function K(){if(Wr)return Ve;Wr=1;var t=P(),e=Di(),r=t({}.hasOwnProperty);return Ve=Object.hasOwn||function(a,i){return r(e(a),i)},Ve}var ze,Yr;function Oa(){if(Yr)return ze;Yr=1;var t=P(),e=0,r=Math.random(),n=t(1.1.toString);return ze=function(a){return"Symbol("+(a===void 0?"":a)+")_"+n(++e+r,36)},ze}var We,Jr;function nr(){if(Jr)return We;Jr=1;var t=T(),e=Aa(),r=K(),n=Oa(),a=ba(),i=wa(),s=t.Symbol,o=e("wks"),c=i?s.for||s:s&&s.withoutSetter||n;return We=function(u){return r(o,u)||(o[u]=a&&r(s,u)?s[u]:c("Symbol."+u)),o[u]},We}var Ye,Xr;function Ci(){if(Xr)return Ye;Xr=1;var t=Zt(),e=Z(),r=_a(),n=Mi(),a=ji(),i=nr(),s=TypeError,o=i("toPrimitive");return Ye=function(c,u){if(!e(c)||r(c))return c;var l=n(c,o),f;if(l){if(u===void 0&&(u="default"),f=t(l,c,u),!e(f)||r(f))return f;throw new s("Can't convert object to primitive value")}return u===void 0&&(u="number"),a(c,u)},Ye}var Je,Zr;function Ea(){if(Zr)return Je;Zr=1;var t=Ci(),e=_a();return Je=function(r){var n=t(r,"string");return e(n)?n:n+""},Je}var Xe,Qr;function Ni(){if(Qr)return Xe;Qr=1;var t=T(),e=Z(),r=t.document,n=e(r)&&e(r.createElement);return Xe=function(a){return n?r.createElement(a):{}},Xe}var Ze,en;function Ia(){if(en)return Ze;en=1;var t=z(),e=G(),r=Ni();return Ze=!t&&!e(function(){return Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a!==7}),Ze}var tn;function Ra(){if(tn)return ve;tn=1;var t=z(),e=Zt(),r=Ei(),n=va(),a=er(),i=Ea(),s=K(),o=Ia(),c=Object.getOwnPropertyDescriptor;return ve.f=t?c:function(l,f){if(l=a(l),f=i(f),o)try{return c(l,f)}catch{}if(s(l,f))return n(!e(r.f,l,f),l[f])},ve}var Qe={},et,rn;function Bi(){if(rn)return et;rn=1;var t=z(),e=G();return et=t&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),et}var tt,nn;function Ta(){if(nn)return tt;nn=1;var t=Z(),e=String,r=TypeError;return tt=function(n){if(t(n))return n;throw new r(e(n)+" is not an object")},tt}var an;function ar(){if(an)return Qe;an=1;var t=z(),e=Ia(),r=Bi(),n=Ta(),a=Ea(),i=TypeError,s=Object.defineProperty,o=Object.getOwnPropertyDescriptor,c="enumerable",u="configurable",l="writable";return Qe.f=t?r?function(d,h,v){if(n(d),h=a(h),n(v),typeof d=="function"&&h==="prototype"&&"value"in v&&l in v&&!v[l]){var w=o(d,h);w&&w[l]&&(d[h]=v.value,v={configurable:u in v?v[u]:w[u],enumerable:c in v?v[c]:w[c],writable:!1})}return s(d,h,v)}:s:function(d,h,v){if(n(d),h=a(h),n(v),e)try{return s(d,h,v)}catch{}if("get"in v||"set"in v)throw new i("Accessors not supported");return"value"in v&&(d[h]=v.value),d},Qe}var rt,sn;function xa(){if(sn)return rt;sn=1;var t=z(),e=ar(),r=va();return rt=t?function(n,a,i){return e.f(n,a,r(1,i))}:function(n,a,i){return n[a]=i,n},rt}var nt={exports:{}},at,on;function Fi(){if(on)return at;on=1;var t=z(),e=K(),r=Function.prototype,n=t&&Object.getOwnPropertyDescriptor,a=e(r,"name"),i=a&&(function(){}).name==="something",s=a&&(!t||t&&n(r,"name").configurable);return at={EXISTS:a,PROPER:i,CONFIGURABLE:s},at}var it,un;function $i(){if(un)return it;un=1;var t=P(),e=B(),r=rr(),n=t(Function.toString);return e(r.inspectSource)||(r.inspectSource=function(a){return n(a)}),it=r.inspectSource,it}var st,cn;function Li(){if(cn)return st;cn=1;var t=T(),e=B(),r=t.WeakMap;return st=e(r)&&/native code/.test(String(r)),st}var ot,ln;function Ui(){if(ln)return ot;ln=1;var t=Aa(),e=Oa(),r=t("keys");return ot=function(n){return r[n]||(r[n]=e(n))},ot}var ut,fn;function qa(){return fn||(fn=1,ut={}),ut}var ct,dn;function ki(){if(dn)return ct;dn=1;var t=Li(),e=T(),r=Z(),n=xa(),a=K(),i=rr(),s=Ui(),o=qa(),c="Object already initialized",u=e.TypeError,l=e.WeakMap,f,d,h,v=function(m){return h(m)?d(m):f(m,{})},w=function(m){return function(g){var S;if(!r(g)||(S=d(g)).type!==m)throw new u("Incompatible receiver, "+m+" required");return S}};if(t||i.state){var y=i.state||(i.state=new l);y.get=y.get,y.has=y.has,y.set=y.set,f=function(m,g){if(y.has(m))throw new u(c);return g.facade=m,y.set(m,g),g},d=function(m){return y.get(m)||{}},h=function(m){return y.has(m)}}else{var b=s("state");o[b]=!0,f=function(m,g){if(a(m,b))throw new u(c);return g.facade=m,n(m,b,g),g},d=function(m){return a(m,b)?m[b]:{}},h=function(m){return a(m,b)}}return ct={set:f,get:d,has:h,enforce:v,getterFor:w},ct}var hn;function Gi(){if(hn)return nt.exports;hn=1;var t=P(),e=G(),r=B(),n=K(),a=z(),i=Fi().CONFIGURABLE,s=$i(),o=ki(),c=o.enforce,u=o.get,l=String,f=Object.defineProperty,d=t("".slice),h=t("".replace),v=t([].join),w=a&&!e(function(){return f(function(){},"length",{value:8}).length!==8}),y=String(String).split("String"),b=nt.exports=function(m,g,S){d(l(g),0,7)==="Symbol("&&(g="["+h(l(g),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),S&&S.getter&&(g="get "+g),S&&S.setter&&(g="set "+g),(!n(m,"name")||i&&m.name!==g)&&(a?f(m,"name",{value:g,configurable:!0}):m.name=g),w&&S&&n(S,"arity")&&m.length!==S.arity&&f(m,"length",{value:S.arity});try{S&&n(S,"constructor")&&S.constructor?a&&f(m,"prototype",{writable:!1}):m.prototype&&(m.prototype=void 0)}catch{}var E=c(m);return n(E,"source")||(E.source=v(y,typeof g=="string"?g:"")),m};return Function.prototype.toString=b(function(){return r(this)&&u(this).source||s(this)},"toString"),nt.exports}var lt,yn;function Ki(){if(yn)return lt;yn=1;var t=B(),e=ar(),r=Gi(),n=tr();return lt=function(a,i,s,o){o||(o={});var c=o.enumerable,u=o.name!==void 0?o.name:i;if(t(s)&&r(s,u,o),o.global)c?a[i]=s:n(i,s);else{try{o.unsafe?a[i]&&(c=!0):delete a[i]}catch{}c?a[i]=s:e.f(a,i,{value:s,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return a},lt}var ft={},dt,vn;function Hi(){if(vn)return dt;vn=1;var t=Math.ceil,e=Math.floor;return dt=Math.trunc||function(n){var a=+n;return(a>0?e:t)(a)},dt}var ht,pn;function Ma(){if(pn)return ht;pn=1;var t=Hi();return ht=function(e){var r=+e;return r!==r||r===0?0:t(r)},ht}var yt,gn;function Vi(){if(gn)return yt;gn=1;var t=Ma(),e=Math.max,r=Math.min;return yt=function(n,a){var i=t(n);return i<0?e(i+a,0):r(i,a)},yt}var vt,mn;function zi(){if(mn)return vt;mn=1;var t=Ma(),e=Math.min;return vt=function(r){var n=t(r);return n>0?e(n,9007199254740991):0},vt}var pt,bn;function ja(){if(bn)return pt;bn=1;var t=zi();return pt=function(e){return t(e.length)},pt}var gt,wn;function Wi(){if(wn)return gt;wn=1;var t=er(),e=Vi(),r=ja(),n=function(a){return function(i,s,o){var c=t(i),u=r(c);if(u===0)return!a&&-1;var l=e(o,u),f;if(a&&s!==s){for(;u>l;)if(f=c[l++],f!==f)return!0}else for(;u>l;l++)if((a||l in c)&&c[l]===s)return a||l||0;return!a&&-1}};return gt={includes:n(!0),indexOf:n(!1)},gt}var mt,_n;function Yi(){if(_n)return mt;_n=1;var t=P(),e=K(),r=er(),n=Wi().indexOf,a=qa(),i=t([].push);return mt=function(s,o){var c=r(s),u=0,l=[],f;for(f in c)!e(a,f)&&e(c,f)&&i(l,f);for(;o.length>u;)e(c,f=o[u++])&&(~n(l,f)||i(l,f));return l},mt}var bt,Sn;function Ji(){return Sn||(Sn=1,bt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),bt}var An;function Xi(){if(An)return ft;An=1;var t=Yi(),e=Ji(),r=e.concat("length","prototype");return ft.f=Object.getOwnPropertyNames||function(a){return t(a,r)},ft}var wt={},On;function Zi(){return On||(On=1,wt.f=Object.getOwnPropertySymbols),wt}var _t,En;function Qi(){if(En)return _t;En=1;var t=ma(),e=P(),r=Xi(),n=Zi(),a=Ta(),i=e([].concat);return _t=t("Reflect","ownKeys")||function(o){var c=r.f(a(o)),u=n.f;return u?i(c,u(o)):c},_t}var St,In;function es(){if(In)return St;In=1;var t=K(),e=Qi(),r=Ra(),n=ar();return St=function(a,i,s){for(var o=e(i),c=n.f,u=r.f,l=0;l<o.length;l++){var f=o[l];!t(a,f)&&!(s&&t(s,f))&&c(a,f,u(i,f))}},St}var At,Rn;function ts(){if(Rn)return At;Rn=1;var t=G(),e=B(),r=/#|\.prototype\./,n=function(c,u){var l=i[a(c)];return l===o?!0:l===s?!1:e(u)?t(u):!!u},a=n.normalize=function(c){return String(c).replace(r,".").toLowerCase()},i=n.data={},s=n.NATIVE="N",o=n.POLYFILL="P";return At=n,At}var Ot,Tn;function Pa(){if(Tn)return Ot;Tn=1;var t=T(),e=Ra().f,r=xa(),n=Ki(),a=tr(),i=es(),s=ts();return Ot=function(o,c){var u=o.target,l=o.global,f=o.stat,d,h,v,w,y,b;if(l?h=t:f?h=t[u]||a(u,{}):h=t[u]&&t[u].prototype,h)for(v in c){if(y=c[v],o.dontCallGetSet?(b=e(h,v),w=b&&b.value):w=h[v],d=s(l?v:u+(f?".":"#")+v,o.forced),!d&&w!==void 0){if(typeof y==typeof w)continue;i(y,w)}(o.sham||w&&w.sham)&&r(y,"sham",!0),n(h,v,y,o)}},Ot}var Et,xn;function rs(){if(xn)return Et;xn=1;var t=ja();return Et=function(e,r,n){for(var a=0,i=arguments.length>2?n:t(r),s=new e(i);i>a;)s[a]=r[a++];return s},Et}var It,qn;function Da(){if(qn)return It;qn=1;var t=Z(),e=String,r=TypeError;return It=function(n){if(n===void 0||t(n))return n;throw new r(e(n)+" is not an object or undefined")},It}var Rt,Mn;function ns(){if(Mn)return Rt;Mn=1;var t=TypeError;return Rt=function(e){if(typeof e=="string")return e;throw new t("Argument is not a string")},Rt}var Tt,jn;function Ca(){if(jn)return Tt;jn=1;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=t+"+/",r=t+"-_",n=function(a){for(var i={},s=0;s<64;s++)i[a.charAt(s)]=s;return i};return Tt={i2c:e,c2i:n(e),i2cUrl:r,c2iUrl:n(r)},Tt}var xt,Pn;function Na(){if(Pn)return xt;Pn=1;var t=TypeError;return xt=function(e){var r=e&&e.alphabet;if(r===void 0||r==="base64"||r==="base64url")return r||"base64";throw new t("Incorrect `alphabet` option")},xt}var qt,Dn;function as(){return Dn||(Dn=1,qt=typeof ArrayBuffer<"u"&&typeof DataView<"u"),qt}var Mt,Cn;function is(){if(Cn)return Mt;Cn=1;var t=P(),e=Sa();return Mt=function(r,n,a){try{return t(e(Object.getOwnPropertyDescriptor(r,n)[a]))}catch{}},Mt}var jt,Nn;function ss(){if(Nn)return jt;Nn=1;var t=T(),e=is(),r=Qt(),n=t.ArrayBuffer,a=t.TypeError;return jt=n&&e(n.prototype,"byteLength","get")||function(i){if(r(i)!=="ArrayBuffer")throw new a("ArrayBuffer expected");return i.byteLength},jt}var Pt,Bn;function os(){if(Bn)return Pt;Bn=1;var t=T(),e=as(),r=ss(),n=t.DataView;return Pt=function(a){if(!e||r(a)!==0)return!1;try{return new n(a),!1}catch{return!0}},Pt}var Dt,Fn;function Ba(){if(Fn)return Dt;Fn=1;var t=os(),e=TypeError;return Dt=function(r){if(t(r))throw new e("ArrayBuffer is detached");return r},Dt}var Ct,$n;function us(){if($n)return Ct;$n=1;var t=T(),e=P(),r=Da(),n=ns(),a=K(),i=Ca(),s=Na(),o=Ba(),c=i.c2i,u=i.c2iUrl,l=t.SyntaxError,f=t.TypeError,d=e("".charAt),h=function(y,b){for(var m=y.length;b<m;b++){var g=d(y,b);if(g!==" "&&g!=="	"&&g!==`
`&&g!=="\f"&&g!=="\r")break}return b},v=function(y,b,m){var g=y.length;g<4&&(y+=g===2?"AA":"A");var S=(b[d(y,0)]<<18)+(b[d(y,1)]<<12)+(b[d(y,2)]<<6)+b[d(y,3)],E=[S>>16&255,S>>8&255,S&255];if(g===2){if(m&&E[1]!==0)throw new l("Extra bits");return[E[0]]}if(g===3){if(m&&E[2]!==0)throw new l("Extra bits");return[E[0],E[1]]}return E},w=function(y,b,m){for(var g=b.length,S=0;S<g;S++)y[m+S]=b[S];return m+g};return Ct=function(y,b,m,g){n(y),r(b);var S=s(b)==="base64"?c:u,E=b?b.lastChunkHandling:void 0;if(E===void 0&&(E="loose"),E!=="loose"&&E!=="strict"&&E!=="stop-before-partial")throw new f("Incorrect `lastChunkHandling` option");m&&o(m.buffer);var I=m||[],j=0,W=0,x="",R=0;if(g)for(;;){if(R=h(y,R),R===y.length){if(x.length>0){if(E==="stop-before-partial")break;if(E==="loose"){if(x.length===1)throw new l("Malformed padding: exactly one additional character");j=w(I,v(x,S,!1),j)}else throw new l("Missing padding")}W=y.length;break}var Q=d(y,R);if(++R,Q==="="){if(x.length<2)throw new l("Padding is too early");if(R=h(y,R),x.length===2){if(R===y.length){if(E==="stop-before-partial")break;throw new l("Malformed padding: only one =")}d(y,R)==="="&&(++R,R=h(y,R))}if(R<y.length)throw new l("Unexpected character after padding");j=w(I,v(x,S,E==="strict"),j),W=y.length;break}if(!a(S,Q))throw new l("Unexpected character");var L=g-j;if(L===1&&x.length===2||L===2&&x.length===3||(x+=Q,x.length===4&&(j=w(I,v(x,S,!1),j),x="",W=R,j===g)))break}return{bytes:I,read:W,written:j}},Ct}var Ln;function cs(){if(Ln)return pr;Ln=1;var t=Pa(),e=T(),r=rs(),n=us(),a=e.Uint8Array,i=!a||!a.fromBase64||!function(){try{a.fromBase64("",null)}catch{return!0}}();return a&&t({target:"Uint8Array",stat:!0,forced:i},{fromBase64:function(o){var c=n(o,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return r(a,c.bytes)}}),pr}var Un;function ls(){return Un||(Un=1,cs()),vr}ls();var kn={},Gn={},Nt,Kn;function fs(){if(Kn)return Nt;Kn=1;var t=nr(),e=t("toStringTag"),r={};return r[e]="z",Nt=String(r)==="[object z]",Nt}var Bt,Hn;function ds(){if(Hn)return Bt;Hn=1;var t=fs(),e=B(),r=Qt(),n=nr(),a=n("toStringTag"),i=Object,s=r(function(){return arguments}())==="Arguments",o=function(c,u){try{return c[u]}catch{}};return Bt=t?r:function(c){var u,l,f;return c===void 0?"Undefined":c===null?"Null":typeof(l=o(u=i(c),a))=="string"?l:s?r(u):(f=r(u))==="Object"&&e(u.callee)?"Arguments":f},Bt}var Ft,Vn;function hs(){if(Vn)return Ft;Vn=1;var t=ds(),e=TypeError;return Ft=function(r){if(t(r)==="Uint8Array")return r;throw new e("Argument is not an Uint8Array")},Ft}var zn;function ys(){if(zn)return Gn;zn=1;var t=Pa(),e=T(),r=P(),n=Da(),a=hs(),i=Ba(),s=Ca(),o=Na(),c=s.i2c,u=s.i2cUrl,l=r("".charAt),f=e.Uint8Array,d=!f||!f.prototype.toBase64||!function(){try{var h=new f;h.toBase64(null)}catch{return!0}}();return f&&t({target:"Uint8Array",proto:!0,forced:d},{toBase64:function(){var v=a(this),w=arguments.length?n(arguments[0]):void 0,y=o(w)==="base64"?c:u,b=!!w&&!!w.omitPadding;i(this.buffer);for(var m="",g=0,S=v.length,E,I=function(j){return l(y,E>>6*j&63)};g+2<S;g+=3)E=(v[g]<<16)+(v[g+1]<<8)+v[g+2],m+=I(3)+I(2)+I(1)+I(0);return g+2===S?(E=(v[g]<<16)+(v[g+1]<<8),m+=I(3)+I(2)+I(1)+(b?"":"=")):g+1===S&&(E=v[g]<<16,m+=I(3)+I(2)+(b?"":"==")),m}}),Gn}var Wn;function vs(){return Wn||(Wn=1,ys()),kn}vs();const ps=new RegExp("\\p{Script=Han}","u"),gs=new RegExp("^\\p{Script=Han}$","u"),ms=/[\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}\u{2e80}-\u{2fd5}\u{3000}-\u{303f}\u{31f0}-\u{31ff}\u{3220}-\u{3243}\u{3280}-\u{337f}\u{ff5f}-\u{ff9f}\u{ff01}-\u{ff5e}]/u;function mo(t){return ms.test(t)}function bo(t){return ps.test(t)}function wo(t){return gs.test(t)}function bs(t){return new TextDecoder().decode(Uint8Array.fromBase64(t))}function ws(t){return new TextEncoder().encode(t).toBase64()}const kt=["bookmarked-words","cards","decks","progress","reviews"],_s="${PLACEHOLDER}";function Ss(t){if(!kt.includes(t))throw new F({actual:t,message:`Expected "${t}" to be a store name`})}function As(t,e){ue(t,e);for(const r of e[t]){ha(r),U("name",r),Ss(r.name),ye("add",r,{optional:!0}),ue("set",r,{optional:!0});for(const n of r.set??[]){if(ne(n),n.length!==2)throw new F({actual:n,message:`Excpected a 2-tuple. Got ${n.length}-tuple`});da(n[0]),ne(n[1]);for(const a of n[1]){if(ne(a),a.length!==3)throw new F({actual:n,message:`Excpected a 3-tuple. Got ${a.length}-tuple`});U(0,a),ye(1,a),U(2,a)}}ye("delete",r,{optional:!0})}}function Os(t,e){ue(t,e);for(const r of e[t])ne(r),U(0,r),U(1,r,{nullable:!0})}async function Es(){const t=bi.value,e=URL.parse(wi.value),r=new Headers(_i.value);if(!e)throw new Error("Remote sync not set up");e.host==="gist.githubusercontent.com"&&e.searchParams.set("cachebuster",new Date().toISOString());const a=await fetch(e,{method:t,headers:r,mode:"cors"}),i=await a.text();if(!a.ok)throw new Error(`Error ${a.status} fetching sync: ${i}`);if(!i.trim())return[];const s=la.value,o=JSON.parse(s?bs(i):i);return ne(o),o.map(c=>(ha(c),U("hash",c),U("parent",c,{nullable:!0}),U("syncedAt",c),hr("dbVersion",c),hr("patchVersion",c),As("stores",c),Os("preferences",c),{...c,syncedAt:new Date(c.syncedAt)}))}async function Is(t){const e=Si.value,r=URL.parse(Ai.value),n=new Headers(Oi.value),a=la.value;if(!r)throw new Error("Remote sync not set up");let i=JSON.stringify(t);a&&(i=a.replace(_s,ws(i)));const s=await fetch(r,{method:e,headers:n,body:i,mode:"cors"});if(!s.ok)throw new Error(`Error ${s.status} pushing sync: ${await s.text()}`)}const $="shodoku.app.sync.latest",Rs=1;async function Ts(t){const e=JSON.stringify(t),r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function xs(t){const e={...t,parent:localStorage.getItem($)};return{...e,hash:await Ts(e)}}async function qs(){const t=await k,e=t.transaction(kt),r=[];for(const n of kt){const a=e.objectStore(n),i=await a.getAll();if(i.length===0)continue;const s=i.map(o=>{if(a.autoIncrement&&typeof a.keyPath=="string"){const c=a.keyPath;delete o[c]}return re(o)});r.push({name:n,add:s})}return r.length===0?null:{syncedAt:new Date,dbVersion:t.version,patchVersion:Rs,stores:r,preferences:[]}}async function Ms(){const t=await k;if(await t.count("syncs")===0&&localStorage.getItem($)&&localStorage.removeItem($),!localStorage.getItem($))return qs();const e=t.transaction(t.objectStoreNames),r=await aa(e.objectStore("sync.staging.stores").iterate(),ti(a=>a.value),ei(a=>a.store));if(r.size===0)return null;const n=[];for(const[a,i]of r){const s=[],o=[],c=[];for(const l of i)if(l.op==="add"){const f=e.objectStore(a),d=await f.get(l.key);if(!d)continue;if(f.autoIncrement&&typeof f.keyPath=="string"){const h=f.keyPath;delete d[h]}s.push(re(d))}else l.op==="put"?o.push(re(await e.objectStore(a).get(l.key))):c.push(re(l.key));const u={name:a};s.length>0&&(u.add=s),o.length>0&&(u.put=o),c.length>0&&(u.delete=c),(u.add||u.put||u.delete)&&n.push(u)}return{syncedAt:new Date,dbVersion:t.version,patchVersion:1,stores:n,preferences:[]}}function Gt(t,e){if(Array.isArray(t))return t.map(n=>Gt(n,e));let r=e;for(const n of t.split("."))r=r[n];return r}function js(t,e){return t.updatedAt?e.updatedAt?t.updatedAt>e.updatedAt:!0:e.updatedAt?!1:t.createdAt>e.createdAt}function Ps(t,e){return t.fsrs.last_review?e.fsrs.last_review?t.fsrs.last_review>e.fsrs.last_review:!0:!1}function Ds(t,e){return t.log.review>e.log.review}function Cs(t,e){return t.bookmarkedAt>e.bookmarkedAt}function Ns(t,e,r){return t==="decks"?js(e,r):t==="progress"?Ps(e,r):t==="reviews"?Ds(e,r):t==="bookmarked-words"?Cs(e,r):!0}function Bs(t,e,r){if(!r)return;const n=r.stores.find(({name:i})=>i===t);if(!n?.add)return;const a=n.add.indexOf(e);a!==-1&&n.add.splice(a,1)}function Fs(t,e,r){if(!r)return;const n=r.stores.find(({name:i})=>i===t);if(!n)return;let a=n.put;a||(a=[],n.put=a),a.push(e)}function Yn(t){return t instanceof DOMException&&t.name==="ConstraintError"}async function $s(t,e){const r=await k,n=r.transaction(r.objectStoreNames,"readwrite"),a=localStorage.getItem($)??null;let i;for(const s of aa(t,ri(({parent:o})=>o!==a))){for(const o of s.stores){const c=n.objectStore(o.name);for(const u of o.add??[]){const l=de(u),f=c.add(l),d=Ua(f);d.addEventListener("error",h=>{Yn(d.error)&&(h.preventDefault(),h.stopPropagation())});try{await f}catch(h){if(Yn(h)){const v=await c.get(Gt(c.keyPath,l));if(v){const w=re(v);Bs(o.name,w,e),Ns(o.name,v,l)?Fs(o.name,w,e):c.put(l)}}else throw h}}for(const u of o.put??[]){const l=de(u),f=await c.openCursor(Gt(c.keyPath,l));f&&f.update(l)}for(const u of o.delete??[]){const l=de(u);console.log(l),c.delete(l)}}n.objectStore("syncs").add(s),i=s.hash}await n.done,i&&localStorage.setItem($,i)}async function _o(){const t=await Es(),e=await Ms();if(await $s(t,e),!e)return;const r=await xs(e),a=(await k).transaction(["sync.staging.preferences","sync.staging.stores","syncs"],"readwrite");a.objectStore("sync.staging.stores").clear(),a.objectStore("sync.staging.preferences").clear(),a.objectStore("syncs").add(r),await a.done,localStorage.setItem($,r.hash),ra.postMessage("sync-enabled"),await Is([...t,r])}function Ls(){return localStorage.getItem($)!=null}async function So(){const e=(await k).transaction(["sync.staging.preferences","sync.staging.stores","syncs"],"readwrite");e.objectStore("sync.staging.stores").clear(),e.objectStore("sync.staging.preferences").clear(),e.objectStore("syncs").clear(),await e.done,localStorage.removeItem($),ra.postMessage("sync-disabled")}async function Ao(t){if(!Ls())return;const r=(await k).transaction("sync.staging.stores","readwrite");for(const n of t)r.store.add(n);await r.done}var A=(t=>(t[t.New=0]="New",t[t.Learning=1]="Learning",t[t.Review=2]="Review",t[t.Relearning=3]="Relearning",t))(A||{}),p=(t=>(t[t.Manual=0]="Manual",t[t.Again=1]="Again",t[t.Hard=2]="Hard",t[t.Good=3]="Good",t[t.Easy=4]="Easy",t))(p||{});class _{static card(e){return{...e,state:_.state(e.state),due:_.time(e.due),last_review:e.last_review?_.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){const r=e.charAt(0).toUpperCase(),n=e.slice(1).toLowerCase(),a=p[`${r}${n}`];if(a===void 0)throw new Error(`Invalid rating:[${e}]`);return a}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){const r=e.charAt(0).toUpperCase(),n=e.slice(1).toLowerCase(),a=A[`${r}${n}`];if(a===void 0)throw new Error(`Invalid state:[${e}]`);return a}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){const r=Date.parse(e);if(Number.isNaN(r))throw new Error(`Invalid date:[${e}]`);return new Date(r)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:_.time(e.due),rating:_.rating(e.rating),state:_.state(e.state),review:_.time(e.review)}}}Date.prototype.scheduler=function(t,e){return C(this,t,e)};Date.prototype.diff=function(t,e){return X(this,t,e)};Date.prototype.format=function(){return Us(this)};Date.prototype.dueFormat=function(t,e,r){return ks(this,t,e,r)};function C(t,e,r){return new Date(r?_.time(t).getTime()+e*24*60*60*1e3:_.time(t).getTime()+e*60*1e3)}function X(t,e,r){if(!t||!e)throw new Error("Invalid date");const n=_.time(t).getTime()-_.time(e).getTime();let a=0;switch(r){case"days":a=Math.floor(n/(24*60*60*1e3));break;case"minutes":a=Math.floor(n/(60*1e3));break}return a}function Us(t){const e=_.time(t),r=e.getFullYear(),n=e.getMonth()+1,a=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds();return`${r}-${te(n)}-${te(a)} ${te(i)}:${te(s)}:${te(o)}`}function te(t){return t<10?`0${t}`:`${t}`}const $t=[60,60,24,31,12],Lt=["second","min","hour","day","month","year"];function ks(t,e,r,n=Lt){t=_.time(t),e=_.time(e),n.length!==Lt.length&&(n=Lt);let a=t.getTime()-e.getTime(),i=0;for(a/=1e3,i=0;i<$t.length&&!(a<$t[i]);i++)a/=$t[i];return`${Math.floor(a)}${r?n[i]:""}`}const Gs=Object.freeze([p.Again,p.Hard,p.Good,p.Easy]),Ks=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function Hs(t,e,r){let n=1;for(const s of Ks)n+=s.factor*Math.max(Math.min(t,s.end)-s.start,0);t=Math.min(t,r);let a=Math.max(2,Math.round(t-n));const i=Math.min(Math.round(t+n),r);return t>e&&(a=Math.max(a,e+1)),a=Math.min(a,i),{min_ivl:a,max_ivl:i}}function M(t,e,r){return Math.min(Math.max(t,e),r)}function Vs(t,e){const r=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),n=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((n-r)/864e5)}const zs=t=>{const e=t.slice(-1),r=parseInt(t.slice(0,-1),10);if(Number.isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${t}`);switch(e){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${t}, expected m/h/d`)}},Ws=(t,e,r)=>{const n=e===A.Relearning||e===A.Review?t.relearning_steps:t.learning_steps,a=n.length;if(a===0||r>=a)return{};const i=n[0],s=zs,o=()=>s(i),c=()=>{if(a===1)return Math.round(s(i)*1.5);const h=n[1];return Math.round((s(i)+s(h))/2)},u=h=>h<0||h>=a?null:n[h],l=h=>s(h),f={},d=u(Math.max(0,r));if(e===A.Review)return f[p.Again]={scheduled_minutes:s(d),next_step:0},f;{f[p.Again]={scheduled_minutes:o(),next_step:0},f[p.Hard]={scheduled_minutes:c(),next_step:r};const h=u(r+1);if(h){const v=l(h);v&&(f[p.Good]={scheduled_minutes:Math.round(v),next_step:r+1})}}return f};function Ys(){const t=this.review_time.getTime(),e=this.current.reps,r=this.current.difficulty*this.current.stability;return`${t}_${e}_${r}`}var ce=(t=>(t.SCHEDULER="Scheduler",t.LEARNING_STEPS="LearningSteps",t.SEED="Seed",t))(ce||{});class Fa{last;current;review_time;next=new Map;algorithm;strategies;elapsed_days=0;constructor(e,r,n,a){this.algorithm=n,this.last=_.card(e),this.current=_.card(e),this.review_time=_.time(r),this.strategies=a,this.init()}checkGrade(e){if(!Number.isFinite(e)||e<0||e>4)throw new Error(`Invalid grade "${e}",expected 1-4`)}init(){const{state:e,last_review:r}=this.current;let n=0;e!==A.New&&r&&(n=Vs(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=n,this.current.elapsed_days=n,this.current.reps+=1;let a=Ys;if(this.strategies){const i=this.strategies.get(ce.SEED);i&&(a=i)}this.algorithm.seed=a.call(this)}preview(){return{[p.Again]:this.review(p.Again),[p.Hard]:this.review(p.Hard),[p.Good]:this.review(p.Good),[p.Easy]:this.review(p.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const e of Gs)yield this.review(e)}review(e){const{state:r}=this.last;let n;switch(this.checkGrade(e),r){case A.New:n=this.newState(e);break;case A.Learning:case A.Relearning:n=this.learningState(e);break;case A.Review:n=this.reviewState(e);break}return n}buildLog(e){const{last_review:r,due:n,elapsed_days:a}=this.last;return{rating:e,state:this.current.state,due:r||n,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:a,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class Js{c;s0;s1;s2;constructor(e){const r=Xs();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),e==null&&(e=Date.now()),this.s0-=r(e),this.s0<0&&(this.s0+=1),this.s1-=r(e),this.s1<0&&(this.s1+=1),this.s2-=r(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.c=e|0,this.s2=e-this.c,this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function Xs(){let t=4022871197;return function(r){r=String(r);for(let n=0;n<r.length;n++){t+=r.charCodeAt(n);let a=.02519603282416938*t;t=a>>>0,a-=t,a*=t,t=a>>>0,a-=t,t+=a*4294967296}return(t>>>0)*23283064365386963e-26}}function Zs(t){const e=new Js(t),r=()=>e.next();return r.int32=()=>e.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>e.state,r.importState=n=>(e.state=n,r),r}const Qs=.9,eo=36500,to=!1,ro=!0,no=Object.freeze(["1m","10m"]),ao=Object.freeze(["10m"]),N=.001,se=100,Jn=.5,io=.1542,Xn=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,io]),so=2,oo=t=>[[N,se],[N,se],[N,se],[N,se],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,t],[0,t],[0,.8],[.1,.8]],ir=(t,e)=>{let r=so;if(Math.max(0,e)>1){const a=-(Math.log(t[11])+Math.log(Math.pow(2,t[13])-1)+t[14]*.3)/e;r=M(+a.toFixed(8),.01,2)}return oo(r).map(([a,i],s)=>M(t[s],a,i))},sr=t=>{if(t===void 0)return[...Xn];switch(t.length){case 21:return[...t];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...t,0,Jn];case 17:{const e=[...t];return e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),e.concat([0,0,0,Jn])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...Xn]}},Zn=t=>{const e=Array.isArray(t?.learning_steps)?t.learning_steps:no,r=Array.isArray(t?.relearning_steps)?t.relearning_steps:ao,n=ir(sr(t?.w),r.length);return{request_retention:t?.request_retention||Qs,maximum_interval:t?.maximum_interval||eo,w:n,enable_fuzz:t?.enable_fuzz??to,enable_short_term:t?.enable_short_term??ro,learning_steps:e,relearning_steps:r}};function Kt(t,e){return{due:t?_.time(t):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:A.New,last_review:void 0}}const $a=t=>{const e=typeof t=="number"?-t:-t[20],r=Math.exp(Math.pow(e,-1)*Math.log(.9))-1;return{decay:e,factor:+r.toFixed(8)}};function Ht(t,e,r){const{decay:n,factor:a}=$a(t);return+Math.pow(1+a*e/r,n).toFixed(8)}class uo{param;intervalModifier;_seed;constructor(e){this.param=new Proxy(Zn(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=Ht.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:n}=$a(this.param.w);return+((Math.pow(e,1/r)-1)/n).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){const e=this;return{set:function(r,n,a){return n==="request_retention"&&Number.isFinite(a)?e.intervalModifier=e.calculate_interval_modifier(Number(a)):n==="w"&&(a=ir(sr(a),r.relearning_steps.length),e.forgetting_curve=Ht.bind(this,a),e.intervalModifier=e.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,n,a),!0}}}update_parameters(e){const r=Zn(e);for(const n in r){const a=n;this.param[a]=r[a]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return+(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(e,r){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);const a=Zs(this._seed)(),{min_ivl:i,max_ivl:s}=Hs(e,r,this.param.maximum_interval);return Math.floor(a*(s-i+1)+i)}next_interval(e,r){const n=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(n,r)}linear_damping(e,r){return+(e*(10-r)/9).toFixed(8)}next_difficulty(e,r){const n=-this.param.w[6]*(r-3),a=e+this.linear_damping(n,e);return M(this.mean_reversion(this.init_difficulty(p.Easy),a),1,10)}mean_reversion(e,r){return+(this.param.w[7]*e+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(e,r,n,a){const i=p.Hard===a?this.param.w[15]:1,s=p.Easy===a?this.param.w[16]:1;return+M(r*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(r,-this.param.w[9])*(Math.exp((1-n)*this.param.w[10])-1)*i*s),N,36500).toFixed(8)}next_forget_stability(e,r,n){return+M(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-n)*this.param.w[14]),N,36500).toFixed(8)}next_short_term_stability(e,r){const n=Math.pow(e,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),a=r>=3?Math.max(n,1):n;return+M(e*a,N,36500).toFixed(8)}forgetting_curve;next_state(e,r,n){const{difficulty:a,stability:i}=e??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(n<0||n>4)throw new Error(`Invalid grade "${n}"`);if(a===0&&i===0)return{difficulty:M(this.init_difficulty(n),1,10),stability:this.init_stability(n)};if(n===0)return{difficulty:a,stability:i};if(a<1||i<N)throw new Error(`Invalid memory state { difficulty: ${a}, stability: ${i} }`);const s=this.forgetting_curve(r,i),o=this.next_recall_stability(a,i,s,n),c=this.next_forget_stability(a,i,s),u=this.next_short_term_stability(i,n);let l=o;if(n===1){let[d,h]=[0,0];this.param.enable_short_term&&(d=this.param.w[17],h=this.param.w[18]);const v=i/Math.exp(d*h);l=M(+v.toFixed(8),N,c)}return r===0&&this.param.enable_short_term&&(l=u),{difficulty:this.next_difficulty(a,n),stability:l}}}class Qn extends Fa{learningStepsStrategy;constructor(e,r,n,a){super(e,r,n,a);let i=Ws;if(this.strategies){const s=this.strategies.get(ce.LEARNING_STEPS);s&&(i=s)}this.learningStepsStrategy=i}getLearningInfo(e,r){const n=this.algorithm.parameters;e.learning_steps=e.learning_steps||0;const a=this.learningStepsStrategy(n,e.state,this.current.state===A.Learning&&r!==p.Again&&r!==p.Hard?e.learning_steps+1:e.learning_steps),i=Math.max(0,a[r]?.scheduled_minutes??0),s=Math.max(0,a[r]?.next_step??0);return{scheduled_minutes:i,next_steps:s}}applyLearningSteps(e,r,n){const{scheduled_minutes:a,next_steps:i}=this.getLearningInfo(this.current,r);if(a>0&&a<1440)e.learning_steps=i,e.scheduled_days=0,e.state=n,e.due=C(this.review_time,Math.round(a),!1);else if(e.state=A.Review,a>=1440)e.learning_steps=i,e.due=C(this.review_time,Math.round(a),!1),e.scheduled_days=Math.floor(a/1440);else{e.learning_steps=0;const s=this.algorithm.next_interval(e.stability,this.elapsed_days);e.scheduled_days=s,e.due=C(this.review_time,s,!0)}}newState(e){const r=this.next.get(e);if(r)return r;const n=_.card(this.current);n.difficulty=M(this.algorithm.init_difficulty(e),1,10),n.stability=this.algorithm.init_stability(e),this.applyLearningSteps(n,e,A.Learning);const a={card:n,log:this.buildLog(e)};return this.next.set(e,a),a}learningState(e){const r=this.next.get(e);if(r)return r;const{state:n,difficulty:a,stability:i}=this.last,s=_.card(this.current);s.difficulty=this.algorithm.next_difficulty(a,e),s.stability=this.algorithm.next_short_term_stability(i,e),this.applyLearningSteps(s,e,n);const o={card:s,log:this.buildLog(e)};return this.next.set(e,o),o}reviewState(e){const r=this.next.get(e);if(r)return r;const n=this.elapsed_days,{difficulty:a,stability:i}=this.last,s=this.algorithm.forgetting_curve(n,i),o=_.card(this.current),c=_.card(this.current),u=_.card(this.current),l=_.card(this.current);this.next_ds(o,c,u,l,a,i,s),this.next_interval(c,u,l,n),this.next_state(c,u,l),this.applyLearningSteps(o,p.Again,A.Relearning),o.lapses+=1;const f={card:o,log:this.buildLog(p.Again)},d={card:c,log:super.buildLog(p.Hard)},h={card:u,log:super.buildLog(p.Good)},v={card:l,log:super.buildLog(p.Easy)};return this.next.set(p.Again,f),this.next.set(p.Hard,d),this.next.set(p.Good,h),this.next.set(p.Easy,v),this.next.get(e)}next_ds(e,r,n,a,i,s,o){e.difficulty=this.algorithm.next_difficulty(i,p.Again);const c=s/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),u=this.algorithm.next_forget_stability(i,s,o);e.stability=M(+c.toFixed(8),N,u),r.difficulty=this.algorithm.next_difficulty(i,p.Hard),r.stability=this.algorithm.next_recall_stability(i,s,o,p.Hard),n.difficulty=this.algorithm.next_difficulty(i,p.Good),n.stability=this.algorithm.next_recall_stability(i,s,o,p.Good),a.difficulty=this.algorithm.next_difficulty(i,p.Easy),a.stability=this.algorithm.next_recall_stability(i,s,o,p.Easy)}next_interval(e,r,n,a){let i,s;i=this.algorithm.next_interval(e.stability,a),s=this.algorithm.next_interval(r.stability,a),i=Math.min(i,s),s=Math.max(s,i+1);const o=Math.max(this.algorithm.next_interval(n.stability,a),s+1);e.scheduled_days=i,e.due=C(this.review_time,i,!0),r.scheduled_days=s,r.due=C(this.review_time,s,!0),n.scheduled_days=o,n.due=C(this.review_time,o,!0)}next_state(e,r,n){e.state=A.Review,e.learning_steps=0,r.state=A.Review,r.learning_steps=0,n.state=A.Review,n.learning_steps=0}}class ea extends Fa{newState(e){const r=this.next.get(e);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const n=_.card(this.current),a=_.card(this.current),i=_.card(this.current),s=_.card(this.current);return this.init_ds(n,a,i,s),this.next_interval(n,a,i,s,0),this.next_state(n,a,i,s),this.update_next(n,a,i,s),this.next.get(e)}init_ds(e,r,n,a){e.difficulty=M(this.algorithm.init_difficulty(p.Again),1,10),e.stability=this.algorithm.init_stability(p.Again),r.difficulty=M(this.algorithm.init_difficulty(p.Hard),1,10),r.stability=this.algorithm.init_stability(p.Hard),n.difficulty=M(this.algorithm.init_difficulty(p.Good),1,10),n.stability=this.algorithm.init_stability(p.Good),a.difficulty=M(this.algorithm.init_difficulty(p.Easy),1,10),a.stability=this.algorithm.init_stability(p.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){const r=this.next.get(e);if(r)return r;const n=this.elapsed_days,{difficulty:a,stability:i}=this.last,s=this.algorithm.forgetting_curve(n,i),o=_.card(this.current),c=_.card(this.current),u=_.card(this.current),l=_.card(this.current);return this.next_ds(o,c,u,l,a,i,s),this.next_interval(o,c,u,l,n),this.next_state(o,c,u,l),o.lapses+=1,this.update_next(o,c,u,l),this.next.get(e)}next_ds(e,r,n,a,i,s,o){e.difficulty=this.algorithm.next_difficulty(i,p.Again);const c=this.algorithm.next_forget_stability(i,s,o);e.stability=M(s,N,c),r.difficulty=this.algorithm.next_difficulty(i,p.Hard),r.stability=this.algorithm.next_recall_stability(i,s,o,p.Hard),n.difficulty=this.algorithm.next_difficulty(i,p.Good),n.stability=this.algorithm.next_recall_stability(i,s,o,p.Good),a.difficulty=this.algorithm.next_difficulty(i,p.Easy),a.stability=this.algorithm.next_recall_stability(i,s,o,p.Easy)}next_interval(e,r,n,a,i){let s,o,c,u;s=this.algorithm.next_interval(e.stability,i),o=this.algorithm.next_interval(r.stability,i),c=this.algorithm.next_interval(n.stability,i),u=this.algorithm.next_interval(a.stability,i),s=Math.min(s,o),o=Math.max(o,s+1),c=Math.max(c,o+1),u=Math.max(u,c+1),e.scheduled_days=s,e.due=C(this.review_time,s,!0),r.scheduled_days=o,r.due=C(this.review_time,o,!0),n.scheduled_days=c,n.due=C(this.review_time,c,!0),a.scheduled_days=u,a.due=C(this.review_time,u,!0)}next_state(e,r,n,a){e.state=A.Review,e.learning_steps=0,r.state=A.Review,r.learning_steps=0,n.state=A.Review,n.learning_steps=0,a.state=A.Review,a.learning_steps=0}update_next(e,r,n,a){const i={card:e,log:this.buildLog(p.Again)},s={card:r,log:super.buildLog(p.Hard)},o={card:n,log:super.buildLog(p.Good)},c={card:a,log:super.buildLog(p.Easy)};this.next.set(p.Again,i),this.next.set(p.Hard,s),this.next.set(p.Good,o),this.next.set(p.Easy,c)}}class co{fsrs;constructor(e){this.fsrs=e}replay(e,r,n){return this.fsrs.next(e,r,n)}handleManualRating(e,r,n,a,i,s,o){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let c,u;if(r===A.New)c={rating:p.Manual,state:r,due:o??n,stability:e.stability,difficulty:e.difficulty,elapsed_days:a,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:n},u=Kt(n),u.last_review=n;else{if(typeof o>"u")throw new Error("reschedule: due is required for manual rating");const l=X(o,n,"days");c={rating:p.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:a,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:n},u={...e,state:r,due:o,last_review:n,stability:i||e.stability,difficulty:s||e.difficulty,elapsed_days:a,scheduled_days:l,reps:e.reps+1}}return{card:u,log:c}}reschedule(e,r){const n=[];let a=Kt(e.due);for(const i of r){let s;if(i.review=_.time(i.review),i.rating===p.Manual){let o=0;a.state!==A.New&&a.last_review&&(o=X(i.review,a.last_review,"days")),s=this.handleManualRating(a,i.state,i.review,o,i.stability,i.difficulty,i.due?_.time(i.due):void 0)}else s=this.replay(a,i.review,i.rating);n.push(s),a=s.card}return n}calculateManualRecord(e,r,n,a){if(!n)return null;const{card:i,log:s}=n,o=_.card(e);return o.due.getTime()===i.due.getTime()?null:(o.scheduled_days=X(i.due,o.due,"days"),this.handleManualRating(o,i.state,_.time(r),s.elapsed_days,a?i.stability:void 0,a?i.difficulty:void 0,i.due))}}class lo extends uo{strategyHandler=new Map;Scheduler;constructor(e){super(e);const{enable_short_term:r}=this.parameters;this.Scheduler=r?Qn:ea}params_handler_proxy(){const e=this;return{set:function(r,n,a){return n==="request_retention"&&Number.isFinite(a)?e.intervalModifier=e.calculate_interval_modifier(Number(a)):n==="enable_short_term"?e.Scheduler=a===!0?Qn:ea:n==="w"&&(a=ir(sr(a),r.relearning_steps.length),e.forgetting_curve=Ht.bind(this,a),e.intervalModifier=e.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,n,a),!0}}}useStrategy(e,r){return this.strategyHandler.set(e,r),this}clearStrategy(e){return e?this.strategyHandler.delete(e):this.strategyHandler.clear(),this}getScheduler(e,r){const a=this.strategyHandler.get(ce.SCHEDULER)||this.Scheduler;return new a(e,r,this,this.strategyHandler)}repeat(e,r,n){const i=this.getScheduler(e,r).preview();return n&&typeof n=="function"?n(i):i}next(e,r,n,a){const i=this.getScheduler(e,r),s=_.rating(n);if(s===p.Manual)throw new Error("Cannot review a manual rating");const o=i.review(s);return a&&typeof a=="function"?a(o):o}get_retrievability(e,r,n=!0){const a=_.card(e);r=r?_.time(r):new Date;const i=a.state!==A.New?Math.max(X(r,a.last_review,"days"),0):0,s=a.state!==A.New?this.forgetting_curve(i,+a.stability.toFixed(8)):0;return n?`${(s*100).toFixed(2)}%`:s}rollback(e,r,n){const a=_.card(e),i=_.review_log(r);if(i.rating===p.Manual)throw new Error("Cannot rollback a manual rating");let s,o,c;switch(i.state){case A.New:s=i.due,o=void 0,c=0;break;case A.Learning:case A.Relearning:case A.Review:s=i.review,o=i.due,c=a.lapses-(i.rating===p.Again&&i.state===A.Review?1:0);break}const u={...a,due:s,stability:i.stability,difficulty:i.difficulty,elapsed_days:i.last_elapsed_days,scheduled_days:i.scheduled_days,reps:Math.max(0,a.reps-1),lapses:Math.max(0,c),learning_steps:i.learning_steps,state:i.state,last_review:o};return n&&typeof n=="function"?n(u):u}forget(e,r,n=!1,a){const i=_.card(e);r=_.time(r);const s=i.state===A.New?0:X(r,i.due,"days"),o={rating:p.Manual,state:i.state,due:i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:0,last_elapsed_days:i.elapsed_days,scheduled_days:s,learning_steps:i.learning_steps,review:r},u={card:{...i,due:r,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:n?0:i.reps,lapses:n?0:i.lapses,learning_steps:0,state:A.New,last_review:i.last_review},log:o};return a&&typeof a=="function"?a(u):u}reschedule(e,r=[],n={}){const{recordLogHandler:a,reviewsOrderBy:i,skipManual:s=!0,now:o=new Date,update_memory_state:c=!1}=n;i&&typeof i=="function"&&r.sort(i),s&&(r=r.filter(v=>v.rating!==p.Manual));const u=new co(this),l=u.reschedule(n.first_card||Kt(),r),f=l.length,d=_.card(e),h=u.calculateManualRecord(d,o,f?l[f-1]:void 0,c);return a&&typeof a=="function"?{collections:l.map(a),reschedule_item:h?a(h):null}:{collections:l,reschedule_item:h}}}const Oo=t=>new lo(t||{});export{lo as F,_s as P,p as R,A as S,Ao as a,Kt as b,vo as c,mo as d,ps as e,Oo as f,Zn as g,bo as h,wo as i,Si as j,Oi as k,la as l,ti as m,wi as n,bi as o,aa as p,_i as q,Ai as r,So as s,go as t,po as u,_o as v,H as w};
