import{d as A,O as L,P as U,c as T,a as p,Q as Y,e as k,b as m,A as _,w as C,h as b,t as V,o as r,_ as N,R as q,E as W,i as D,S as E,F as $,m as S,z as X,u as y,N as z,g as B,l as R,x as Z,v as M,T as x}from"./index-Q4noPGif.js";import{j as h,a as ee,n as te,g as ae,b as se}from"./decks-C8NYG5fl.js";import{c as J,e as le,r as P,a as oe,d as re,b as ie,f as ne}from"./decks-mTR0UDKY.js";import{d as O,u as ce}from"./db-BhNzgzsk.js";import{p as Q,d as de,m as ue}from"./reviews-DovQcjTA.js";import{A as pe,a as me,b as fe}from"./AppTextArea-BhDoLf8H.js";function ke(n,t){return async e=>{let a=t;for await(const c of e)a=n(a,c);return a}}function ye(){return n=>[...n]}function ve(n){return function*(t){for(const e of t)yield n(e)}}function ge(n){return function*(t){for(const e of t)n(e)&&(yield e)}}function be(){return function*(n){const t=new Set;for(const e of n)t.has(e)||(yield e,t.add(e))}}const De={class:"form-body"},we={class:"buttons"},Ce=A({__name:"CustomDeckForm",props:L({labelFieldDisabled:{type:Boolean,default:!1},priorityFieldDisabled:{type:Boolean,default:!1},confirmIcon:{default:null},confirmLabel:{default:"confirm"}},{label:{},labelModifiers:{},priority:{},priorityModifiers:{},cards:{},cardsModifiers:{}}),emits:L(["submit","reset"],["update:label","update:priority","update:cards"]),setup(n){const t=U(n,"label"),e=U(n,"priority"),a=U(n,"cards"),c=T({get(){return a.value?a.value.map(s=>String.fromCodePoint(s)).join(""):""},set(s){a.value=Q(s,ge(de),ve(l=>l.codePointAt(0)),be(),ye())}});return(s,l)=>(r(),p("form",{onSubmit:l[3]||(l[3]=Y(o=>s.$emit("submit"),["prevent"])),onReset:l[4]||(l[4]=o=>s.$emit("reset"))},[k("div",De,[m(pe,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=o=>t.value=o),class:"name-field",label:"Deck Name",disabled:s.labelFieldDisabled,required:""},null,8,["modelValue","disabled"]),m(me,{modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value=o),class:"priority-field",label:"Priority",min:"1",disabled:s.priorityFieldDisabled,required:""},null,8,["modelValue","disabled"]),m(fe,{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=o=>c.value=o),class:"kanji-field",label:"Kanji",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",placeholder:"Type or paste in your kanji here: 日月火時漢字読書"},null,8,["modelValue"])]),k("div",we,[m(_,{type:"reset"},{default:C(()=>l[5]||(l[5]=[b(" Cancel ")])),_:1,__:[5]}),m(_,{type:"submit","prefix-icon":s.confirmIcon,filled:""},{default:C(()=>[b(V(s.confirmLabel),1)]),_:1},8,["prefix-icon"])])],32))}}),G=N(Ce,[["__scopeId","data-v-a5ea0a3c"]]),$e=A({__name:"CustomDeckCreate",emits:["cancel","success"],setup(n,{emit:t}){const e=t,a=q({label:"",priority:1,cards:[]});async function c(){const l=await Q((await O).transaction("decks").store.index("category").iterate("custom"),ue(o=>o.value.cards.length),ke((o,d)=>o+d,0));l&&(a.priority=Math.ceil(l/12))}async function s(){const l=await J({category:"custom",label:a.label,priority:a.priority,cards:E(a.cards)});e("success",l)}return W(()=>{c()}),(l,o)=>(r(),D(G,{cards:a.cards,"onUpdate:cards":o[0]||(o[0]=d=>a.cards=d),label:a.label,"onUpdate:label":o[1]||(o[1]=d=>a.label=d),priority:a.priority,"onUpdate:priority":o[2]||(o[2]=d=>a.priority=d),"confirm-icon":"plus","confirm-label":"Create",onSubmit:s,onReset:o[3]||(o[3]=d=>l.$emit("cancel"))},null,8,["cards","label","priority"]))}}),_e=A({__name:"DeckActivateButton",props:{isActive:{type:Boolean,default:!1},toggling:{type:Boolean,default:!1}},emits:["activate","deactivate"],setup(n,{emit:t}){const e=n,a=t;function c(){e.isActive?a("deactivate"):a("activate")}return(s,l)=>(r(),D(_,{class:"activate-button",filled:s.isActive,disabled:s.toggling,"prefix-icon":s.toggling?void 0:s.isActive?"checkmark":"plus","aria-pressed":s.isActive,onClick:c},{default:C(()=>[s.toggling?(r(),p($,{key:0},[l[0]||(l[0]=k("span",{class:"loading-icon"},"時",-1)),l[1]||(l[1]=b(" Loading "))],64)):s.isActive?(r(),p($,{key:1},[b(" Active ")],64)):(r(),p($,{key:2},[b(" Add ")],64))]),_:1},8,["filled","disabled","prefix-icon","aria-pressed"]))}}),H=N(_e,[["__scopeId","data-v-8468a69b"]]),Ae=A({__name:"CustomDeckEdit",props:{deck:{}},emits:["cancel","success"],setup(n,{emit:t}){const e=n,a=t,c=q({label:e.deck.label,priority:e.deck.priority,cards:e.deck.cards});async function s(){await le({...e.deck,label:c.label,priority:c.priority,cards:E(c.cards)}),a("success")}return(l,o)=>(r(),D(G,{cards:c.cards,"onUpdate:cards":o[0]||(o[0]=d=>c.cards=d),label:c.label,"onUpdate:label":o[1]||(o[1]=d=>c.label=d),priority:c.priority,"onUpdate:priority":o[2]||(o[2]=d=>c.priority=d),"confirm-label":"Update","label-field-disabled":e.deck.category!=="custom","priority-field-disabled":e.deck.category!=="custom",onSubmit:s,onReset:o[3]||(o[3]=d=>l.$emit("cancel"))},null,8,["cards","label","priority","label-field-disabled","priority-field-disabled"]))}}),Be=["aria-labelledby"],Ie={class:"controls"},je=["id"],Te={class:"kanji-list"},Ve=A({__name:"DeckBrowserItem",props:{deck:{},template:{},category:{},togglingCategory:{type:Boolean,default:!1}},setup(n){const t=n,e=S(!1),a=S(!1),c=z(),s=S(null),l=T(()=>t.deck?.active);async function o(){e.value=!0;try{t.deck?await oe(t.deck.name):await J({name:t.template.name,label:t.template.label,priority:t.template.priority,category:t.category,cards:s.value?.map(i=>i.codePointAt(0)??NaN)??[]})}catch(i){console.error(i)}finally{e.value=!1}}async function d(){if(t.deck){e.value=!0;try{await re(t.deck.name)}catch(i){console.error(i)}finally{e.value=!1}}}return X(()=>t.template?.content,async i=>{if(!i){s.value=null;return}const I=await(await fetch(i)).text();s.value=I.split(`
`).filter(v=>v)},{immediate:!0}),(i,u)=>{const I=Z("RouterLink");return a.value&&i.deck?(r(),D(Ae,{key:0,deck:i.deck,onCancel:u[0]||(u[0]=v=>a.value=!1),onSuccess:u[1]||(u[1]=v=>a.value=!1)},null,8,["deck"])):(r(),p("article",{key:1,"aria-labelledby":y(c)},[k("div",Ie,[k("strong",{id:y(c)},V(i.deck?.label??i.template?.label),9,je),m(H,{toggling:e.value||i.togglingCategory,"is-active":l.value,onActivate:o,onDeactivate:d},null,8,["toggling","is-active"]),i.deck?.active||i.deck?.category==="custom"?(r(),D(_,{key:0,class:"edit-button",onClick:u[2]||(u[2]=v=>a.value=!0)},{default:C(()=>u[5]||(u[5]=[b(" Edit ")])),_:1,__:[5]})):i.deck&&!i.deck.active&&i.deck.category!=="custom"?(r(),D(_,{key:1,class:"edit-button",onClick:u[3]||(u[3]=v=>y(P)(i.deck.name))},{default:C(()=>u[6]||(u[6]=[b(" Reset ")])),_:1,__:[6]})):B("",!0),i.deck?.category==="custom"?(r(),D(_,{key:2,class:"delete-button",onClick:u[4]||(u[4]=v=>y(P)(i.deck.name))},{default:C(()=>u[7]||(u[7]=[b(" Delete ")])),_:1,__:[7]})):B("",!0)]),k("ol",Te,[i.deck?(r(!0),p($,{key:0},R(i.deck.cards,v=>(r(),p("li",{key:v,class:"kanji"},[m(I,{to:y(M)(String.fromCodePoint(v))},{default:C(()=>[b(V(String.fromCodePoint(v)),1)]),_:2},1032,["to"])]))),128)):s.value?(r(!0),p($,{key:1},R(s.value,v=>(r(),p("li",{key:v,class:"kanji"},[m(I,{to:y(M)(v)},{default:C(()=>[b(V(v),1)]),_:2},1032,["to"])]))),128)):B("",!0)])],8,Be))}}}),K=N(Ve,[["__scopeId","data-v-1c288e12"]]),Se=["aria-labelledby"],Ne={class:"controls"},Fe=["id"],Re={key:2,class:"deck-list"},Ue=A({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(n){const t=n,e=S(!1),a=S(!1),c=z(),{result:s}=ce(T(()=>{const{category:g}=t;return async()=>{const f=new Map,w=(await O).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound([g,0],[g,Number.POSITIVE_INFINITY],!0,!0));for await(const F of w)f.set(F.primaryKey,F.value);return f}})),l=T(()=>t.deckTemplates?t.deckTemplates.length:s.value?.size??0),o=T(()=>{if(!s.value)return 0;let g=0;for(const[,{active:f}]of s.value)f&&(g+=1);return g}),d=S(!1),i=T(()=>t.deckTemplates?o.value>=t.deckTemplates.length:!0);async function u(g){d.value=!0;try{await ie(t.category,g)}catch(f){console.error(f)}finally{d.value=!1}}async function I(){d.value=!0;try{await ne(t.category)}catch(g){console.error(g)}finally{d.value=!1}}function v(){a.value=!0,e.value=!1}return(g,f)=>(r(),p("article",{"aria-labelledby":y(c)},[k("div",Ne,[k("strong",{id:y(c),class:"title"},V(g.title),9,Fe),g.deckTemplates?(r(),D(H,{key:0,toggling:d.value,"is-active":i.value,onActivate:f[0]||(f[0]=w=>u(g.deckTemplates)),onDeactivate:I},null,8,["toggling","is-active"])):e.value?B("",!0):(r(),D(_,{key:1,class:"create-custom-button","prefix-icon":"plus",onClick:f[1]||(f[1]=w=>e.value=!0)},{default:C(()=>f[4]||(f[4]=[b(" Create New ")])),_:1,__:[4]}))]),l.value>0?(r(),D(_,{key:0,class:"expand-button","aria-pressed":a.value,onClick:f[2]||(f[2]=w=>a.value=!a.value)},{default:C(()=>[a.value?(r(),p($,{key:0},[b(" Hide ")],64)):(r(),p($,{key:1},[b(" Show ")],64)),b(" ("+V(l.value)+" decks) ",1)]),_:1},8,["aria-pressed"])):B("",!0),e.value?(r(),D($e,{key:1,class:"custom-deck-create",onCancel:f[3]||(f[3]=w=>e.value=!1),onSuccess:v})):B("",!0),a.value?(r(),p("ol",Re,[g.deckTemplates?(r(!0),p($,{key:0},R(g.deckTemplates,w=>(r(),p("li",{key:w.name},[m(K,{deck:y(s)?.get(w.name),template:w,category:g.category,"toggling-category":d.value},null,8,["deck","template","category","toggling-category"])]))),128)):y(s)?(r(!0),p($,{key:1},R(y(s),([w,F])=>(r(),p("li",{key:w},[m(K,{deck:F},null,8,["deck"])]))),128)):B("",!0)])):B("",!0)],8,Se))}}),j=N(Ue,[["__scopeId","data-v-30d5847d"]]),Le=A({__name:"DeckBrowserCustom",setup(n){return(t,e)=>(r(),D(j,{title:"Custom",category:"custom"}))}}),Me={class:"categories"},Pe=A({__name:"DeckBrowser",setup(n){return(t,e)=>(r(),p("ul",Me,[k("li",null,[m(j,{title:"JLPT",category:"jlpt","deck-templates":y(h)},null,8,["deck-templates"])]),k("li",null,[m(j,{title:"Jōyō Kanji",category:"jouyou","deck-templates":y(ee)},null,8,["deck-templates"])]),k("li",null,[m(j,{title:"News Frequency",category:"news","deck-templates":y(te)},null,8,["deck-templates"])]),k("li",null,[m(j,{title:"Genki",category:"genki","deck-templates":y(ae)},null,8,["deck-templates"])]),k("li",null,[m(j,{title:"Basic Kanji Book",category:"basic-kanji","deck-templates":y(se)},null,8,["deck-templates"])]),k("li",null,[m(Le)])]))}}),Ke=N(Pe,[["__scopeId","data-v-268e36e5"]]),qe={class:"article-header"},Ee={class:"actions"},ze=A({__name:"DeckBrowserView",setup(n){return(t,e)=>(r(),p("article",null,[k("header",qe,[e[1]||(e[1]=k("h2",{class:"title"},"Add Decks",-1)),k("div",Ee,[m(_,{to:y(x),"prefix-icon":"arrow-left"},{default:C(()=>e[0]||(e[0]=[b(" Back to your decks ")])),_:1,__:[0]},8,["to"])])]),m(Ke)]))}}),We=N(ze,[["__scopeId","data-v-a1e5f41b"]]);export{We as default};
