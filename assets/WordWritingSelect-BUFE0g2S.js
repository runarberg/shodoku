import{b as D}from"./fsrs-C9LDqAL5.js";import{i as E,a as M}from"./index-CZZIk45U.js";import{m as V,z as P,c as b,C as I,d as B,i as W,w as F,u as w,A as Q,b as S,I as U,o as a,_ as R,a as t,F as o,l as L,h as r,t as $,v as J,x as X,e as u,g as G,K as Z,W as h,a8 as c,L as x,N as _,a9 as nn}from"./index-C4O8d0Wk.js";import{u as en,d as q,l as O}from"./db-D-l1LJxU.js";function*an(...d){const e=d.map(n=>n[Symbol.iterator]());try{let n=e.map(i=>i.next());for(;!n.some(({done:i})=>i);)yield n.map(({value:i})=>i),n=e.map(i=>i.next())}finally{e.forEach(n=>{typeof n.return=="function"&&n.return()})}}function En(d){const e=V(null);return P(()=>I(d),async n=>{if(!n){e.value=null;return}const s=await(await fetch(`/data/words-v1/${n}.json`)).json();e.value=s},{immediate:!0}),e}function Pn(d){const e=V([]);return P(()=>I(d),async n=>{if(!n){e.value=[];return}const s=await(await fetch(`/data/words-sentences-v1/${n}.json`)).json();e.value=s},{immediate:!0}),e}function tn(d,e={}){return b(()=>{const n=I(e.kanji),{writings:i}=I(d)??{};if(!i)return null;let s=null;for(const f of i){if(!s){s=f;continue}if(n){if(!f.text.includes(n))continue;if(!s?.text.includes(n)){s=f;continue}}f.priority?.freq&&f.priority.freq<(s.priority?.freq??Number.POSITIVE_INFINITY)&&(s=f)}return s?.text})}function rn(d){return b(()=>{const{readings:e}=I(d)??{};if(!e)return null;let n=null;for(const i of e){if(!n){n=i;continue}i.priority?.freq&&i.priority.freq<(n.priority?.freq??Number.POSITIVE_INFINITY)&&(n=i)}return n?.text})}function Fn(d,e={}){const n=tn(d,e),i=rn(d),s=D(()=>I(d)?.writings?.map(({text:g})=>g).join("")),f=b(()=>{const g=I(e.forceReading),k=I(e.kanji);return p=>{if(g&&k&&p.includes(k))return!1;for(const j of p)if(E(j)&&!s.has(j))return!1;return!0}});return b(()=>{const{furigana:g}=I(d)??{};let k;!i.value||!n.value?k=g?.at(0):k=g?.find(y=>y.writing===n.value&&y.reading===i.value),k||(k=g?.at(0));const p=k?.furigana??[{ruby:n.value??i.value??""}];let j=!1;return p.map(({ruby:y,rt:C})=>{const N=j;return j=!1,C?y==="々"&&N?{ruby:y}:f.value(y)?(j=!0,{ruby:y}):{ruby:y,rt:C}:{ruby:y}})})}const on=B({__name:"BookmarkWordButton",props:{wordId:{},reading:{}},setup(d){const e=d,{result:n}=en(b(()=>{const s=e.wordId;return async()=>await(await q).count("bookmarked-words",s)>0}));async function i(){const s=await q;if(n.value){await s.delete("bookmarked-words",e.wordId),O.postMessage("word-unbookmarked"),M([{store:"bookmarked-words",op:"delete",key:e.wordId}]);return}const f={wordId:e.wordId,reading:e.reading,bookmarkedAt:new Date};await s.add("bookmarked-words",f),O.postMessage("word-bookmarked"),M([{store:"bookmarked-words",op:"add",key:e.wordId}])}return(s,f)=>(a(),W(Q,{"aria-pressed":w(n),class:"bookmark-button",onClick:f[0]||(f[0]=g=>i())},{default:F(()=>[S(U,{icon:w(n)?"star-filled":"star"},null,8,["icon"])]),_:1},8,["aria-pressed"]))}}),Mn=R(on,[["__scopeId","data-v-36e09a23"]]);function sn(d){const e=V(null);return P(()=>I(d),async n=>{const s=await(await fetch(`/data/sentences-v1/${n}.json`)).json();e.value=s},{immediate:!0}),e}const un={key:0,class:"placeholder"},ln=B({__name:"MaybeHideKanji",props:{str:{},kanji:{default:null},hide:{type:Boolean,default:!1},link:{type:Boolean,default:!1}},setup(d){return(e,n)=>{const i=X("RouterLink");return e.link?(a(!0),t(o,{key:0},L(e.str,s=>(a(),t(o,{key:s},[w(E)(s)?(a(),W(i,{key:0,to:w(J)(s),class:"link"},{default:F(()=>[r($(s),1)]),_:2},1032,["to"])):(a(),t(o,{key:1},[r($(s),1)],64))],64))),128)):!e.kanji||!e.hide?(a(),t(o,{key:1},[r($(e.str),1)],64)):(a(!0),t(o,{key:2},L(e.str,s=>(a(),t(o,{key:s},[s===e.kanji?(a(),t("span",un,"◌")):(a(),t(o,{key:1},[r($(s),1)],64))],64))),128))}}}),A=R(ln,[["__scopeId","data-v-dd465f3e"]]),dn={key:0},gn={key:0},kn={key:1},T=B({__name:"VocabularyWordFurigana",props:{furigana:{},kanji:{},hideKanji:{type:Boolean},hideReading:{type:Boolean},linkKanji:{type:Boolean}},setup(d){const e=d;function n(i,s){return!e.hideReading||!e.kanji?!1:i==="々"&&e.furigana.at(s-1)?.ruby===e.kanji?!0:i.includes(e.kanji)}return(i,s)=>(a(!0),t(o,null,L(i.furigana,({ruby:f,rt:g},k)=>(a(),t(o,{key:k},[g?(a(),t("ruby",dn,[S(A,{hide:i.hideKanji,kanji:i.kanji,str:f,link:i.linkKanji},null,8,["hide","kanji","str","link"]),s[0]||(s[0]=u("rp",null,"(",-1)),n(f,k)?(a(),t("rt",gn,"◌")):(a(),t("rt",kn,$(g),1)),s[1]||(s[1]=u("rp",null,")",-1))])):(a(),W(A,{key:1,hide:i.hideKanji,kanji:i.kanji,str:f,link:i.linkKanji},null,8,["hide","kanji","str","link"]))],64))),128))}}),fn={key:0,class:"vocabulary-sentence"},pn={lang:"ja",class:"sentence"},vn=B({__name:"VocabularySentence",props:{sentenceId:{},hideKanji:{},hideReading:{},hideMeaning:{type:Boolean}},setup(d){const e=d,n=sn(()=>e.sentenceId),i=D(()=>n.value?.sentence),s=b(()=>g=>{if(e.hideKanji&&g.includes(e.hideKanji))return!1;for(const k of g)if(E(k)&&!i.has(k))return!1;return!0}),f=b(()=>g=>{let k=!1;return g.furigana.map(({ruby:p,rt:j})=>{const y=k;return k=!1,j?p==="々"&&y?{ruby:p}:s.value(p)?(k=!0,{ruby:p}):{ruby:p,rt:j}:{ruby:p}})});return(g,k)=>w(n)?(a(),t("div",fn,[u("p",pn,[(a(!0),t(o,null,L(w(n).words,p=>(a(),W(c(p.word?"RouterLink":"span"),{key:p.word,to:w(h)(p.word),class:"word"},{default:F(()=>[S(T,{furigana:f.value(p),"hide-kanji":!!g.hideKanji,"hide-reading":!!g.hideReading,kanji:g.hideKanji??g.hideReading},null,8,["furigana","hide-kanji","hide-reading","kanji"])]),_:2},1032,["to"]))),128))]),Z(u("p",{lang:"en",class:"translation"},$(w(n).meaning),513),[[x,!g.hideMeaning]])])):G("",!0)}}),qn=R(vn,[["__scopeId","data-v-8d86d741"]]),yn={class:"pos-tag"},mn=B({__name:"PartOfSpeechTag",props:{tag:{}},setup(d){return(e,n)=>(a(),t("span",yn,[e.tag==="adj-f"?(a(),t(o,{key:0},[r(" noun or prenominal verb")],64)):e.tag==="adj-i"?(a(),t(o,{key:1},[n[0]||(n[0]=u("i",{lang:"ja-Latn"},"i",-1)),n[1]||(n[1]=r(" adjective"))],64)):e.tag==="adj-ix"?(a(),t(o,{key:2},[n[2]||(n[2]=r(" adjective – ")),n[3]||(n[3]=u("i",{lang:"ja-Latn"},"yoi",-1)),n[4]||(n[4]=r("/")),n[5]||(n[5]=u("i",{lang:"ja-Latn"},"ii",-1)),n[6]||(n[6]=r(" class"))],64)):e.tag==="adj-na"?(a(),t(o,{key:3},[r(" na adjective")],64)):e.tag==="adj-nari"?(a(),t(o,{key:4},[n[7]||(n[7]=r(" formal ")),n[8]||(n[8]=u("i",{lang:"ja-Latn"},"na",-1)),n[9]||(n[9]=r("-adjective"))],64)):e.tag==="adj-no"?(a(),t(o,{key:5},[n[10]||(n[10]=r(" noun w. ")),n[11]||(n[11]=u("i",null,"no",-1)),n[12]||(n[12]=r(" particle"))],64)):e.tag==="adj-pn"?(a(),t(o,{key:6},[r(" pre-noun adjectival")],64)):e.tag==="adj-t"?(a(),t(o,{key:7},[n[13]||(n[13]=u("i",{lang:"ja-Latn"},"taru",-1)),n[14]||(n[14]=r(" adjective"))],64)):e.tag==="adv"?(a(),t(o,{key:8},[r(" adverb")],64)):e.tag==="adv-to"?(a(),t(o,{key:9},[n[15]||(n[15]=r(" adverb w. ")),n[16]||(n[16]=u("i",{lang:"ja-Latn"},"to",-1)),n[17]||(n[17]=r(" particle"))],64)):e.tag==="aux"?(a(),t(o,{key:10},[r(" auxiliary")],64)):e.tag==="aux-adj"?(a(),t(o,{key:11},[r(" auxiliary adjective")],64)):e.tag==="aux-v"?(a(),t(o,{key:12},[r(" auxiliary verb")],64)):e.tag==="conj"?(a(),t(o,{key:13},[r(" conjunction")],64)):e.tag==="cop"?(a(),t(o,{key:14},[r(" copula")],64)):e.tag==="ctr"?(a(),t(o,{key:15},[r(" counter")],64)):e.tag==="exp"?(a(),t(o,{key:16},[r(" expressions")],64)):e.tag==="int"?(a(),t(o,{key:17},[r(" interjection")],64)):e.tag==="n"?(a(),t(o,{key:18},[r(" noun")],64)):e.tag==="n-adv"?(a(),t(o,{key:19},[r(" adverbial noun")],64)):e.tag==="n-pr"?(a(),t(o,{key:20},[r(" proper noun")],64)):e.tag==="n-pref"?(a(),t(o,{key:21},[r(" noun, used as a prefix")],64)):e.tag==="n-suf"?(a(),t(o,{key:22},[r(" noun, used as a suffix")],64)):e.tag==="n-t"?(a(),t(o,{key:23},[r(" noun (temporal)")],64)):e.tag==="num"?(a(),t(o,{key:24},[r(" numeric")],64)):e.tag==="pn"?(a(),t(o,{key:25},[r(" pronoun")],64)):e.tag==="pref"?(a(),t(o,{key:26},[r(" prefix")],64)):e.tag==="prt"?(a(),t(o,{key:27},[r(" particle")],64)):e.tag==="suf"?(a(),t(o,{key:28},[r(" suffix")],64)):e.tag==="uk"?(a(),t(o,{key:29},[r(" Usually written with kana")],64)):e.tag==="v-unspec"?(a(),t(o,{key:30},[r(" verb")],64)):e.tag==="v1"?(a(),t(o,{key:31},[r(" Ichidan verb")],64)):e.tag==="v1-s"?(a(),t(o,{key:32},[n[18]||(n[18]=r(" Ichidan verb – ")),n[19]||(n[19]=u("i",{lang:"ja-Latn"},"kureru",-1))],64)):e.tag==="v5aru"?(a(),t(o,{key:33},[n[20]||(n[20]=r(" Godan verb – ")),n[21]||(n[21]=u("i",{lang:"ja-Latn"},"-aru",-1))],64)):e.tag==="v5b"?(a(),t(o,{key:34},[r(" Godan verb")],64)):e.tag==="v5g"?(a(),t(o,{key:35},[r(" Godan verb")],64)):e.tag==="v5k"?(a(),t(o,{key:36},[r(" Godan verb")],64)):e.tag==="v5k-s"?(a(),t(o,{key:37},[n[22]||(n[22]=r(" Godan verb – ")),n[23]||(n[23]=u("i",{lang:"ja-Latn"},"iku",-1)),n[24]||(n[24]=r("/")),n[25]||(n[25]=u("i",{lang:"ja-Latn"},"yuku",-1))],64)):e.tag==="v5m"?(a(),t(o,{key:38},[r(" Godan verb")],64)):e.tag==="v5n"?(a(),t(o,{key:39},[r(" Godan verb")],64)):e.tag==="v5r"?(a(),t(o,{key:40},[n[26]||(n[26]=r(" Godan verb with ")),n[27]||(n[27]=u("i",{lang:"ja-Latn"},"ru",-1)),n[28]||(n[28]=r(" ending"))],64)):e.tag==="v5r-i"?(a(),t(o,{key:41},[n[29]||(n[29]=r(" Godan verb with ")),n[30]||(n[30]=u("i",{lang:"ja-Latn"},"ru",-1)),n[31]||(n[31]=r(" ending (irregular)"))],64)):e.tag==="v5s"?(a(),t(o,{key:42},[r(" Godan verb")],64)):e.tag==="v5t"?(a(),t(o,{key:43},[r(" Godan verb")],64)):e.tag==="v5u"?(a(),t(o,{key:44},[r(" Godan verb")],64)):e.tag==="v5u-s"?(a(),t(o,{key:45},[n[32]||(n[32]=r(" Godan verb with ")),n[33]||(n[33]=u("i",{lang:"ja-Latn"},"u",-1)),n[34]||(n[34]=r(" ending (special class)"))],64)):e.tag==="v5uru"?(a(),t(o,{key:46},[n[35]||(n[35]=r(" Godan verb – ")),n[36]||(n[36]=u("i",{lang:"ja-Latn"},"Uru",-1)),n[37]||(n[37]=r(" old class verb"))],64)):e.tag==="vi"?(a(),t(o,{key:47},[r(" intransitive verb")],64)):e.tag==="vk"?(a(),t(o,{key:48},[n[38]||(n[38]=u("i",{lang:"ja-Latn"},"Kuru",-1)),n[39]||(n[39]=r(" verb"))],64)):e.tag==="vn"?(a(),t(o,{key:49},[n[40]||(n[40]=r(" irregular ")),n[41]||(n[41]=u("i",{lang:"ja-Latn"},"nu",-1)),n[42]||(n[42]=r(" verb"))],64)):e.tag==="vr"?(a(),t(o,{key:50},[n[43]||(n[43]=r(" irregular ")),n[44]||(n[44]=u("i",{lang:"ja-Latn"},"ru",-1)),n[45]||(n[45]=r(" verb"))],64)):e.tag==="vs"?(a(),t(o,{key:51},[n[46]||(n[46]=u("i",{lang:"ja-Latn"},"suru",-1)),n[47]||(n[47]=r(" verb"))],64)):e.tag==="vs-c"?(a(),t(o,{key:52},[n[48]||(n[48]=u("i",{lang:"ja-Latn"},"su",-1)),n[49]||(n[49]=r(" verb—precursor to the modern ")),n[50]||(n[50]=u("i",{lang:"ja-Latn"},"suru",-1))],64)):e.tag==="vs-i"?(a(),t(o,{key:53},[n[51]||(n[51]=u("i",{lang:"ja-Latn"},"suru",-1)),n[52]||(n[52]=r(" verb – included"))],64)):e.tag==="vs-s"?(a(),t(o,{key:54},[n[53]||(n[53]=u("i",{lang:"ja-Latn"},"suru",-1)),n[54]||(n[54]=r(" verb – special class"))],64)):e.tag==="vt"?(a(),t(o,{key:55},[r(" transitive verb")],64)):e.tag==="vz"?(a(),t(o,{key:56},[n[55]||(n[55]=r(" Ichidan verb – ")),n[56]||(n[56]=u("i",{lang:"ja-Latn"},"zuru",-1)),n[57]||(n[57]=r(" verb"))],64)):G("",!0)]))}}),z=R(mn,[["__scopeId","data-v-ee320153"]]),jn={class:"vocabulary-word-meaning"},bn={class:"meaning-pos"},wn={class:"glossary"},In=B({__name:"VocabularyWordMeaning",props:{meaning:{}},setup(d){return(e,n)=>(a(),t("div",jn,[u("div",bn,[(a(!0),t(o,null,L(e.meaning.pos,i=>(a(),W(z,{key:i,tag:i},null,8,["tag"]))),128)),e.meaning.kanaPreferred?(a(),W(z,{key:0,tag:"uk"})):G("",!0)]),u("div",wn,[(a(!0),t(o,null,L(e.meaning.glossary,i=>(a(),t("span",{key:i,class:"glossary-word"},$(i),1))),128))])]))}}),On=R(In,[["__scopeId","data-v-9dd3a484"]]),$n={key:0,class:"word-writing-details popover-container"},Ln=["popovertarget"],Bn={class:"writing-select-count"},Kn=["id"],Vn=["disabled"],Wn=["disabled","onClick"],Rn=["disabled","onClick"],Sn=B({__name:"WordWritingSelect",props:{word:{},defaultFurigana:{},modelValue:{}},emits:["update:modelValue"],setup(d){nn(l=>({ae632862:w(i)}));const e=d,n=_(),i=`--${n}`.replace(":","-anchor-"),s=b(()=>e.word.writings?.filter(l=>l.irregular||l.outdated||l.searchOnly).map(({text:l})=>l)??[]),f=b(()=>e.word.readings?.filter(l=>l.irregular||l.outdated||l.searchOnly).map(({text:l})=>l)??[]);function g(l,m){if(l.length!==m.length)return!1;for(const[v,K]of an(l,m))if(v.ruby!==K.ruby||v.rt!==K.rt)return!1;return!0}const k=b(()=>e.word.furigana?.filter(l=>!g(e.defaultFurigana,l.furigana)&&!s.value.includes(l.writing)&&!f.value.includes(l.reading))??[]),p=b(()=>e.word.readings?.filter(l=>!l.irregular&&!l.outdated&&!l.searchOnly&&!e.word.furigana?.some(m=>l.text===m.reading))??[]),j=V(null),y=V(null),C=V(!1);function N(l){C.value=l.newState==="open"}function H(l){if(l.newState==="open"&&!("anchorName"in document.documentElement.style)){const m=j.value?.getBoundingClientRect(),v=y.value?.style;v&&m&&(v.insetBlockStart=`${m.bottom+window.scrollY}px`,v.insetInlineEnd=`calc(100% - ${m.right}px)`)}}return(l,m)=>k.value.length+p.value.length>0?(a(),t("div",$n,[u("button",{ref_key:"toggleButton",ref:j,title:"Additional Writings",class:"toggle-button",popovertarget:w(n)},[m[1]||(m[1]=u("span",{class:"writing-select-icon"},"か",-1)),u("small",Bn,"(+"+$(k.value.length+p.value.length+1)+")",1)],8,Ln),u("ul",{id:w(n),ref_key:"popoverEl",ref:y,class:"writing-list popover",popover:"",onBeforetoggle:H,onToggle:N},[u("li",null,[u("button",{class:"select-button",disabled:l.modelValue===null,onClick:m[0]||(m[0]=v=>l.$emit("update:modelValue",null))},[S(T,{furigana:l.defaultFurigana},null,8,["furigana"])],8,Vn)]),(a(!0),t(o,null,L(k.value,(v,K)=>(a(),t("li",{key:K,class:"additional-writing"},[u("button",{class:"select-button",disabled:l.modelValue===v.furigana,onClick:Y=>l.$emit("update:modelValue",v.furigana)},[S(T,{furigana:v.furigana},null,8,["furigana"])],8,Wn)]))),128)),(a(!0),t(o,null,L(p.value,(v,K)=>(a(),t("li",{key:K},[u("button",{class:"select-button",disabled:l.modelValue===v.text,onClick:Y=>l.$emit("update:modelValue",v.text)},$(v.text),9,Rn)]))),128))],40,Kn)])):G("",!0)}}),An=R(Sn,[["__scopeId","data-v-c6ac4536"]]);export{Mn as B,qn as V,An as W,T as _,En as a,Fn as b,On as c,Pn as u};
