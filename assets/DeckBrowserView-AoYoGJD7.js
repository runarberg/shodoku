import{d as C,M as L,N as U,i as D,u as k,L as P,w as $,I as E,O as Z,e as y,P as z,o as i,_ as V,Q as x,c as S,a as f,R as h,b as v,A as I,h as g,t as M,S as G,T as O,F as A,m as N,y as ee,g as B,l as R,v as te,s as K,G as ae,U as le}from"./index-iqwy-qSw.js";import{j as oe,n as se,g as ie,b as re}from"./decks-CfOZF5PQ.js";import{d as Q,u as ne}from"./db-B7IDTSNy.js";import{e as ce,r as de,a as ue,c as H,d as pe,b as me,f as fe}from"./decks-BHcpk4Nd.js";import{p as J,m as ke}from"./index-BOsLoRk8.js";import{i as ye}from"./text-p0dDw4FE.js";import{A as Y,a as ve}from"./AppNumberInput-B9qgyPF5.js";function be(n,t){return async e=>{let a=t;for await(const r of e)a=n(a,r);return a}}function ge(){return n=>[...n]}function De(n){return function*(t){for(const e of t)yield n(e)}}function $e(n){return function*(t){for(const e of t)n(e)&&(yield e)}}function we(){return function*(n){const t=new Set;for(const e of n)t.has(e)||(yield e,t.add(e))}}const Ce=["id"],_e=C({__name:"AppInput",props:L({label:{},inline:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const t=U(n,"modelValue"),e=P();return(a,r)=>(i(),D(Y,{control:k(e),label:a.label,inline:a.inline},{default:$(()=>[E(y("input",z({id:k(e),"onUpdate:modelValue":r[0]||(r[0]=l=>t.value=l)},a.$attrs,{class:"input"}),null,16,Ce),[[Z,t.value]])]),_:1},8,["control","label","inline"]))}}),Ae=V(_e,[["__scopeId","data-v-4a8ba3a8"]]),Be=["id"],Ie=C({__name:"AppTextArea",props:L({label:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const t=U(n,"modelValue"),e=P();return(a,r)=>(i(),D(Y,{control:k(e),label:a.label},{default:$(()=>[E(y("textarea",z({id:k(e),"onUpdate:modelValue":r[0]||(r[0]=l=>t.value=l)},a.$attrs,{class:"textarea"}),null,16,Be),[[x,t.value]])]),_:1},8,["control","label"]))}}),Ve=V(Ie,[["__scopeId","data-v-948e7413"]]),Te={class:"form-body"},je={class:"buttons"},Se=C({__name:"CustomDeckForm",props:L({labelFieldDisabled:{type:Boolean,default:!1},priorityFieldDisabled:{type:Boolean,default:!1},confirmIcon:{},confirmLabel:{default:"confirm"}},{label:{},labelModifiers:{},priority:{},priorityModifiers:{},cards:{},cardsModifiers:{}}),emits:L(["submit","reset"],["update:label","update:priority","update:cards"]),setup(n){const t=U(n,"label"),e=U(n,"priority"),a=U(n,"cards"),r=S({get(){return a.value?a.value.map(l=>String.fromCodePoint(l)).join(""):""},set(l){a.value=J(l,$e(ye),De(o=>o.codePointAt(0)),we(),ge())}});return(l,o)=>(i(),f("form",{onSubmit:o[3]||(o[3]=h(s=>l.$emit("submit"),["prevent"])),onReset:o[4]||(o[4]=s=>l.$emit("reset"))},[y("div",Te,[v(Ae,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value=s),class:"name-field",label:"Deck Name",disabled:l.labelFieldDisabled,required:""},null,8,["modelValue","disabled"]),v(ve,{modelValue:e.value,"onUpdate:modelValue":o[1]||(o[1]=s=>e.value=s),class:"priority-field",label:"Priority",min:"1",disabled:l.priorityFieldDisabled,required:""},null,8,["modelValue","disabled"]),v(Ve,{modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=s=>r.value=s),class:"kanji-field",label:"Kanji",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",placeholder:"Type or paste in your kanji here: 日月火時漢字読書"},null,8,["modelValue"])]),y("div",je,[v(I,{type:"reset"},{default:$(()=>o[5]||(o[5]=[g("Cancel")])),_:1}),v(I,{type:"submit","prefix-icon":l.confirmIcon,filled:""},{default:$(()=>[g(M(l.confirmLabel),1)]),_:1},8,["prefix-icon"])])],32))}}),W=V(Se,[["__scopeId","data-v-3dc0e575"]]),Me=C({__name:"CustomDeckEdit",props:{deck:{}},emits:["cancel","success"],setup(n,{emit:t}){const e=n,a=t,r=G({label:e.deck.label,priority:e.deck.priority,cards:e.deck.cards});async function l(){await ce({...e.deck,label:r.label,priority:r.priority,cards:O(r.cards)}),a("success")}return(o,s)=>(i(),D(W,{cards:r.cards,"onUpdate:cards":s[0]||(s[0]=d=>r.cards=d),label:r.label,"onUpdate:label":s[1]||(s[1]=d=>r.label=d),priority:r.priority,"onUpdate:priority":s[2]||(s[2]=d=>r.priority=d),"confirm-label":"Update","label-field-disabled":e.deck.category!=="custom","priority-field-disabled":e.deck.category!=="custom",onSubmit:l,onReset:s[3]||(s[3]=d=>o.$emit("cancel"))},null,8,["cards","label","priority","label-field-disabled","priority-field-disabled"]))}}),Ne=C({__name:"DeckActivateButton",props:{isActive:{type:Boolean,default:!1},toggling:{type:Boolean,default:!1}},emits:["activate","deactivate"],setup(n,{emit:t}){const e=n,a=t;function r(){e.isActive?a("deactivate"):a("activate")}return(l,o)=>(i(),D(I,{class:"activate-button",filled:l.isActive,disabled:l.toggling,"prefix-icon":l.toggling?void 0:l.isActive?"checkmark":"plus","aria-pressed":l.isActive,onClick:r},{default:$(()=>[l.toggling?(i(),f(A,{key:0},[o[0]||(o[0]=y("span",{class:"loading-icon"},"時",-1)),o[1]||(o[1]=g(" Loading "))],64)):l.isActive?(i(),f(A,{key:1},[g("Active")],64)):(i(),f(A,{key:2},[g("Add")],64))]),_:1},8,["filled","disabled","prefix-icon","aria-pressed"]))}}),X=V(Ne,[["__scopeId","data-v-d238a2ea"]]),Fe=["aria-labelledby"],Ue={class:"controls"},Le=["id"],Re={class:"kanji-list"},Pe=C({__name:"DeckBrowserItem",props:{deck:{},template:{},category:{},togglingCategory:{type:Boolean,default:!1}},setup(n){const t=n,e=N(!1),a=N(!1),r=P(),l=N(null),o=S(()=>{var c;return(c=t.deck)==null?void 0:c.active});async function s(){var c;e.value=!0;try{t.deck?await ue(t.deck.name):await H({name:t.template.name,label:t.template.label,priority:t.template.priority,category:t.category,cards:((c=l.value)==null?void 0:c.map(m=>m.codePointAt(0)??NaN))??[]})}catch(m){console.error(m)}finally{e.value=!1}}async function d(){if(t.deck){e.value=!0;try{await pe(t.deck.name)}catch(c){console.error(c)}finally{e.value=!1}}}return ee(()=>{var c;return(c=t.template)==null?void 0:c.content},async c=>{if(!c){l.value=null;return}const T=await(await fetch(c)).text();l.value=T.split(`
`).filter(j=>j)},{immediate:!0}),(c,m)=>{var j,u,p,b,_;const T=te("RouterLink");return a.value&&c.deck?(i(),D(Me,{key:0,deck:c.deck,onCancel:m[0]||(m[0]=w=>a.value=!1),onSuccess:m[1]||(m[1]=w=>a.value=!1)},null,8,["deck"])):(i(),f("article",{key:1,"aria-labelledby":k(r)},[y("div",Ue,[y("strong",{id:k(r)},M(((j=c.deck)==null?void 0:j.label)??((u=c.template)==null?void 0:u.label)),9,Le),v(X,{toggling:e.value||c.togglingCategory,"is-active":o.value,onActivate:s,onDeactivate:d},null,8,["toggling","is-active"]),(p=c.deck)!=null&&p.active||((b=c.deck)==null?void 0:b.category)==="custom"?(i(),D(I,{key:0,class:"edit-button",onClick:m[2]||(m[2]=w=>a.value=!0)},{default:$(()=>m[4]||(m[4]=[g(" Edit ")])),_:1})):B("",!0),((_=c.deck)==null?void 0:_.category)==="custom"?(i(),D(I,{key:1,class:"delete-button",onClick:m[3]||(m[3]=w=>k(de)(c.deck.name))},{default:$(()=>m[5]||(m[5]=[g(" Delete ")])),_:1})):B("",!0)]),y("ol",Re,[c.deck?(i(!0),f(A,{key:0},R(c.deck.cards,w=>(i(),f("li",{key:w,class:"kanji"},[v(T,{to:k(K)(String.fromCodePoint(w))},{default:$(()=>[g(M(String.fromCodePoint(w)),1)]),_:2},1032,["to"])]))),128)):l.value?(i(!0),f(A,{key:1},R(l.value,w=>(i(),f("li",{key:w,class:"kanji"},[v(T,{to:k(K)(w)},{default:$(()=>[g(M(w),1)]),_:2},1032,["to"])]))),128)):B("",!0)])],8,Fe))}}}),q=V(Pe,[["__scopeId","data-v-5da83b96"]]),Ke=C({__name:"CustomDeckCreate",emits:["cancel","success"],setup(n,{emit:t}){const e=t,a=G({label:"",priority:1,cards:[]});async function r(){const o=await J((await Q).transaction("decks").store.index("category").iterate("custom"),ke(s=>s.value.cards.length),be((s,d)=>s+d,0));o&&(a.priority=Math.ceil(o/12))}async function l(){const o=await H({category:"custom",label:a.label,priority:a.priority,cards:O(a.cards)});e("success",o)}return ae(()=>{r()}),(o,s)=>(i(),D(W,{cards:a.cards,"onUpdate:cards":s[0]||(s[0]=d=>a.cards=d),label:a.label,"onUpdate:label":s[1]||(s[1]=d=>a.label=d),priority:a.priority,"onUpdate:priority":s[2]||(s[2]=d=>a.priority=d),"confirm-icon":"plus","confirm-label":"Create",onSubmit:l,onReset:s[3]||(s[3]=d=>o.$emit("cancel"))},null,8,["cards","label","priority"]))}}),qe=["aria-labelledby"],Ee={class:"controls"},ze=["id"],Ge={key:2,class:"deck-list"},Oe=C({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(n){const t=n,e=N(!1),a=N(!1),r=P(),{result:l}=ne(S(()=>{const{category:u}=t;return async()=>{const p=new Map,b=(await Q).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound([u,0],[u,Number.POSITIVE_INFINITY],!0,!0));for await(const _ of b)p.set(_.primaryKey,_.value);return p}})),o=S(()=>{var u;return t.deckTemplates?t.deckTemplates.length:((u=l.value)==null?void 0:u.size)??0}),s=S(()=>{if(!l.value)return 0;let u=0;for(const[,{active:p}]of l.value)p&&(u+=1);return u}),d=N(!1),c=S(()=>t.deckTemplates?s.value>=t.deckTemplates.length:!0);async function m(u){d.value=!0;try{await me(t.category,u)}catch(p){console.error(p)}finally{d.value=!1}}async function T(){d.value=!0;try{await fe(t.category)}catch(u){console.error(u)}finally{d.value=!1}}function j(){a.value=!0,e.value=!1}return(u,p)=>(i(),f("article",{"aria-labelledby":k(r)},[y("div",Ee,[y("strong",{id:k(r),class:"title"},M(u.title),9,ze),u.deckTemplates?(i(),D(X,{key:0,toggling:d.value,"is-active":c.value,onActivate:p[0]||(p[0]=b=>m(u.deckTemplates)),onDeactivate:T},null,8,["toggling","is-active"])):e.value?B("",!0):(i(),D(I,{key:1,class:"create-custom-button","prefix-icon":"plus",onClick:p[1]||(p[1]=b=>e.value=!0)},{default:$(()=>p[4]||(p[4]=[g(" Create New ")])),_:1}))]),o.value>0?(i(),D(I,{key:0,class:"expand-button","aria-pressed":a.value,onClick:p[2]||(p[2]=b=>a.value=!a.value)},{default:$(()=>[a.value?(i(),f(A,{key:0},[g("Hide ")],64)):(i(),f(A,{key:1},[g("Show ")],64)),g(" ("+M(o.value)+" decks) ",1)]),_:1},8,["aria-pressed"])):B("",!0),e.value?(i(),D(Ke,{key:1,class:"custom-deck-create",onCancel:p[3]||(p[3]=b=>e.value=!1),onSuccess:j})):B("",!0),a.value?(i(),f("ol",Ge,[u.deckTemplates?(i(!0),f(A,{key:0},R(u.deckTemplates,b=>{var _;return i(),f("li",{key:b.name},[v(q,{deck:(_=k(l))==null?void 0:_.get(b.name),template:b,category:u.category,"toggling-category":d.value},null,8,["deck","template","category","toggling-category"])])}),128)):k(l)?(i(!0),f(A,{key:1},R(k(l),([b,_])=>(i(),f("li",{key:b},[v(q,{deck:_},null,8,["deck"])]))),128)):B("",!0)])):B("",!0)],8,qe))}}),F=V(Oe,[["__scopeId","data-v-6735dcda"]]),Qe=C({__name:"DeckBrowserCustom",setup(n){return(t,e)=>(i(),D(F,{title:"Custom",category:"custom"}))}}),He={class:"categories"},Je=C({__name:"DeckBrowser",setup(n){return(t,e)=>(i(),f("ul",He,[y("li",null,[v(F,{title:"JLPT",category:"jlpt","deck-templates":k(oe)},null,8,["deck-templates"])]),y("li",null,[v(F,{title:"News Frequency",category:"news","deck-templates":k(se)},null,8,["deck-templates"])]),y("li",null,[v(F,{title:"Genki",category:"genki","deck-templates":k(ie)},null,8,["deck-templates"])]),y("li",null,[v(F,{title:"Basic Kanji Book",category:"basic-kanji","deck-templates":k(re)},null,8,["deck-templates"])]),y("li",null,[v(Qe)])]))}}),Ye=V(Je,[["__scopeId","data-v-346b37c3"]]),We={class:"article-header"},Xe={class:"actions"},Ze=C({__name:"DeckBrowserView",setup(n){return(t,e)=>(i(),f("article",null,[y("header",We,[e[1]||(e[1]=y("h2",{class:"title"},"Add Decks",-1)),y("div",Xe,[v(I,{to:k(le),"prefix-icon":"arrow-left"},{default:$(()=>e[0]||(e[0]=[g(" Back to your decks ")])),_:1},8,["to"])])]),v(Ye)]))}}),st=V(Ze,[["__scopeId","data-v-a1e5f41b"]]);export{st as default};
