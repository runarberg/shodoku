import{h as R,r as k,t as p,S as l,d as D,W as j,e as P,k as h}from"./reviews-BBX2ZUfX.js";import{u as d,d as g}from"./db-CNlb8ZXY.js";import{c as f,M as m,P as K,C as z}from"./index-CvwMh420.js";function v(){return f(()=>{const e=R({enable_fuzz:k.value});return p(e)})}function S(e){const{result:n}=d(f(()=>{const t=m(e);return async()=>{const r=(await g).transaction("progress").store,s=await r.get([t,"kanji-read"]),a=await r.get([t,"kanji-write"]);return{read:s??null,write:a??null}}}),{read:null,write:null});return n}function w(e,n,t=new Date){return e?e.fsrs.state===l.Learning?"learning":e.fsrs.state===l.Relearning?"relearning":n.get_retrievability(e.fsrs,t,!1):null}function F(e){const n=v(),t=S(e),{result:r}=d(f(()=>{const s=n.value,{read:a,write:u}=t.value;return async()=>{const i=new Date;return{read:w(a,s,i),write:w(u,s,i)}}}),{read:null,write:null});return r}function L(e){const n=v(),t=K(new Set);return z([()=>m(e),P,h],async([r,s,a])=>{if(!r)return;const u=new Date,i=a/100,b=new Date(Date.now()+s*j);for(const c of r)if(D(c)){const y=c.codePointAt(0)??0,o=await(await g).get("progress",[y,"kanji-read"]);if(o){if(o.fsrs.state!==l.Review)continue;n.value.get_retrievability(o.fsrs,u,!1)>i&&o.fsrs.due>b&&t.add(c)}}},{immediate:!0}),t}export{S as a,F as b,L as c,v as u};
