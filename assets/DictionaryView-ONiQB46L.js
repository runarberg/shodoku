import{d as k,o as a,f as b,u as d,k as P,a as i,b as m,F as f,j as I,e as c,D as A,g as L,h as q,_ as y,B as O,x as S,J as z,c as w,p as T,w as J,t as N,K as U,L as G,m as H,n as Q}from"./index-jUm0nxGk.js";import{W as X,v as Y}from"./WordListItem-EeNwFwSj.js";import{c as Z,w as F}from"./index-BNLyvoft.js";import{d as ee,A as se}from"./db-C8CERaXs.js";import{d as re,h as B,e as te,B as ae,_ as ne,g as oe,j,i as ue}from"./WordWritingSelect-C3Xn3wf5.js";import{W as E}from"./WordKanjiListItem-DQS005p-.js";import"./index-xwVy6i7n.js";import"./iterators-PeFxZeGd.js";const ie=k({__name:"BookmarkedWordListItem",props:{wordId:{}},setup(n){const t=n,s=re(()=>t.wordId);return(r,u)=>(a(),b(X,{word:{word:r.wordId,sentences:d(s)}},null,8,["word"]))}}),le={class:"word-search-results"},ce={class:"results-list"},de=k({__name:"BookmarkedWords",setup(n){const t=Z(async()=>{const o=[],e=(await ee).transaction("bookmarked-words").store.index("bookmarkedAt").iterate(null,"prev");for await(const l of e)o.push(l.primaryKey);return o},[]),s=P(20);function r(){s.value+=20}function u([{isIntersecting:o}]){o&&r()}return(o,e)=>(a(),i("section",le,[e[2]||(e[2]=m("h3",null,"Bookmarked Words",-1)),m("ul",ce,[(a(!0),i(f,null,I(d(t).slice(0,s.value),l=>(a(),i("li",{key:l},[c(ie,{"word-id":l},null,8,["word-id"])]))),128))]),s.value<d(t).length?A((a(),i("button",{key:0,class:"next-page-button",onClick:e[0]||(e[0]=l=>r())},e[1]||(e[1]=[L(" Load More ")]))),[[d(Y),u]]):q("",!0)]))}}),me=y(de,[["__scopeId","data-v-2109a23e"]]);function fe(n){return new Worker("/assets/search-kanji.worker-CVf2lNVP.js",{name:n==null?void 0:n.name})}function pe(n){return new Worker("/assets/search-words.worker-Cf1PrufV.js",{name:n==null?void 0:n.name})}const R=new fe,$=new pe;function _e(n){const t=O([]);F(()=>S(n),async r=>{t.splice(0,t.length),r.length>0&&$.postMessage(r)},{debounce:300,immediate:!0});function s(r){const u=r.data;u.phrase===S(n)&&t.push(u)}return $.addEventListener("message",s),z(()=>{$.removeEventListener("message",s)}),t}function he(n){const t=P([]);F(()=>S(n),async r=>{r.length===0||B(r)?t.value=[]:R.postMessage(r)},{debounce:300,immediate:!0});function s(r){t.value=r.data}return R.addEventListener("message",s),z(()=>{R.removeEventListener("message",s)}),t}const ge={class:"word-search-result-item"},ke={class:"meaning"},ve=k({__name:"WordSearchResultItem",props:{result:{}},setup(n){const t=n,s=te(()=>t.result.id),r=w(()=>{var e,l;return s.value?(l=(e=s.value.readings)==null?void 0:e.at(0))==null?void 0:l.text:t.result.readings.at(0)}),u=w(()=>{var W,v,K,V,C,D,M;const{match:e,readings:l,writings:h}=t.result;if(s.value){let g;return B(e)?g=(W=s.value.furigana)==null?void 0:W.find(x=>x.writing===e):j(e)&&(g=(v=s.value.furigana)==null?void 0:v.find(x=>x.reading===e)),g||(g=(K=s.value.furigana)==null?void 0:K.at(0)),g?g.furigana:((C=(V=s.value.writings)==null?void 0:V.at(0))==null?void 0:C.text)??((M=(D=s.value.readings)==null?void 0:D.at(0))==null?void 0:M.text)??e}if(B(e))return[{ruby:e,rt:l.at(0)}];const[p]=h;if(j(e))return p?[{ruby:p,rt:e}]:e;const[_]=l;return p&&_?[{ruby:_,rt:_}]:p??_??e}),o=w(()=>{var h,p;const{match:e,glossary:l}=t.result;if(s.value){if(j(e))return((h=s.value.meanings)==null?void 0:h.at(0))??l.at(0)??e;const _=(p=s.value.meanings)==null?void 0:p.find(W=>{var v;return(v=W.glossary)==null?void 0:v.includes(e)});if(_)return _}return j(e)?l.at(0)??e:e});return(e,l)=>{const h=T("RouterLink");return a(),i("div",ge,[c(ae,{"word-id":e.result.id,reading:r.value,class:"bookmark-button"},null,8,["word-id","reading"]),c(h,{to:d(U)(e.result.id),class:"word"},{default:J(()=>[typeof u.value=="string"?(a(),i(f,{key:0},[L(N(u.value),1)],64)):(a(),b(ne,{key:1,furigana:u.value},null,8,["furigana"]))]),_:1},8,["to"]),m("div",ke,[typeof o.value=="string"?(a(),i(f,{key:0},[L(N(o.value),1)],64)):(a(),b(oe,{key:1,meaning:o.value},null,8,["meaning"]))])])}}}),we=y(ve,[["__scopeId","data-v-3a6c2f15"]]),ye={class:"word-search-results"},We={class:"results-list"},je=k({__name:"WordSearchResults",props:{phrase:{}},setup(n){const t=n,s=_e(()=>t.phrase);return(r,u)=>(a(),i("section",ye,[u[0]||(u[0]=m("h3",null,"Words",-1)),m("ul",We,[(a(!0),i(f,null,I(d(s),o=>(a(),i("li",{key:o.id},[c(we,{result:o},null,8,["result"])]))),128))])]))}}),be=y(je,[["__scopeId","data-v-884f1e39"]]),Ie={key:0,class:"kanji-search-results"},xe={key:0,class:"results-list"},Re={key:1,class:"results-list"},$e=k({__name:"KanjiSearchResults",props:{phrase:{}},setup(n){const t=n,s=w(()=>{const u=new Set;for(const o of t.phrase)ue(o)&&u.add(o);return u}),r=he(()=>t.phrase);return(u,o)=>s.value.size>0||d(r).length>0?(a(),i("section",Ie,[o[0]||(o[0]=m("h3",null,"Kanji",-1)),s.value.size>0?(a(),i("ul",xe,[(a(!0),i(f,null,I(s.value,e=>(a(),i("li",{key:e},[c(E,{kanji:e},null,8,["kanji"])]))),128))])):(a(),i("ul",Re,[(a(!0),i(f,null,I(d(r),e=>(a(),i("li",{key:e.id},[c(E,{kanji:String.fromCodePoint(e.id)},null,8,["kanji"])]))),128))]))])):q("",!0)}}),Le=y($e,[["__scopeId","data-v-37e6699a"]]),Se={class:"search-field"},Be=k({__name:"DictionaryView",setup(n){const t=H(),s=Q(),r=w({get(){return typeof t.query.search!="string"?"":t.query.search},set(u){s.replace({query:{search:u||void 0}})}});return(u,o)=>(a(),i(f,null,[m("label",Se,[c(se,{icon:"search",class:"icon"}),A(m("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>r.value=e),type:"search","aria-label":"search",placeholder:"Search for new words, kanji, meanings, etc."},null,512),[[G,r.value]])]),r.value?(a(),i(f,{key:0},[c(Le,{class:"kanji-results",phrase:r.value},null,8,["phrase"]),c(be,{class:"word-results",phrase:r.value},null,8,["phrase"])],64)):(a(),b(me,{key:1,class:"bookmark-results"}))],64))}}),Ae=y(Be,[["__scopeId","data-v-acb4ae58"]]);export{Ae as default};
