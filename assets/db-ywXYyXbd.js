import{d as O,S as T,o as y,c as h,u as d,t as E,e as L,b as V,_ as N,l as m,m as R,g as I,L as W}from"./index-uL2dLKam.js";const $=new URL("sprite-C-g4xJaW.svg",import.meta.url).href,F=["data-icon","aria-hidden","aria-labelledby","aria-describedby"],Q=["id"],K=["id"],U=["href"],Y=O({__name:"AppIcon",props:{icon:{},title:{default:""},description:{default:""}},setup(e){const t=T();return(r,n)=>(y(),h("svg",{"data-icon":r.icon,"aria-hidden":!r.title&&!r.description,"aria-labelledby":`${d(t)}/title`,"aria-describedby":`${d(t)}/desc`,class:"app-icon",preserveAspectRatio:"xMidYMid meet"},[r.title?(y(),h("title",{key:0,id:`${d(t)}/title`},E(r.title),9,Q)):L("",!0),r.description?(y(),h("desc",{key:1,id:`${d(t)}/desc`},E(r.description),9,K)):L("",!0),V("use",{href:`${d($)}#${r.icon}`},null,8,U)],8,F))}}),ie=N(Y,[["__scopeId","data-v-e711c5a6"]]),v=(e,t)=>t.some(r=>e instanceof r);let P,k;function H(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function J(){return k||(k=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const g=new WeakMap,p=new WeakMap,f=new WeakMap;function z(e){const t=new Promise((r,n)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{r(u(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",i)});return f.set(t,e),t}function G(e){if(g.has(e))return;const t=new Promise((r,n)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{r(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});g.set(e,t)}let b={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return g.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return u(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function _(e){b=e(b)}function X(e){return J().includes(e)?function(...t){return e.apply(D(this),t),u(this.request)}:function(...t){return u(e.apply(D(this),t))}}function Z(e){return typeof e=="function"?X(e):(e instanceof IDBTransaction&&G(e),v(e,H())?new Proxy(e,b):e)}function u(e){if(e instanceof IDBRequest)return z(e);if(p.has(e))return p.get(e);const t=Z(e);return t!==e&&(p.set(e,t),f.set(t,e)),t}const D=e=>f.get(e);function q(e,t,{blocked:r,upgrade:n,blocking:s,terminated:o}={}){const i=indexedDB.open(e,t),l=u(i);return n&&i.addEventListener("upgradeneeded",a=>{n(u(i.result),a.oldVersion,a.newVersion,u(i.transaction),a)}),r&&i.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),l.then(a=>{o&&a.addEventListener("close",()=>o()),s&&a.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),l}const ee=["get","getKey","getAll","getAllKeys","count"],te=["put","add","delete","clear"],w=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(w.get(t))return w.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=te.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||ee.includes(r)))return;const o=async function(i,...l){const a=this.transaction(i,s?"readwrite":"readonly");let c=a.store;return n&&(c=c.index(l.shift())),(await Promise.all([c[r](...l),s&&a.done]))[0]};return w.set(t,o),o}_(e=>({...e,get:(t,r,n)=>C(t,r)||e.get(t,r,n),has:(t,r)=>!!C(t,r)||e.has(t,r)}));const re=["continue","continuePrimaryKey","advance"],M={},B=new WeakMap,j=new WeakMap,ne={get(e,t){if(!re.includes(t))return e[t];let r=M[t];return r||(r=M[t]=function(...n){B.set(this,j.get(this)[t](...n))}),r}};async function*se(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const r=new Proxy(t,ne);for(j.set(r,t),f.set(r,D(t));t;)yield r,t=await(B.get(r)||t.continue()),B.delete(r)}function x(e,t){return t===Symbol.asyncIterator&&v(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&v(e,[IDBIndex,IDBObjectStore])}_(e=>({...e,get(t,r,n){return x(t,r)?se:e.get(t,r,n)},has(t,r){return x(t,r)||e.has(t,r)}}));const ae=q("shodoku",3,{upgrade(e,t){if(t<1){const r=e.createObjectStore("decks",{keyPath:"name"});r.createIndex("category","category"),r.createIndex("category+priority",["category","priority"]),r.createIndex("cards","cards",{multiEntry:!0});const n=e.createObjectStore("cards",{keyPath:"id"});n.createIndex("decks","decks",{multiEntry:!0}),n.createIndex("position",["position.priority","position.order"]);const s=e.createObjectStore("progress",{keyPath:["cardId","cardType"]});s.createIndex("cardId+cardType+state",["cardId","cardType","fsrs.state"]),s.createIndex("state+due",["fsrs.state","fsrs.due"]);const o=e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0});o.createIndex("cardId","cardId"),o.createIndex("review","log.review"),o.createIndex("state+review",["log.state","log.review"])}t<2&&e.createObjectStore("review-limits",{keyPath:"id",autoIncrement:!0}).createIndex("time","time"),t<3&&e.createObjectStore("bookmarked-words",{keyPath:"wordId"})}}),A="live-query-channel",S=new BroadcastChannel(A),ce=new BroadcastChannel(A);function de(e){const t=m(!0),r=m(null),n=m(null);async function s(){t.value=!0,n.value=null;const o=d(e);try{r.value=await o()}catch(i){n.value=i,r.value=null}finally{t.value=!1}}return S.addEventListener("message",s),R(()=>d(e),s,{immediate:!0}),W(()=>{S.removeEventListener("message",s)}),{error:I(()=>n.value),result:I(()=>r.value),loading:I(()=>t.value)}}export{ie as A,ae as d,ce as l,de as u};
