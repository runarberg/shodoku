import{d as _,Z as G,$ as P,c as K,a as d,N as ee,e as m,b as u,A as N,w as g,h as v,t as T,o as s,_ as h,Q as J,S as te,i as w,P as Y,F as A,q as x,I as ae,u as n,K as O,g as D,l as j,z as Q,m as H,D as le,x as se,O as V,a0 as ne}from"./index-6ufKAMkN.js";import{k as $,j as oe,a as ie,n as re,g as ce,b as ue}from"./decks-BkI394ym.js";import{c as U,e as de,r as F,a as me,d as ke,b as ye,f as fe}from"./decks-DSZdWDh0.js";import{d as q,u as Z}from"./db-CAXDHHnL.js";import{p as W,d as ge,m as ve}from"./reviews-vv4OOlcX.js";import{A as pe,a as be}from"./AppNumberInput-CByc6bl-.js";import{A as Ae}from"./AppTextArea-DuYNWae5.js";import{H as De,a as we,b as $e,c as _e,d as Ie,e as Te}from"./kana-BuuNxAQb.js";function Ce(e,l){return async t=>{let a=l;for await(const o of t)a=e(a,o);return a}}function Be(){return e=>[...e]}function Ne(e){return function*(l){for(const t of l)yield e(t)}}function xe(e){return function*(l){for(const t of l)e(t)&&(yield t)}}function he(){return function*(e){const l=new Set;for(const t of e)l.has(t)||(yield t,l.add(t))}}const Ke={class:"form-body"},je={class:"buttons"},Ve=_({__name:"CustomDeckForm",props:G({labelFieldDisabled:{type:Boolean,default:!1},priorityFieldDisabled:{type:Boolean,default:!1},confirmIcon:{default:null},confirmLabel:{default:"confirm"}},{label:{},labelModifiers:{},priority:{},priorityModifiers:{},cards:{},cardsModifiers:{}}),emits:G(["submit","reset"],["update:label","update:priority","update:cards"]),setup(e){const l=P(e,"label"),t=P(e,"priority"),a=P(e,"cards"),o=K({get(){return a.value?a.value.map(c=>String.fromCodePoint(c)).join(""):""},set(c){a.value=W(c,xe(ge),Ne(i=>i.codePointAt(0)),he(),Be())}});return(c,i)=>(s(),d("form",{onSubmit:i[3]||(i[3]=ee(r=>c.$emit("submit"),["prevent"])),onReset:i[4]||(i[4]=r=>c.$emit("reset"))},[m("div",Ke,[u(pe,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=r=>l.value=r),class:"name-field",label:"Deck Name",disabled:e.labelFieldDisabled,required:""},null,8,["modelValue","disabled"]),u(be,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=r=>t.value=r),class:"priority-field",label:"Priority",min:"1",disabled:e.priorityFieldDisabled,required:""},null,8,["modelValue","disabled"]),u(Ae,{modelValue:o.value,"onUpdate:modelValue":i[2]||(i[2]=r=>o.value=r),class:"kanji-field",label:"Kanji",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",placeholder:"Type or paste in your kanji here: 日月火時漢字読書"},null,8,["modelValue"])]),m("div",je,[u(N,{type:"reset"},{default:g(()=>[...i[5]||(i[5]=[v(" Cancel ",-1)])]),_:1}),u(N,{type:"submit","prefix-icon":e.confirmIcon,filled:""},{default:g(()=>[v(T(e.confirmLabel),1)]),_:1},8,["prefix-icon"])])],32))}}),X=h(Ve,[["__scopeId","data-v-a5ea0a3c"]]),Se=_({__name:"CustomDeckCreate",emits:["cancel","success"],setup(e,{emit:l}){const t=l,a=J({label:"",priority:1,cards:[]});async function o(){const i=await W((await q).transaction("decks").store.index("category").iterate("custom"),ve(r=>r.value.cards.length),Ce((r,y)=>r+y,0));i&&(a.priority=Math.ceil(i/12))}async function c(){const i=await U({label:a.label,priority:a.priority,cards:Y(a.cards),cardTypes:["kanji-write","kanji-read"]});t("success",i)}return te(()=>{o()}),(i,r)=>(s(),w(X,{cards:a.cards,"onUpdate:cards":r[0]||(r[0]=y=>a.cards=y),label:a.label,"onUpdate:label":r[1]||(r[1]=y=>a.label=y),priority:a.priority,"onUpdate:priority":r[2]||(r[2]=y=>a.priority=y),"confirm-icon":"plus","confirm-label":"Create",onSubmit:c,onReset:r[3]||(r[3]=y=>i.$emit("cancel"))},null,8,["cards","label","priority"]))}}),Ee=_({__name:"DeckActivateButton",props:{isActive:{type:Boolean,default:!1},toggling:{type:Boolean,default:!1}},emits:["activate","deactivate"],setup(e,{emit:l}){const t=e,a=l;function o(){t.isActive?a("deactivate"):a("activate")}return(c,i)=>(s(),w(N,{class:"activate-button",filled:e.isActive,disabled:e.toggling,"prefix-icon":e.toggling?void 0:e.isActive?"checkmark":"plus","aria-pressed":e.isActive,onClick:o},{default:g(()=>[e.toggling?(s(),d(A,{key:0},[i[0]||(i[0]=m("span",{class:"loading-icon"},"時",-1)),i[1]||(i[1]=v(" Loading ",-1))],64)):e.isActive?(s(),d(A,{key:1},[v(" Active ")],64)):(s(),d(A,{key:2},[v(" Add ")],64))]),_:1},8,["filled","disabled","prefix-icon","aria-pressed"]))}}),M=h(Ee,[["__scopeId","data-v-8468a69b"]]),Le=_({__name:"CustomDeckEdit",props:{deck:{}},emits:["cancel","success"],setup(e,{emit:l}){const t=e,a=l,o=J({label:t.deck.label,priority:t.deck.priority,cards:t.deck.cards});async function c(){const i=Y(t.deck);await de({...i,label:o.label,priority:o.priority,cards:Y(o.cards)}),a("success")}return(i,r)=>(s(),w(X,{cards:o.cards,"onUpdate:cards":r[0]||(r[0]=y=>o.cards=y),label:o.label,"onUpdate:label":r[1]||(r[1]=y=>o.label=y),priority:o.priority,"onUpdate:priority":r[2]||(r[2]=y=>o.priority=y),"confirm-label":"Update","label-field-disabled":t.deck.category!=="custom","priority-field-disabled":t.deck.category!=="custom",onSubmit:c,onReset:r[3]||(r[3]=y=>i.$emit("cancel"))},null,8,["cards","label","priority","label-field-disabled","priority-field-disabled"]))}}),Re=["aria-labelledby"],Fe={class:"header"},Ue=["id"],Me={class:"kanji-list"},Pe=_({__name:"DeckBrowserItem",props:{deck:{},template:{},category:{},togglingCategory:{type:Boolean,default:!1}},setup(e){const l=e,t=x(!1),a=x(!1),o=O(),c=x(null),i=K(()=>l.deck?.active);async function r(){t.value=!0;try{l.deck?await me(l.deck.name):await U({name:l.template.name,label:l.template.label,priority:l.template.priority,category:l.category,cards:c.value?.map(f=>f.codePointAt(0)??NaN)??[],cardTypes:["kanji-write","kanji-read"]})}catch(f){console.error(f)}finally{t.value=!1}}async function y(){if(l.deck){t.value=!0;try{await ke(l.deck.name)}catch(f){console.error(f)}finally{t.value=!1}}}return ae(()=>l.template?.content,async f=>{if(!f){c.value=null;return}const C=await(await fetch(f)).text();c.value=C.split(`
`).filter(b=>b)},{immediate:!0}),(f,k)=>{const C=Q("RouterLink");return a.value&&e.deck?(s(),w(Le,{key:0,deck:e.deck,onCancel:k[0]||(k[0]=b=>a.value=!1),onSuccess:k[1]||(k[1]=b=>a.value=!1)},null,8,["deck"])):(s(),d("article",{key:1,"aria-labelledby":n(o)},[m("header",Fe,[m("strong",{id:n(o)},T(e.deck?.label??e.template?.label),9,Ue),u(M,{toggling:t.value||e.togglingCategory,"is-active":i.value,onActivate:r,onDeactivate:y},null,8,["toggling","is-active"]),e.deck?.active||e.deck?.category==="custom"?(s(),w(N,{key:0,class:"edit-button",onClick:k[2]||(k[2]=b=>a.value=!0)},{default:g(()=>[...k[5]||(k[5]=[v(" Edit ",-1)])]),_:1})):e.deck&&!e.deck.active&&e.deck.category!=="custom"?(s(),w(N,{key:1,class:"edit-button",onClick:k[3]||(k[3]=b=>n(F)(e.deck.name))},{default:g(()=>[...k[6]||(k[6]=[v(" Reset ",-1)])]),_:1})):D("",!0),e.deck?.category==="custom"?(s(),w(N,{key:2,class:"delete-button",onClick:k[4]||(k[4]=b=>n(F)(e.deck.name))},{default:g(()=>[...k[7]||(k[7]=[v(" Delete ",-1)])]),_:1})):D("",!0)]),m("ol",Me,[e.deck?(s(!0),d(A,{key:0},j(e.deck.cards,b=>(s(),d("li",{key:b,class:"kanji"},[u(C,{to:n(H)(String.fromCodePoint(b))},{default:g(()=>[v(T(String.fromCodePoint(b)),1)]),_:2},1032,["to"])]))),128)):c.value?(s(!0),d(A,{key:1},j(c.value,b=>(s(),d("li",{key:b,class:"kanji"},[u(C,{to:n(H)(b)},{default:g(()=>[v(T(b),1)]),_:2},1032,["to"])]))),128)):D("",!0)])],8,Re))}}}),z=h(Pe,[["__scopeId","data-v-24a893c0"]]),Ye=["aria-labelledby"],Oe={class:"controls"},qe=["id"],Ge={key:2,class:"deck-list"},He=_({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(e){const l=e,t=x(!1),a=x(!1),o=O(),{result:c}=Z(K(()=>{const{category:B}=l;return async()=>{const p=new Map,I=(await q).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound([B,Number.NEGATIVE_INFINITY],[B,Number.POSITIVE_INFINITY],!0,!0));for await(const R of I)p.set(R.primaryKey,R.value);return p}})),i=K(()=>l.deckTemplates?l.deckTemplates.length:c.value?.size??0),r=K(()=>{if(!c.value)return 0;let B=0;for(const[,{active:p}]of c.value)p&&(B+=1);return B}),y=x(!1),f=K(()=>l.deckTemplates?r.value>=l.deckTemplates.length:!0);async function k(B){y.value=!0;try{await ye(l.category,B)}catch(p){console.error(p)}finally{y.value=!1}}async function C(){y.value=!0;try{await fe(l.category)}catch(B){console.error(B)}finally{y.value=!1}}function b(){a.value=!0,t.value=!1}return(B,p)=>(s(),d("article",{"aria-labelledby":n(o)},[m("div",Oe,[m("strong",{id:n(o),class:"title"},T(e.title),9,qe),e.deckTemplates?(s(),w(M,{key:0,toggling:y.value,"is-active":f.value,onActivate:p[0]||(p[0]=I=>k(e.deckTemplates)),onDeactivate:C},null,8,["toggling","is-active"])):t.value?D("",!0):(s(),w(N,{key:1,class:"create-custom-button","prefix-icon":"plus",onClick:p[1]||(p[1]=I=>t.value=!0)},{default:g(()=>[...p[4]||(p[4]=[v(" Create New ",-1)])]),_:1}))]),i.value>0?(s(),w(N,{key:0,class:"expand-button","aria-pressed":a.value,onClick:p[2]||(p[2]=I=>a.value=!a.value)},{default:g(()=>[a.value?(s(),d(A,{key:0},[v(" Hide ")],64)):(s(),d(A,{key:1},[v(" Show ")],64)),v(" ("+T(i.value)+" decks) ",1)]),_:1},8,["aria-pressed"])):D("",!0),t.value?(s(),w(Se,{key:1,class:"custom-deck-create",onCancel:p[3]||(p[3]=I=>t.value=!1),onSuccess:b})):D("",!0),a.value?(s(),d("ol",Ge,[e.deckTemplates?(s(!0),d(A,{key:0},j(e.deckTemplates,I=>(s(),d("li",{key:I.name},[u(z,{deck:n(c)?.get(I.name),template:I,category:e.category,"toggling-category":y.value},null,8,["deck","template","category","toggling-category"])]))),128)):n(c)?(s(!0),d(A,{key:1},j(n(c),([I,R])=>(s(),d("li",{key:I},[u(z,{deck:R,category:"custom",template:null},null,8,["deck"])]))),128)):D("",!0)])):D("",!0)],8,Ye))}}),L=h(He,[["__scopeId","data-v-4055e6ef"]]),ze=_({__name:"DeckBrowserCustom",setup(e){return(l,t)=>(s(),w(L,{title:"Custom",category:"custom"}))}}),Je={class:"deck-browser-kana-deck-item"},Qe={class:"header"},Ze={class:"kana-title"},We={class:"body"},Xe=_({__name:"DeckBrowserKanaItem",props:{template:{},togglingCategory:{type:Boolean},isActive:{type:Boolean}},setup(e){const l=e,t=x(!1);async function a(){t.value=!0;try{await U(l.template)}catch(c){console.error(c)}finally{t.value=!1}}async function o(){t.value=!0;try{await F(l.template.name)}catch(c){console.error(c)}finally{t.value=!1}}return(c,i)=>(s(),d("article",Je,[m("header",Qe,[m("strong",Ze,T(e.template.label),1),u(M,{toggling:t.value||e.togglingCategory,"is-active":e.isActive,onActivate:a,onDeactivate:o},null,8,["toggling","is-active"])]),m("div",We,[le(c.$slots,"default")])]))}}),S=h(Xe,[["__scopeId","data-v-e59ee8fd"]]),et={class:"kana-table"},tt={key:0},at={key:0,class:"aiueo"},lt={key:0},st={class:"consonant"},nt=_({__name:"KanaTable",props:{headings:{},rows:{}},setup(e){return(l,t)=>{const a=Q("RouterLink");return s(),d("table",et,[e.headings?(s(),d("thead",tt,[m("tr",null,[(s(!0),d(A,null,j(e.headings,(o,c)=>(s(),d("th",{key:c},[o?(s(),d("span",at,T(o),1)):D("",!0)]))),128))])])):D("",!0),m("tbody",null,[(s(!0),d(A,null,j(e.rows,({heading:o,cells:c},i)=>(s(),d("tr",{key:i},[o?(s(),d("th",lt,[m("span",st,T(o),1)])):D("",!0),(s(!0),d(A,null,j(c,(r,y)=>(s(),d("td",{key:y},[r?(s(),w(a,{key:0,class:"kana-literal",to:n(se)(r)},{default:g(()=>[v(T(r),1)]),_:2},1032,["to"])):D("",!0)]))),128))]))),128))])])}}}),E=h(nt,[["__scopeId","data-v-f41c3b1c"]]),ot=["aria-labelledby"],it={class:"controls"},rt=["id"],ct={key:0,class:"deck-list"},ut=_({__name:"DeckBrowserKana",setup(e){const l=x(!1),t=O(),a=x(!1),{result:o}=Z(K(()=>async()=>{const f=new Map,k=(await q).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound(["kana",Number.NEGATIVE_INFINITY],["kana",Number.POSITIVE_INFINITY],!0,!0));for await(const C of k)f.set(C.primaryKey,C.value);return f}),new Map),c=Object.keys($).length,i=K(()=>o.value.size===c);async function r(){a.value=!0;const f=o.value;try{for(const k of Object.values($))f.has(k.name)||await U(k)}catch(k){console.error(k)}finally{a.value=!1}}async function y(){a.value=!0;try{for(const f of o.value.keys())await F(f)}catch(f){console.error(f)}finally{a.value=!1}}return(f,k)=>(s(),d("article",{"aria-labelledby":n(t)},[m("div",it,[m("strong",{id:n(t),class:"title"},"Kana",8,rt),u(M,{toggling:a.value,"is-active":i.value,onActivate:r,onDeactivate:y},null,8,["toggling","is-active"])]),u(N,{class:"expand-button","aria-pressed":l.value,onClick:k[0]||(k[0]=C=>l.value=!l.value)},{default:g(()=>[l.value?(s(),d(A,{key:0},[v("Hide ")],64)):(s(),d(A,{key:1},[v("Show ")],64)),v(" ("+T(n(c))+" decks) ",1)]),_:1},8,["aria-pressed"]),l.value?(s(),d("ol",ct,[m("li",null,[u(S,{template:n($).hiragana,"toggling-category":a.value,"is-active":n(o).has("hiragana")},{default:g(()=>[u(E,V({class:"kana-table"},n(De)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(S,{template:n($).katakana,"toggling-category":a.value,"is-active":n(o).has("katakana")},{default:g(()=>[u(E,V({class:"kana-table"},n(we)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(S,{template:n($).hiraganaDakuten,"toggling-category":a.value,"is-active":n(o).has(n($).hiraganaDakuten.name)},{default:g(()=>[u(E,V({class:"kana-table"},n($e)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(S,{template:n($).hiraganaYoon,"toggling-category":a.value,"is-active":n(o).has(n($).hiraganaYoon.name)},{default:g(()=>[u(E,V({class:"kana-table"},n(_e)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(S,{template:n($).katakanaDakuten,"toggling-category":a.value,"is-active":n(o).has(n($).katakanaDakuten.name)},{default:g(()=>[u(E,V({class:"kana-table"},n(Ie)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(S,{template:n($).katakanaYoon,"toggling-category":a.value,"is-active":n(o).has(n($).katakanaYoon.name)},{default:g(()=>[u(E,V({class:"kana-table"},n(Te)),null,16)]),_:1},8,["template","toggling-category","is-active"])])])):D("",!0)],8,ot))}}),dt=h(ut,[["__scopeId","data-v-678701c1"]]),mt={class:"categories"},kt=_({__name:"DeckBrowser",setup(e){return(l,t)=>(s(),d("ul",mt,[m("li",null,[u(dt)]),m("li",null,[u(L,{title:"JLPT",category:"jlpt","deck-templates":n(oe)},null,8,["deck-templates"])]),m("li",null,[u(L,{title:"Jōyō Kanji",category:"jouyou","deck-templates":n(ie)},null,8,["deck-templates"])]),m("li",null,[u(L,{title:"News Frequency",category:"news","deck-templates":n(re)},null,8,["deck-templates"])]),m("li",null,[u(L,{title:"Genki",category:"genki","deck-templates":n(ce)},null,8,["deck-templates"])]),m("li",null,[u(L,{title:"Basic Kanji Book",category:"basic-kanji","deck-templates":n(ue)},null,8,["deck-templates"])]),m("li",null,[u(ze)])]))}}),yt=h(kt,[["__scopeId","data-v-45aa42ba"]]),ft={class:"article-header"},gt={class:"actions"},vt=_({__name:"DeckBrowserView",setup(e){return(l,t)=>(s(),d("article",null,[m("header",ft,[t[1]||(t[1]=m("h2",{class:"title"},"Add Decks",-1)),m("div",gt,[u(N,{to:n(ne),"prefix-icon":"arrow-left"},{default:g(()=>[...t[0]||(t[0]=[v(" Back to your decks ",-1)])]),_:1},8,["to"])])]),u(yt)]))}}),Tt=h(vt,[["__scopeId","data-v-a1e5f41b"]]);export{Tt as default};
//# sourceMappingURL=DeckBrowserView-_d8ruq7o.js.map
