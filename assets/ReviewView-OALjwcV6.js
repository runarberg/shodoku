import{d as j,c as R,a as l,F as p,l as A,i as $,w as q,e as v,t as C,u,A as N,o as d,_ as I,b as g,g as f,m as S,h as y,n as W,p as D,q as P,s as x,v as B,k as F,x as L,j as K}from"./index-3SZaU-iL.js";import{A as E}from"./AppLoading-dOxd0OoU.js";import{R as T,b as Y,S as G,u as M,c as Q}from"./reviews-C0tp5JDi.js";import{d as z}from"./db-CmzCis4b.js";import{r as H,u as J}from"./kana-DFdUvK8b.js";import{K as O,_ as U,a as X}from"./KanaTitle-CEk6R7Iq.js";import{u as Z}from"./fsrs-D14ruAop.js";import{u as _,a as ee}from"./kanji-BFHyEMwy.js";import{p as ae}from"./CardRetrievabilityLabel-46Oryz0n.js";import{K as te,a as ne,b as ie,c as re,d as se}from"./KanjiWordList-D7GvJb65.js";import"./decks-BkI394ym.js";import"./formats-BZjAUNO7.js";import"./decks-gvUqHaG3.js";import"./WordWritingSelect-DnSPLHUE.js";import"./kanji-components-C9A26trC.js";import"./index-BVkQD7g-.js";import"./WordListItem-DZ1Oghxl.js";const oe={class:"rate-buttons"},de={class:"rate-button-content"},ue={class:"rating"},ce={class:"next-review-time"},le=j({__name:"RateButtons",props:{progress:{}},emits:["rate"],setup(e,{emit:i}){const t=e,r=i,n=Z(),a=R(()=>n.value.repeat(t.progress,new Date));function s(w){const b=w.last_review?.getTime()??Date.now(),k=w.due.getTime();return Y(k-b)}function m(w){w!==T.Manual&&r("rate",n.value.next(t.progress,new Date,w))}return(w,b)=>(d(),l("div",oe,[(d(!0),l(p,null,A(a.value,({log:k,card:o})=>(d(),$(N,{key:k.rating,class:"rating-button","data-rating":u(T)[k.rating],onClick:c=>m(k.rating)},{default:q(()=>[v("span",de,[v("span",ue,C(u(T)[k.rating]),1),v("small",ce,C(s(o)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),me=I(le,[["__scopeId","data-v-8b639bb2"]]),ge={class:"advance-buttons"},we=j({__name:"ReviewAdvanceButtons",props:{progress:{},isRating:{type:Boolean},mode:{}},emits:["answer","rate"],setup(e){return(i,t)=>(d(),l("div",ge,[e.isRating?(d(),$(me,{key:0,progress:e.progress,onRate:t[0]||(t[0]=r=>i.$emit("rate",r))},null,8,["progress"])):(d(),l(p,{key:1},[g(N,{filled:"",onClick:t[1]||(t[1]=r=>i.$emit("answer"))},{default:q(()=>[t[2]||(t[2]=y(" Show ",-1)),e.mode==="read"?(d(),l(p,{key:0},[y(" Reading ")],64)):(d(),l(p,{key:1},[y(" Writing ")],64))]),_:1}),"singleton"in i.$route.query&&typeof i.$route.params.kanji=="string"?(d(),$(N,{key:0,to:u(S)(i.$route.params.kanji),replace:""},{default:q(()=>[...t[3]||(t[3]=[y(" Cancel ",-1)])]),_:1},8,["to"])):f("",!0)],64))]))}}),V=I(we,[["__scopeId","data-v-5ce12812"]]),ve={key:0},fe=j({__name:"ReviewCardKana",props:{cardId:{},progress:{},isNew:{type:Boolean},isRating:{type:Boolean},mode:{}},emits:["answer","rate"],setup(e){const i=e;function t(a){return[12419,12421,12423,12515,12517,12519].includes(a)}const r=R(()=>{const{cardId:a}=i;return t(a)?H(String.fromCodePoint(a)):String.fromCodePoint(a)}),n=J(r);return(a,s)=>u(n)?(d(),l("section",ve,[g(O,{kana:r.value,"kana-info":u(n),"hide-kana":!e.isRating&&!e.isNew&&e.mode==="write","hide-romaji":!e.isRating&&e.mode==="read",actions:"review",class:"title"},null,8,["kana","kana-info","hide-kana","hide-romaji"]),g(U,{class:"strokes",kana:r.value,"auto-hint":e.isNew&&!e.isRating&&e.mode==="write","practice-mode":!e.isRating&&e.mode==="write",onPracticeDone:s[0]||(s[0]=m=>a.$emit("answer"))},null,8,["kana","auto-hint","practice-mode"]),g(V,{progress:e.progress,"is-rating":e.isRating,mode:e.mode,onAnswer:s[1]||(s[1]=m=>a.$emit("answer")),onRate:s[2]||(s[2]=m=>a.$emit("rate",m))},null,8,["progress","is-rating","mode"]),u(n)?.vocab?(d(),$(X,{key:0,vocab:u(n).vocab,"hide-romaji":!e.isRating&&e.mode==="read","hide-kana":!e.isRating&&!e.isNew&&e.mode==="write","target-kana":r.value},null,8,["vocab","hide-romaji","hide-kana","target-kana"])):f("",!0)])):f("",!0)}}),ke={key:0},Re=j({__name:"ReviewCardKanji",props:{cardId:{},progress:{},isNew:{type:Boolean},isRating:{type:Boolean},mode:{}},emits:["answer","rate"],setup(e){const i=e,t=_(()=>i.cardId),r=ee(()=>i.cardId);return ae(()=>i.cardId.toString(16).padStart(5,"0")),(n,a)=>u(t)?(d(),l("section",ke,[g(te,{class:"title",kanji:u(t),"hide-literal":!e.isRating&&!e.isNew&&e.mode==="write","hide-meaning":!e.isRating&&e.mode==="read"},null,8,["kanji","hide-literal","hide-meaning"]),g(ne,{class:"readings",kanji:u(t),"hide-readings":e.mode==="read"&&!e.isRating},null,8,["kanji","hide-readings"]),g(ie,{class:"strokes",kanji:u(t).literal,"auto-hint":e.isNew&&!e.isRating&&e.mode==="write","practice-mode":!e.isRating&&e.mode==="write",onPracticeDone:a[0]||(a[0]=s=>n.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),g(V,{progress:e.progress,"is-rating":e.isRating,mode:e.mode,onAnswer:a[1]||(a[1]=s=>n.$emit("answer")),onRate:a[2]||(a[2]=s=>n.$emit("rate",s))},null,8,["progress","is-rating","mode"]),g(re,{class:"components",hide:!e.isRating&&!(e.mode==="write"&&e.isNew)},null,8,["hide"]),u(r)?(d(),$(se,{key:0,class:"words","kanji-vocab":u(r),"hide-kanji":!e.isRating&&!e.isNew&&e.mode==="write","hide-reading":!e.isRating&&e.mode==="read","hide-meaning":!e.isRating&&e.mode==="read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):f("",!0)])):f("",!0)}}),ye={key:0},$e=j({__name:"ReviewCard",props:{card:{},isRating:{type:Boolean}},emits:["answer","rate"],setup(e){const i=e,t=W(async()=>{const{cardId:n,cardType:a,fsrs:s}=i.card;return s||(await(await z).get("progress",[n,a]))?.fsrs},i.card.fsrs),r=R(()=>t.value?.state===G.New);return(n,a)=>u(t)?(d(),l("section",ye,[(d(),$(D(e.card.cardType.startsWith("kana-")?fe:Re),{"card-id":e.card.cardId,progress:u(t),"is-new":r.value,"is-rating":e.isRating,mode:e.card.cardType.endsWith("-write")?"write":"read",onAnswer:a[0]||(a[0]=s=>n.$emit("answer")),onRate:a[1]||(a[1]=s=>n.$emit("rate",{progress:{...e.card,fsrs:u(t)},next:s}))},null,40,["card-id","progress","is-new","is-rating","mode"]))])):f("",!0)}}),je={key:0,class:"review-remaining-count"},he={class:"review-count"},pe={class:"new-count"},Ce={class:"learning-count"},be=j({__name:"ReviewRemainCount",setup(e){const i=M();return(t,r)=>u(i)?(d(),l("div",je,[v("span",he,C(u(i).due),1),v("span",pe,"(+ "+C(u(i).new)+")",1),v("span",Ce,C(u(i).learning),1)])):f("",!0)}}),Ie=I(be,[["__scopeId","data-v-adc21f06"]]);function Te(e){return e==="kanji-read"||e==="kanji-write"||e==="kana-read"||e==="kana-write"}const qe={class:"header"},Ne={class:"title"},Be={key:0,class:"loading"},Ke=j({__name:"ReviewView",setup(e){const i=P(null),t=x(),r=F(),n=Q(),a=R(()=>{const{"card-type":o}=t.query;return typeof o!="string"||!Te(o)?null:o}),s=R(()=>{const{"card-id":o}=t.query;if(typeof o!="string")return null;const c=Number.parseInt(o);return Number.isFinite(c)?c:null}),m=R(()=>!s.value||!a.value?null:n.queue.find(c=>c.cardId===s.value&&c.cardType===a.value)??{cardId:s.value,cardType:a.value}),w=R(()=>"rating"in t.query),b=R(()=>!m.value&&n.refreshing);n.refreshQueues(),B(()=>{n.queue.length===0&&!n.refreshing&&!w.value&&!("singleton"in t.query)&&r.replace(K)}),B(()=>{if(m.value)return;const[o]=n.queue;o&&r.replace({query:{"card-id":o.cardId,"card-type":o.cardType,rating:void 0}})});function k({progress:o,next:c}){if(n.rateCard(o,c),"singleton"in t.query){o.cardType.startsWith("kanji-")?r.replace(S(String.fromCodePoint(o.cardId))):o.cardType.startsWith("kana-")&&r.replace(L(String.fromCodePoint(o.cardId)));return}const[h]=n.queue;h?(r.replace({query:{"card-id":String.fromCodePoint(h.cardId),"card-type":h.cardType,rating:void 0}}),i.value?.scrollIntoView({behavior:"instant",block:"start"})):r.replace(K)}return(o,c)=>(d(),l("article",{ref_key:"el",ref:i,class:"review-view"},[v("header",qe,[v("strong",Ne,[a.value?.endsWith("-read")?(d(),l(p,{key:0},[y(" Reading ")],64)):a.value?.endsWith("-write")?(d(),l(p,{key:1},[y(" Writing ")],64)):f("",!0),c[2]||(c[2]=y(" Review ",-1))]),g(Ie,{class:"counts"})]),b.value?(d(),l("section",Be,[c[3]||(c[3]=v("p",null,"Loading next cardâ€¦",-1)),g(E,{class:"loading-icon"})])):m.value?(d(),$($e,{key:1,card:m.value,"is-rating":w.value,onAnswer:c[0]||(c[0]=h=>o.$router.replace({query:{...o.$route.query,rating:""}})),onRate:c[1]||(c[1]=h=>k(h))},null,8,["card","is-rating"])):f("",!0)],512))}}),Oe=I(Ke,[["__scopeId","data-v-65542c37"]]);export{Oe as default};
//# sourceMappingURL=ReviewView-OALjwcV6.js.map
