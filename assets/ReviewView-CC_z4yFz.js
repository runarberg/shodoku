import{d as C,c as _,a as c,F as R,l as A,i as w,w as S,e as g,t as h,u as i,A as q,o as n,_ as $,m as V,n as N,g as f,b as T,p as B,h as j,q as D,s as I,k as P,j as K}from"./index-BM2Ra3on.js";import{A as E}from"./AppLoading-DqTj0FUC.js";import{R as b,b as L,S as F,u as W,c as G}from"./reviews-BZy-Kf2y.js";import{d as M}from"./db-MrKA-e94.js";import{u as Q,a as z}from"./kanji-FSB18ZmU.js";import{p as H,K as J,a as O,b as U,c as X,d as Y}from"./KanjiWordList-Bkqv3Okt.js";import{u as Z}from"./fsrs-B_IQ2BK6.js";import"./kanji-components-CdOEBGxo.js";import"./decks-SO1bh7uj.js";import"./decks-Bhp3y8Gp.js";import"./decks-BBCgiq92.js";import"./index-BaBsQMEA.js";import"./WordListItem-CxTWrGoe.js";import"./WordWritingSelect-ba5XybYn.js";const x={class:"rate-buttons"},ee={class:"rate-button-content"},ae={class:"rating"},ne={class:"next-review-time"},te=C({__name:"RateButtons",props:{progress:{}},emits:["rate"],setup(k,{emit:u}){const t=k,l=u,r=Z(),p=_(()=>r.value.repeat(t.progress,new Date));function y(o){const s=o.last_review?.getTime()??Date.now(),a=o.due.getTime();return L(a-s)}function m(o){o!==b.Manual&&l("rate",r.value.next(t.progress,new Date,o))}return(o,s)=>(n(),c("div",x,[(n(!0),c(R,null,A(p.value,({log:a,card:e})=>(n(),w(q,{key:a.rating,class:"rating-button","data-rating":i(b)[a.rating],onClick:d=>m(a.rating)},{default:S(()=>[g("span",ee,[g("span",ae,h(i(b)[a.rating]),1),g("small",ne,h(y(e)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),re=$(te,[["__scopeId","data-v-8b639bb2"]]),se={key:0},ie={class:"advance-buttons"},oe=C({__name:"KanjiReview",props:{card:{},isRating:{type:Boolean},singleton:{type:Boolean}},emits:["answer","rate"],setup(k,{emit:u}){const t=k,l=u,r=Q(()=>t.card.cardId),p=z(()=>t.card.cardId),y=V(null);H(()=>t.card.cardId.toString(16).padStart(5,"0"));const m=N(async()=>{const{cardId:e,cardType:d,fsrs:v}=t.card;return v||(await(await M).get("progress",[e,d]))?.fsrs},t.card.fsrs),o=_(()=>m.value?.state===F.New);function s(){l("answer"),t.card.cardType==="kanji-write"&&y.value?.maybeShowAnswer()}function a(e){m.value&&(y.value?.clearPracticeStrokes(),l("rate",{progress:{...t.card,fsrs:m.value},next:e}))}return(e,d)=>i(r)&&i(m)?(n(),c("section",se,[T(J,{class:"title",kanji:i(r),"hide-literal":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.isRating||e.card.cardType==="kanji-write"?(n(),w(O,{key:0,class:"readings",kanji:i(r)},null,8,["kanji"])):f("",!0),T(U,{ref_key:"kanjiStrokesEl",ref:y,class:"strokes",kanji:i(r),"auto-hint":!e.isRating&&e.card.cardType==="kanji-write"&&o.value,"practice-mode":!e.isRating&&e.card.cardType==="kanji-write",onPracticeDone:d[0]||(d[0]=v=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),g("div",ie,[e.isRating?(n(),w(re,{key:0,progress:i(m),onRate:a},null,8,["progress"])):(n(),c(R,{key:1},[T(q,{filled:"",onClick:d[1]||(d[1]=v=>s())},{default:S(()=>[d[2]||(d[2]=j(" Show ",-1)),e.card.cardType==="kanji-read"?(n(),c(R,{key:0},[j(" Reading ")],64)):(n(),c(R,{key:1},[j(" Writing ")],64))]),_:1}),e.singleton?(n(),w(q,{key:0,to:i(B)(i(r).literal),replace:""},{default:S(()=>[...d[3]||(d[3]=[j(" Cancel ",-1)])]),_:1},8,["to"])):f("",!0)],64))]),e.isRating||e.card.cardType==="kanji-write"&&o.value?(n(),w(X,{key:1,class:"components"})):f("",!0),i(p)?(n(),w(Y,{key:2,class:"words","kanji-vocab":i(p),"hide-kanji":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-reading":!e.isRating&&e.card.cardType==="kanji-read","hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):f("",!0)])):f("",!0)}}),de=$(oe,[["__scopeId","data-v-124cfaf0"]]),ce={key:0,class:"review-remaining-count"},ue={class:"review-count"},le={class:"new-count"},pe={class:"learning-count"},ge=C({__name:"ReviewRemainCount",setup(k){const u=W();return(t,l)=>i(u)?(n(),c("div",ce,[g("span",ue,h(i(u).due),1),g("span",le,"(+ "+h(i(u).new)+")",1),g("span",pe,h(i(u).learning),1)])):f("",!0)}}),me=$(ge,[["__scopeId","data-v-adc21f06"]]);function ke(k){return k==="kanji-read"||k==="kanji-write"}const fe={class:"header"},ye={class:"title"},ve={key:0,class:"loading"},we=C({__name:"ReviewView",setup(k){const u=V(null),t=D(),l=P(),r=G(),p=_(()=>{const{kanji:s,"card-type":a}=t.query;if(typeof s!="string"||typeof a!="string")return null;const e=s.codePointAt(0);return!e||!ke(a)?null:r.queue.find(v=>v.cardId===e&&v.cardType===a)??{cardId:e,cardType:a}}),y=_(()=>"rating"in t.query),m=_(()=>!p.value&&r.refreshing);r.refreshQueues(),I(()=>{r.queue.length===0&&!r.refreshing&&l.replace(K)}),I(()=>{if(p.value)return;const[s]=r.queue;s&&l.replace({query:{kanji:String.fromCodePoint(s.cardId),"card-type":s.cardType,rating:void 0}})});function o({progress:s,next:a}){if(r.rateCard(s,a),"singleton"in t.query&&typeof t.query.kanji=="string"){l.replace(B(t.query.kanji));return}const[e]=r.queue;e?(l.replace({query:{kanji:String.fromCodePoint(e.cardId),"card-type":e.cardType,rating:void 0}}),u.value?.scrollIntoView({behavior:"instant",block:"start"})):l.replace(K)}return(s,a)=>(n(),c("article",{ref_key:"el",ref:u},[g("header",fe,[g("strong",ye,[p.value?(n(),c(R,{key:0},[p.value.cardType==="kanji-read"?(n(),c(R,{key:0},[j(" Reading ")],64)):(n(),c(R,{key:1},[j("Writing")],64)),a[2]||(a[2]=j(" Review ",-1))],64)):f("",!0)]),T(me,{class:"counts"})]),m.value?(n(),c("section",ve,[a[3]||(a[3]=g("p",null,"Loading next cardâ€¦",-1)),T(E,{class:"loading-icon"})])):p.value?(n(),w(de,{key:1,card:p.value,"is-rating":y.value,singleton:"singleton"in s.$route.query,onAnswer:a[0]||(a[0]=e=>s.$router.replace({query:{...s.$route.query,rating:""}})),onRate:a[1]||(a[1]=e=>o(e))},null,8,["card","is-rating","singleton"])):f("",!0)],512))}}),Ne=$(we,[["__scopeId","data-v-8168279c"]]);export{Ne as default};
//# sourceMappingURL=ReviewView-CC_z4yFz.js.map
