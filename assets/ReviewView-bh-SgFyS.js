import{d as C,c as _,a as u,F as j,l as A,i as y,w as K,e as m,t as h,u as i,A as q,o as n,_ as $,m as V,g as w,b as T,h as R,n as B,p as S,k as N,j as I}from"./index-gkm2TMQe.js";import{A as D}from"./AppLoading-D3ZrQC-U.js";import{R as b,c as P,S as E}from"./index-CbYumIFw.js";import{d as L}from"./db-DOZG9NOu.js";import{u as F,a as W}from"./kanji-J44TzOjd.js";import{p as G,K as M,a as Q,b as z,c as H,d as J}from"./KanjiWordList-OM-xYhjQ.js";import{u as O}from"./fsrs-CmfFmnHz.js";import{b as U,u as X,c as Y}from"./reviews-D84XVVKd.js";import"./index-EEqkjwK5.js";import"./kanji-components-BvfvIGIG.js";import"./decks-CfOZF5PQ.js";import"./formats-CxjEYhKc.js";import"./index-urjZb-CP.js";import"./WordListItem-CTik2-3f.js";import"./WordWritingSelect-CTMgAR99.js";const Z={class:"rate-buttons"},x={class:"rate-button-content"},ee={class:"rating"},ae={class:"next-review-time"},ne=C({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(g,{emit:d}){const s=g,l=d,r=_(()=>k.value.repeat(s.fsrs,new Date));function c(o){const t=o.last_review?.getTime()??Date.now(),a=o.due.getTime();return U(a-t)}const k=O();function f(o){o!==b.Manual&&l("rate",k.value.next(s.fsrs,new Date,o))}return(o,t)=>(n(),u("div",Z,[(n(!0),u(j,null,A(r.value,({log:a,card:e})=>(n(),y(q,{class:"rating-button",key:a.rating,"data-rating":i(b)[a.rating],onClick:p=>f(a.rating)},{default:K(()=>[m("span",x,[m("span",ee,h(i(b)[a.rating]),1),m("small",ae,h(c(e)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),te=$(ne,[["__scopeId","data-v-4210a69b"]]),re={key:0},se={class:"advance-buttons"},ie=C({__name:"KanjiReview",props:{card:{},isRating:{type:Boolean}},emits:["answer","rate"],setup(g,{emit:d}){const s=g,l=d,r=F(()=>s.card.cardId),c=W(()=>s.card.cardId),k=V(null);G(()=>s.card.cardId.toString(16).padStart(5,"0"));const f=P(async()=>{const{cardId:e,cardType:p,fsrs:v}=s.card;return v||(await(await L).get("progress",[e,p]))?.fsrs},s.card.fsrs),o=_(()=>f.value?.state===E.New);function t(){l("answer"),s.card.cardType==="kanji-write"&&k.value?.maybeShowAnswer()}function a(e){f.value&&(k.value?.clearPracticeStrokes(),l("rate",{progress:{...s.card,fsrs:f.value},next:e}))}return(e,p)=>i(r)&&i(f)?(n(),u("section",re,[T(M,{class:"title",kanji:i(r),"hide-literal":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.isRating||e.card.cardType==="kanji-write"?(n(),y(Q,{key:0,class:"readings",kanji:i(r)},null,8,["kanji"])):w("",!0),T(z,{ref_key:"kanjiStrokesEl",ref:k,class:"strokes",kanji:i(r),"auto-hint":!e.isRating&&e.card.cardType==="kanji-write"&&o.value,"practice-mode":!e.isRating&&e.card.cardType==="kanji-write",onPracticeDone:p[0]||(p[0]=v=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),m("div",se,[e.isRating?(n(),y(te,{key:0,fsrs:i(f),onRate:a},null,8,["fsrs"])):(n(),y(q,{key:1,onClick:p[1]||(p[1]=v=>t()),filled:""},{default:K(()=>[p[2]||(p[2]=R(" Show ")),e.card.cardType==="kanji-read"?(n(),u(j,{key:0},[R(" Reading")],64)):(n(),u(j,{key:1},[R(" Writing")],64))]),_:1,__:[2]}))]),e.isRating||e.card.cardType==="kanji-write"&&o.value?(n(),y(H,{key:1,class:"components"})):w("",!0),i(c)?(n(),y(J,{key:2,class:"words","kanji-vocab":i(c),"hide-kanji":!e.isRating&&e.card.cardType==="kanji-write"&&!o.value,"hide-reading":!e.isRating&&e.card.cardType==="kanji-read","hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):w("",!0)])):w("",!0)}}),oe=$(ie,[["__scopeId","data-v-0008267d"]]),de={key:0,class:"review-remaining-count"},ce={class:"review-count"},ue={class:"new-count"},le={class:"learning-count"},pe=C({__name:"ReviewRemainCount",setup(g){const d=X();return(s,l)=>i(d)?(n(),u("div",de,[m("span",ce,h(i(d).due),1),m("span",ue,"(+ "+h(i(d).new)+")",1),m("span",le,h(i(d).learning),1)])):w("",!0)}}),me=$(pe,[["__scopeId","data-v-adc21f06"]]);function fe(g){return g==="kanji-read"||g==="kanji-write"}const ge={class:"header"},ke={class:"title"},ve={key:0,class:"loading"},ye=C({__name:"ReviewView",setup(g){const d=V(null),s=B(),l=N(),r=Y(),c=_(()=>{const{kanji:t,"card-type":a}=s.query;if(typeof t!="string"||typeof a!="string")return null;const e=t.codePointAt(0);return!e||!fe(a)?null:r.queue.find(v=>v.cardId===e&&v.cardType===a)??{cardId:e,cardType:a}}),k=_(()=>"rating"in s.query),f=_(()=>!c.value&&r.refreshing);r.refreshQueues(),S(()=>{r.queue.length===0&&!r.refreshing&&l.replace(I)}),S(()=>{if(c.value)return;const[t]=r.queue;t&&l.replace({query:{kanji:String.fromCodePoint(t.cardId),"card-type":t.cardType,rating:void 0}})});function o({progress:t,next:a}){r.rateCard(t,a);const[e]=r.queue;e?(l.replace({query:{kanji:String.fromCodePoint(e.cardId),"card-type":e.cardType,rating:void 0}}),d.value?.scrollIntoView({behavior:"instant",block:"start"})):l.replace(I)}return(t,a)=>(n(),u("article",{ref_key:"el",ref:d},[m("header",ge,[m("strong",ke,[c.value?(n(),u(j,{key:0},[c.value.cardType==="kanji-read"?(n(),u(j,{key:0},[R(" Reading ")],64)):(n(),u(j,{key:1},[R("Writing")],64)),a[2]||(a[2]=R(" Review "))],64)):w("",!0)]),T(me,{class:"counts"})]),f.value?(n(),u("section",ve,[a[3]||(a[3]=m("p",null,"Loading next cardâ€¦",-1)),T(D,{class:"loading-icon"})])):c.value?(n(),y(oe,{key:1,card:c.value,"is-rating":k.value,onAnswer:a[0]||(a[0]=e=>t.$router.replace({query:{...t.$route.query,rating:""}})),onRate:a[1]||(a[1]=e=>o(e))},null,8,["card","is-rating"])):w("",!0)],512))}}),Ne=$(ye,[["__scopeId","data-v-d4d44108"]]);export{Ne as default};
