import{d as O,G as T,o as y,a as m,u,t as B,g as E,f as N,_ as V,j as I,k as R,c as h,J as W}from"./index-CgdTuyLR.js";const $=new URL("sprite-CY9-oe3f.svg",import.meta.url).href,F=["data-icon","aria-hidden","aria-labelledby","aria-describedby"],K=["id"],Q=["id"],Y=["href"],U=O({__name:"AppIcon",props:{icon:{},title:{default:""},description:{default:""}},setup(e){const t=T();return(r,o)=>(y(),m("svg",{"data-icon":r.icon,"aria-hidden":!r.title&&!r.description,"aria-labelledby":`${u(t)}/title`,"aria-describedby":`${u(t)}/desc`,class:"app-icon",preserveAspectRatio:"xMidYMid meet"},[r.title?(y(),m("title",{key:0,id:`${u(t)}/title`},B(r.title),9,K)):E("",!0),r.description?(y(),m("desc",{key:1,id:`${u(t)}/desc`},B(r.description),9,Q)):E("",!0),N("use",{href:`${u($)}#${r.icon}`},null,8,Y)],8,F))}}),ae=V(U,[["__scopeId","data-v-e711c5a6"]]),b=(e,t)=>t.some(r=>e instanceof r);let L,P;function G(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function H(){return P||(P=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const g=new WeakMap,p=new WeakMap,f=new WeakMap;function J(e){const t=new Promise((r,o)=>{const n=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{r(l(e.result)),n()},s=()=>{o(e.error),n()};e.addEventListener("success",a),e.addEventListener("error",s)});return f.set(t,e),t}function z(e){if(g.has(e))return;const t=new Promise((r,o)=>{const n=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{r(),n()},s=()=>{o(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});g.set(e,t)}let v={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return g.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return l(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function S(e){v=e(v)}function X(e){return H().includes(e)?function(...t){return e.apply(k(this),t),l(this.request)}:function(...t){return l(e.apply(k(this),t))}}function Z(e){return typeof e=="function"?X(e):(e instanceof IDBTransaction&&z(e),b(e,G())?new Proxy(e,v):e)}function l(e){if(e instanceof IDBRequest)return J(e);if(p.has(e))return p.get(e);const t=Z(e);return t!==e&&(p.set(e,t),f.set(t,e)),t}const k=e=>f.get(e);function q(e,t,{blocked:r,upgrade:o,blocking:n,terminated:a}={}){const s=indexedDB.open(e,t),c=l(s);return o&&s.addEventListener("upgradeneeded",i=>{o(l(s.result),i.oldVersion,i.newVersion,l(s.transaction),i)}),r&&s.addEventListener("blocked",i=>r(i.oldVersion,i.newVersion,i)),c.then(i=>{a&&i.addEventListener("close",()=>a()),n&&i.addEventListener("versionchange",d=>n(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const ee=["get","getKey","getAll","getAllKeys","count"],te=["put","add","delete","clear"],w=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(w.get(t))return w.get(t);const r=t.replace(/FromIndex$/,""),o=t!==r,n=te.includes(r);if(!(r in(o?IDBIndex:IDBObjectStore).prototype)||!(n||ee.includes(r)))return;const a=async function(s,...c){const i=this.transaction(s,n?"readwrite":"readonly");let d=i.store;return o&&(d=d.index(c.shift())),(await Promise.all([d[r](...c),n&&i.done]))[0]};return w.set(t,a),a}S(e=>({...e,get:(t,r,o)=>C(t,r)||e.get(t,r,o),has:(t,r)=>!!C(t,r)||e.has(t,r)}));const re=["continue","continuePrimaryKey","advance"],x={},D=new WeakMap,_=new WeakMap,ne={get(e,t){if(!re.includes(t))return e[t];let r=x[t];return r||(r=x[t]=function(...o){D.set(this,_.get(this)[t](...o))}),r}};async function*oe(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const r=new Proxy(t,ne);for(_.set(r,t),f.set(r,k(t));t;)yield r,t=await(D.get(r)||t.continue()),D.delete(r)}function M(e,t){return t===Symbol.asyncIterator&&b(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&b(e,[IDBIndex,IDBObjectStore])}S(e=>({...e,get(t,r,o){return M(t,r)?oe:e.get(t,r,o)},has(t,r){return M(t,r)||e.has(t,r)}}));const ie=q("shodoku",4,{async upgrade(e,t,r,o){if(t<1){const n=e.createObjectStore("decks",{keyPath:"name"});n.createIndex("category","category"),n.createIndex("category+priority",["category","priority"]),n.createIndex("cards","cards",{multiEntry:!0});const a=e.createObjectStore("cards",{keyPath:"id"});a.createIndex("decks","decks",{multiEntry:!0}),a.createIndex("position",["position.priority","position.order"]);const s=e.createObjectStore("progress",{keyPath:["cardId","cardType"]});s.createIndex("cardId+cardType+state",["cardId","cardType","fsrs.state"]),s.createIndex("state+due",["fsrs.state","fsrs.due"]);const c=e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0});c.createIndex("cardId","cardId"),c.createIndex("review","log.review"),c.createIndex("state+review",["log.state","log.review"])}if(t<2&&e.createObjectStore("review-limits",{keyPath:"id",autoIncrement:!0}).createIndex("time","time"),t<3&&e.createObjectStore("bookmarked-words",{keyPath:"wordId"}),t<4){const n=o.objectStore("bookmarked-words");if(n.createIndex("reading","reading"),n.createIndex("bookmarkedAt","bookmarkedAt"),t>=3){const a=await n.getAllKeys();for(const s of a)n.put({wordId:s,bookmarkedAt:new Date})}}}}),j="live-query-channel",A=new BroadcastChannel(j),ce=new BroadcastChannel(j);function de(e){const t=I(!0),r=I(null),o=I(null);async function n(){t.value=!0,o.value=null;const a=u(e);try{r.value=await a()}catch(s){o.value=s,r.value=null}finally{t.value=!1}}return A.addEventListener("message",n),R(()=>u(e),n,{immediate:!0}),W(()=>{A.removeEventListener("message",n)}),{error:h(()=>o.value),result:h(()=>r.value),loading:h(()=>t.value)}}export{ae as A,ie as d,ce as l,de as u};
