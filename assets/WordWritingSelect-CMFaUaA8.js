import{j as w,k as K,v as m,c as b,d as L,b as B,w as N,u as v,o as a,h as S,_ as V,n as H,a as t,i as I,F as o,e as r,t as j,p as D,f as u,K as P,V as Y,C as z,D as Q,g as W,W as U,G as J}from"./index-CgdTuyLR.js";import{u as X,d as G,l as Z,A as h}from"./db-CcU_202h.js";import{A as x}from"./AppButton-BT87rAPg.js";function Tn(l){const e=w(null);return K(()=>m(l),async n=>{var k;if(!n){e.value=null;return}if(n===((k=e.value)==null?void 0:k.codepoint))return;const s=n.toString(16).padStart(5,"0"),d=await(await fetch(`/data/kanji-v1/${s}.json`)).json();e.value=d},{immediate:!0}),e}function On(l){const e=w(null);return K(()=>m(l),async n=>{if(!n){e.value=null;return}const s=n.toString(16).padStart(5,"0"),d=await(await fetch(`/data/kanji-vocab-v1/${s}.json`)).json();e.value=d},{immediate:!0}),e}function An(l){const e=w(null);return K(()=>m(l),async n=>{if(!n){e.value=null;return}const i=await(await fetch(`/data/words-v1/${n}.json`)).json();e.value=i},{immediate:!0}),e}function Fn(l){const e=w([]);return K(()=>m(l),async n=>{if(!n){e.value=[];return}const i=await(await fetch(`/data/words-sentences-v1/${n}.json`)).json();e.value=i},{immediate:!0}),e}function c(l,e={}){return b(()=>{var d,k;const n=m(e.kanji),{writings:s}=m(l)??{};if(!s)return null;let i=null;for(const y of s){if(!i){i=y;continue}n&&!y.text.includes(n)||(d=y.priority)!=null&&d.freq&&y.priority.freq<(((k=i.priority)==null?void 0:k.freq)??Number.POSITIVE_INFINITY)&&(i=y)}return i==null?void 0:i.text})}function _(l){return b(()=>{var s,i;const{readings:e}=m(l)??{};if(!e)return null;let n=null;for(const d of e){if(!n){n=d;continue}(s=d.priority)!=null&&s.freq&&d.priority.freq<(((i=n.priority)==null?void 0:i.freq)??Number.POSITIVE_INFINITY)&&(n=d)}return n==null?void 0:n.text})}function Mn(l,e={}){const n=c(l,e),s=_(l);return b(()=>{const{furigana:i}=m(l)??{};let d;return!s.value||!n.value?d=i==null?void 0:i.at(0):d=i==null?void 0:i.find(k=>k.writing===n.value&&k.reading===s.value),d||(d=i==null?void 0:i.at(0)),(d==null?void 0:d.furigana)??[{ruby:n.value??s.value??""}]})}const nn=L({__name:"BookmarkWordButton",props:{wordId:{},reading:{}},setup(l){const e=l,{result:n}=X(b(()=>{const i=e.wordId;return async()=>await(await G).count("bookmarked-words",i)>0}));async function s(){n.value?(await G).delete("bookmarked-words",e.wordId):(await G).add("bookmarked-words",{wordId:e.wordId,reading:e.reading,bookmarkedAt:new Date}),Z.postMessage("word-bookmarked")}return(i,d)=>(a(),B(x,{"aria-pressed":v(n),class:"bookmark-button",onClick:d[0]||(d[0]=k=>s())},{default:N(()=>[S(h,{icon:v(n)?"star-filled":"star"},null,8,["icon"])]),_:1},8,["aria-pressed"]))}}),qn=V(nn,[["__scopeId","data-v-5945e700"]]);function en(l){const e=w(null);return K(()=>m(l),async n=>{const i=await(await fetch(`/data/sentences-v1/${n}.json`)).json();e.value=i},{immediate:!0}),e}const an=new RegExp("\\p{Script=Han}","u"),tn=new RegExp("^\\p{Script=Han}$","u"),rn=/[\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}\u{2e80}-\u{2fd5}\u{3000}-\u{303f}\u{31f0}-\u{31ff}\u{3220}-\u{3243}\u{3280}-\u{337f}\u{ff5f}-\u{ff9f}\u{ff01}-\u{ff5e}]/u;function Hn(l){return rn.test(l)}function Dn(l){return an.test(l)}function on(l){return tn.test(l)}const sn={key:0,class:"placeholder"},un=L({__name:"MaybeHideKanji",props:{str:{},kanji:{default:null},hide:{type:Boolean,default:!1},link:{type:Boolean,default:!1}},setup(l){return(e,n)=>{const s=H("RouterLink");return e.link?(a(!0),t(o,{key:0},I(e.str,i=>(a(),t(o,null,[v(on)(i)?(a(),B(s,{key:0,to:v(D)(i),class:"link"},{default:N(()=>[r(j(i),1)]),_:2},1032,["to"])):(a(),t(o,{key:1},[r(j(i),1)],64))],64))),256)):!e.kanji||!e.hide?(a(),t(o,{key:1},[r(j(e.str),1)],64)):(a(!0),t(o,{key:2},I(e.str,i=>(a(),t(o,null,[i===e.kanji?(a(),t("span",sn,"◌")):(a(),t(o,{key:1},[r(j(i),1)],64))],64))),256))}}}),O=V(un,[["__scopeId","data-v-46882cf0"]]),ln={key:0},dn={key:0},gn={key:1},C=L({__name:"VocabularyWordFurigana",props:{furigana:{},kanji:{},hideKanji:{type:Boolean},hideReading:{type:Boolean},linkKanji:{type:Boolean}},setup(l){const e=l;function n(s){return!e.hideReading||!e.kanji?!1:s.includes(e.kanji)}return(s,i)=>(a(!0),t(o,null,I(s.furigana,({ruby:d,rt:k})=>(a(),t(o,null,[k?(a(),t("ruby",ln,[S(O,{hide:s.hideKanji,kanji:s.kanji,str:d,link:s.linkKanji},null,8,["hide","kanji","str","link"]),i[0]||(i[0]=u("rp",null,"(",-1)),n(d)?(a(),t("rt",dn,"◌")):(a(),t("rt",gn,j(k),1)),i[1]||(i[1]=u("rp",null,")",-1))])):(a(),B(O,{key:1,hide:s.hideKanji,kanji:s.kanji,str:d,link:s.linkKanji},null,8,["hide","kanji","str","link"]))],64))),256))}}),pn={key:0},kn={lang:"ja",class:"sentence"},fn=L({__name:"VocabularySentence",props:{sentenceId:{},hideKanji:{},hideReading:{},hideMeaning:{type:Boolean}},setup(l){const e=l,n=en(()=>e.sentenceId);return(s,i)=>v(n)?(a(),t("div",pn,[u("p",kn,[(a(!0),t(o,null,I(v(n).words,d=>(a(),B(Y(d.word?"RouterLink":"span"),{key:d.word,to:v(P)(d.word),class:"word"},{default:N(()=>[S(C,{furigana:d.furigana,"hide-kanji":!!s.hideKanji,"hide-reading":!!s.hideReading,kanji:s.hideKanji??s.hideReading},null,8,["furigana","hide-kanji","hide-reading","kanji"])]),_:2},1032,["to"]))),128))]),z(u("p",{lang:"en",class:"translation"},j(v(n).meaning),513),[[Q,!s.hideMeaning]])])):W("",!0)}}),Pn=V(fn,[["__scopeId","data-v-743b6622"]]),vn={class:"pos-tag"},yn=L({__name:"PartOfSpeechTag",props:{tag:{}},setup(l){return(e,n)=>(a(),t("span",vn,[e.tag==="adj-f"?(a(),t(o,{key:0},[r(" noun or prenominal verb")],64)):e.tag==="adj-i"?(a(),t(o,{key:1},[n[0]||(n[0]=u("i",{lang:"ja-Latn"},"i",-1)),n[1]||(n[1]=r(" adjective"))],64)):e.tag==="adj-ix"?(a(),t(o,{key:2},[n[2]||(n[2]=r(" adjective – ")),n[3]||(n[3]=u("i",{lang:"ja-Latn"},"yoi",-1)),n[4]||(n[4]=r("/")),n[5]||(n[5]=u("i",{lang:"ja-Latn"},"ii",-1)),n[6]||(n[6]=r(" class"))],64)):e.tag==="adj-na"?(a(),t(o,{key:3},[r(" na adjective")],64)):e.tag==="adj-nari"?(a(),t(o,{key:4},[n[7]||(n[7]=r(" formal ")),n[8]||(n[8]=u("i",{lang:"ja-Latn"},"na",-1)),n[9]||(n[9]=r("-adjective"))],64)):e.tag==="adj-no"?(a(),t(o,{key:5},[n[10]||(n[10]=r(" noun w. ")),n[11]||(n[11]=u("i",null,"no",-1)),n[12]||(n[12]=r(" particle"))],64)):e.tag==="adj-pn"?(a(),t(o,{key:6},[r(" pre-noun adjectival")],64)):e.tag==="adj-t"?(a(),t(o,{key:7},[n[13]||(n[13]=u("i",{lang:"ja-Latn"},"taru",-1)),n[14]||(n[14]=r(" adjective"))],64)):e.tag==="adv"?(a(),t(o,{key:8},[r(" adverb")],64)):e.tag==="adv-to"?(a(),t(o,{key:9},[n[15]||(n[15]=r(" adverb w. ")),n[16]||(n[16]=u("i",{lang:"ja-Latn"},"to",-1)),n[17]||(n[17]=r(" particle"))],64)):e.tag==="aux"?(a(),t(o,{key:10},[r(" auxiliary")],64)):e.tag==="aux-adj"?(a(),t(o,{key:11},[r(" auxiliary adjective")],64)):e.tag==="aux-v"?(a(),t(o,{key:12},[r(" auxiliary verb")],64)):e.tag==="conj"?(a(),t(o,{key:13},[r(" conjunction")],64)):e.tag==="cop"?(a(),t(o,{key:14},[r(" copula")],64)):e.tag==="ctr"?(a(),t(o,{key:15},[r(" counter")],64)):e.tag==="exp"?(a(),t(o,{key:16},[r(" expressions")],64)):e.tag==="int"?(a(),t(o,{key:17},[r(" interjection")],64)):e.tag==="n"?(a(),t(o,{key:18},[r(" noun")],64)):e.tag==="n-adv"?(a(),t(o,{key:19},[r(" adverbial noun")],64)):e.tag==="n-pr"?(a(),t(o,{key:20},[r(" proper noun")],64)):e.tag==="n-pref"?(a(),t(o,{key:21},[r(" noun, used as a prefix")],64)):e.tag==="n-suf"?(a(),t(o,{key:22},[r(" noun, used as a suffix")],64)):e.tag==="n-t"?(a(),t(o,{key:23},[r(" noun (temporal)")],64)):e.tag==="num"?(a(),t(o,{key:24},[r(" numeric")],64)):e.tag==="pn"?(a(),t(o,{key:25},[r(" pronoun")],64)):e.tag==="pref"?(a(),t(o,{key:26},[r(" prefix")],64)):e.tag==="prt"?(a(),t(o,{key:27},[r(" particle")],64)):e.tag==="suf"?(a(),t(o,{key:28},[r(" suffix")],64)):e.tag==="uk"?(a(),t(o,{key:29},[r(" Usually written with kana")],64)):e.tag==="v-unspec"?(a(),t(o,{key:30},[r(" verb")],64)):e.tag==="v1"?(a(),t(o,{key:31},[r(" Ichidan verb")],64)):e.tag==="v1-s"?(a(),t(o,{key:32},[n[18]||(n[18]=r(" Ichidan verb – ")),n[19]||(n[19]=u("i",{lang:"ja-Latn"},"kureru",-1))],64)):e.tag==="v5aru"?(a(),t(o,{key:33},[n[20]||(n[20]=r(" Godan verb – ")),n[21]||(n[21]=u("i",{lang:"ja-Latn"},"-aru",-1))],64)):e.tag==="v5b"?(a(),t(o,{key:34},[r(" Godan verb")],64)):e.tag==="v5g"?(a(),t(o,{key:35},[r(" Godan verb")],64)):e.tag==="v5k"?(a(),t(o,{key:36},[r(" Godan verb")],64)):e.tag==="v5k-s"?(a(),t(o,{key:37},[n[22]||(n[22]=r(" Godan verb – ")),n[23]||(n[23]=u("i",{lang:"ja-Latn"},"iku",-1)),n[24]||(n[24]=r("/")),n[25]||(n[25]=u("i",{lang:"ja-Latn"},"yuku",-1))],64)):e.tag==="v5m"?(a(),t(o,{key:38},[r(" Godan verb")],64)):e.tag==="v5n"?(a(),t(o,{key:39},[r(" Godan verb")],64)):e.tag==="v5r"?(a(),t(o,{key:40},[n[26]||(n[26]=r(" Godan verb with ")),n[27]||(n[27]=u("i",{lang:"ja-Latn"},"ru",-1)),n[28]||(n[28]=r(" ending"))],64)):e.tag==="v5r-i"?(a(),t(o,{key:41},[n[29]||(n[29]=r(" Godan verb with ")),n[30]||(n[30]=u("i",{lang:"ja-Latn"},"ru",-1)),n[31]||(n[31]=r(" ending (irregular)"))],64)):e.tag==="v5s"?(a(),t(o,{key:42},[r(" Godan verb")],64)):e.tag==="v5t"?(a(),t(o,{key:43},[r(" Godan verb")],64)):e.tag==="v5u"?(a(),t(o,{key:44},[r(" Godan verb")],64)):e.tag==="v5u-s"?(a(),t(o,{key:45},[n[32]||(n[32]=r(" Godan verb with ")),n[33]||(n[33]=u("i",{lang:"ja-Latn"},"u",-1)),n[34]||(n[34]=r(" ending (special class)"))],64)):e.tag==="v5uru"?(a(),t(o,{key:46},[n[35]||(n[35]=r(" Godan verb – ")),n[36]||(n[36]=u("i",{lang:"ja-Latn"},"Uru",-1)),n[37]||(n[37]=r(" old class verb"))],64)):e.tag==="vi"?(a(),t(o,{key:47},[r(" intransitive verb")],64)):e.tag==="vk"?(a(),t(o,{key:48},[n[38]||(n[38]=u("i",{lang:"ja-Latn"},"Kuru",-1)),n[39]||(n[39]=r(" verb"))],64)):e.tag==="vn"?(a(),t(o,{key:49},[n[40]||(n[40]=r(" irregular ")),n[41]||(n[41]=u("i",{lang:"ja-Latn"},"nu",-1)),n[42]||(n[42]=r(" verb"))],64)):e.tag==="vr"?(a(),t(o,{key:50},[n[43]||(n[43]=r(" irregular ")),n[44]||(n[44]=u("i",{lang:"ja-Latn"},"ru",-1)),n[45]||(n[45]=r(" verb"))],64)):e.tag==="vs"?(a(),t(o,{key:51},[n[46]||(n[46]=u("i",{lang:"ja-Latn"},"suru",-1)),n[47]||(n[47]=r(" verb"))],64)):e.tag==="vs-c"?(a(),t(o,{key:52},[n[48]||(n[48]=u("i",{lang:"ja-Latn"},"su",-1)),n[49]||(n[49]=r(" verb—precursor to the modern ")),n[50]||(n[50]=u("i",{lang:"ja-Latn"},"suru",-1))],64)):e.tag==="vs-i"?(a(),t(o,{key:53},[n[51]||(n[51]=u("i",{lang:"ja-Latn"},"suru",-1)),n[52]||(n[52]=r(" verb – included"))],64)):e.tag==="vs-s"?(a(),t(o,{key:54},[n[53]||(n[53]=u("i",{lang:"ja-Latn"},"suru",-1)),n[54]||(n[54]=r(" verb – special class"))],64)):e.tag==="vt"?(a(),t(o,{key:55},[r(" transitive verb")],64)):e.tag==="vz"?(a(),t(o,{key:56},[n[55]||(n[55]=r(" Ichidan verb – ")),n[56]||(n[56]=u("i",{lang:"ja-Latn"},"zuru",-1)),n[57]||(n[57]=r(" verb"))],64)):W("",!0)]))}}),A=V(yn,[["__scopeId","data-v-ee320153"]]),jn={class:"vocabulary-word-meaning"},mn={class:"meaning-pos"},bn={class:"glossary"},wn={class:"glossary-word"},In=L({__name:"VocabularyWordMeaning",props:{meaning:{}},setup(l){return(e,n)=>(a(),t("div",jn,[u("div",mn,[(a(!0),t(o,null,I(e.meaning.pos,s=>(a(),B(A,{tag:s},null,8,["tag"]))),256)),e.meaning.kanaPreferred?(a(),B(A,{key:0,tag:"uk"})):W("",!0)]),u("div",bn,[(a(!0),t(o,null,I(e.meaning.glossary,s=>(a(),t("span",wn,j(s),1))),256))])]))}}),Yn=V(In,[["__scopeId","data-v-b323a088"]]),$n={key:0,class:"word-writing-details popover-container"},Ln=["popovertarget"],Bn={class:"writing-select-count"},Vn=["id"],Sn=["disabled"],Kn={class:"additional-writing"},Wn=["disabled","onClick"],Rn=["disabled","onClick"],Gn=L({__name:"WordWritingSelect",props:{word:{},default:{},modelValue:{}},emits:["update:modelValue"],setup(l){U(p=>({"6d48b81e":v(s)}));const e=l,n=J(),s=`--${n}`.replace(":","-anchor-"),i=b(()=>{var p;return((p=e.word.writings)==null?void 0:p.filter(g=>g.irregular||g.outdated||g.searchOnly).map(({text:g})=>g))??[]}),d=b(()=>{var p;return((p=e.word.readings)==null?void 0:p.filter(g=>g.irregular||g.outdated||g.searchOnly).map(({text:g})=>g))??[]}),k=b(()=>{var p;return((p=e.word.furigana)==null?void 0:p.filter(g=>g.furigana!==e.default&&!i.value.includes(g.writing)&&!d.value.includes(g.reading)))??[]}),y=b(()=>{var p;return((p=e.word.readings)==null?void 0:p.filter(g=>{var f;return!g.irregular&&!g.outdated&&!g.searchOnly&&!((f=e.word.furigana)!=null&&f.some($=>g.text===$.reading))}))??[]}),E=w(null),T=w(null),F=w(!1);function M(p){F.value=p.newState==="open"}function q(p){var g,f;if(p.newState==="open"&&!("anchorName"in document.documentElement.style)){const $=(g=E.value)==null?void 0:g.getBoundingClientRect(),R=(f=T.value)==null?void 0:f.style;R&&$&&(R.insetBlockStart=`${$.bottom+window.scrollY}px`,R.insetInlineEnd=`calc(100% - ${$.right}px)`)}}return(p,g)=>k.value.length+y.value.length>0?(a(),t("div",$n,[u("button",{ref_key:"toggleButton",ref:E,title:"Additional Writings",class:"toggle-button",popovertarget:v(n)},[g[1]||(g[1]=u("span",{class:"writing-select-icon"},"か",-1)),u("small",Bn,"(+"+j(k.value.length+y.value.length+1)+")",1)],8,Ln),u("ul",{id:v(n),ref_key:"popoverEl",ref:T,class:"writing-list popover",popover:"",onBeforetoggle:q,onToggle:M},[u("li",null,[u("button",{class:"select-button",disabled:p.modelValue===null,onClick:g[0]||(g[0]=f=>p.$emit("update:modelValue",null))},[S(C,{furigana:p.default},null,8,["furigana"])],8,Sn)]),(a(!0),t(o,null,I(k.value,f=>(a(),t("li",Kn,[u("button",{class:"select-button",disabled:p.modelValue===f.furigana,onClick:$=>p.$emit("update:modelValue",f.furigana)},[S(C,{furigana:f.furigana},null,8,["furigana"])],8,Wn)]))),256)),(a(!0),t(o,null,I(y.value,f=>(a(),t("li",null,[u("button",{class:"select-button",disabled:p.modelValue===f.text,onClick:$=>p.$emit("update:modelValue",f.text)},j(f.text),9,Rn)]))),256))],40,Vn)])):W("",!0)}}),zn=V(Gn,[["__scopeId","data-v-fb653267"]]);export{qn as B,Pn as V,zn as W,C as _,On as a,Fn as b,An as c,Mn as d,Yn as e,Hn as f,an as g,Dn as h,on as i,Tn as u};
