import{q as E,I as W,c as M,G as ae,W as be,H as Se,d as oe,a as b,e as A,o as k,_ as Q,X as ne,g as J,U as Pe,V as Ce,F as X,l as le,u as ce,Y as pe,Z as ve,i as R,A as L,w as G,b as D,y as he,J as q,D as ge,h as se,t as re}from"./index-sZE7bAWT.js";import{s as ue}from"./reviews-BjQG9Nhh.js";import{f as $e}from"./formats-B8hr5_5_.js";const me="http://kanjivg.tagaini.net",ee=Symbol("kanjivg"),ie=["general","tradit","nelson"],Ae=new DOMParser;function Me(e){let n=0,t=e;for(;t;)n+=1,t=t.parentElement?.closest("g");return n}function Be(e){const n=[];let t=e.closest("[data-position]");for(;t instanceof SVGElement;)n.push(t.dataset.position),t=t.parentElement?.closest("[data-position]")??null;return n}async function Ie(e){const t=await(await fetch(`/kanjivg/kanji/${e}.svg`)).text(),a=Ae.parseFromString(t,"image/svg+xml");let r=null;a.documentElement instanceof SVGSVGElement&&(r=a.documentElement.viewBox.baseVal);const o=a.getElementById(`kvg:${e}`);if(o){for(const i of[...o.querySelectorAll("*"),o])if(i instanceof SVGElement){for(const d of[...i.attributes])d.namespaceURI===me&&(i.dataset[d.localName]=d.value,i.removeAttributeNS(me,d.localName));i.removeAttribute("xmlns:kvg")}}return{strokes:o,rect:r}}function wt(e){const n=E(null),t=E(null),a=E(!1);W(()=>be(e),async(o,i)=>{if(!o){n.value=null,t.value=null;return}if(o!==i){a.value=!0;try{const{strokes:d,rect:u}=await Ie(o);n.value=d,u&&(t.value=`${u.x},${u.y},${u.width},${u.height}`)}finally{a.value=!1}}},{immediate:!0});const r=M(()=>{const o=n.value;if(!o)return new Map;const i=new Map,d={};function u(s){if(s.dataset.part&&Number.parseInt(s.dataset.part)>1)return;const y=s.dataset.element,h={element:y,original:s.dataset.original??null,position:Be(s),radical:s.dataset.radical??null,phon:s.dataset.phon??null,depth:Me(s)};let m=i.get(y);m?m.push(h):(m=[h],i.set(y,m)),h.radical&&(d[h.radical]=y)}o.dataset.radical&&u(o);for(const s of o.querySelectorAll("g[data-element]"))u(s);const p=new Map;for(const s of ie){const y=d[s],h=i.get(y);h&&(h.sort((m,c)=>m.radical?c.radical?ie.indexOf(m.radical)-ie.indexOf(c.radical):1:c.radical?-1:m.depth-c.depth),p.set(y,h),i.delete(y))}for(const[s,y]of[...i].sort(([,h],[,m])=>Math.min(...h.map(({depth:c})=>c))-Math.min(...m.map(({depth:c})=>c))))p.set(s,y);return p});Se(ee,{strokesEl:n,viewBox:t,components:r,syncing:a})}function bt(){const e=ae(ee,null);return M(()=>e?.strokesEl.value?.cloneNode(!0)??null)}function St(){const e=ae(ee,null);return M(()=>e?.viewBox.value??"0,0,109,109")}function Pt(){const e=ae(ee,null);return M(()=>e?.components.value??new Map)}function Ct(){const e=ae(ee,null);return M(()=>e?.syncing.value??!1)}const De={class:"kanji-strokes-background"},Ne=["x","y","width","height"],Ee=["x1","y1","x2","y2"],Ve=["x1","y1","x2","y2"],je=["x1","y1","x2","y2"],Ge=["x1","y1","x2","y2"],Ke=["x1","y1","x2","y2"],Le=["x1","y1","x2","y2"],qe=oe({__name:"KanjiStrokesBackground",props:{viewBox:{}},setup(e){const n=e,t=M(()=>{const[o,i,d,u]=n.viewBox.split(",");return{x:Number.parseInt(o),y:Number.parseInt(i),width:Number.parseInt(d),height:Number.parseInt(u)}}),a=M(()=>{const{x:o,width:i}=t.value;return o+i/2}),r=M(()=>{const{y:o,height:i}=t.value;return o+i/2});return(o,i)=>(k(),b("g",De,[A("rect",{class:"background",x:t.value.x,y:t.value.y,width:t.value.width,height:t.value.width,rx:"5"},null,8,Ne),A("line",{class:"midline",x1:t.value.x+1,y1:r.value,x2:t.value.x+t.value.width-1,y2:r.value},null,8,Ee),A("line",{class:"midline",x1:a.value,y1:t.value.y+1,x2:a.value,y2:t.value.y+t.value.height-1},null,8,Ve),A("line",{class:"quartline",x1:a.value/2,y1:t.value.y+1,x2:a.value/2,y2:t.value.y+t.value.height-1},null,8,je),A("line",{class:"quartline",x1:3*a.value/2,y1:t.value.y+1,x2:3*a.value/2,y2:t.value.y+t.value.height-1},null,8,Ge),A("line",{class:"quartline",x1:t.value.x+1,y1:r.value/2,x2:t.value.x+t.value.width-1,y2:r.value/2},null,8,Ke),A("line",{class:"quartline",x1:t.value.x+1,y1:3*r.value/2,x2:t.value.x+t.value.width-1,y2:3*r.value/2},null,8,Le)]))}}),Oe=Q(qe,[["__scopeId","data-v-78045927"]]),Xe=1e-12,ye=112e-18,Fe=e=>e>=-ye&&e<=ye,xe=(e,n)=>Math.sqrt(e*e+n*n),U=(e,n)=>({x:e,y:n}),Te=e=>xe(e.x,e.y),Ye=e=>U(-e.x,-e.y),Z=(e,n)=>U(e.x+n.x,e.y+n.y),N=(e,n)=>U(e.x-n.x,e.y-n.y),z=(e,n)=>U(e.x*n,e.y*n),j=(e,n)=>e.x*n.x+e.y*n.y,de=(e,n)=>xe(e.x-n.x,e.y-n.y),O=(e,n=1)=>z(e,n/(Te(e)||1/0)),_e=(e,n)=>({p:e,i:n}),Re=(e,n,t)=>{n&&(e.unshift(e[e.length-1]),e.push(e[1]));const a=e.length;if(a===0)return[];const r=[_e(e[0])];return fe(e,r,t,0,a-1,N(e[1],e[0]),N(e[a-2],e[a-1])),n&&(r.shift(),r.pop()),r},fe=(e,n,t,a,r,o,i)=>{if(r-a===1){const h=e[a],m=e[r],c=de(h,m)/3;ke(n,[h,Z(h,O(o,c)),Z(m,O(i,c)),m]);return}const d=Ue(e,a,r);let u=Math.max(t,t*t),p,s=!0;for(let h=0;h<=4;h++){const m=ze(e,a,r,d,o,i),c=We(e,a,r,m,d);if(c.error<t&&s){ke(n,m);return}if(p=c.index,c.error>=u)break;s=He(e,a,r,d,m),u=c.error}const y=N(e[p-1],e[p+1]);fe(e,n,t,a,p,o,y),fe(e,n,t,p,r,Ye(y),i)},ke=(e,n)=>{const t=e[e.length-1];t.o=N(n[1],n[0]),e.push(_e(n[3],N(n[2],n[3])))},ze=(e,n,t,a,r,o)=>{const i=Xe,d=Math.abs,u=e[n],p=e[t],s=[[0,0],[0,0]],y=[0,0];for(let g=0,I=t-n+1;g<I;g++){const C=a[g],V=1-C,F=3*C*V,T=V*V*V,H=F*V,v=F*C,x=C*C*C,$=O(r,H),l=O(o,v),f=N(N(e[n+g],z(u,T+H)),z(p,v+x));s[0][0]+=j($,$),s[0][1]+=j($,l),s[1][0]=s[0][1],s[1][1]+=j(l,l),y[0]+=j($,f),y[1]+=j(l,f)}const h=s[0][0]*s[1][1]-s[1][0]*s[0][1];let m,c;if(d(h)>i){const g=s[0][0]*y[1]-s[1][0]*y[0];m=(y[0]*s[1][1]-y[1]*s[0][1])/h,c=g/h}else{const g=s[0][0]+s[0][1],I=s[1][0]+s[1][1];m=c=d(g)>i?y[0]/g:d(I)>i?y[1]/I:0}const B=de(p,u),P=i*B;let w,S;if(m<P||c<P)m=c=B/3;else{const g=N(p,u);w=O(r,m),S=O(o,c),j(w,g)-j(S,g)>B*B&&(m=c=B/3,w=S=null)}return[u,Z(u,w||O(r,m)),Z(p,S||O(o,c)),p]},He=(e,n,t,a,r)=>{for(let o=n;o<=t;o++)a[o-n]=Je(r,e[o],a[o-n]);for(let o=1,i=a.length;o<i;o++)if(a[o]<=a[o-1])return!1;return!0},Je=(e,n,t)=>{const a=[],r=[];for(let s=0;s<=2;s++)a[s]=z(N(e[s+1],e[s]),3);for(let s=0;s<=1;s++)r[s]=z(N(a[s+1],a[s]),2);const o=te(3,e,t),i=te(2,a,t),d=te(1,r,t),u=N(o,n),p=j(i,i)+j(u,d);return Fe(p)?t:t-j(u,i)/p},te=(e,n,t)=>{const a=n.slice();for(let r=1;r<=e;r++)for(let o=0;o<=e-r;o++)a[o]=Z(z(a[o],1-t),z(a[o+1],t));return a[0]},Ue=(e,n,t)=>{const a=[0];for(let r=n+1;r<=t;r++)a[r-n]=a[r-n-1]+de(e[r],e[r-1]);for(let r=1,o=t-n;r<=o;r++)a[r]/=a[o];return a},We=(e,n,t,a,r)=>{let o=Math.floor((t-n+1)/2),i=0;for(let d=n+1;d<t;d++){const u=te(3,a,r[d-n]),p=N(u,e[d]),s=p.x*p.x+p.y*p.y;s>=i&&(i=s,o=d)}return{error:i,index:o}},Ze=(e,n,t)=>{const a=e.length,r=10**t,o=t<16?c=>Math.round(c*r)/r:c=>c,i=(c,B)=>o(c)+","+o(B);let d=!0,u,p,s,y;const h=[],m=(c,B)=>{const P=c.p.x,w=c.p.y;if(d)h.push("M"+i(P,w)),d=!1;else{const S=P+(c.i?.x??0),g=w+(c.i?.y??0);if(S===P&&g===w&&s===u&&y===p){if(!B){const I=P-u,C=w-p;h.push(I===0?"v"+o(C):C===0?"h"+o(I):"l"+i(I,C))}}else h.push("c"+i(s-u,y-p)+" "+i(S-u,g-p)+" "+i(P-u,w-p))}u=P,p=w,s=P+(c.o?.x??0),y=w+(c.o?.y??0)};if(!a)return"";for(let c=0;c<a;c++)m(e[c]);return n&&a>0&&(m(e[0],!0),h.push("z")),h.join("")},Qe=(e,n={})=>e.length===0?"":Ze(Re(e.map(typeof e[0].x=="number"?t=>U(t.x,t.y):t=>U(t[0],t[1])),n.closed,n.tolerance??2.5),n.closed,n.precision??5),et=["x","y","width","height"],tt={class:"practice-strokes"},nt=["d"],at=["d"],ot=["points"],st=oe({__name:"KanjiStrokesPracticeCanvas",props:{animatePause:{type:Boolean}},emits:["stroke"],setup(e,{expose:n,emit:t}){const a=e,r=t,o=E(null),i=M(()=>o.value?.closest("svg")),d=M(()=>i.value?.viewBox.baseVal),u=ne([]),p=ne([]),s=E(null),y=E(!1);function h(v){if(!i.value)return{x:v.x,y:v.y};const x=i.value.createSVGPoint();x.x=v.x,x.y=v.y;const $=x.matrixTransform(i.value.getScreenCTM()?.inverse());return{x:$.x,y:$.y}}function m(v){v.isPrimary&&(v.preventDefault(),o.value?.setPointerCapture(v.pointerId),p.push(h(v)))}function c(v){p.length===0||!v.isPrimary||p.push(h(v))}function B(v){v.isPrimary&&(p.length>1&&(u.push(Qe(p)),r("stroke")),o.value?.releasePointerCapture(v.pointerId),p.splice(0,p.length),i.value?.parentElement?.click())}function P(v){const x=v.getTotalLength();return[{strokeDasharray:x,strokeDashoffset:x},{strokeDasharray:x,strokeDashoffset:0}]}const w={duration:500,easing:"ease-in-out"},S=[];async function g(){if(o.value){for(const v of o.value.querySelectorAll(".practice-strokes .stroke")){const x=v.animate(P(v),w);x.pause(),S.push(x)}y.value=!1,await I()}}async function I(){let v=S.at(0);for(;v;)v.play(),await v.finished,S.shift(),v=S.at(0),v&&await ue(100)}W(()=>a.animatePause,v=>{v?S.at(0)?.pause():S.at(0)?.play()});const C=E(null);W(C,v=>{v&&v.animate(P(v),w).finished.then(()=>{s.value=null})});function V(){u.splice(0,u.length)}function F(){u.pop()}function T(v){u.push(v)}function H(v){s.value=v}return n({clear:V,pop:F,push:T,hint:H,animate:g,prepareForAnimation(){y.value=!0}}),(v,x)=>(k(),b("g",{ref_key:"el",ref:o,class:"kanji-strokes-practice-canvas canvas",onPointerdown:m,onPointermove:c,onPointerup:B},[d.value?(k(),b("rect",{key:0,class:"background",x:d.value.x,y:d.value.y,width:d.value.width,height:d.value.height},null,8,et)):J("",!0),Pe(A("g",tt,[(k(!0),b(X,null,le(ce(u),($,l)=>(k(),b("path",{key:l,class:"stroke practice-stroke",d:$},null,8,nt))),128))],512),[[Ce,!y.value]]),s.value?(k(),b("path",{key:1,ref_key:"hintPath",ref:C,class:"stroke hint",d:s.value},null,8,at)):J("",!0),A("polyline",{class:"stroke current-stroke",points:ce(p).map(({x:$,y:l})=>`${$},${l}`).join(" ")},null,8,ot)],544))}}),rt=Q(st,[["__scopeId","data-v-fd6ec31f"]]),it={class:"strokes-figure"},lt={class:"svgs"},ct=["viewBox"],ut=["d"],ft={class:"controls"},dt=oe({__name:"StrokesFigure",props:pe({viewBox:{},charStrokes:{},practiceMode:{type:Boolean}},{practicing:{type:Boolean,default:!1},practicingModifiers:{},"auto-hint":{type:Boolean,default:!1},"auto-hintModifiers":{}}),emits:pe(["practiceDone"],["update:practicing","update:auto-hint"]),setup(e,{emit:n}){const t=ve(e,"practicing"),a=ve(e,"auto-hint"),r=e,o=n,i=E([]),d=E([]),u=ne([]),p=M(()=>u.length>0),s=E(!1),y=E(!1),h=M(()=>r.charStrokes.flat()),m=ne([]),c=M(()=>m.length);function B(l){const f=l.getTotalLength();return[{strokeDasharray:f,strokeDashoffset:f},{strokeDasharray:f,strokeDashoffset:0}]}const P={duration:500,easing:"ease-in-out"};function w(){for(const l of i.value){const f=l.animate(B(l),P);f.pause(),u.push(f)}S(),g()}async function S(){let l=u.at(0);for(;l;)l.play(),await l.finished,u.shift(),l=u.at(0),l&&await ue(100)}async function g(){for(const l of d.value)l.prepareForAnimation();for(const l of d.value)await l.animate(),await ue(100)}function I(){u.at(0)?.pause(),s.value=!0}function C(){u.at(0)?.play(),s.value=!1}function V(l){m.push(l);const f=c.value;r.practiceMode&&f===h.value.length&&o("practiceDone"),r.practiceMode&&a.value&&f<h.value.length&&T()}function F(){if(c.value>=h.value.length)return null;const l=Array.from({length:r.charStrokes.length},()=>0);for(const K of m)l[K]+=1;let f,_=-1;for(const K of r.charStrokes)if(_+=1,f=K.at(l[_]),f)break;if(!f)return null;const Y=d.value.at(_);return Y?{path:f,canvas:Y,index:_}:null}function T(){const l=F();if(!l)return;const{path:f,canvas:_}=l;_.hint(f)}function H(){const l=F();if(!l)return;const{path:f,canvas:_,index:Y}=l;_.push(f),V(Y)}function v(){const l=m.pop();l!=null&&d.value.at(l)?.pop()}function x(){for(const l of d.value)l.clear();m.splice(0,m.length),y.value=!1}function $(){for(const l of u)l.cancel();u.splice(0,u.length),s.value=!1;for(const l of i.value)for(const f of l.getAnimations())f.cancel()}return W(t,l=>{y.value=!1,l?$():x()}),W(h,(l,f)=>{l!==f&&(x(),$(),y.value=!1,t.value!==r.practiceMode&&(t.value=r.practiceMode),a.value&&requestAnimationFrame(async()=>{T()}))},{immediate:!0}),(l,f)=>(k(),b("figure",it,[A("div",lt,[(k(!0),b(X,null,le(l.charStrokes,(_,Y)=>(k(),b("svg",{key:Y,class:he(["svg",{practicing:t.value}]),viewBox:l.viewBox,onTouchstart:f[0]||(f[0]=K=>{t.value&&K.preventDefault()})},[D(Oe,{viewBox:l.viewBox},null,8,["viewBox"]),A("g",{class:he(["strokes",{comparing:p.value||y.value||h.value.length<=c.value,practicing:t.value}])},[(k(!0),b(X,null,le(_,(K,we)=>(k(),b("path",{key:we,ref_for:!0,ref_key:"strokePaths",ref:i,class:"stroke-path",d:K},null,8,ut))),128))],2),t.value?(k(),R(rt,{key:0,ref_for:!0,ref_key:"practiceCanvases",ref:d,"animate-pause":s.value,onStroke:K=>V(Y)},null,8,["animate-pause","onStroke"])):J("",!0)],42,ct))),128))]),A("figcaption",ft,[p.value?(k(),b(X,{key:0},[s.value?(k(),R(L,{key:0,"aria-label":"Play",onClick:f[1]||(f[1]=_=>C())},{default:G(()=>[D(q,{icon:"play"})]),_:1})):(k(),R(L,{key:1,"aria-label":"Pause",onClick:f[2]||(f[2]=_=>I())},{default:G(()=>[D(q,{icon:"pause"})]),_:1}))],64)):(k(),b(X,{key:1},[t.value&&c.value<h.value.length?(k(),R(L,{key:0,"aria-label":"Show Hint",onClick:f[3]||(f[3]=_=>T())},{default:G(()=>[D(q,{icon:"help-circle"})]),_:1})):(k(),R(L,{key:1,"aria-label":"Animate Stroke Order",onClick:f[4]||(f[4]=_=>w())},{default:G(()=>[D(q,{icon:"play"})]),_:1}))],64)),l.practiceMode?J("",!0):(k(),R(L,{key:2,"aria-lable":"Practice Drawing","aria-pressed":`${t.value}`,filled:t.value,onClick:f[5]||(f[5]=_=>t.value=!t.value)},{default:G(()=>[D(q,{icon:"draw"})]),_:1},8,["aria-pressed","filled"])),t.value?(k(),b(X,{key:3},[f[9]||(f[9]=A("hr",{class:"rule"},null,-1)),D(L,{"aria-label":"Start Over",disabled:c.value===0,onClick:f[6]||(f[6]=_=>x())},{default:G(()=>[D(q,{icon:"rotate-left"})]),_:1},8,["disabled"]),D(L,{"aria-label":"Skip Backward",disabled:c.value===0,onClick:f[7]||(f[7]=_=>v())},{default:G(()=>[D(q,{icon:"skip-backward"})]),_:1},8,["disabled"]),D(L,{"aria-label":"Skip Backward",disabled:c.value===h.value.length,onClick:f[8]||(f[8]=_=>H())},{default:G(()=>[D(q,{icon:"skip-forward"})]),_:1},8,["disabled"])],64)):J("",!0)])]))}}),$t=Q(dt,[["__scopeId","data-v-f0ed9ba4"]]),pt={},vt={class:"app-label"};function ht(e,n){return k(),b("span",vt,[ge(e.$slots,"default")])}const mt=Q(pt,[["render",ht],["__scopeId","data-v-f3e79f70"]]),yt={class:"prefix"},kt=oe({__name:"CardRetrievabilityLabel",props:{r:{},label:{}},setup(e){const n=e,t=M(()=>typeof n.r!="number"?"poor":n.r>.9?"good":n.r>.7?"fair":"poor");return(a,r)=>a.r?(k(),R(mt,{key:0,class:"card-retrievability-label",title:"Writing Retrievability","data-r":t.value},{default:G(()=>[A("span",yt,[ge(a.$slots,"label",{},()=>[se(re(a.label),1)],!0)]),typeof a.r=="number"?(k(),b(X,{key:0},[se(re(ce($e)(a.r)),1)],64)):(k(),b(X,{key:1},[se(re(a.r),1)],64))]),_:3},8,["data-r"])):J("",!0)}}),At=Q(kt,[["__scopeId","data-v-0c65750d"]]);export{mt as A,At as C,$t as S,St as a,Pt as b,Ct as c,Ie as f,wt as p,bt as u};
//# sourceMappingURL=CardRetrievabilityLabel-BgFlRhxu.js.map
