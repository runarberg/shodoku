import{d as C,c as _,a as l,F as j,l as B,o as n,h as y,w as q,e as f,t as h,u as o,A as V,_ as $,m as A,b as T,g as w,f as R,n as I,p as N,i as D,k as K}from"./index-chiovaS4.js";import{A as P}from"./AppLoading-DvFWb5mG.js";import{l as S,f as E,c as L,b as F,u as W,d as G}from"./reviews-D4EEJ0cN.js";import{d as M}from"./db-1SYsvhON.js";import{u as Q,a as z}from"./WordWritingSelect-CWzBzoS3.js";import{p as H,K as J,a as O,b as U,c as X,d as Y}from"./KanjiWordList-eDUBuEOX.js";import{u as Z}from"./fsrs-CLWAx46U.js";import"./decks-GrwULuka.js";import"./formats-CxjEYhKc.js";import"./WordListItem-C_CKfiAe.js";const x={class:"rate-buttons"},ee={class:"rate-button-content"},ae={class:"rating"},ne={class:"next-review-time"},te=C({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(g,{emit:c}){const i=g,p=c,s=_(()=>k.value.repeat(i.fsrs,new Date));function u(d){var e;const t=((e=d.last_review)==null?void 0:e.getTime())??Date.now(),a=d.due.getTime();return E(a-t)}const k=Z();function m(d){d!==S.Manual&&p("rate",k.value.next(i.fsrs,new Date,d))}return(d,t)=>(n(),l("div",x,[(n(!0),l(j,null,B(s.value,({log:a,card:e})=>(n(),y(V,{class:"rating-button",key:a.rating,"data-rating":o(S)[a.rating],onClick:r=>m(a.rating)},{default:q(()=>[f("span",ee,[f("span",ae,h(o(S)[a.rating]),1),f("small",ne,h(u(e)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),re=$(te,[["__scopeId","data-v-4210a69b"]]),se={key:0},ie={class:"advance-buttons"},oe=C({__name:"KanjiReview",props:{card:{},isRating:{type:Boolean}},emits:["answer","rate"],setup(g,{emit:c}){const i=g,p=c,s=Q(()=>i.card.cardId),u=z(()=>i.card.cardId),k=A(null);H(()=>i.card.cardId.toString(16).padStart(5,"0"));const m=L(async()=>{const{cardId:e,cardType:r,fsrs:v}=i.card;if(v)return v;const b=await(await M).get("progress",[e,r]);return b==null?void 0:b.fsrs},i.card.fsrs),d=_(()=>{var e;return((e=m.value)==null?void 0:e.state)===F.New});function t(){var e;p("answer"),i.card.cardType==="kanji-write"&&((e=k.value)==null||e.maybeShowAnswer())}function a(e){var r;m.value&&((r=k.value)==null||r.clearPracticeStrokes(),p("rate",{progress:{...i.card,fsrs:m.value},next:e}))}return(e,r)=>o(s)&&o(m)?(n(),l("section",se,[T(J,{class:"title",kanji:o(s),"hide-literal":!e.isRating&&e.card.cardType==="kanji-write"&&!d.value,"hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.isRating||e.card.cardType==="kanji-write"?(n(),y(O,{key:0,class:"readings",kanji:o(s)},null,8,["kanji"])):w("",!0),T(U,{ref_key:"kanjiStrokesEl",ref:k,class:"strokes",kanji:o(s),"auto-hint":!e.isRating&&e.card.cardType==="kanji-write"&&d.value,"practice-mode":!e.isRating&&e.card.cardType==="kanji-write",onPracticeDone:r[0]||(r[0]=v=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),f("div",ie,[e.isRating?(n(),y(re,{key:0,fsrs:o(m),onRate:a},null,8,["fsrs"])):(n(),y(V,{key:1,onClick:r[1]||(r[1]=v=>t()),filled:""},{default:q(()=>[r[2]||(r[2]=R(" Show ")),e.card.cardType==="kanji-read"?(n(),l(j,{key:0},[R(" Reading")],64)):(n(),l(j,{key:1},[R(" Writing")],64))]),_:1}))]),e.isRating||e.card.cardType==="kanji-write"&&d.value?(n(),y(Y,{key:1,class:"components"})):w("",!0),o(u)?(n(),y(X,{key:2,class:"words","kanji-vocab":o(u),"hide-kanji":!e.isRating&&e.card.cardType==="kanji-write"&&!d.value,"hide-reading":!e.isRating&&e.card.cardType==="kanji-read","hide-meaning":!e.isRating&&e.card.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):w("",!0)])):w("",!0)}}),de=$(oe,[["__scopeId","data-v-32f859cb"]]),ce={key:0,class:"review-remaining-count"},ue={class:"review-count"},le={class:"new-count"},pe={class:"learning-count"},fe=C({__name:"ReviewRemainCount",setup(g){const c=W();return(i,p)=>o(c)?(n(),l("div",ce,[f("span",ue,h(o(c).due),1),f("span",le,"(+ "+h(o(c).new)+")",1),f("span",pe,h(o(c).learning),1)])):w("",!0)}}),me=$(fe,[["__scopeId","data-v-adc21f06"]]);function ge(g){return g==="kanji-read"||g==="kanji-write"}const ke={class:"header"},ve={class:"title"},ye={key:0,class:"loading"},we=C({__name:"ReviewView",setup(g){const c=A(null),i=N(),p=D(),s=G(),u=_(()=>{const{kanji:t,"card-type":a}=i.query;if(typeof t!="string"||typeof a!="string")return null;const e=t.codePointAt(0);return!e||!ge(a)?null:s.queue.find(v=>v.cardId===e&&v.cardType===a)??{cardId:e,cardType:a}}),k=_(()=>"rating"in i.query),m=_(()=>!u.value&&s.refreshing);s.refreshQueues(),I(()=>{s.queue.length===0&&!s.refreshing&&p.replace(K)}),I(()=>{if(u.value)return;const[t]=s.queue;t&&p.replace({query:{kanji:String.fromCodePoint(t.cardId),"card-type":t.cardType,rating:void 0}})});function d({progress:t,next:a}){var r;s.rateCard(t,a);const[e]=s.queue;e?(p.replace({query:{kanji:String.fromCodePoint(e.cardId),"card-type":e.cardType,rating:void 0}}),(r=c.value)==null||r.scrollIntoView({behavior:"instant",block:"start"})):p.replace(K)}return(t,a)=>(n(),l("article",{ref_key:"el",ref:c},[f("header",ke,[f("strong",ve,[u.value?(n(),l(j,{key:0},[u.value.cardType==="kanji-read"?(n(),l(j,{key:0},[R(" Reading ")],64)):(n(),l(j,{key:1},[R("Writing")],64)),a[2]||(a[2]=R(" Review "))],64)):w("",!0)]),T(me,{class:"counts"})]),m.value?(n(),l("section",ye,[a[3]||(a[3]=f("p",null,"Loading next cardâ€¦",-1)),T(P,{class:"loading-icon"})])):u.value?(n(),y(de,{key:1,card:u.value,"is-rating":k.value,onAnswer:a[0]||(a[0]=e=>t.$router.replace({query:{...t.$route.query,rating:""}})),onRate:a[1]||(a[1]=e=>d(e))},null,8,["card","is-rating"])):w("",!0)],512))}}),Ke=$(we,[["__scopeId","data-v-89301efa"]]);export{Ke as default};
