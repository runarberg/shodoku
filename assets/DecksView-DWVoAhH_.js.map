{"version":3,"file":"DecksView-DWVoAhH_.js","sources":["../../src/components/DeckKanjiCardItem.vue","../../src/components/DeckKanjiCards.vue","../../src/components/DeckListItem.vue","../../src/components/DeckList.vue","../../src/views/DecksView.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { Card as FSRSCard, State } from \"ts-fsrs\";\nimport { computed } from \"vue\";\n\nimport { db } from \"../db/index.ts\";\nimport { useLiveQuery } from \"../helpers/db.ts\";\nimport { useFsrs } from \"../helpers/fsrs.ts\";\nimport { WEEK } from \"../helpers/time.ts\";\nimport { kanjiRoute } from \"../router.ts\";\nimport { knownMinDueWeeks, knownMinRetention } from \"../store/reviews.ts\";\n\nconst props = defineProps<{\n  codepoint: number;\n}>();\n\nconst kanji = computed(() => String.fromCodePoint(props.codepoint));\n\nconst { result: progress } = useLiveQuery(async () => {\n  const { codepoint } = props;\n  const progressStore = (await db).transaction(\"progress\").store;\n\n  const read = await progressStore.get([codepoint, \"kanji-read\"]);\n  const write = await progressStore.get([codepoint, \"kanji-write\"]);\n\n  return { read, write };\n});\n\nconst fsrs = useFsrs();\n\nfunction isProficient(fsrsCard: FSRSCard) {\n  const now = new Date();\n  const minRetentionProb = knownMinRetention.value / 100;\n  const minDueDate = new Date(Date.now() + knownMinDueWeeks.value * WEEK);\n  const r = fsrs.value.get_retrievability(fsrsCard, now, false);\n\n  return r > minRetentionProb && fsrsCard.due > minDueDate;\n}\n\nfunction getStatus(\n  fsrsCard: FSRSCard | undefined,\n): \"know\" | \"review\" | \"due\" | \"new\" | null {\n  if (!fsrsCard) {\n    return null;\n  }\n\n  if (fsrsCard.state === State.New) {\n    return \"new\";\n  }\n\n  if (\n    fsrsCard.state === State.Learning ||\n    fsrsCard.state === State.Relearning ||\n    fsrsCard.due < new Date()\n  ) {\n    return \"due\";\n  }\n\n  if (isProficient(fsrsCard)) {\n    return \"know\";\n  }\n\n  return \"review\";\n}\n\nconst readStatus = computed(() => getStatus(progress.value?.read?.fsrs));\nconst writeStatus = computed(() => getStatus(progress.value?.write?.fsrs));\n</script>\n\n<template>\n  <RouterLink\n    :to=\"kanjiRoute(kanji)\"\n    class=\"kanji\"\n    :data-read=\"readStatus\"\n    :data-write=\"writeStatus\"\n  >\n    {{ kanji }}\n  </RouterLink>\n</template>\n\n<style scoped>\n.kanji {\n  --border-color: var(--medium-gray);\n\n  background: var(--background-strong);\n  border: 2px solid var(--border-color);\n  border-block-start-color: var(--write-color, var(--border-color));\n  border-inline-end-color: var(--read-color, var(--border-color));\n  border-block-end-color: var(--read-color, var(--border-color));\n  border-inline-start-color: var(--write-color, var(--border-color));\n  color: inherit;\n  font-size: 1.2em;\n  padding: 0.3ex;\n  text-decoration: none;\n\n  &[data-read=\"know\"] {\n    --read-color: var(--green);\n  }\n\n  &[data-read=\"review\"] {\n    --read-color: var(--blue);\n  }\n\n  &[data-read=\"due\"] {\n    --read-color: var(--orange);\n  }\n\n  &[data-write=\"know\"] {\n    --write-color: var(--green);\n  }\n\n  &[data-write=\"review\"] {\n    --write-color: var(--blue);\n  }\n\n  &[data-write=\"due\"] {\n    --write-color: var(--orange);\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport DeckKanjiCardItem from \"./DeckKanjiCardItem.vue\";\n\ndefineProps<{\n  kanji: number[];\n}>();\n</script>\n\n<template>\n  <ol class=\"kanji-list\">\n    <li v-for=\"codepoint of kanji\" :key=\"codepoint\" class=\"kanji\">\n      <DeckKanjiCardItem :codepoint=\"codepoint\" />\n    </li>\n  </ol>\n</template>\n\n<style scoped>\n.kanji-list {\n  column-gap: 1ex;\n  display: flex;\n  flex-wrap: wrap;\n  list-style: none;\n  margin: 0;\n  padding-inline-start: 1em;\n  row-gap: 1em;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed, onMounted, ref, useId } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nimport { deckLabel } from \"../helpers/decks.ts\";\nimport { formatPercent } from \"../helpers/formats.ts\";\nimport { useDeckStatus } from \"../store/decks.ts\";\nimport { Deck } from \"../types.ts\";\nimport DeckKanjiCards from \"./DeckKanjiCards.vue\";\n\nconst props = defineProps<{\n  deck: Deck;\n}>();\n\nconst el = ref<HTMLElement | null>(null);\nconst labelId = useId();\nconst route = useRoute();\n\nconst label = computed(() => deckLabel(props.deck));\n\nconst expandedDeckNames = computed(() => {\n  if (!route.query.deck) {\n    return [];\n  }\n\n  if (typeof route.query.deck === \"string\") {\n    return [route.query.deck];\n  }\n\n  return route.query.deck;\n});\n\nconst expanded = computed(() =>\n  expandedDeckNames.value.includes(props.deck.name),\n);\n\nconst toggleExpanded = computed(() => {\n  const { name } = props.deck;\n  const deckQuery = expanded.value\n    ? expandedDeckNames.value.filter((other) => other !== name)\n    : [...expandedDeckNames.value, name];\n\n  return {\n    query: { ...route.query, deck: deckQuery },\n  };\n});\n\nconst deckStatus = useDeckStatus(() => props.deck.name);\nfunction sumStatus(status: \"new\" | \"due\" | \"review\" | \"know\") {\n  if (!deckStatus.value) {\n    return 0;\n  }\n\n  const { \"kanji-read\": read, \"kanji-write\": write } = deckStatus.value;\n\n  return (read[status] + write[status]) / 2;\n}\n\nconst newCount = computed(() => sumStatus(\"new\"));\nconst dueCount = computed(() => sumStatus(\"due\"));\nconst reviewCount = computed(() => sumStatus(\"review\"));\nconst knowCount = computed(() => sumStatus(\"know\"));\n\nonMounted(() => {\n  if (expanded.value && expandedDeckNames.value.length === 1) {\n    el.value?.scrollIntoView({ block: \"start\" });\n  }\n});\n</script>\n\n<template>\n  <article ref=\"el\" class=\"deck-list-item\" :aria-labelledby=\"labelId\">\n    <strong :id=\"labelId\" class=\"label\">\n      <RouterLink :to=\"toggleExpanded\" :aria-pressed=\"expanded\" replace>\n        {{ label }}\n      </RouterLink>\n    </strong>\n\n    <div class=\"status\">\n      <span class=\"count total-count\">{{ deck.cards.length }} cards</span>\n      <template v-if=\"deckStatus\">\n        <span v-if=\"knowCount > 0\" class=\"count know-count\">\n          {{ formatPercent(knowCount / deck.cards.length) }} know\n        </span>\n        <span v-if=\"reviewCount > 0\" class=\"count review-count\">\n          {{ formatPercent(reviewCount / deck.cards.length) }} reviewed\n        </span>\n        <span v-if=\"dueCount > 0\" class=\"count due-count\">\n          {{ formatPercent(dueCount / deck.cards.length) }} due\n        </span>\n        <span v-if=\"newCount > 0\" class=\"count new-count\">\n          {{ formatPercent(newCount / deck.cards.length) }} remaining\n        </span>\n      </template>\n    </div>\n\n    <DeckKanjiCards v-if=\"expanded\" :kanji=\"deck.cards\" class=\"cards\" />\n  </article>\n</template>\n\n<style scoped>\n.deck-list-item {\n  column-gap: 1em;\n  display: grid;\n  grid-template:\n    \"label\"\n    \"status\"\n    \"cards\"\n    / 1fr;\n  justify-content: start;\n}\n\n.label {\n  font-size: 1.1em;\n  font-weight: 600;\n  grid-area: label;\n\n  & a {\n    color: var(--accent-color);\n    text-decoration: none;\n  }\n}\n\n.status {\n  column-gap: 1ex;\n  display: flex;\n  font-size: 0.9em;\n  grid-area: status;\n}\n\n.count {\n  font-weight: 500;\n\n  &.know-count {\n    color: var(--green);\n  }\n\n  &.review-count {\n    color: var(--blue);\n  }\n\n  &.due-count {\n    color: var(--orange);\n  }\n\n  &.new-count {\n    color: var(--medium-gray);\n  }\n}\n\n.cards {\n  grid-area: cards;\n  margin-block: 1ex 1em;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { deckBrowserRoute } from \"../router.ts\";\nimport { useDecks } from \"../store/decks.ts\";\nimport AppButton from \"./AppButton.vue\";\nimport DeckListItem from \"./DeckListItem.vue\";\n\nconst decks = useDecks();\n</script>\n\n<template>\n  <section>\n    <p>\n      Decks allow you do keep track of your practice, such that you know which\n      kanji you already know, which you should learn next, and which you need to\n      review.\n    </p>\n\n    <template v-if=\"decks && decks.length > 0\">\n      <ol class=\"deck-list\">\n        <li v-for=\"deck of decks\" :key=\"deck.name\" class=\"deck-list-item\">\n          <DeckListItem :deck=\"deck\" />\n        </li>\n      </ol>\n    </template>\n\n    <template v-else-if=\"decks\">\n      <p>\n        You donâ€˜t have any decks.\n        <RouterLink :to=\"deckBrowserRoute\"> Add your first deck </RouterLink> by\n        clicking the button below.\n      </p>\n\n      <AppButton :to=\"deckBrowserRoute\" prefix-icon=\"plus\">\n        Add Deck\n      </AppButton>\n    </template>\n  </section>\n</template>\n\n<style scoped>\nol.deck-list {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n\n  & > li.deck-list-item:not(:first-child) {\n    margin-block-start: 1ex;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport AppButton from \"../components/AppButton.vue\";\nimport DeckList from \"../components/DeckList.vue\";\nimport { deckBrowserRoute } from \"../router.ts\";\n</script>\n\n<template>\n  <article>\n    <header class=\"article-header\">\n      <h2 class=\"title\">Your Decks</h2>\n\n      <div class=\"actions\">\n        <AppButton :to=\"deckBrowserRoute\" prefix-icon=\"draw\">\n          Manage Decks\n        </AppButton>\n      </div>\n    </header>\n\n    <DeckList />\n  </article>\n</template>\n\n<style scoped>\n.article-header {\n  align-items: center;\n  display: flex;\n  margin-block-end: 1.5em;\n\n  & .title {\n    margin-block: 0;\n  }\n\n  & .actions {\n    margin-inline-start: auto;\n  }\n}\n</style>\n"],"names":["props","__props","kanji","computed","progress","useLiveQuery","codepoint","progressStore","db","read","write","fsrs","useFsrs","isProficient","fsrsCard","now","minRetentionProb","knownMinRetention","minDueDate","knownMinDueWeeks","WEEK","getStatus","State","readStatus","writeStatus","_createBlock","_component_RouterLink","_unref","kanjiRoute","_openBlock","_createElementBlock","_hoisted_1","_Fragment","_renderList","_createVNode","DeckKanjiCardItem","el","ref","labelId","useId","route","useRoute","label","deckLabel","expandedDeckNames","expanded","toggleExpanded","name","deckQuery","other","deckStatus","useDeckStatus","sumStatus","status","newCount","dueCount","reviewCount","knowCount","onMounted","_createElementVNode","_hoisted_3","_hoisted_4","_toDisplayString","deck","_hoisted_5","formatPercent","_hoisted_6","_hoisted_7","_hoisted_8","DeckKanjiCards","decks","useDecks","_cache","DeckListItem","deckBrowserRoute","AppButton","_hoisted_2","DeckList"],"mappings":"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"}