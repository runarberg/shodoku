import{d as _,Y as q,Z as Y,c as K,a as d,N as ee,e as m,b as u,A as N,w as g,h as v,t as T,o as s,_ as h,P as z,Q as te,i as w,$ as J,F as A,q as x,I as ae,u as n,K as P,g as D,l as j,z as Q,m as G,D as le,x as se,O as V,a0 as ne}from"./index-3SZaU-iL.js";import{k as $,j as oe,a as ie,n as re,g as ce,b as ue}from"./decks-BkI394ym.js";import{c as U,e as de,r as F,a as me,d as ke,b as fe,f as ye}from"./decks-gvUqHaG3.js";import{d as O,u as Z}from"./db-CmzCis4b.js";import{p as W,d as ge,m as ve}from"./reviews-C0tp5JDi.js";import{A as pe,a as be}from"./AppNumberInput-Ds6KzMhA.js";import{A as Ae}from"./AppTextArea-Cv4SwLFT.js";import{H as De,a as we,b as $e,c as _e,d as Ie,e as Te}from"./kana-DFdUvK8b.js";function Ce(e,l){return async t=>{let a=l;for await(const o of t)a=e(a,o);return a}}function Be(){return e=>[...e]}function Ne(e){return function*(l){for(const t of l)yield e(t)}}function xe(e){return function*(l){for(const t of l)e(t)&&(yield t)}}function he(){return function*(e){const l=new Set;for(const t of e)l.has(t)||(yield t,l.add(t))}}const Ke={class:"form-body"},je={class:"buttons"},Ve=_({__name:"CustomDeckForm",props:q({labelFieldDisabled:{type:Boolean,default:!1},priorityFieldDisabled:{type:Boolean,default:!1},confirmIcon:{default:null},confirmLabel:{default:"confirm"}},{label:{},labelModifiers:{},priority:{},priorityModifiers:{},cards:{},cardsModifiers:{}}),emits:q(["submit","reset"],["update:label","update:priority","update:cards"]),setup(e){const l=Y(e,"label"),t=Y(e,"priority"),a=Y(e,"cards"),o=K({get(){return a.value?a.value.map(c=>String.fromCodePoint(c)).join(""):""},set(c){a.value=W(c,xe(ge),Ne(r=>r.codePointAt(0)),he(),Be())}});return(c,r)=>(s(),d("form",{onSubmit:r[3]||(r[3]=ee(i=>c.$emit("submit"),["prevent"])),onReset:r[4]||(r[4]=i=>c.$emit("reset"))},[m("div",Ke,[u(pe,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=i=>l.value=i),class:"name-field",label:"Deck Name",disabled:e.labelFieldDisabled,required:""},null,8,["modelValue","disabled"]),u(be,{modelValue:t.value,"onUpdate:modelValue":r[1]||(r[1]=i=>t.value=i),class:"priority-field",label:"Priority",min:"1",disabled:e.priorityFieldDisabled,required:""},null,8,["modelValue","disabled"]),u(Ae,{modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=i=>o.value=i),class:"kanji-field",label:"Kanji",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",placeholder:"Type or paste in your kanji here: 日月火時漢字読書"},null,8,["modelValue"])]),m("div",je,[u(N,{type:"reset"},{default:g(()=>[...r[5]||(r[5]=[v(" Cancel ",-1)])]),_:1}),u(N,{type:"submit","prefix-icon":e.confirmIcon,filled:""},{default:g(()=>[v(T(e.confirmLabel),1)]),_:1},8,["prefix-icon"])])],32))}}),X=h(Ve,[["__scopeId","data-v-a5ea0a3c"]]),Ee=_({__name:"CustomDeckCreate",emits:["cancel","success"],setup(e,{emit:l}){const t=l,a=z({label:"",priority:1,cards:[]});async function o(){const r=await W((await O).transaction("decks").store.index("category").iterate("custom"),ve(i=>i.value.cards.length),Ce((i,f)=>i+f,0));r&&(a.priority=Math.ceil(r/12))}async function c(){const r=await U({label:a.label,priority:a.priority,cards:J(a.cards),cardTypes:["kanji-write","kanji-read"]});t("success",r)}return te(()=>{o()}),(r,i)=>(s(),w(X,{cards:a.cards,"onUpdate:cards":i[0]||(i[0]=f=>a.cards=f),label:a.label,"onUpdate:label":i[1]||(i[1]=f=>a.label=f),priority:a.priority,"onUpdate:priority":i[2]||(i[2]=f=>a.priority=f),"confirm-icon":"plus","confirm-label":"Create",onSubmit:c,onReset:i[3]||(i[3]=f=>r.$emit("cancel"))},null,8,["cards","label","priority"]))}}),Le=_({__name:"DeckActivateButton",props:{isActive:{type:Boolean,default:!1},toggling:{type:Boolean,default:!1}},emits:["activate","deactivate"],setup(e,{emit:l}){const t=e,a=l;function o(){t.isActive?a("deactivate"):a("activate")}return(c,r)=>(s(),w(N,{class:"activate-button",filled:e.isActive,disabled:e.toggling,"prefix-icon":e.toggling?void 0:e.isActive?"checkmark":"plus","aria-pressed":e.isActive,onClick:o},{default:g(()=>[e.toggling?(s(),d(A,{key:0},[r[0]||(r[0]=m("span",{class:"loading-icon"},"時",-1)),r[1]||(r[1]=v(" Loading ",-1))],64)):e.isActive?(s(),d(A,{key:1},[v(" Active ")],64)):(s(),d(A,{key:2},[v(" Add ")],64))]),_:1},8,["filled","disabled","prefix-icon","aria-pressed"]))}}),M=h(Le,[["__scopeId","data-v-8468a69b"]]),Re=_({__name:"CustomDeckEdit",props:{deck:{}},emits:["cancel","success"],setup(e,{emit:l}){const t=e,a=l,o=z({label:t.deck.label,priority:t.deck.priority,cards:t.deck.cards});async function c(){await de({...t.deck,label:o.label,priority:o.priority,cards:J(o.cards)}),a("success")}return(r,i)=>(s(),w(X,{cards:o.cards,"onUpdate:cards":i[0]||(i[0]=f=>o.cards=f),label:o.label,"onUpdate:label":i[1]||(i[1]=f=>o.label=f),priority:o.priority,"onUpdate:priority":i[2]||(i[2]=f=>o.priority=f),"confirm-label":"Update","label-field-disabled":t.deck.category!=="custom","priority-field-disabled":t.deck.category!=="custom",onSubmit:c,onReset:i[3]||(i[3]=f=>r.$emit("cancel"))},null,8,["cards","label","priority","label-field-disabled","priority-field-disabled"]))}}),Se=["aria-labelledby"],Fe={class:"header"},Ue=["id"],Me={class:"kanji-list"},Ye=_({__name:"DeckBrowserItem",props:{deck:{},template:{},category:{},togglingCategory:{type:Boolean,default:!1}},setup(e){const l=e,t=x(!1),a=x(!1),o=P(),c=x(null),r=K(()=>l.deck?.active);async function i(){t.value=!0;try{l.deck?await me(l.deck.name):await U({name:l.template.name,label:l.template.label,priority:l.template.priority,category:l.category,cards:c.value?.map(y=>y.codePointAt(0)??NaN)??[],cardTypes:["kanji-write","kanji-read"]})}catch(y){console.error(y)}finally{t.value=!1}}async function f(){if(l.deck){t.value=!0;try{await ke(l.deck.name)}catch(y){console.error(y)}finally{t.value=!1}}}return ae(()=>l.template?.content,async y=>{if(!y){c.value=null;return}const C=await(await fetch(y)).text();c.value=C.split(`
`).filter(b=>b)},{immediate:!0}),(y,k)=>{const C=Q("RouterLink");return a.value&&e.deck?(s(),w(Re,{key:0,deck:e.deck,onCancel:k[0]||(k[0]=b=>a.value=!1),onSuccess:k[1]||(k[1]=b=>a.value=!1)},null,8,["deck"])):(s(),d("article",{key:1,"aria-labelledby":n(o)},[m("header",Fe,[m("strong",{id:n(o)},T(e.deck?.label??e.template?.label),9,Ue),u(M,{toggling:t.value||e.togglingCategory,"is-active":r.value,onActivate:i,onDeactivate:f},null,8,["toggling","is-active"]),e.deck?.active||e.deck?.category==="custom"?(s(),w(N,{key:0,class:"edit-button",onClick:k[2]||(k[2]=b=>a.value=!0)},{default:g(()=>[...k[5]||(k[5]=[v(" Edit ",-1)])]),_:1})):e.deck&&!e.deck.active&&e.deck.category!=="custom"?(s(),w(N,{key:1,class:"edit-button",onClick:k[3]||(k[3]=b=>n(F)(e.deck.name))},{default:g(()=>[...k[6]||(k[6]=[v(" Reset ",-1)])]),_:1})):D("",!0),e.deck?.category==="custom"?(s(),w(N,{key:2,class:"delete-button",onClick:k[4]||(k[4]=b=>n(F)(e.deck.name))},{default:g(()=>[...k[7]||(k[7]=[v(" Delete ",-1)])]),_:1})):D("",!0)]),m("ol",Me,[e.deck?(s(!0),d(A,{key:0},j(e.deck.cards,b=>(s(),d("li",{key:b,class:"kanji"},[u(C,{to:n(G)(String.fromCodePoint(b))},{default:g(()=>[v(T(String.fromCodePoint(b)),1)]),_:2},1032,["to"])]))),128)):c.value?(s(!0),d(A,{key:1},j(c.value,b=>(s(),d("li",{key:b,class:"kanji"},[u(C,{to:n(G)(b)},{default:g(()=>[v(T(b),1)]),_:2},1032,["to"])]))),128)):D("",!0)])],8,Se))}}}),H=h(Ye,[["__scopeId","data-v-24a893c0"]]),Pe=["aria-labelledby"],Oe={class:"controls"},qe=["id"],Ge={key:2,class:"deck-list"},He=_({__name:"DeckBrowserCategory",props:{title:{},category:{},deckTemplates:{}},setup(e){const l=e,t=x(!1),a=x(!1),o=P(),{result:c}=Z(K(()=>{const{category:B}=l;return async()=>{const p=new Map,I=(await O).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound([B,Number.NEGATIVE_INFINITY],[B,Number.POSITIVE_INFINITY],!0,!0));for await(const S of I)p.set(S.primaryKey,S.value);return p}})),r=K(()=>l.deckTemplates?l.deckTemplates.length:c.value?.size??0),i=K(()=>{if(!c.value)return 0;let B=0;for(const[,{active:p}]of c.value)p&&(B+=1);return B}),f=x(!1),y=K(()=>l.deckTemplates?i.value>=l.deckTemplates.length:!0);async function k(B){f.value=!0;try{await fe(l.category,B)}catch(p){console.error(p)}finally{f.value=!1}}async function C(){f.value=!0;try{await ye(l.category)}catch(B){console.error(B)}finally{f.value=!1}}function b(){a.value=!0,t.value=!1}return(B,p)=>(s(),d("article",{"aria-labelledby":n(o)},[m("div",Oe,[m("strong",{id:n(o),class:"title"},T(e.title),9,qe),e.deckTemplates?(s(),w(M,{key:0,toggling:f.value,"is-active":y.value,onActivate:p[0]||(p[0]=I=>k(e.deckTemplates)),onDeactivate:C},null,8,["toggling","is-active"])):t.value?D("",!0):(s(),w(N,{key:1,class:"create-custom-button","prefix-icon":"plus",onClick:p[1]||(p[1]=I=>t.value=!0)},{default:g(()=>[...p[4]||(p[4]=[v(" Create New ",-1)])]),_:1}))]),r.value>0?(s(),w(N,{key:0,class:"expand-button","aria-pressed":a.value,onClick:p[2]||(p[2]=I=>a.value=!a.value)},{default:g(()=>[a.value?(s(),d(A,{key:0},[v(" Hide ")],64)):(s(),d(A,{key:1},[v(" Show ")],64)),v(" ("+T(r.value)+" decks) ",1)]),_:1},8,["aria-pressed"])):D("",!0),t.value?(s(),w(Ee,{key:1,class:"custom-deck-create",onCancel:p[3]||(p[3]=I=>t.value=!1),onSuccess:b})):D("",!0),a.value?(s(),d("ol",Ge,[e.deckTemplates?(s(!0),d(A,{key:0},j(e.deckTemplates,I=>(s(),d("li",{key:I.name},[u(H,{deck:n(c)?.get(I.name),template:I,category:e.category,"toggling-category":f.value},null,8,["deck","template","category","toggling-category"])]))),128)):n(c)?(s(!0),d(A,{key:1},j(n(c),([I,S])=>(s(),d("li",{key:I},[u(H,{deck:S},null,8,["deck"])]))),128)):D("",!0)])):D("",!0)],8,Pe))}}),R=h(He,[["__scopeId","data-v-937c40f4"]]),ze=_({__name:"DeckBrowserCustom",setup(e){return(l,t)=>(s(),w(R,{title:"Custom",category:"custom"}))}}),Je={class:"deck-browser-kana-deck-item"},Qe={class:"header"},Ze={class:"kana-title"},We={class:"body"},Xe=_({__name:"DeckBrowserKanaItem",props:{template:{},togglingCategory:{type:Boolean},isActive:{type:Boolean}},setup(e){const l=e,t=x(!1);async function a(){t.value=!0;try{await U(l.template)}catch(c){console.error(c)}finally{t.value=!1}}async function o(){t.value=!0;try{await F(l.template.name)}catch(c){console.error(c)}finally{t.value=!1}}return(c,r)=>(s(),d("article",Je,[m("header",Qe,[m("strong",Ze,T(e.template.label),1),u(M,{toggling:t.value||e.togglingCategory,"is-active":e.isActive,onActivate:a,onDeactivate:o},null,8,["toggling","is-active"])]),m("div",We,[le(c.$slots,"default")])]))}}),E=h(Xe,[["__scopeId","data-v-e59ee8fd"]]),et={class:"kana-table"},tt={key:0},at={key:0,class:"aiueo"},lt={key:0},st={class:"consonant"},nt=_({__name:"KanaTable",props:{headings:{},rows:{}},setup(e){return(l,t)=>{const a=Q("RouterLink");return s(),d("table",et,[e.headings?(s(),d("thead",tt,[m("tr",null,[(s(!0),d(A,null,j(e.headings,(o,c)=>(s(),d("th",{key:c},[o?(s(),d("span",at,T(o),1)):D("",!0)]))),128))])])):D("",!0),m("tbody",null,[(s(!0),d(A,null,j(e.rows,({heading:o,cells:c},r)=>(s(),d("tr",{key:r},[o?(s(),d("th",lt,[m("span",st,T(o),1)])):D("",!0),(s(!0),d(A,null,j(c,(i,f)=>(s(),d("td",{key:f},[i?(s(),w(a,{key:0,class:"kana-literal",to:n(se)(i)},{default:g(()=>[v(T(i),1)]),_:2},1032,["to"])):D("",!0)]))),128))]))),128))])])}}}),L=h(nt,[["__scopeId","data-v-f41c3b1c"]]),ot=["aria-labelledby"],it={class:"controls"},rt=["id"],ct={key:0,class:"deck-list"},ut=_({__name:"DeckBrowserKana",setup(e){const l=x(!1),t=P(),a=x(!1),{result:o}=Z(K(()=>async()=>{const y=new Map,k=(await O).transaction("decks").store.index("category+priority").iterate(IDBKeyRange.bound(["kana",Number.NEGATIVE_INFINITY],["kana",Number.POSITIVE_INFINITY],!0,!0));for await(const C of k)y.set(C.primaryKey,C.value);return y}),new Map),c=Object.keys($).length,r=K(()=>o.value.size===c);async function i(){a.value=!0;const y=o.value;try{for(const k of Object.values($))y.has(k.name)||await U(k)}catch(k){console.error(k)}finally{a.value=!1}}async function f(){a.value=!0;try{for(const y of o.value.keys())await F(y)}catch(y){console.error(y)}finally{a.value=!1}}return(y,k)=>(s(),d("article",{"aria-labelledby":n(t)},[m("div",it,[m("strong",{id:n(t),class:"title"},"Kana",8,rt),u(M,{toggling:a.value,"is-active":r.value,onActivate:i,onDeactivate:f},null,8,["toggling","is-active"])]),u(N,{class:"expand-button","aria-pressed":l.value,onClick:k[0]||(k[0]=C=>l.value=!l.value)},{default:g(()=>[l.value?(s(),d(A,{key:0},[v("Hide ")],64)):(s(),d(A,{key:1},[v("Show ")],64)),v(" ("+T(n(c))+" decks) ",1)]),_:1},8,["aria-pressed"]),l.value?(s(),d("ol",ct,[m("li",null,[u(E,{template:n($).hiragana,"toggling-category":a.value,"is-active":n(o).has("hiragana")},{default:g(()=>[u(L,V({class:"kana-table"},n(De)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(E,{template:n($).katakana,"toggling-category":a.value,"is-active":n(o).has("katakana")},{default:g(()=>[u(L,V({class:"kana-table"},n(we)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(E,{template:n($).hiraganaDakuten,"toggling-category":a.value,"is-active":n(o).has(n($).hiraganaDakuten.name)},{default:g(()=>[u(L,V({class:"kana-table"},n($e)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(E,{template:n($).hiraganaYoon,"toggling-category":a.value,"is-active":n(o).has(n($).hiraganaYoon.name)},{default:g(()=>[u(L,V({class:"kana-table"},n(_e)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(E,{template:n($).katakanaDakuten,"toggling-category":a.value,"is-active":n(o).has(n($).katakanaDakuten.name)},{default:g(()=>[u(L,V({class:"kana-table"},n(Ie)),null,16)]),_:1},8,["template","toggling-category","is-active"])]),m("li",null,[u(E,{template:n($).katakanaYoon,"toggling-category":a.value,"is-active":n(o).has(n($).katakanaYoon.name)},{default:g(()=>[u(L,V({class:"kana-table"},n(Te)),null,16)]),_:1},8,["template","toggling-category","is-active"])])])):D("",!0)],8,ot))}}),dt=h(ut,[["__scopeId","data-v-678701c1"]]),mt={class:"categories"},kt=_({__name:"DeckBrowser",setup(e){return(l,t)=>(s(),d("ul",mt,[m("li",null,[u(dt)]),m("li",null,[u(R,{title:"JLPT",category:"jlpt","deck-templates":n(oe)},null,8,["deck-templates"])]),m("li",null,[u(R,{title:"Jōyō Kanji",category:"jouyou","deck-templates":n(ie)},null,8,["deck-templates"])]),m("li",null,[u(R,{title:"News Frequency",category:"news","deck-templates":n(re)},null,8,["deck-templates"])]),m("li",null,[u(R,{title:"Genki",category:"genki","deck-templates":n(ce)},null,8,["deck-templates"])]),m("li",null,[u(R,{title:"Basic Kanji Book",category:"basic-kanji","deck-templates":n(ue)},null,8,["deck-templates"])]),m("li",null,[u(ze)])]))}}),ft=h(kt,[["__scopeId","data-v-45aa42ba"]]),yt={class:"article-header"},gt={class:"actions"},vt=_({__name:"DeckBrowserView",setup(e){return(l,t)=>(s(),d("article",null,[m("header",yt,[t[1]||(t[1]=m("h2",{class:"title"},"Add Decks",-1)),m("div",gt,[u(N,{to:n(ne),"prefix-icon":"arrow-left"},{default:g(()=>[...t[0]||(t[0]=[v(" Back to your decks ",-1)])]),_:1},8,["to"])])]),u(ft)]))}}),Tt=h(vt,[["__scopeId","data-v-a1e5f41b"]]);export{Tt as default};
//# sourceMappingURL=DeckBrowserView-Di9ZAIVP.js.map
