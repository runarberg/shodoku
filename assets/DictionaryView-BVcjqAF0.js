import{d as v,m as L,a as o,e as d,I as V,g as C,F as m,l as W,b as c,u as p,h as R,o as a,_ as k,G as E,B as $,T as D,c as g,v as N,U as A,w as q,i as I,t as B,k as z,n as P,H as T,V as U}from"./index-CLUsYwP5.js";import{v as F}from"./index-BD3mXX1B.js";import{c as H,h as S,d as y,i as O}from"./index-eVDaGfEF.js";import{d as G}from"./db-BazvF5w-.js";import{W as Y}from"./WordListItem-D5d5ozLf.js";import{w as M}from"./index-ed5PeQn_.js";import{a as Z,B as J,_ as Q,c as X}from"./WordWritingSelect-CPNcGmdw.js";import{W as K}from"./WordKanjiListItem-DtTVVUYX.js";import"./fsrs-DsV1x14T.js";import"./reviews-sfrX3_Un.js";import"./kanji-Bdy0JbjC.js";const ee={class:"word-search-results"},se={class:"results-list"},te=v({__name:"BookmarkedWords",setup(u){const r=H(async()=>{const n=[],e=(await G).transaction("bookmarked-words").store.index("bookmarkedAt").iterate(null,"prev");for await(const l of e)n.push(l.primaryKey);return n},[]),s=L(20);function t(){s.value+=20}function i([{isIntersecting:n}]){n&&t()}return(n,e)=>(a(),o("section",ee,[e[2]||(e[2]=d("h3",null,"Bookmarked Words",-1)),d("ul",se,[(a(!0),o(m,null,W(p(r).slice(0,s.value),l=>(a(),o("li",{key:l},[c(Y,{word:l},null,8,["word"])]))),128))]),s.value<p(r).length?V((a(),o("button",{key:0,class:"next-page-button",onClick:e[0]||(e[0]=l=>t())},e[1]||(e[1]=[R(" Load More ")]))),[[p(F),i]]):C("",!0)]))}}),re=k(te,[["__scopeId","data-v-8a1217ab"]]);function ae(u){return new Worker("/assets/search-kanji.worker-DUz-mWlb.js",{name:u?.name})}function ne(u){return new Worker("/assets/search-words.worker-BKHYCkZA.js",{name:u?.name})}const j=new ae,x=new ne;function oe(u){const r=E([]);M(()=>$(u),async t=>{r.splice(0,r.length),t.length>0&&x.postMessage(t)},{debounce:300,immediate:!0});function s(t){const i=t.data;i.phrase===$(u)&&r.push(i)}return x.addEventListener("message",s),D(()=>{x.removeEventListener("message",s)}),r}function ie(u){const r=L([]);M(()=>$(u),async t=>{t.length===0||S(t)?r.value=[]:j.postMessage(t)},{debounce:300,immediate:!0});function s(t){r.value=t.data}return j.addEventListener("message",s),D(()=>{j.removeEventListener("message",s)}),r}const ue={class:"word-search-result-item"},le={class:"meaning"},ce=v({__name:"WordSearchResultItem",props:{result:{}},setup(u){const r=u,s=Z(()=>r.result.id),t=g(()=>s.value?s.value.readings?.at(0)?.text:r.result.readings.at(0)),i=g(()=>{const{match:e,readings:l,writings:f}=r.result;if(s.value){let _;return S(e)?_=s.value.furigana?.find(b=>b.writing===e):y(e)&&(_=s.value.furigana?.find(b=>b.reading===e)),_||(_=s.value.furigana?.at(0)),_?_.furigana:s.value.writings?.at(0)?.text??s.value.readings?.at(0)?.text??e}if(S(e))return[{ruby:e,rt:l.at(0)}];const[h]=f;if(y(e))return h?[{ruby:h,rt:e}]:e;const[w]=l;return h&&w?[{ruby:w,rt:w}]:h??w??e}),n=g(()=>{const{match:e,glossary:l}=r.result;if(s.value){if(y(e))return s.value.meanings?.at(0)??l.at(0)??e;const f=s.value.meanings?.find(h=>h.glossary?.includes(e));if(f)return f}return y(e)?l.at(0)??e:e});return(e,l)=>{const f=N("RouterLink");return a(),o("div",ue,[c(J,{"word-id":e.result.id,reading:t.value,class:"bookmark-button"},null,8,["word-id","reading"]),c(f,{to:p(A)(e.result.id),class:"word"},{default:q(()=>[typeof i.value=="string"?(a(),o(m,{key:0},[R(B(i.value),1)],64)):(a(),I(Q,{key:1,furigana:i.value},null,8,["furigana"]))]),_:1},8,["to"]),d("div",le,[typeof n.value=="string"?(a(),o(m,{key:0},[R(B(n.value),1)],64)):(a(),I(X,{key:1,meaning:n.value},null,8,["meaning"]))])])}}}),de=k(ce,[["__scopeId","data-v-3a6c2f15"]]),me={class:"word-search-results"},pe={class:"results-list"},fe=v({__name:"WordSearchResults",props:{phrase:{}},setup(u){const r=u,s=oe(()=>r.phrase);return(t,i)=>(a(),o("section",me,[i[0]||(i[0]=d("h3",null,"Words",-1)),d("ul",pe,[(a(!0),o(m,null,W(p(s),n=>(a(),o("li",{key:n.id},[c(de,{result:n},null,8,["result"])]))),128))])]))}}),he=k(fe,[["__scopeId","data-v-884f1e39"]]),_e={key:0,class:"kanji-search-results"},ge={key:0,class:"results-list"},ve={key:1,class:"results-list"},ke=v({__name:"KanjiSearchResults",props:{phrase:{}},setup(u){const r=u,s=g(()=>{const i=new Set;for(const n of r.phrase)O(n)&&i.add(n);return i}),t=ie(()=>r.phrase);return(i,n)=>s.value.size>0||p(t).length>0?(a(),o("section",_e,[n[0]||(n[0]=d("h3",null,"Kanji",-1)),s.value.size>0?(a(),o("ul",ge,[(a(!0),o(m,null,W(s.value,e=>(a(),o("li",{key:e},[c(K,{kanji:e},null,8,["kanji"])]))),128))])):(a(),o("ul",ve,[(a(!0),o(m,null,W(p(t),e=>(a(),o("li",{key:e.id},[c(K,{kanji:String.fromCodePoint(e.id)},null,8,["kanji"])]))),128))]))])):C("",!0)}}),we=k(ke,[["__scopeId","data-v-37e6699a"]]),ye={class:"search-field"},We=v({__name:"DictionaryView",setup(u){const r=P(),s=z(),t=g({get(){return typeof r.query.search!="string"?"":r.query.search},set(i){s.replace({query:{search:i||void 0}})}});return(i,n)=>(a(),o(m,null,[d("label",ye,[c(T,{icon:"search",class:"icon"}),V(d("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),type:"search","aria-label":"search",placeholder:"Search for words, kanji, meanings, etc."},null,512),[[U,t.value]])]),t.value?(a(),o(m,{key:0},[c(we,{class:"kanji-results",phrase:t.value},null,8,["phrase"]),c(he,{class:"word-results",phrase:t.value},null,8,["phrase"])],64)):(a(),I(re,{key:1,class:"bookmark-results"}))],64))}}),Ce=k(We,[["__scopeId","data-v-5c4cb6f2"]]);export{Ce as default};
