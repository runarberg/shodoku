import{q as E,I as W,c as M,G as ae,W as be,H as Se,d as oe,a as b,e as A,o as k,_ as Q,X as ne,g as J,U as Pe,V as Ce,F as X,l as le,u as ce,Y as pe,Z as ve,i as R,A as L,w as G,b as D,y as he,J as q,D as xe,h as se,t as ie}from"./index-3SZaU-iL.js";import{s as ue}from"./reviews-C0tp5JDi.js";import{f as $e}from"./formats-BZjAUNO7.js";const me="http://kanjivg.tagaini.net",ee=Symbol("kanjivg"),re=["general","tradit","nelson"],Ae=new DOMParser;function Me(e){let n=0,t=e;for(;t;)n+=1,t=t.parentElement?.closest("g");return n}function Be(e){const n=[];let t=e.closest("[data-position]");for(;t instanceof SVGElement;)n.push(t.dataset.position),t=t.parentElement?.closest("[data-position]")??null;return n}async function Ie(e){const t=await(await fetch(`/kanjivg/kanji/${e}.svg`)).text(),s=Ae.parseFromString(t,"image/svg+xml");let i=null;s.documentElement instanceof SVGSVGElement&&(i=s.documentElement.viewBox.baseVal);const a=s.getElementById(`kvg:${e}`);if(a){for(const r of[...a.querySelectorAll("*"),a])if(r instanceof SVGElement){for(const d of[...r.attributes])d.namespaceURI===me&&(r.dataset[d.localName]=d.value,r.removeAttributeNS(me,d.localName));r.removeAttribute("xmlns:kvg")}}return{strokes:a,rect:i}}function _t(e){const n=E(null),t=E(null),s=E(!1);W(()=>be(e),async(a,r)=>{if(!a){n.value=null,t.value=null;return}if(a!==r){s.value=!0;try{const{strokes:d,rect:c}=await Ie(a);n.value=d,c&&(t.value=`${c.x},${c.y},${c.width},${c.height}`)}finally{s.value=!1}}},{immediate:!0});const i=M(()=>{const a=n.value;if(!a)return new Map;const r=new Map,d={};function c(o){if(o.dataset.part&&Number.parseInt(o.dataset.part)>1)return;const y=o.dataset.element,h={element:y,original:o.dataset.original??null,position:Be(o),radical:o.dataset.radical??null,phon:o.dataset.phon??null,depth:Me(o)};let m=r.get(y);m?m.push(h):(m=[h],r.set(y,m)),h.radical&&(d[h.radical]=y)}a.dataset.radical&&c(a);for(const o of a.querySelectorAll("g[data-element]"))c(o);const p=new Map;for(const o of re){const y=d[o],h=r.get(y);h&&(h.sort((m,l)=>m.radical?l.radical?re.indexOf(m.radical)-re.indexOf(l.radical):1:l.radical?-1:m.depth-l.depth),p.set(y,h),r.delete(y))}for(const[o,y]of[...r].sort(([,h],[,m])=>Math.min(...h.map(({depth:l})=>l))-Math.min(...m.map(({depth:l})=>l))))p.set(o,y);return p});Se(ee,{strokesEl:n,viewBox:t,components:i,syncing:s})}function bt(){const e=ae(ee,null);return M(()=>e?.strokesEl.value?.cloneNode(!0)??null)}function St(){const e=ae(ee,null);return M(()=>e?.viewBox.value??"0,0,109,109")}function Pt(){const e=ae(ee,null);return M(()=>e?.components.value??new Map)}function Ct(){const e=ae(ee,null);return M(()=>e?.syncing.value??!1)}const De={class:"kanji-strokes-background"},Ne=["x","y","width","height"],Ee=["x1","y1","x2","y2"],Ve=["x1","y1","x2","y2"],je=["x1","y1","x2","y2"],Ge=["x1","y1","x2","y2"],Ke=["x1","y1","x2","y2"],Le=["x1","y1","x2","y2"],qe=oe({__name:"KanjiStrokesBackground",props:{viewBox:{}},setup(e){const n=e,t=M(()=>{const[a,r,d,c]=n.viewBox.split(",");return{x:Number.parseInt(a),y:Number.parseInt(r),width:Number.parseInt(d),height:Number.parseInt(c)}}),s=M(()=>{const{x:a,width:r}=t.value;return a+r/2}),i=M(()=>{const{y:a,height:r}=t.value;return a+r/2});return(a,r)=>(k(),b("g",De,[A("rect",{class:"background",x:t.value.x,y:t.value.y,width:t.value.width,height:t.value.width,rx:"5"},null,8,Ne),A("line",{class:"midline",x1:t.value.x+1,y1:i.value,x2:t.value.x+t.value.width-1,y2:i.value},null,8,Ee),A("line",{class:"midline",x1:s.value,y1:t.value.y+1,x2:s.value,y2:t.value.y+t.value.height-1},null,8,Ve),A("line",{class:"quartline",x1:s.value/2,y1:t.value.y+1,x2:s.value/2,y2:t.value.y+t.value.height-1},null,8,je),A("line",{class:"quartline",x1:3*s.value/2,y1:t.value.y+1,x2:3*s.value/2,y2:t.value.y+t.value.height-1},null,8,Ge),A("line",{class:"quartline",x1:t.value.x+1,y1:i.value/2,x2:t.value.x+t.value.width-1,y2:i.value/2},null,8,Ke),A("line",{class:"quartline",x1:t.value.x+1,y1:3*i.value/2,x2:t.value.x+t.value.width-1,y2:3*i.value/2},null,8,Le)]))}}),Oe=Q(qe,[["__scopeId","data-v-78045927"]]),Xe=1e-12,ye=112e-18,Fe=e=>e>=-ye&&e<=ye,ge=(e,n)=>Math.sqrt(e*e+n*n),U=(e,n)=>({x:e,y:n}),Te=e=>ge(e.x,e.y),Ye=e=>U(-e.x,-e.y),Z=(e,n)=>U(e.x+n.x,e.y+n.y),N=(e,n)=>U(e.x-n.x,e.y-n.y),z=(e,n)=>U(e.x*n,e.y*n),j=(e,n)=>e.x*n.x+e.y*n.y,de=(e,n)=>ge(e.x-n.x,e.y-n.y),O=(e,n=1)=>z(e,n/(Te(e)||1/0)),we=(e,n)=>({p:e,i:n}),Re=(e,n,t)=>{n&&(e.unshift(e[e.length-1]),e.push(e[1]));const s=e.length;if(s===0)return[];const i=[we(e[0])];return fe(e,i,t,0,s-1,N(e[1],e[0]),N(e[s-2],e[s-1])),n&&(i.shift(),i.pop()),i},fe=(e,n,t,s,i,a,r)=>{if(i-s===1){const h=e[s],m=e[i],l=de(h,m)/3;ke(n,[h,Z(h,O(a,l)),Z(m,O(r,l)),m]);return}const d=Ue(e,s,i);let c=Math.max(t,t*t),p,o=!0;for(let h=0;h<=4;h++){const m=ze(e,s,i,d,a,r),l=We(e,s,i,m,d);if(l.error<t&&o){ke(n,m);return}if(p=l.index,l.error>=c)break;o=He(e,s,i,d,m),c=l.error}const y=N(e[p-1],e[p+1]);fe(e,n,t,s,p,a,y),fe(e,n,t,p,i,Ye(y),r)},ke=(e,n)=>{const t=e[e.length-1];t.o=N(n[1],n[0]),e.push(we(n[3],N(n[2],n[3])))},ze=(e,n,t,s,i,a)=>{const r=Xe,d=Math.abs,c=e[n],p=e[t],o=[[0,0],[0,0]],y=[0,0];for(let x=0,I=t-n+1;x<I;x++){const C=s[x],V=1-C,F=3*C*V,T=V*V*V,H=F*V,v=F*C,g=C*C*C,$=O(i,H),u=O(a,v),f=N(N(e[n+x],z(c,T+H)),z(p,v+g));o[0][0]+=j($,$),o[0][1]+=j($,u),o[1][0]=o[0][1],o[1][1]+=j(u,u),y[0]+=j($,f),y[1]+=j(u,f)}const h=o[0][0]*o[1][1]-o[1][0]*o[0][1];let m,l;if(d(h)>r){const x=o[0][0]*y[1]-o[1][0]*y[0];m=(y[0]*o[1][1]-y[1]*o[0][1])/h,l=x/h}else{const x=o[0][0]+o[0][1],I=o[1][0]+o[1][1];m=l=d(x)>r?y[0]/x:d(I)>r?y[1]/I:0}const B=de(p,c),P=r*B;let _,S;if(m<P||l<P)m=l=B/3;else{const x=N(p,c);_=O(i,m),S=O(a,l),j(_,x)-j(S,x)>B*B&&(m=l=B/3,_=S=null)}return[c,Z(c,_||O(i,m)),Z(p,S||O(a,l)),p]},He=(e,n,t,s,i)=>{for(let a=n;a<=t;a++)s[a-n]=Je(i,e[a],s[a-n]);for(let a=1,r=s.length;a<r;a++)if(s[a]<=s[a-1])return!1;return!0},Je=(e,n,t)=>{const s=[],i=[];for(let o=0;o<=2;o++)s[o]=z(N(e[o+1],e[o]),3);for(let o=0;o<=1;o++)i[o]=z(N(s[o+1],s[o]),2);const a=te(3,e,t),r=te(2,s,t),d=te(1,i,t),c=N(a,n),p=j(r,r)+j(c,d);return Fe(p)?t:t-j(c,r)/p},te=(e,n,t)=>{const s=n.slice();for(let i=1;i<=e;i++)for(let a=0;a<=e-i;a++)s[a]=Z(z(s[a],1-t),z(s[a+1],t));return s[0]},Ue=(e,n,t)=>{const s=[0];for(let i=n+1;i<=t;i++)s[i-n]=s[i-n-1]+de(e[i],e[i-1]);for(let i=1,a=t-n;i<=a;i++)s[i]/=s[a];return s},We=(e,n,t,s,i)=>{let a=Math.floor((t-n+1)/2),r=0;for(let d=n+1;d<t;d++){const c=te(3,s,i[d-n]),p=N(c,e[d]),o=p.x*p.x+p.y*p.y;o>=r&&(r=o,a=d)}return{error:r,index:a}},Ze=(e,n,t)=>{const s=e.length,i=10**t,a=t<16?l=>Math.round(l*i)/i:l=>l,r=(l,B)=>a(l)+","+a(B);let d=!0,c,p,o,y;const h=[],m=(l,B)=>{const P=l.p.x,_=l.p.y;if(d)h.push("M"+r(P,_)),d=!1;else{const S=P+(l.i?.x??0),x=_+(l.i?.y??0);if(S===P&&x===_&&o===c&&y===p){if(!B){const I=P-c,C=_-p;h.push(I===0?"v"+a(C):C===0?"h"+a(I):"l"+r(I,C))}}else h.push("c"+r(o-c,y-p)+" "+r(S-c,x-p)+" "+r(P-c,_-p))}c=P,p=_,o=P+(l.o?.x??0),y=_+(l.o?.y??0)};if(!s)return"";for(let l=0;l<s;l++)m(e[l]);return n&&s>0&&(m(e[0],!0),h.push("z")),h.join("")},Qe=(e,n={})=>e.length===0?"":Ze(Re(e.map(typeof e[0].x=="number"?t=>U(t.x,t.y):t=>U(t[0],t[1])),n.closed,n.tolerance??2.5),n.closed,n.precision??5),et=["x","y","width","height"],tt={class:"practice-strokes"},nt=["d"],at=["d"],ot=["points"],st=oe({__name:"KanjiStrokesPracticeCanvas",props:{animatePause:{type:Boolean}},emits:["stroke"],setup(e,{expose:n,emit:t}){const s=e,i=t,a=E(null),r=M(()=>a.value?.closest("svg")),d=M(()=>r.value?.viewBox.baseVal),c=ne([]),p=ne([]),o=E(null),y=E(!1);function h(v){if(!r.value)return{x:v.x,y:v.y};const g=r.value.createSVGPoint();g.x=v.x,g.y=v.y;const $=g.matrixTransform(r.value.getScreenCTM()?.inverse());return{x:$.x,y:$.y}}function m(v){v.isPrimary&&(v.preventDefault(),a.value?.setPointerCapture(v.pointerId),p.push(h(v)))}function l(v){p.length===0||!v.isPrimary||p.push(h(v))}function B(v){v.isPrimary&&(p.length>1&&(c.push(Qe(p)),i("stroke")),a.value?.releasePointerCapture(v.pointerId),p.splice(0,p.length),r.value?.parentElement?.click())}function P(v){const g=v.getTotalLength();return[{strokeDasharray:g,strokeDashoffset:g},{strokeDasharray:g,strokeDashoffset:0}]}const _={duration:500,easing:"ease-in-out"},S=[];async function x(){if(a.value){for(const v of a.value.querySelectorAll(".practice-strokes .stroke")){const g=v.animate(P(v),_);g.pause(),S.push(g)}y.value=!1,await I()}}async function I(){let v=S.at(0);for(;v;)v.play(),await v.finished,S.shift(),v=S.at(0),v&&await ue(100)}W(()=>s.animatePause,v=>{v?S.at(0)?.pause():S.at(0)?.play()});const C=E(null);W(C,v=>{v&&v.animate(P(v),_).finished.then(()=>{o.value=null})});function V(){c.splice(0,c.length)}function F(){c.pop()}function T(v){c.push(v)}function H(v){o.value=v}return n({clear:V,pop:F,push:T,hint:H,animate:x,prepareForAnimation(){y.value=!0}}),(v,g)=>(k(),b("g",{ref_key:"el",ref:a,class:"kanji-strokes-practice-canvas canvas",onPointerdown:m,onPointermove:l,onPointerup:B},[d.value?(k(),b("rect",{key:0,class:"background",x:d.value.x,y:d.value.y,width:d.value.width,height:d.value.height},null,8,et)):J("",!0),Pe(A("g",tt,[(k(!0),b(X,null,le(ce(c),($,u)=>(k(),b("path",{key:u,class:"stroke practice-stroke",d:$},null,8,nt))),128))],512),[[Ce,!y.value]]),o.value?(k(),b("path",{key:1,ref_key:"hintPath",ref:C,class:"stroke hint",d:o.value},null,8,at)):J("",!0),A("polyline",{class:"stroke current-stroke",points:ce(p).map(({x:$,y:u})=>`${$},${u}`).join(" ")},null,8,ot)],544))}}),it=Q(st,[["__scopeId","data-v-fd6ec31f"]]),rt={class:"strokes-figure"},lt={class:"svgs"},ct=["viewBox"],ut=["d"],ft={class:"controls"},dt=oe({__name:"StrokesFigure",props:pe({viewBox:{},charStrokes:{},practiceMode:{type:Boolean}},{practicing:{type:Boolean,default:!1},practicingModifiers:{},"auto-hint":{type:Boolean,default:!1},"auto-hintModifiers":{}}),emits:pe(["practiceDone"],["update:practicing","update:auto-hint"]),setup(e,{emit:n}){const t=ve(e,"practicing"),s=ve(e,"auto-hint"),i=e,a=n,r=E([]),d=E([]),c=ne([]),p=M(()=>c.length>0),o=E(!1),y=E(!1),h=M(()=>i.charStrokes.flat()),m=ne([]),l=M(()=>m.length);function B(u){const f=u.getTotalLength();return[{strokeDasharray:f,strokeDashoffset:f},{strokeDasharray:f,strokeDashoffset:0}]}const P={duration:500,easing:"ease-in-out"};function _(){for(const u of r.value){const f=u.animate(B(u),P);f.pause(),c.push(f)}S(),x()}async function S(){let u=c.at(0);for(;u;)u.play(),await u.finished,c.shift(),u=c.at(0),u&&await ue(100)}async function x(){for(const u of d.value)u.prepareForAnimation();for(const u of d.value)await u.animate(),await ue(100)}function I(){c.at(0)?.pause(),o.value=!0}function C(){c.at(0)?.play(),o.value=!1}function V(u){m.push(u);const f=l.value;i.practiceMode&&f===h.value.length&&a("practiceDone"),i.practiceMode&&s.value&&f<h.value.length&&T()}function F(){if(l.value>=h.value.length)return null;const u=Array.from({length:i.charStrokes.length},()=>0);for(const K of m)u[K]+=1;let f,w=-1;for(const K of i.charStrokes)if(w+=1,f=K.at(u[w]),f)break;if(!f)return null;const Y=d.value.at(w);return Y?{path:f,canvas:Y,index:w}:null}function T(){const u=F();if(!u)return;const{path:f,canvas:w}=u;w.hint(f)}function H(){const u=F();if(!u)return;const{path:f,canvas:w,index:Y}=u;w.push(f),V(Y)}function v(){const u=m.pop();u!=null&&d.value.at(u)?.pop()}function g(){for(const u of d.value)u.clear();m.splice(0,m.length),y.value=!1}function $(){for(const u of c)u.cancel();c.splice(0,c.length),o.value=!1;for(const u of r.value)for(const f of u.getAnimations())f.cancel()}return W(t,u=>{y.value=!1,u?$():g()}),W(h,(u,f)=>{u!==f&&(g(),$(),y.value=!1,t.value!==i.practiceMode&&(t.value=i.practiceMode),s.value&&requestAnimationFrame(async()=>{T()}))},{immediate:!0}),(u,f)=>(k(),b("figure",rt,[A("div",lt,[(k(!0),b(X,null,le(e.charStrokes,(w,Y)=>(k(),b("svg",{key:Y,class:he(["svg",{practicing:t.value}]),viewBox:e.viewBox,onTouchstart:f[0]||(f[0]=K=>{t.value&&K.preventDefault()})},[D(Oe,{viewBox:e.viewBox},null,8,["viewBox"]),A("g",{class:he(["strokes",{comparing:p.value||y.value||h.value.length<=l.value,practicing:t.value}])},[(k(!0),b(X,null,le(w,(K,_e)=>(k(),b("path",{key:_e,ref_for:!0,ref_key:"strokePaths",ref:r,class:"stroke-path",d:K},null,8,ut))),128))],2),t.value?(k(),R(it,{key:0,ref_for:!0,ref_key:"practiceCanvases",ref:d,"animate-pause":o.value,onStroke:K=>V(Y)},null,8,["animate-pause","onStroke"])):J("",!0)],42,ct))),128))]),A("figcaption",ft,[p.value?(k(),b(X,{key:0},[o.value?(k(),R(L,{key:0,"aria-label":"Play",onClick:f[1]||(f[1]=w=>C())},{default:G(()=>[D(q,{icon:"play"})]),_:1})):(k(),R(L,{key:1,"aria-label":"Pause",onClick:f[2]||(f[2]=w=>I())},{default:G(()=>[D(q,{icon:"pause"})]),_:1}))],64)):(k(),b(X,{key:1},[t.value&&l.value<h.value.length?(k(),R(L,{key:0,"aria-label":"Show Hint",onClick:f[3]||(f[3]=w=>T())},{default:G(()=>[D(q,{icon:"help-circle"})]),_:1})):(k(),R(L,{key:1,"aria-label":"Animate Stroke Order",onClick:f[4]||(f[4]=w=>_())},{default:G(()=>[D(q,{icon:"play"})]),_:1}))],64)),e.practiceMode?J("",!0):(k(),R(L,{key:2,"aria-lable":"Practice Drawing","aria-pressed":`${t.value}`,filled:t.value,onClick:f[5]||(f[5]=w=>t.value=!t.value)},{default:G(()=>[D(q,{icon:"draw"})]),_:1},8,["aria-pressed","filled"])),t.value?(k(),b(X,{key:3},[f[9]||(f[9]=A("hr",{class:"rule"},null,-1)),D(L,{"aria-label":"Start Over",disabled:l.value===0,onClick:f[6]||(f[6]=w=>g())},{default:G(()=>[D(q,{icon:"rotate-left"})]),_:1},8,["disabled"]),D(L,{"aria-label":"Skip Backward",disabled:l.value===0,onClick:f[7]||(f[7]=w=>v())},{default:G(()=>[D(q,{icon:"skip-backward"})]),_:1},8,["disabled"]),D(L,{"aria-label":"Skip Backward",disabled:l.value===h.value.length,onClick:f[8]||(f[8]=w=>H())},{default:G(()=>[D(q,{icon:"skip-forward"})]),_:1},8,["disabled"])],64)):J("",!0)])]))}}),$t=Q(dt,[["__scopeId","data-v-f0ed9ba4"]]),pt={},vt={class:"app-label"};function ht(e,n){return k(),b("span",vt,[xe(e.$slots,"default")])}const mt=Q(pt,[["render",ht],["__scopeId","data-v-f3e79f70"]]),yt={class:"prefix"},kt=oe({__name:"CardRetrievabilityLabel",props:{r:{},label:{}},setup(e){const n=e,t=M(()=>typeof n.r!="number"?"poor":n.r>.9?"good":n.r>.7?"fair":"poor");return(s,i)=>e.r?(k(),R(mt,{key:0,class:"card-retrievability-label",title:"Writing Retrievability","data-r":t.value},{default:G(()=>[A("span",yt,[xe(s.$slots,"label",{},()=>[se(ie(e.label),1)],!0)]),typeof e.r=="number"?(k(),b(X,{key:0},[se(ie(ce($e)(e.r)),1)],64)):(k(),b(X,{key:1},[se(ie(e.r),1)],64))]),_:3},8,["data-r"])):J("",!0)}}),At=Q(kt,[["__scopeId","data-v-0c65750d"]]);export{mt as A,At as C,$t as S,St as a,Pt as b,Ct as c,Ie as f,_t as p,bt as u};
//# sourceMappingURL=CardRetrievabilityLabel-46Oryz0n.js.map
