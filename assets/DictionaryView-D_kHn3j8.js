import{d as v,m as L,a as o,e as d,I as V,g as C,F as m,l as W,b as c,u as p,h as R,o as a,_ as k,E,B as S,S as D,c as g,v as N,T as A,w as q,i as $,t as B,k as z,n as P,H as T,U}from"./index-DyCUo9BM.js";import{W as F,v as H}from"./WordListItem-B1C9zql_.js";import{c as O,w as M,h as I,d as y,i as Y}from"./index-DM9RO-23.js";import{d as Z}from"./db-DFxFyH6D.js";import{c as G,B as J,_ as Q,e as X}from"./WordWritingSelect-CEJWBOWv.js";import{W as K}from"./WordKanjiListItem-BXZDXe7U.js";import"./fsrs-BIHyrU4v.js";import"./reviews-3IHrIhKH.js";const ee={class:"word-search-results"},se={class:"results-list"},te=v({__name:"BookmarkedWords",setup(i){const r=O(async()=>{const n=[],e=(await Z).transaction("bookmarked-words").store.index("bookmarkedAt").iterate(null,"prev");for await(const l of e)n.push(l.primaryKey);return n},[]),s=L(20);function t(){s.value+=20}function u([{isIntersecting:n}]){n&&t()}return(n,e)=>(a(),o("section",ee,[e[2]||(e[2]=d("h3",null,"Bookmarked Words",-1)),d("ul",se,[(a(!0),o(m,null,W(p(r).slice(0,s.value),l=>(a(),o("li",{key:l},[c(F,{word:l},null,8,["word"])]))),128))]),s.value<p(r).length?V((a(),o("button",{key:0,class:"next-page-button",onClick:e[0]||(e[0]=l=>t())},e[1]||(e[1]=[R(" Load More ")]))),[[p(H),u]]):C("",!0)]))}}),re=k(te,[["__scopeId","data-v-8a1217ab"]]);function ae(i){return new Worker("/assets/search-kanji.worker-DUz-mWlb.js",{name:i?.name})}function ne(i){return new Worker("/assets/search-words.worker-BKHYCkZA.js",{name:i?.name})}const j=new ae,x=new ne;function oe(i){const r=E([]);M(()=>S(i),async t=>{r.splice(0,r.length),t.length>0&&x.postMessage(t)},{debounce:300,immediate:!0});function s(t){const u=t.data;u.phrase===S(i)&&r.push(u)}return x.addEventListener("message",s),D(()=>{x.removeEventListener("message",s)}),r}function ue(i){const r=L([]);M(()=>S(i),async t=>{t.length===0||I(t)?r.value=[]:j.postMessage(t)},{debounce:300,immediate:!0});function s(t){r.value=t.data}return j.addEventListener("message",s),D(()=>{j.removeEventListener("message",s)}),r}const ie={class:"word-search-result-item"},le={class:"meaning"},ce=v({__name:"WordSearchResultItem",props:{result:{}},setup(i){const r=i,s=G(()=>r.result.id),t=g(()=>s.value?s.value.readings?.at(0)?.text:r.result.readings.at(0)),u=g(()=>{const{match:e,readings:l,writings:f}=r.result;if(s.value){let _;return I(e)?_=s.value.furigana?.find(b=>b.writing===e):y(e)&&(_=s.value.furigana?.find(b=>b.reading===e)),_||(_=s.value.furigana?.at(0)),_?_.furigana:s.value.writings?.at(0)?.text??s.value.readings?.at(0)?.text??e}if(I(e))return[{ruby:e,rt:l.at(0)}];const[h]=f;if(y(e))return h?[{ruby:h,rt:e}]:e;const[w]=l;return h&&w?[{ruby:w,rt:w}]:h??w??e}),n=g(()=>{const{match:e,glossary:l}=r.result;if(s.value){if(y(e))return s.value.meanings?.at(0)??l.at(0)??e;const f=s.value.meanings?.find(h=>h.glossary?.includes(e));if(f)return f}return y(e)?l.at(0)??e:e});return(e,l)=>{const f=N("RouterLink");return a(),o("div",ie,[c(J,{"word-id":e.result.id,reading:t.value,class:"bookmark-button"},null,8,["word-id","reading"]),c(f,{to:p(A)(e.result.id),class:"word"},{default:q(()=>[typeof u.value=="string"?(a(),o(m,{key:0},[R(B(u.value),1)],64)):(a(),$(Q,{key:1,furigana:u.value},null,8,["furigana"]))]),_:1},8,["to"]),d("div",le,[typeof n.value=="string"?(a(),o(m,{key:0},[R(B(n.value),1)],64)):(a(),$(X,{key:1,meaning:n.value},null,8,["meaning"]))])])}}}),de=k(ce,[["__scopeId","data-v-3a6c2f15"]]),me={class:"word-search-results"},pe={class:"results-list"},fe=v({__name:"WordSearchResults",props:{phrase:{}},setup(i){const r=i,s=oe(()=>r.phrase);return(t,u)=>(a(),o("section",me,[u[0]||(u[0]=d("h3",null,"Words",-1)),d("ul",pe,[(a(!0),o(m,null,W(p(s),n=>(a(),o("li",{key:n.id},[c(de,{result:n},null,8,["result"])]))),128))])]))}}),he=k(fe,[["__scopeId","data-v-884f1e39"]]),_e={key:0,class:"kanji-search-results"},ge={key:0,class:"results-list"},ve={key:1,class:"results-list"},ke=v({__name:"KanjiSearchResults",props:{phrase:{}},setup(i){const r=i,s=g(()=>{const u=new Set;for(const n of r.phrase)Y(n)&&u.add(n);return u}),t=ue(()=>r.phrase);return(u,n)=>s.value.size>0||p(t).length>0?(a(),o("section",_e,[n[0]||(n[0]=d("h3",null,"Kanji",-1)),s.value.size>0?(a(),o("ul",ge,[(a(!0),o(m,null,W(s.value,e=>(a(),o("li",{key:e},[c(K,{kanji:e},null,8,["kanji"])]))),128))])):(a(),o("ul",ve,[(a(!0),o(m,null,W(p(t),e=>(a(),o("li",{key:e.id},[c(K,{kanji:String.fromCodePoint(e.id)},null,8,["kanji"])]))),128))]))])):C("",!0)}}),we=k(ke,[["__scopeId","data-v-37e6699a"]]),ye={class:"search-field"},We=v({__name:"DictionaryView",setup(i){const r=P(),s=z(),t=g({get(){return typeof r.query.search!="string"?"":r.query.search},set(u){s.replace({query:{search:u||void 0}})}});return(u,n)=>(a(),o(m,null,[d("label",ye,[c(T,{icon:"search",class:"icon"}),V(d("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),type:"search","aria-label":"search",placeholder:"Search for words, kanji, meanings, etc."},null,512),[[U,t.value]])]),t.value?(a(),o(m,{key:0},[c(we,{class:"kanji-results",phrase:t.value},null,8,["phrase"]),c(he,{class:"word-results",phrase:t.value},null,8,["phrase"])],64)):(a(),$(re,{key:1,class:"bookmark-results"}))],64))}}),Ke=k(We,[["__scopeId","data-v-5c4cb6f2"]]);export{Ke as default};
