import{k as L,l as V,x as m,c as j,B as Q,d as K,f as S,w as q,u as b,o as t,e as C,_ as R,p as U,a,j as B,F as s,g as r,t as $,q as J,b as g,K as X,V as Z,D as c,E as h,h as E,W as x,H as _}from"./index-jUm0nxGk.js";import{u as D,d as G,l as nn,A as en}from"./db-C8CERaXs.js";import{W as tn,b as an,A as rn}from"./index-xwVy6i7n.js";import{z as sn}from"./iterators-PeFxZeGd.js";function Pn(l){const e=L(null);return V(()=>m(l),async n=>{var u;if(!n){e.value=null;return}if(n===((u=e.value)==null?void 0:u.codepoint))return;const i=n.toString(16).padStart(5,"0"),f=await(await fetch(`/data/kanji-v1/${i}.json`)).json();e.value=f},{immediate:!0}),e}function zn(l){const e=L(null);return V(()=>m(l),async n=>{if(!n){e.value=null;return}const i=n.toString(16).padStart(5,"0"),f=await(await fetch(`/data/kanji-vocab-v1/${i}.json`)).json();e.value=f},{immediate:!0}),e}const on=new RegExp("\\p{Script=Han}","u"),un=new RegExp("^\\p{Script=Han}$","u"),ln=/[\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}\u{2e80}-\u{2fd5}\u{3000}-\u{303f}\u{31f0}-\u{31ff}\u{3220}-\u{3243}\u{3280}-\u{337f}\u{ff5f}-\u{ff9f}\u{ff01}-\u{ff5e}]/u;function Yn(l){return ln.test(l)}function Qn(l){return on.test(l)}function N(l){return un.test(l)}function M(){return j(()=>{const l=an();return tn(l)})}function Un(l){const e=M(),{result:n}=D(j(()=>{const i=m(l);return async()=>{const o=(await G).transaction("progress").store,f=await o.get([i,"kanji-read"]),u=await o.get([i,"kanji-write"]),d=new Date;return{read:f?e.value.get_retrievability(f.fsrs,d,!1):null,write:u?e.value.get_retrievability(u.fsrs,d,!1):null}}}));return n}function F(l){const e=M(),n=Q(new Set);return V(()=>m(l),async i=>{if(!i)return;const o=new Date;for(const f of i)if(N(f)){const u=f.codePointAt(0)??0,d=await(await G).get("progress",[u,"kanji-read"]);d&&e.value.get_retrievability(d.fsrs,o,!1)>.99&&n.add(f)}},{immediate:!0}),n}function Jn(l){const e=L(null);return V(()=>m(l),async n=>{if(!n){e.value=null;return}const o=await(await fetch(`/data/words-v1/${n}.json`)).json();e.value=o},{immediate:!0}),e}function Xn(l){const e=L([]);return V(()=>m(l),async n=>{if(!n){e.value=[];return}const o=await(await fetch(`/data/words-sentences-v1/${n}.json`)).json();e.value=o},{immediate:!0}),e}function dn(l,e={}){return j(()=>{var f,u;const n=m(e.kanji),{writings:i}=m(l)??{};if(!i)return null;let o=null;for(const d of i){if(!o){o=d;continue}n&&!d.text.includes(n)||(f=d.priority)!=null&&f.freq&&d.priority.freq<(((u=o.priority)==null?void 0:u.freq)??Number.POSITIVE_INFINITY)&&(o=d)}return o==null?void 0:o.text})}function gn(l){return j(()=>{var i,o;const{readings:e}=m(l)??{};if(!e)return null;let n=null;for(const f of e){if(!n){n=f;continue}(i=f.priority)!=null&&i.freq&&f.priority.freq<(((o=n.priority)==null?void 0:o.freq)??Number.POSITIVE_INFINITY)&&(n=f)}return n==null?void 0:n.text})}function Zn(l,e={}){const n=dn(l,e),i=gn(l),o=F(()=>{var u,d;return(d=(u=m(l))==null?void 0:u.writings)==null?void 0:d.map(({text:y})=>y).join("")}),f=j(()=>u=>{for(const d of u)if(N(d)&&!o.has(d))return!1;return!0});return j(()=>{const{furigana:u}=m(l)??{};let d;return!i.value||!n.value?d=u==null?void 0:u.at(0):d=u==null?void 0:u.find(w=>w.writing===n.value&&w.reading===i.value),d||(d=u==null?void 0:u.at(0)),((d==null?void 0:d.furigana)??[{ruby:n.value??i.value??""}]).map(({ruby:w,rt:W})=>W?f.value(w)?{ruby:w}:{ruby:w,rt:W}:{ruby:w})})}const fn=K({__name:"BookmarkWordButton",props:{wordId:{},reading:{}},setup(l){const e=l,{result:n}=D(j(()=>{const o=e.wordId;return async()=>await(await G).count("bookmarked-words",o)>0}));async function i(){n.value?(await G).delete("bookmarked-words",e.wordId):(await G).add("bookmarked-words",{wordId:e.wordId,reading:e.reading,bookmarkedAt:new Date}),nn.postMessage("word-bookmarked")}return(o,f)=>(t(),S(rn,{"aria-pressed":b(n),class:"bookmark-button",onClick:f[0]||(f[0]=u=>i())},{default:q(()=>[C(en,{icon:b(n)?"star-filled":"star"},null,8,["icon"])]),_:1},8,["aria-pressed"]))}}),cn=R(fn,[["__scopeId","data-v-5945e700"]]);function pn(l){const e=L(null);return V(()=>m(l),async n=>{const o=await(await fetch(`/data/sentences-v1/${n}.json`)).json();e.value=o},{immediate:!0}),e}const kn={key:0,class:"placeholder"},vn=K({__name:"MaybeHideKanji",props:{str:{},kanji:{default:null},hide:{type:Boolean,default:!1},link:{type:Boolean,default:!1}},setup(l){return(e,n)=>{const i=U("RouterLink");return e.link?(t(!0),a(s,{key:0},B(e.str,o=>(t(),a(s,null,[b(N)(o)?(t(),S(i,{key:0,to:b(J)(o),class:"link"},{default:q(()=>[r($(o),1)]),_:2},1032,["to"])):(t(),a(s,{key:1},[r($(o),1)],64))],64))),256)):!e.kanji||!e.hide?(t(),a(s,{key:1},[r($(e.str),1)],64)):(t(!0),a(s,{key:2},B(e.str,o=>(t(),a(s,null,[o===e.kanji?(t(),a("span",kn,"◌")):(t(),a(s,{key:1},[r($(o),1)],64))],64))),256))}}}),A=R(vn,[["__scopeId","data-v-46882cf0"]]),yn={key:0},jn={key:0},mn={key:1},O=K({__name:"VocabularyWordFurigana",props:{furigana:{},kanji:{},hideKanji:{type:Boolean},hideReading:{type:Boolean},linkKanji:{type:Boolean}},setup(l){const e=l;function n(i){return!e.hideReading||!e.kanji?!1:i.includes(e.kanji)}return(i,o)=>(t(!0),a(s,null,B(i.furigana,({ruby:f,rt:u})=>(t(),a(s,null,[u?(t(),a("ruby",yn,[C(A,{hide:i.hideKanji,kanji:i.kanji,str:f,link:i.linkKanji},null,8,["hide","kanji","str","link"]),o[0]||(o[0]=g("rp",null,"(",-1)),n(f)?(t(),a("rt",jn,"◌")):(t(),a("rt",mn,$(u),1)),o[1]||(o[1]=g("rp",null,")",-1))])):(t(),S(A,{key:1,hide:i.hideKanji,kanji:i.kanji,str:f,link:i.linkKanji},null,8,["hide","kanji","str","link"]))],64))),256))}}),bn={key:0,class:"vocabulary-sentence"},wn={lang:"ja",class:"sentence"},In=K({__name:"VocabularySentence",props:{sentenceId:{},hideKanji:{},hideReading:{},hideMeaning:{type:Boolean}},setup(l){const e=l,n=pn(()=>e.sentenceId),i=F(()=>{var u;return(u=n.value)==null?void 0:u.sentence}),o=j(()=>u=>{for(const d of u)if(N(d)&&!i.has(d))return!1;return!0}),f=j(()=>u=>u.furigana.map(({ruby:d,rt:y})=>y?o.value(d)?{ruby:d}:{ruby:d,rt:y}:{ruby:d}));return(u,d)=>b(n)?(t(),a("div",bn,[g("p",wn,[(t(!0),a(s,null,B(b(n).words,y=>(t(),S(Z(y.word?"RouterLink":"span"),{key:y.word,to:b(X)(y.word),class:"word"},{default:q(()=>[C(O,{furigana:f.value(y),"hide-kanji":!!u.hideKanji,"hide-reading":!!u.hideReading,kanji:u.hideKanji??u.hideReading},null,8,["furigana","hide-kanji","hide-reading","kanji"])]),_:2},1032,["to"]))),128))]),c(g("p",{lang:"en",class:"translation"},$(b(n).meaning),513),[[h,!u.hideMeaning]])])):E("",!0)}}),hn=R(In,[["__scopeId","data-v-584673d2"]]),$n={class:"pos-tag"},Ln=K({__name:"PartOfSpeechTag",props:{tag:{}},setup(l){return(e,n)=>(t(),a("span",$n,[e.tag==="adj-f"?(t(),a(s,{key:0},[r(" noun or prenominal verb")],64)):e.tag==="adj-i"?(t(),a(s,{key:1},[n[0]||(n[0]=g("i",{lang:"ja-Latn"},"i",-1)),n[1]||(n[1]=r(" adjective"))],64)):e.tag==="adj-ix"?(t(),a(s,{key:2},[n[2]||(n[2]=r(" adjective – ")),n[3]||(n[3]=g("i",{lang:"ja-Latn"},"yoi",-1)),n[4]||(n[4]=r("/")),n[5]||(n[5]=g("i",{lang:"ja-Latn"},"ii",-1)),n[6]||(n[6]=r(" class"))],64)):e.tag==="adj-na"?(t(),a(s,{key:3},[r(" na adjective")],64)):e.tag==="adj-nari"?(t(),a(s,{key:4},[n[7]||(n[7]=r(" formal ")),n[8]||(n[8]=g("i",{lang:"ja-Latn"},"na",-1)),n[9]||(n[9]=r("-adjective"))],64)):e.tag==="adj-no"?(t(),a(s,{key:5},[n[10]||(n[10]=r(" noun w. ")),n[11]||(n[11]=g("i",null,"no",-1)),n[12]||(n[12]=r(" particle"))],64)):e.tag==="adj-pn"?(t(),a(s,{key:6},[r(" pre-noun adjectival")],64)):e.tag==="adj-t"?(t(),a(s,{key:7},[n[13]||(n[13]=g("i",{lang:"ja-Latn"},"taru",-1)),n[14]||(n[14]=r(" adjective"))],64)):e.tag==="adv"?(t(),a(s,{key:8},[r(" adverb")],64)):e.tag==="adv-to"?(t(),a(s,{key:9},[n[15]||(n[15]=r(" adverb w. ")),n[16]||(n[16]=g("i",{lang:"ja-Latn"},"to",-1)),n[17]||(n[17]=r(" particle"))],64)):e.tag==="aux"?(t(),a(s,{key:10},[r(" auxiliary")],64)):e.tag==="aux-adj"?(t(),a(s,{key:11},[r(" auxiliary adjective")],64)):e.tag==="aux-v"?(t(),a(s,{key:12},[r(" auxiliary verb")],64)):e.tag==="conj"?(t(),a(s,{key:13},[r(" conjunction")],64)):e.tag==="cop"?(t(),a(s,{key:14},[r(" copula")],64)):e.tag==="ctr"?(t(),a(s,{key:15},[r(" counter")],64)):e.tag==="exp"?(t(),a(s,{key:16},[r(" expressions")],64)):e.tag==="int"?(t(),a(s,{key:17},[r(" interjection")],64)):e.tag==="n"?(t(),a(s,{key:18},[r(" noun")],64)):e.tag==="n-adv"?(t(),a(s,{key:19},[r(" adverbial noun")],64)):e.tag==="n-pr"?(t(),a(s,{key:20},[r(" proper noun")],64)):e.tag==="n-pref"?(t(),a(s,{key:21},[r(" noun, used as a prefix")],64)):e.tag==="n-suf"?(t(),a(s,{key:22},[r(" noun, used as a suffix")],64)):e.tag==="n-t"?(t(),a(s,{key:23},[r(" noun (temporal)")],64)):e.tag==="num"?(t(),a(s,{key:24},[r(" numeric")],64)):e.tag==="pn"?(t(),a(s,{key:25},[r(" pronoun")],64)):e.tag==="pref"?(t(),a(s,{key:26},[r(" prefix")],64)):e.tag==="prt"?(t(),a(s,{key:27},[r(" particle")],64)):e.tag==="suf"?(t(),a(s,{key:28},[r(" suffix")],64)):e.tag==="uk"?(t(),a(s,{key:29},[r(" Usually written with kana")],64)):e.tag==="v-unspec"?(t(),a(s,{key:30},[r(" verb")],64)):e.tag==="v1"?(t(),a(s,{key:31},[r(" Ichidan verb")],64)):e.tag==="v1-s"?(t(),a(s,{key:32},[n[18]||(n[18]=r(" Ichidan verb – ")),n[19]||(n[19]=g("i",{lang:"ja-Latn"},"kureru",-1))],64)):e.tag==="v5aru"?(t(),a(s,{key:33},[n[20]||(n[20]=r(" Godan verb – ")),n[21]||(n[21]=g("i",{lang:"ja-Latn"},"-aru",-1))],64)):e.tag==="v5b"?(t(),a(s,{key:34},[r(" Godan verb")],64)):e.tag==="v5g"?(t(),a(s,{key:35},[r(" Godan verb")],64)):e.tag==="v5k"?(t(),a(s,{key:36},[r(" Godan verb")],64)):e.tag==="v5k-s"?(t(),a(s,{key:37},[n[22]||(n[22]=r(" Godan verb – ")),n[23]||(n[23]=g("i",{lang:"ja-Latn"},"iku",-1)),n[24]||(n[24]=r("/")),n[25]||(n[25]=g("i",{lang:"ja-Latn"},"yuku",-1))],64)):e.tag==="v5m"?(t(),a(s,{key:38},[r(" Godan verb")],64)):e.tag==="v5n"?(t(),a(s,{key:39},[r(" Godan verb")],64)):e.tag==="v5r"?(t(),a(s,{key:40},[n[26]||(n[26]=r(" Godan verb with ")),n[27]||(n[27]=g("i",{lang:"ja-Latn"},"ru",-1)),n[28]||(n[28]=r(" ending"))],64)):e.tag==="v5r-i"?(t(),a(s,{key:41},[n[29]||(n[29]=r(" Godan verb with ")),n[30]||(n[30]=g("i",{lang:"ja-Latn"},"ru",-1)),n[31]||(n[31]=r(" ending (irregular)"))],64)):e.tag==="v5s"?(t(),a(s,{key:42},[r(" Godan verb")],64)):e.tag==="v5t"?(t(),a(s,{key:43},[r(" Godan verb")],64)):e.tag==="v5u"?(t(),a(s,{key:44},[r(" Godan verb")],64)):e.tag==="v5u-s"?(t(),a(s,{key:45},[n[32]||(n[32]=r(" Godan verb with ")),n[33]||(n[33]=g("i",{lang:"ja-Latn"},"u",-1)),n[34]||(n[34]=r(" ending (special class)"))],64)):e.tag==="v5uru"?(t(),a(s,{key:46},[n[35]||(n[35]=r(" Godan verb – ")),n[36]||(n[36]=g("i",{lang:"ja-Latn"},"Uru",-1)),n[37]||(n[37]=r(" old class verb"))],64)):e.tag==="vi"?(t(),a(s,{key:47},[r(" intransitive verb")],64)):e.tag==="vk"?(t(),a(s,{key:48},[n[38]||(n[38]=g("i",{lang:"ja-Latn"},"Kuru",-1)),n[39]||(n[39]=r(" verb"))],64)):e.tag==="vn"?(t(),a(s,{key:49},[n[40]||(n[40]=r(" irregular ")),n[41]||(n[41]=g("i",{lang:"ja-Latn"},"nu",-1)),n[42]||(n[42]=r(" verb"))],64)):e.tag==="vr"?(t(),a(s,{key:50},[n[43]||(n[43]=r(" irregular ")),n[44]||(n[44]=g("i",{lang:"ja-Latn"},"ru",-1)),n[45]||(n[45]=r(" verb"))],64)):e.tag==="vs"?(t(),a(s,{key:51},[n[46]||(n[46]=g("i",{lang:"ja-Latn"},"suru",-1)),n[47]||(n[47]=r(" verb"))],64)):e.tag==="vs-c"?(t(),a(s,{key:52},[n[48]||(n[48]=g("i",{lang:"ja-Latn"},"su",-1)),n[49]||(n[49]=r(" verb—precursor to the modern ")),n[50]||(n[50]=g("i",{lang:"ja-Latn"},"suru",-1))],64)):e.tag==="vs-i"?(t(),a(s,{key:53},[n[51]||(n[51]=g("i",{lang:"ja-Latn"},"suru",-1)),n[52]||(n[52]=r(" verb – included"))],64)):e.tag==="vs-s"?(t(),a(s,{key:54},[n[53]||(n[53]=g("i",{lang:"ja-Latn"},"suru",-1)),n[54]||(n[54]=r(" verb – special class"))],64)):e.tag==="vt"?(t(),a(s,{key:55},[r(" transitive verb")],64)):e.tag==="vz"?(t(),a(s,{key:56},[n[55]||(n[55]=r(" Ichidan verb – ")),n[56]||(n[56]=g("i",{lang:"ja-Latn"},"zuru",-1)),n[57]||(n[57]=r(" verb"))],64)):E("",!0)]))}}),H=R(Ln,[["__scopeId","data-v-ee320153"]]),Bn={class:"vocabulary-word-meaning"},Kn={class:"meaning-pos"},Sn={class:"glossary"},Vn={class:"glossary-word"},Rn=K({__name:"VocabularyWordMeaning",props:{meaning:{}},setup(l){return(e,n)=>(t(),a("div",Bn,[g("div",Kn,[(t(!0),a(s,null,B(e.meaning.pos,i=>(t(),S(H,{tag:i},null,8,["tag"]))),256)),e.meaning.kanaPreferred?(t(),S(H,{key:0,tag:"uk"})):E("",!0)]),g("div",Sn,[(t(!0),a(s,null,B(e.meaning.glossary,i=>(t(),a("span",Vn,$(i),1))),256))])]))}}),xn=R(Rn,[["__scopeId","data-v-b323a088"]]),Wn={key:0,class:"word-writing-details popover-container"},Gn=["popovertarget"],Cn={class:"writing-select-count"},En=["id"],Nn=["disabled"],Tn={class:"additional-writing"},On=["disabled","onClick"],qn=["disabled","onClick"],An=K({__name:"WordWritingSelect",props:{word:{},default:{},modelValue:{}},emits:["update:modelValue"],setup(l){x(k=>({"12841fc5":b(i)}));const e=l,n=_(),i=`--${n}`.replace(":","-anchor-"),o=j(()=>{var k;return((k=e.word.writings)==null?void 0:k.filter(p=>p.irregular||p.outdated||p.searchOnly).map(({text:p})=>p))??[]}),f=j(()=>{var k;return((k=e.word.readings)==null?void 0:k.filter(p=>p.irregular||p.outdated||p.searchOnly).map(({text:p})=>p))??[]});function u(k,p){if(k.length!==p.length)return!1;for(const[v,I]of sn(k,p))if(v.ruby!==I.ruby||v.rt!==I.rt)return!1;return!0}const d=j(()=>{var k;return((k=e.word.furigana)==null?void 0:k.filter(p=>!u(e.default,p.furigana)&&!o.value.includes(p.writing)&&!f.value.includes(p.reading)))??[]}),y=j(()=>{var k;return((k=e.word.readings)==null?void 0:k.filter(p=>{var v;return!p.irregular&&!p.outdated&&!p.searchOnly&&!((v=e.word.furigana)!=null&&v.some(I=>p.text===I.reading))}))??[]}),w=L(null),W=L(null),P=L(!1);function z(k){P.value=k.newState==="open"}function Y(k){var p,v;if(k.newState==="open"&&!("anchorName"in document.documentElement.style)){const I=(p=w.value)==null?void 0:p.getBoundingClientRect(),T=(v=W.value)==null?void 0:v.style;T&&I&&(T.insetBlockStart=`${I.bottom+window.scrollY}px`,T.insetInlineEnd=`calc(100% - ${I.right}px)`)}}return(k,p)=>d.value.length+y.value.length>0?(t(),a("div",Wn,[g("button",{ref_key:"toggleButton",ref:w,title:"Additional Writings",class:"toggle-button",popovertarget:b(n)},[p[1]||(p[1]=g("span",{class:"writing-select-icon"},"か",-1)),g("small",Cn,"(+"+$(d.value.length+y.value.length+1)+")",1)],8,Gn),g("ul",{id:b(n),ref_key:"popoverEl",ref:W,class:"writing-list popover",popover:"",onBeforetoggle:Y,onToggle:z},[g("li",null,[g("button",{class:"select-button",disabled:k.modelValue===null,onClick:p[0]||(p[0]=v=>k.$emit("update:modelValue",null))},[C(O,{furigana:k.default},null,8,["furigana"])],8,Nn)]),(t(!0),a(s,null,B(d.value,v=>(t(),a("li",Tn,[g("button",{class:"select-button",disabled:k.modelValue===v.furigana,onClick:I=>k.$emit("update:modelValue",v.furigana)},[C(O,{furigana:v.furigana},null,8,["furigana"])],8,On)]))),256)),(t(!0),a(s,null,B(y.value,v=>(t(),a("li",null,[g("button",{class:"select-button",disabled:k.modelValue===v.text,onClick:I=>k.$emit("update:modelValue",v.text)},$(v.text),9,qn)]))),256))],40,En)])):E("",!0)}}),_n=R(An,[["__scopeId","data-v-71ce21a5"]]);export{cn as B,hn as V,_n as W,O as _,Pn as a,zn as b,Un as c,Xn as d,Jn as e,Zn as f,xn as g,Qn as h,N as i,Yn as j,on as k,M as u};
