import{q as E,I as J,c as M,G as ne,X as be,H as Se,d as oe,a as b,e as A,o as k,_ as Q,Y as ae,g as U,V as Pe,W as Ce,F as X,l as le,u as ce,Z as pe,$ as ve,i as R,A as L,w as G,b as D,y as he,J as q,D as xe,h as se,t as ie}from"./index-6ufKAMkN.js";import{s as ue}from"./reviews-vv4OOlcX.js";import{f as $e}from"./formats-CYYAzfAw.js";const me="http://kanjivg.tagaini.net",ee=Symbol("kanjivg"),re=["general","tradit","nelson"],Ae=new DOMParser;function Me(e){let a=0,t=e;for(;t;)a+=1,t=t.parentElement?.closest("g");return a}function Be(e){const a=[];let t=e.closest("[data-position]");for(;t instanceof SVGElement;)a.push(t.dataset.position),t=t.parentElement?.closest("[data-position]")??null;return a}async function Ie(e){const t=await(await fetch(`/kanjivg/kanji/${e}.svg`)).text(),i=Ae.parseFromString(t,"image/svg+xml");let o=null;i.documentElement instanceof SVGSVGElement&&(o=i.documentElement.viewBox.baseVal);const n=i.getElementById(`kvg:${e}`);if(n){for(const r of[...n.querySelectorAll("*"),n])if(r instanceof SVGElement){for(const d of[...r.attributes])d.namespaceURI===me&&(r.dataset[d.localName]=d.value,r.removeAttributeNS(me,d.localName));r.removeAttribute("xmlns:kvg")}}return{strokes:n,rect:o}}function _t(e){const a=E(null),t=E(null),i=E(!1);J(()=>be(e),async(n,r)=>{if(!n){a.value=null,t.value=null;return}if(n!==r){i.value=!0;try{const{strokes:d,rect:u}=await Ie(n);a.value=d,u&&(t.value=`${u.x},${u.y},${u.width},${u.height}`)}finally{i.value=!1}}},{immediate:!0});const o=M(()=>{const n=a.value;if(!n)return new Map;const r=new Map,d={};function u(s){if(s.dataset.part&&Number.parseInt(s.dataset.part)>1)return;const y=s.dataset.element,h={element:y,original:s.dataset.original??null,position:Be(s),radical:s.dataset.radical??null,phon:s.dataset.phon??null,depth:Me(s)};let m=r.get(y);m?m.push(h):(m=[h],r.set(y,m)),h.radical&&(d[h.radical]=y)}n.dataset.radical&&u(n);for(const s of n.querySelectorAll("g[data-element]"))u(s);const p=new Map;for(const s of re){const y=d[s],h=r.get(y);h&&(h.sort((m,l)=>m.radical?l.radical?re.indexOf(m.radical)-re.indexOf(l.radical):1:l.radical?-1:m.depth-l.depth),p.set(y,h),r.delete(y))}for(const[s,y]of[...r].sort(([,h],[,m])=>Math.min(...h.map(({depth:l})=>l))-Math.min(...m.map(({depth:l})=>l))))p.set(s,y);return p});Se(ee,{strokesEl:a,viewBox:t,components:o,syncing:i})}function bt(){const e=ne(ee,null);return M(()=>e?.strokesEl.value?.cloneNode(!0)??null)}function St(){const e=ne(ee,null);return M(()=>e?.viewBox.value??"0,0,109,109")}function Pt(){const e=ne(ee,null);return M(()=>e?.components.value??new Map)}function Ct(){const e=ne(ee,null);return M(()=>e?.syncing.value??!1)}const De={class:"kanji-strokes-background"},Ne=["x","y","width","height"],Ee=["x1","y1","x2","y2"],Ve=["x1","y1","x2","y2"],je=["x1","y1","x2","y2"],Ge=["x1","y1","x2","y2"],Ke=["x1","y1","x2","y2"],Le=["x1","y1","x2","y2"],qe=oe({__name:"KanjiStrokesBackground",props:{viewBox:{}},setup(e){const a=e,t=M(()=>{const[n,r,d,u]=a.viewBox.split(",");return{x:Number.parseInt(n),y:Number.parseInt(r),width:Number.parseInt(d),height:Number.parseInt(u)}}),i=M(()=>{const{x:n,width:r}=t.value;return n+r/2}),o=M(()=>{const{y:n,height:r}=t.value;return n+r/2});return(n,r)=>(k(),b("g",De,[A("rect",{class:"background",x:t.value.x,y:t.value.y,width:t.value.width,height:t.value.width,rx:"5"},null,8,Ne),A("line",{class:"midline",x1:t.value.x+1,y1:o.value,x2:t.value.x+t.value.width-1,y2:o.value},null,8,Ee),A("line",{class:"midline",x1:i.value,y1:t.value.y+1,x2:i.value,y2:t.value.y+t.value.height-1},null,8,Ve),A("line",{class:"quartline",x1:i.value/2,y1:t.value.y+1,x2:i.value/2,y2:t.value.y+t.value.height-1},null,8,je),A("line",{class:"quartline",x1:3*i.value/2,y1:t.value.y+1,x2:3*i.value/2,y2:t.value.y+t.value.height-1},null,8,Ge),A("line",{class:"quartline",x1:t.value.x+1,y1:o.value/2,x2:t.value.x+t.value.width-1,y2:o.value/2},null,8,Ke),A("line",{class:"quartline",x1:t.value.x+1,y1:3*o.value/2,x2:t.value.x+t.value.width-1,y2:3*o.value/2},null,8,Le)]))}}),Oe=Q(qe,[["__scopeId","data-v-78045927"]]),Xe=1e-12,ye=112e-18,Fe=e=>e>=-ye&&e<=ye,ge=(e,a)=>Math.sqrt(e*e+a*a),W=(e,a)=>({x:e,y:a}),Te=e=>ge(e.x,e.y),Ye=e=>W(-e.x,-e.y),Z=(e,a)=>W(e.x+a.x,e.y+a.y),N=(e,a)=>W(e.x-a.x,e.y-a.y),z=(e,a)=>W(e.x*a,e.y*a),j=(e,a)=>e.x*a.x+e.y*a.y,de=(e,a)=>ge(e.x-a.x,e.y-a.y),O=(e,a=1)=>z(e,a/(Te(e)||1/0)),we=(e,a)=>({p:e,i:a}),Re=(e,a,t)=>{a&&(e.unshift(e[e.length-1]),e.push(e[1]));const i=e.length;if(i===0)return[];const o=[we(e[0])];return fe(e,o,t,0,i-1,N(e[1],e[0]),N(e[i-2],e[i-1])),a&&(o.shift(),o.pop()),o},fe=(e,a,t,i,o,n,r)=>{if(o-i===1){const h=e[i],m=e[o],l=de(h,m)/3;ke(a,[h,Z(h,O(n,l)),Z(m,O(r,l)),m]);return}const d=Ue(e,i,o);let u=Math.max(t,t*t),p,s=!0;for(let h=0;h<=4;h++){const m=ze(e,i,o,d,n,r),l=We(e,i,o,m,d);if(l.error<t&&s){ke(a,m);return}if(p=l.index,l.error>=u)break;s=He(e,i,o,d,m),u=l.error}const y=N(e[p-1],e[p+1]);fe(e,a,t,i,p,n,y),fe(e,a,t,p,o,Ye(y),r)},ke=(e,a)=>{const t=e[e.length-1];t.o=N(a[1],a[0]),e.push(we(a[3],N(a[2],a[3])))},ze=(e,a,t,i,o,n)=>{const r=Xe,d=Math.abs,u=e[a],p=e[t],s=[[0,0],[0,0]],y=[0,0];for(let x=0,I=t-a+1;x<I;x++){const C=i[x],V=1-C,F=3*C*V,T=V*V*V,H=F*V,v=F*C,g=C*C*C,$=O(o,H),c=O(n,v),f=N(N(e[a+x],z(u,T+H)),z(p,v+g));s[0][0]+=j($,$),s[0][1]+=j($,c),s[1][0]=s[0][1],s[1][1]+=j(c,c),y[0]+=j($,f),y[1]+=j(c,f)}const h=s[0][0]*s[1][1]-s[1][0]*s[0][1];let m,l;if(d(h)>r){const x=s[0][0]*y[1]-s[1][0]*y[0];m=(y[0]*s[1][1]-y[1]*s[0][1])/h,l=x/h}else{const x=s[0][0]+s[0][1],I=s[1][0]+s[1][1];m=l=d(x)>r?y[0]/x:d(I)>r?y[1]/I:0}const B=de(p,u),P=r*B;let _,S;if(m<P||l<P)m=l=B/3;else{const x=N(p,u);_=O(o,m),S=O(n,l),j(_,x)-j(S,x)>B*B&&(m=l=B/3,_=S=null)}return[u,Z(u,_||O(o,m)),Z(p,S||O(n,l)),p]},He=(e,a,t,i,o)=>{for(let n=a;n<=t;n++)i[n-a]=Je(o,e[n],i[n-a]);for(let n=1,r=i.length;n<r;n++)if(i[n]<=i[n-1])return!1;return!0},Je=(e,a,t)=>{const i=[],o=[];for(let s=0;s<=2;s++)i[s]=z(N(e[s+1],e[s]),3);for(let s=0;s<=1;s++)o[s]=z(N(i[s+1],i[s]),2);const n=te(3,e,t),r=te(2,i,t),d=te(1,o,t),u=N(n,a),p=j(r,r)+j(u,d);return Fe(p)?t:t-j(u,r)/p},te=(e,a,t)=>{const i=a.slice();for(let o=1;o<=e;o++)for(let n=0;n<=e-o;n++)i[n]=Z(z(i[n],1-t),z(i[n+1],t));return i[0]},Ue=(e,a,t)=>{const i=[0];for(let o=a+1;o<=t;o++)i[o-a]=i[o-a-1]+de(e[o],e[o-1]);for(let o=1,n=t-a;o<=n;o++)i[o]/=i[n];return i},We=(e,a,t,i,o)=>{let n=Math.floor((t-a+1)/2),r=0;for(let d=a+1;d<t;d++){const u=te(3,i,o[d-a]),p=N(u,e[d]),s=p.x*p.x+p.y*p.y;s>=r&&(r=s,n=d)}return{error:r,index:n}},Ze=(e,a,t)=>{const i=e.length,o=10**t,n=t<16?l=>Math.round(l*o)/o:l=>l,r=(l,B)=>n(l)+","+n(B);let d=!0,u,p,s,y;const h=[],m=(l,B)=>{const P=l.p.x,_=l.p.y;if(d)h.push("M"+r(P,_)),d=!1;else{const S=P+(l.i?.x??0),x=_+(l.i?.y??0);if(S===P&&x===_&&s===u&&y===p){if(!B){const I=P-u,C=_-p;h.push(I===0?"v"+n(C):C===0?"h"+n(I):"l"+r(I,C))}}else h.push("c"+r(s-u,y-p)+" "+r(S-u,x-p)+" "+r(P-u,_-p))}u=P,p=_,s=P+(l.o?.x??0),y=_+(l.o?.y??0)};if(!i)return"";for(let l=0;l<i;l++)m(e[l]);return a&&i>0&&(m(e[0],!0),h.push("z")),h.join("")},Qe=(e,a={})=>e.length===0?"":Ze(Re(e.map(typeof e[0].x=="number"?t=>W(t.x,t.y):t=>W(t[0],t[1])),a.closed,a.tolerance??2.5),a.closed,a.precision??5),et=["x","y","width","height"],tt={class:"practice-strokes"},at=["d"],nt=["d"],ot=["points"],st=oe({__name:"KanjiStrokesPracticeCanvas",props:{animatePause:{type:Boolean}},emits:["stroke"],setup(e,{expose:a,emit:t}){const i=e,o=t,n=E(null),r=M(()=>n.value?.closest("svg")),d=M(()=>r.value?.viewBox.baseVal),u=ae([]),p=ae([]),s=E(null),y=E(!1);function h(v){if(!r.value)return{x:v.x,y:v.y};const g=r.value.createSVGPoint();g.x=v.x,g.y=v.y;const $=g.matrixTransform(r.value.getScreenCTM()?.inverse());return{x:$.x,y:$.y}}function m(v){v.isPrimary&&(v.preventDefault(),n.value?.setPointerCapture(v.pointerId),p.push(h(v)))}function l(v){p.length===0||!v.isPrimary||p.push(h(v))}function B(v){v.isPrimary&&(p.length>1&&(u.push(Qe(p)),o("stroke")),n.value?.releasePointerCapture(v.pointerId),p.splice(0,p.length),r.value?.parentElement?.click())}function P(v){const g=v.getTotalLength();return[{strokeDasharray:g,strokeDashoffset:g},{strokeDasharray:g,strokeDashoffset:0}]}const _={duration:500,easing:"ease-in-out"},S=[];async function x(){if(n.value){for(const v of n.value.querySelectorAll(".practice-strokes .stroke")){const g=v.animate(P(v),_);g.pause(),S.push(g)}y.value=!1,await I()}}async function I(){let v=S.at(0);for(;v;)v.play(),await v.finished,S.shift(),v=S.at(0),v&&await ue(100)}J(()=>i.animatePause,v=>{v?S.at(0)?.pause():S.at(0)?.play()});const C=E(null);J(C,v=>{v&&v.animate(P(v),_).finished.then(()=>{s.value=null})});function V(){u.splice(0,u.length)}function F(){u.pop()}function T(v){u.push(v)}function H(v){s.value=v}return a({clear:V,pop:F,push:T,hint:H,animate:x,prepareForAnimation(){y.value=!0}}),(v,g)=>(k(),b("g",{ref_key:"el",ref:n,class:"kanji-strokes-practice-canvas canvas",onPointerdown:m,onPointermove:l,onPointerup:B},[d.value?(k(),b("rect",{key:0,class:"background",x:d.value.x,y:d.value.y,width:d.value.width,height:d.value.height},null,8,et)):U("",!0),Pe(A("g",tt,[(k(!0),b(X,null,le(ce(u),($,c)=>(k(),b("path",{key:c,class:"stroke practice-stroke",d:$},null,8,at))),128))],512),[[Ce,!y.value]]),s.value?(k(),b("path",{key:1,ref_key:"hintPath",ref:C,class:"stroke hint",d:s.value},null,8,nt)):U("",!0),A("polyline",{class:"stroke current-stroke",points:ce(p).map(({x:$,y:c})=>`${$},${c}`).join(" ")},null,8,ot)],544))}}),it=Q(st,[["__scopeId","data-v-fd6ec31f"]]),rt={class:"strokes-figure"},lt={class:"svgs"},ct=["viewBox"],ut=["d"],ft={class:"controls"},dt=oe({__name:"StrokesFigure",props:pe({charStrokes:{},viewBox:{default:"0,0,109,109"},practiceMode:{type:Boolean,default:!1}},{practicing:{type:Boolean,default:!1},practicingModifiers:{},"auto-hint":{type:Boolean,default:!1},"auto-hintModifiers":{}}),emits:pe(["practiceDone"],["update:practicing","update:auto-hint"]),setup(e,{emit:a}){const t=ve(e,"practicing"),i=ve(e,"auto-hint"),o=e,n=a,r=E([]),d=E([]),u=ae([]),p=M(()=>u.length>0),s=E(!1),y=E(!1),h=M(()=>o.charStrokes.flat()),m=ae([]),l=M(()=>m.length);function B(c){const f=c.getTotalLength();return[{strokeDasharray:f,strokeDashoffset:f},{strokeDasharray:f,strokeDashoffset:0}]}const P={duration:500,easing:"ease-in-out"};function _(){for(const c of r.value){const f=c.animate(B(c),P);f.pause(),u.push(f)}S(),x()}async function S(){let c=u.at(0);for(;c;)c.play(),await c.finished,u.shift(),c=u.at(0),c&&await ue(100)}async function x(){for(const c of d.value)c.prepareForAnimation();for(const c of d.value)await c.animate(),await ue(100)}function I(){u.at(0)?.pause(),s.value=!0}function C(){u.at(0)?.play(),s.value=!1}function V(c){m.push(c);const f=l.value;o.practiceMode&&f===h.value.length&&n("practiceDone"),o.practiceMode&&i.value&&f<h.value.length&&T()}function F(){if(l.value>=h.value.length)return null;const c=Array.from({length:o.charStrokes.length},()=>0);for(const K of m)c[K]+=1;let f,w=-1;for(const K of o.charStrokes)if(w+=1,f=K.at(c[w]),f)break;if(!f)return null;const Y=d.value.at(w);return Y?{path:f,canvas:Y,index:w}:null}function T(){const c=F();if(!c)return;const{path:f,canvas:w}=c;w.hint(f)}function H(){const c=F();if(!c)return;const{path:f,canvas:w,index:Y}=c;w.push(f),V(Y)}function v(){const c=m.pop();c!=null&&d.value.at(c)?.pop()}function g(){for(const c of d.value)c.clear();m.splice(0,m.length),y.value=!1}function $(){for(const c of u)c.cancel();u.splice(0,u.length),s.value=!1;for(const c of r.value)for(const f of c.getAnimations())f.cancel()}return J(t,c=>{y.value=!1,c?$():g()}),J(()=>o.practiceMode,(c,f)=>{c===!1&&f===!0&&(l.value===0?t.value=!1:l.value<h.value.length&&(y.value=!0))}),J(h,(c,f)=>{c!==f&&(g(),$(),y.value=!1,t.value!==o.practiceMode&&(t.value=o.practiceMode),i.value&&requestAnimationFrame(async()=>{T()}))},{immediate:!0}),(c,f)=>(k(),b("figure",rt,[A("div",lt,[(k(!0),b(X,null,le(e.charStrokes,(w,Y)=>(k(),b("svg",{key:Y,class:he(["svg",{practicing:t.value}]),viewBox:e.viewBox,onTouchstart:f[0]||(f[0]=K=>{t.value&&K.preventDefault()})},[D(Oe,{viewBox:e.viewBox},null,8,["viewBox"]),A("g",{class:he(["strokes",{comparing:p.value||y.value||h.value.length<=l.value,practicing:t.value}])},[(k(!0),b(X,null,le(w,(K,_e)=>(k(),b("path",{key:_e,ref_for:!0,ref_key:"strokePaths",ref:r,class:"stroke-path",d:K},null,8,ut))),128))],2),t.value?(k(),R(it,{key:0,ref_for:!0,ref_key:"practiceCanvases",ref:d,"animate-pause":s.value,onStroke:K=>V(Y)},null,8,["animate-pause","onStroke"])):U("",!0)],42,ct))),128))]),A("figcaption",ft,[p.value?(k(),b(X,{key:0},[s.value?(k(),R(L,{key:0,"aria-label":"Play",onClick:f[1]||(f[1]=w=>C())},{default:G(()=>[D(q,{icon:"play"})]),_:1})):(k(),R(L,{key:1,"aria-label":"Pause",onClick:f[2]||(f[2]=w=>I())},{default:G(()=>[D(q,{icon:"pause"})]),_:1}))],64)):(k(),b(X,{key:1},[t.value&&l.value<h.value.length?(k(),R(L,{key:0,"aria-label":"Show Hint",onClick:f[3]||(f[3]=w=>T())},{default:G(()=>[D(q,{icon:"help-circle"})]),_:1})):(k(),R(L,{key:1,"aria-label":"Animate Stroke Order",onClick:f[4]||(f[4]=w=>_())},{default:G(()=>[D(q,{icon:"play"})]),_:1}))],64)),e.practiceMode?U("",!0):(k(),R(L,{key:2,"aria-lable":"Practice Drawing","aria-pressed":`${t.value}`,filled:t.value,onClick:f[5]||(f[5]=w=>t.value=!t.value)},{default:G(()=>[D(q,{icon:"draw"})]),_:1},8,["aria-pressed","filled"])),t.value?(k(),b(X,{key:3},[f[9]||(f[9]=A("hr",{class:"rule"},null,-1)),D(L,{"aria-label":"Start Over",disabled:l.value===0,onClick:f[6]||(f[6]=w=>g())},{default:G(()=>[D(q,{icon:"rotate-left"})]),_:1},8,["disabled"]),D(L,{"aria-label":"Skip Backward",disabled:l.value===0,onClick:f[7]||(f[7]=w=>v())},{default:G(()=>[D(q,{icon:"skip-backward"})]),_:1},8,["disabled"]),D(L,{"aria-label":"Skip Backward",disabled:l.value===h.value.length,onClick:f[8]||(f[8]=w=>H())},{default:G(()=>[D(q,{icon:"skip-forward"})]),_:1},8,["disabled"])],64)):U("",!0)])]))}}),$t=Q(dt,[["__scopeId","data-v-23f89a75"]]),pt={},vt={class:"app-label"};function ht(e,a){return k(),b("span",vt,[xe(e.$slots,"default")])}const mt=Q(pt,[["render",ht],["__scopeId","data-v-f3e79f70"]]),yt={class:"prefix"},kt=oe({__name:"CardRetrievabilityLabel",props:{r:{},label:{}},setup(e){const a=e,t=M(()=>typeof a.r!="number"?"poor":a.r>.9?"good":a.r>.7?"fair":"poor");return(i,o)=>e.r?(k(),R(mt,{key:0,class:"card-retrievability-label",title:"Writing Retrievability","data-r":t.value},{default:G(()=>[A("span",yt,[xe(i.$slots,"label",{},()=>[se(ie(e.label),1)],!0)]),typeof e.r=="number"?(k(),b(X,{key:0},[se(ie(ce($e)(e.r)),1)],64)):(k(),b(X,{key:1},[se(ie(e.r),1)],64))]),_:3},8,["data-r"])):U("",!0)}}),At=Q(kt,[["__scopeId","data-v-0c65750d"]]);export{mt as A,At as C,$t as S,St as a,Pt as b,Ct as c,Ie as f,_t as p,bt as u};
//# sourceMappingURL=CardRetrievabilityLabel-D-GUgiVV.js.map
