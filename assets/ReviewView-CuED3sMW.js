import{g as k,d as R,c as u,F as g,h as K,o as a,i as v,w as $,b as m,t as j,u as r,_ as h,f as C,e as f,a as _,j as N,k as V,n as L,l as b,m as D,p as q,q as A}from"./index-PWB7_iI1.js";import{Q as P,w as F,l as I,u as S}from"./index-guFvHVik.js";import{u as M,a as Q,p as W,K as z,b as E,c as G,d as H,e as J}from"./KanjiWordList-Cc7Htw-3.js";import{A as B,u as O,d as U,l as X}from"./db-D-7ArWxb.js";import{f as Y,m as Z}from"./time-BmRGZSiE.js";import{u as x,a as ee,r as ae}from"./cards-DKV--WZT.js";import"./decks-huPVwMnz.js";function re(){return k(()=>{const l=F();return P(l)})}const se={class:"rate-buttons"},ne={class:"rate-button-content"},te={class:"rating"},ie={class:"next-review-time"},oe=R({__name:"RateButtons",props:{fsrs:{}},emits:["rate"],setup(l,{emit:s}){const n=l,c=s,d=k(()=>t.value.repeat(n.fsrs,new Date));function e(w){var o;const T=((o=w.last_review)==null?void 0:o.getTime())??Date.now(),i=w.due.getTime();return Y(i-T)}const t=re();function p(w){w!==I.Manual&&c("rate",t.value.next(n.fsrs,new Date,w))}return(w,T)=>(a(),u("div",se,[(a(!0),u(g,null,K(d.value,({log:i,card:o})=>(a(),v(B,{class:"rating-button",key:i.rating,"data-rating":r(I)[i.rating],onClick:y=>p(i.rating)},{default:$(()=>[m("span",ne,[m("span",te,j(r(I)[i.rating]),1),m("small",ie,j(e(o)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),de=h(oe,[["__scopeId","data-v-4210a69b"]]),ce={key:0},ue={class:"advance-buttons"},le=R({__name:"KanjiReview",props:{progress:{},answered:{type:Boolean}},emits:["answer","rate"],setup(l){const s=l,n=M(()=>s.progress.cardId),c=Q(()=>s.progress.cardId);W(()=>s.progress.cardId.toString(16).padStart(5,"0"));const d=k(()=>s.progress.fsrs.state===S.New);return(e,t)=>r(n)?(a(),u("section",ce,[C(z,{class:"title",kanji:r(n),"hide-literal":!e.answered&&e.progress.cardType==="kanji-write"&&!d.value,"hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji","hide-literal","hide-meaning"]),e.answered||e.progress.cardType==="kanji-write"?(a(),v(E,{key:0,class:"readings",kanji:r(n)},null,8,["kanji"])):f("",!0),C(G,{class:"strokes",kanji:r(n),"practice-mode":!e.answered&&e.progress.cardType==="kanji-write","auto-hint":!e.answered&&e.progress.cardType==="kanji-write"&&d.value},null,8,["kanji","practice-mode","auto-hint"]),m("div",ue,[e.answered?(a(),v(de,{key:0,fsrs:e.progress.fsrs,onRate:t[0]||(t[0]=p=>e.$emit("rate",p))},null,8,["fsrs"])):(a(),v(B,{key:1,onClick:t[1]||(t[1]=p=>e.$emit("answer")),filled:""},{default:$(()=>[t[2]||(t[2]=_(" Show ")),e.progress.cardType==="kanji-read"?(a(),u(g,{key:0},[_(" Reading")],64)):(a(),u(g,{key:1},[_(" Writing")],64))]),_:1}))]),e.answered||e.progress.cardType==="kanji-write"&&d.value?(a(),v(J,{key:1,class:"components"})):f("",!0),r(c)?(a(),v(H,{key:2,class:"words","kanji-vocab":r(c),"hide-kanji":!e.answered&&e.progress.cardType==="kanji-write"&&!d.value,"hide-reading":!e.answered&&e.progress.cardType==="kanji-read","hide-meaning":!e.answered&&e.progress.cardType==="kanji-read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):f("",!0)])):f("",!0)}}),pe=h(le,[["__scopeId","data-v-9beec935"]]),me={key:0,class:"review-remaining-count"},ve={class:"review-count"},we={class:"new-count"},ye={class:"learning-count"},ge=R({__name:"ReviewRemainCount",setup(l){const s=x();return(n,c)=>r(s)?(a(),u("div",me,[m("span",ve,j(r(s).due),1),m("span",we,"(+ "+j(r(s).new)+")",1),m("span",ye,j(r(s).learning),1)])):f("",!0)}}),ke=h(ge,[["__scopeId","data-v-def2b4ab"]]),fe={class:"card-value"},_e=R({__name:"ReviewSummaryItem",props:{cardId:{},reviews:{}},setup(l){const s=l,n=k(()=>String.fromCharCode(s.cardId)),c=k(()=>s.reviews.at(0)),d=k(()=>c.value?c.value.cardType==="kanji-write"&&c.value.log.state===S.New:!1);return(e,t)=>{const p=N("RouterLink");return a(),v(p,{to:r(V)(n.value),class:L(["review-summary-item",{"is-new":d.value}])},{default:$(()=>[m("strong",fe,j(n.value),1)]),_:1},8,["to","class"])}}}),je=h(_e,[["__scopeId","data-v-be38f85b"]]),Re={key:0,class:"review-summary-list"},he=R({__name:"ReviewSummary",setup(l){const{result:s}=O(async()=>{const n=new Map,c=(await U).transaction("reviews").store.index("review");for await(const d of c.iterate(IDBKeyRange.lowerBound(Z()))){const e=d.value;let t=n.get(e.cardId);t||(t=[],n.set(e.cardId,t)),t.push(e)}return n});return(n,c)=>r(s)?(a(),u("ul",Re,[(a(!0),u(g,null,K(r(s),([d,e])=>(a(),u("li",null,[C(je,{"card-id":d,reviews:e},null,8,["card-id","reviews"])]))),256))])):f("",!0)}}),Te=h(he,[["__scopeId","data-v-f917cdc0"]]);function Ce(l){return l==="kanji-read"||l==="kanji-write"}const Ie={class:"header"},$e={class:"title"},be={key:0},Ke=R({__name:"ReviewView",setup(l){const s=q(),n=A(),c=k(()=>{const{kanji:i,"card-type":o}=s.query;if(typeof i!="string"||typeof o!="string")return null;const y=i.codePointAt(0);return!y||!Ce(o)?null:{cardId:y,cardType:o}}),d=b(null),{result:e,loading:t}=ee(c),p=b(!0);D(t,i=>{i||(p.value=!1)});const w=k(()=>p.value?!0:!e.value||!d.value?!1:t.value&&e.value.cardId===d.value.cardId&&e.value.cardType===e.value.cardType);async function T(i,o){try{d.value={cardId:i.cardId,cardType:i.cardType},await ae(i.cardId,i.cardType,o),X.postMessage("card-review"),n.replace({query:{kanji:void 0,"card-type":void 0}})}catch(y){console.error(y)}}return(i,o)=>(a(),u("article",null,[m("header",Ie,[m("strong",$e,[r(e)?(a(),u(g,{key:0},[r(e).cardType==="kanji-read"?(a(),u(g,{key:0},[_(" Reading ")],64)):(a(),u(g,{key:1},[_("Writing")],64)),o[2]||(o[2]=_(" Review "))],64)):p.value?f("",!0):(a(),u(g,{key:1},[_("Review Summary")],64))]),C(ke,{class:"counts"})]),w.value?(a(),u("p",be,"Loading next card...")):r(e)?(a(),v(pe,{key:1,progress:r(e),answered:c.value!=null,onAnswer:o[0]||(o[0]=y=>i.$router.replace({query:{kanji:String.fromCodePoint(r(e).cardId),"card-type":r(e).cardType}})),onRate:o[1]||(o[1]=y=>T(r(e),y))},null,8,["progress","answered"])):(a(),v(Te,{key:2}))]))}}),Ae=h(Ke,[["__scopeId","data-v-1da1a88a"]]);export{Ae as default};
