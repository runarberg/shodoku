var I=Object.defineProperty;var D=(r,t,i)=>t in r?I(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var _=(r,t,i)=>D(r,typeof t!="symbol"?t+"":t,i);import{A as F}from"./db-C8CERaXs.js";import{d as T,c as C,f as R,w as z,s as q,V as B,o as A,h as V,b as j,X as O,_ as U}from"./index-jUm0nxGk.js";const J={class:"content"},K=T({__name:"AppButton",props:{to:{},filled:{type:Boolean},prefixIcon:{}},setup(r){const t=r,i=C(()=>t.to?"RouterLink":"button");function e(s){(s.target instanceof HTMLButtonElement||s.target instanceof HTMLAnchorElement)&&s.target.focus()}return(s,a)=>(A(),R(B(i.value),{to:s.to,class:q(["app-button",{filled:s.filled}]),onTouchstart:e},{default:z(()=>[s.prefixIcon?(A(),R(F,{key:0,icon:s.prefixIcon,class:"prefix-icon"},null,8,["icon"])):V("",!0),j("span",J,[O(s.$slots,"default")])]),_:3},40,["to","class"]))}}),yt=U(K,[["__scopeId","data-v-aed09976"]]);var u=(r=>(r[r.New=0]="New",r[r.Learning=1]="Learning",r[r.Review=2]="Review",r[r.Relearning=3]="Relearning",r))(u||{}),d=(r=>(r[r.Manual=0]="Manual",r[r.Again=1]="Again",r[r.Hard=2]="Hard",r[r.Good=3]="Good",r[r.Easy=4]="Easy",r))(d||{});class h{static card(t){return{...t,state:h.state(t.state),due:h.time(t.due),last_review:t.last_review?h.time(t.last_review):void 0}}static rating(t){if(typeof t=="string"){const i=t.charAt(0).toUpperCase(),e=t.slice(1).toLowerCase(),s=d[`${i}${e}`];if(s===void 0)throw new Error(`Invalid rating:[${t}]`);return s}else if(typeof t=="number")return t;throw new Error(`Invalid rating:[${t}]`)}static state(t){if(typeof t=="string"){const i=t.charAt(0).toUpperCase(),e=t.slice(1).toLowerCase(),s=u[`${i}${e}`];if(s===void 0)throw new Error(`Invalid state:[${t}]`);return s}else if(typeof t=="number")return t;throw new Error(`Invalid state:[${t}]`)}static time(t){if(typeof t=="object"&&t instanceof Date)return t;if(typeof t=="string"){const i=Date.parse(t);if(isNaN(i))throw new Error(`Invalid date:[${t}]`);return new Date(i)}else if(typeof t=="number")return new Date(t);throw new Error(`Invalid date:[${t}]`)}static review_log(t){return{...t,due:h.time(t.due),rating:h.rating(t.rating),state:h.state(t.state),review:h.time(t.review)}}}const P=.9,Q=36500,W=[.4072,1.1829,3.1262,15.4722,7.2102,.5316,1.0651,.0234,1.616,.1544,1.0824,1.9813,.0953,.2975,2.2042,.2407,2.9466,.5034,.6567],X=!1,Y=!0,S=r=>{let t=W;return r!=null&&r.w&&(r.w.length===19?t=r==null?void 0:r.w:r.w.length===17&&(t=r==null?void 0:r.w.concat([0,0]),console.debug("[FSRS V5]auto fill w to 19 length"))),{request_retention:(r==null?void 0:r.request_retention)||P,maximum_interval:(r==null?void 0:r.maximum_interval)||Q,w:t,enable_fuzz:(r==null?void 0:r.enable_fuzz)??X,enable_short_term:(r==null?void 0:r.enable_short_term)??Y}};function E(r,t){const i={due:r?h.time(r):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:u.New,last_review:void 0};return t&&typeof t=="function"?t(i):i}Date.prototype.scheduler=function(r,t){return Z(this,r,t)},Date.prototype.diff=function(r,t){return tt(this,r,t)},Date.prototype.format=function(){return et(this)},Date.prototype.dueFormat=function(r,t,i){return it(this,r,t,i)};function Z(r,t,i){return new Date(i?m(r).getTime()+t*24*60*60*1e3:m(r).getTime()+t*60*1e3)}function tt(r,t,i){if(!r||!t)throw new Error("Invalid date");const e=m(r).getTime()-m(t).getTime();let s=0;switch(i){case"days":s=Math.floor(e/(24*60*60*1e3));break;case"minutes":s=Math.floor(e/(60*1e3));break}return s}function et(r){const t=m(r),i=t.getFullYear(),e=t.getMonth()+1,s=t.getDate(),a=t.getHours(),n=t.getMinutes(),l=t.getSeconds();return`${i}-${w(e)}-${w(s)} ${w(a)}:${w(n)}:${w(l)}`}function w(r){return r<10?`0${r}`:`${r}`}const x=[60,60,24,31,12],b=["second","min","hour","day","month","year"];function it(r,t,i,e=b){r=m(r),t=m(t),e.length!==b.length&&(e=b);let s=r.getTime()-t.getTime(),a;for(s/=1e3,a=0;a<x.length&&!(s<x[a]);a++)s/=x[a];return`${Math.floor(s)}${i?e[a]:""}`}function m(r){return h.time(r)}const st=[d.Again,d.Hard,d.Good,d.Easy],at=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function rt(r,t,i){let e=1;for(const n of at)e+=n.factor*Math.max(Math.min(r,n.end)-n.start,0);r=Math.min(r,i);let s=Math.max(2,Math.round(r-e));const a=Math.min(Math.round(r+e),i);return r>t&&(s=Math.max(s,t+1)),s=Math.min(s,a),{min_ivl:s,max_ivl:a}}function M(r,t,i){return Math.min(Math.max(r,t),i)}class nt{constructor(t){_(this,"c");_(this,"s0");_(this,"s1");_(this,"s2");const i=lt();this.c=1,this.s0=i(" "),this.s1=i(" "),this.s2=i(" "),t==null&&(t=+new Date),this.s0-=i(t),this.s0<0&&(this.s0+=1),this.s1-=i(t),this.s1<0&&(this.s1+=1),this.s2-=i(t),this.s2<0&&(this.s2+=1)}next(){const t=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=t-(this.c=t|0),this.s2}set state(t){this.c=t.c,this.s0=t.s0,this.s1=t.s1,this.s2=t.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function lt(){let r=4022871197;return function(t){t=String(t);for(let i=0;i<t.length;i++){r+=t.charCodeAt(i);let e=.02519603282416938*r;r=e>>>0,e-=r,e*=r,r=e>>>0,e-=r,r+=e*4294967296}return(r>>>0)*23283064365386963e-26}}function dt(r){const t=new nt(r),i=()=>t.next();return i.int32=()=>t.next()*4294967296|0,i.double=()=>i()+(i()*2097152|0)*11102230246251565e-32,i.state=()=>t.state,i.importState=e=>(t.state=e,i),i}const $=-.5,L=19/81;class ot{constructor(t){_(this,"param");_(this,"intervalModifier");_(this,"_seed");this.param=new Proxy(S(t),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}set seed(t){this._seed=t}calculate_interval_modifier(t){if(t<=0||t>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(t,1/$)-1)/L).toFixed(8)}get parameters(){return this.param}set parameters(t){this.update_parameters(t)}params_handler_proxy(){const t=this;return{set:function(i,e,s){return e==="request_retention"&&Number.isFinite(s)&&(t.intervalModifier=t.calculate_interval_modifier(Number(s))),Reflect.set(i,e,s),!0}}}update_parameters(t){const i=S(t);for(const e in i)if(e in this.param){const s=e;this.param[s]=i[s]}}init_stability(t){return Math.max(this.param.w[t-1],.1)}init_difficulty(t){return this.constrain_difficulty(this.param.w[4]-Math.exp((t-1)*this.param.w[5])+1)}apply_fuzz(t,i){if(!this.param.enable_fuzz||t<2.5)return Math.round(t);const e=dt(this._seed)(),{min_ivl:s,max_ivl:a}=rt(t,i,this.param.maximum_interval);return Math.floor(e*(a-s+1)+s)}next_interval(t,i){const e=Math.min(Math.max(1,Math.round(t*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(e,i)}next_difficulty(t,i){const e=t-this.param.w[6]*(i-3);return this.constrain_difficulty(this.mean_reversion(this.init_difficulty(d.Easy),e))}constrain_difficulty(t){return Math.min(Math.max(+t.toFixed(8),1),10)}mean_reversion(t,i){return+(this.param.w[7]*t+(1-this.param.w[7])*i).toFixed(8)}next_recall_stability(t,i,e,s){const a=d.Hard===s?this.param.w[15]:1,n=d.Easy===s?this.param.w[16]:1;return+M(i*(1+Math.exp(this.param.w[8])*(11-t)*Math.pow(i,-this.param.w[9])*(Math.exp((1-e)*this.param.w[10])-1)*a*n),.01,36500).toFixed(8)}next_forget_stability(t,i,e){return+M(this.param.w[11]*Math.pow(t,-this.param.w[12])*(Math.pow(i+1,this.param.w[13])-1)*Math.exp((1-e)*this.param.w[14]),.01,36500).toFixed(8)}next_short_term_stability(t,i){return+M(t*Math.exp(this.param.w[17]*(i-3+this.param.w[18])),.01,36500).toFixed(8)}forgetting_curve(t,i){return+Math.pow(1+L*t/i,$).toFixed(8)}}class N{constructor(t,i,e){_(this,"last");_(this,"current");_(this,"review_time");_(this,"next",new Map);_(this,"algorithm");this.algorithm=e,this.last=h.card(t),this.current=h.card(t),this.review_time=h.time(i),this.init()}init(){const{state:t,last_review:i}=this.current;let e=0;t!==u.New&&i&&(e=this.review_time.diff(i,"days")),this.current.last_review=this.review_time,this.current.elapsed_days=e,this.current.reps+=1,this.initSeed()}preview(){return{[d.Again]:this.review(d.Again),[d.Hard]:this.review(d.Hard),[d.Good]:this.review(d.Good),[d.Easy]:this.review(d.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const t of st)yield this.review(t)}review(t){const{state:i}=this.last;let e;switch(i){case u.New:e=this.newState(t);break;case u.Learning:case u.Relearning:e=this.learningState(t);break;case u.Review:e=this.reviewState(t);break}if(e)return e;throw new Error("Invalid grade")}initSeed(){const t=this.review_time.getTime(),i=this.current.reps,e=this.current.difficulty*this.current.stability;this.algorithm.seed=`${t}_${i}_${e}`}buildLog(t){const{last_review:i,due:e,elapsed_days:s}=this.last;return{rating:t,state:this.current.state,due:i||e,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.current.elapsed_days,last_elapsed_days:s,scheduled_days:this.current.scheduled_days,review:this.review_time}}}class k extends N{newState(t){const i=this.next.get(t);if(i)return i;const e=h.card(this.current);switch(e.difficulty=this.algorithm.init_difficulty(t),e.stability=this.algorithm.init_stability(t),t){case d.Again:e.scheduled_days=0,e.due=this.review_time.scheduler(1),e.state=u.Learning;break;case d.Hard:e.scheduled_days=0,e.due=this.review_time.scheduler(5),e.state=u.Learning;break;case d.Good:e.scheduled_days=0,e.due=this.review_time.scheduler(10),e.state=u.Learning;break;case d.Easy:{const a=this.algorithm.next_interval(e.stability,this.current.elapsed_days);e.scheduled_days=a,e.due=this.review_time.scheduler(a,!0),e.state=u.Review;break}default:throw new Error("Invalid grade")}const s={card:e,log:this.buildLog(t)};return this.next.set(t,s),s}learningState(t){const i=this.next.get(t);if(i)return i;const{state:e,difficulty:s,stability:a}=this.last,n=h.card(this.current),l=this.current.elapsed_days;switch(n.difficulty=this.algorithm.next_difficulty(s,t),n.stability=this.algorithm.next_short_term_stability(a,t),t){case d.Again:{n.scheduled_days=0,n.due=this.review_time.scheduler(5,!1),n.state=e;break}case d.Hard:{n.scheduled_days=0,n.due=this.review_time.scheduler(10),n.state=e;break}case d.Good:{const c=this.algorithm.next_interval(n.stability,l);n.scheduled_days=c,n.due=this.review_time.scheduler(c,!0),n.state=u.Review;break}case d.Easy:{const c=this.algorithm.next_short_term_stability(a,d.Good),f=this.algorithm.next_interval(c,l),y=Math.max(this.algorithm.next_interval(n.stability,l),f+1);n.scheduled_days=y,n.due=this.review_time.scheduler(y,!0),n.state=u.Review;break}default:throw new Error("Invalid grade")}const o={card:n,log:this.buildLog(t)};return this.next.set(t,o),o}reviewState(t){const i=this.next.get(t);if(i)return i;const e=this.current.elapsed_days,{difficulty:s,stability:a}=this.last,n=this.algorithm.forgetting_curve(e,a),l=h.card(this.current),o=h.card(this.current),c=h.card(this.current),f=h.card(this.current);this.next_ds(l,o,c,f,s,a,n),this.next_interval(l,o,c,f,e),this.next_state(l,o,c,f),l.lapses+=1;const y={card:l,log:this.buildLog(d.Again)},p={card:o,log:super.buildLog(d.Hard)},v={card:c,log:super.buildLog(d.Good)},g={card:f,log:super.buildLog(d.Easy)};return this.next.set(d.Again,y),this.next.set(d.Hard,p),this.next.set(d.Good,v),this.next.set(d.Easy,g),this.next.get(t)}next_ds(t,i,e,s,a,n,l){t.difficulty=this.algorithm.next_difficulty(a,d.Again),t.stability=this.algorithm.next_forget_stability(a,n,l),i.difficulty=this.algorithm.next_difficulty(a,d.Hard),i.stability=this.algorithm.next_recall_stability(a,n,l,d.Hard),e.difficulty=this.algorithm.next_difficulty(a,d.Good),e.stability=this.algorithm.next_recall_stability(a,n,l,d.Good),s.difficulty=this.algorithm.next_difficulty(a,d.Easy),s.stability=this.algorithm.next_recall_stability(a,n,l,d.Easy)}next_interval(t,i,e,s,a){let n,l;n=this.algorithm.next_interval(i.stability,a),l=this.algorithm.next_interval(e.stability,a),n=Math.min(n,l),l=Math.max(l,n+1);const o=Math.max(this.algorithm.next_interval(s.stability,a),l+1);t.scheduled_days=0,t.due=this.review_time.scheduler(5),i.scheduled_days=n,i.due=this.review_time.scheduler(n,!0),e.scheduled_days=l,e.due=this.review_time.scheduler(l,!0),s.scheduled_days=o,s.due=this.review_time.scheduler(o,!0)}next_state(t,i,e,s){t.state=u.Relearning,i.state=u.Review,e.state=u.Review,s.state=u.Review}}class H extends N{newState(t){const i=this.next.get(t);if(i)return i;this.current.scheduled_days=0,this.current.elapsed_days=0;const e=h.card(this.current),s=h.card(this.current),a=h.card(this.current),n=h.card(this.current);return this.init_ds(e,s,a,n),this.next_interval(e,s,a,n,0),this.next_state(e,s,a,n),this.update_next(e,s,a,n),this.next.get(t)}init_ds(t,i,e,s){t.difficulty=this.algorithm.init_difficulty(d.Again),t.stability=this.algorithm.init_stability(d.Again),i.difficulty=this.algorithm.init_difficulty(d.Hard),i.stability=this.algorithm.init_stability(d.Hard),e.difficulty=this.algorithm.init_difficulty(d.Good),e.stability=this.algorithm.init_stability(d.Good),s.difficulty=this.algorithm.init_difficulty(d.Easy),s.stability=this.algorithm.init_stability(d.Easy)}learningState(t){return this.reviewState(t)}reviewState(t){const i=this.next.get(t);if(i)return i;const e=this.current.elapsed_days,{difficulty:s,stability:a}=this.last,n=this.algorithm.forgetting_curve(e,a),l=h.card(this.current),o=h.card(this.current),c=h.card(this.current),f=h.card(this.current);return this.next_ds(l,o,c,f,s,a,n),this.next_interval(l,o,c,f,e),this.next_state(l,o,c,f),l.lapses+=1,this.update_next(l,o,c,f),this.next.get(t)}next_ds(t,i,e,s,a,n,l){t.difficulty=this.algorithm.next_difficulty(a,d.Again),t.stability=this.algorithm.next_forget_stability(a,n,l),i.difficulty=this.algorithm.next_difficulty(a,d.Hard),i.stability=this.algorithm.next_recall_stability(a,n,l,d.Hard),e.difficulty=this.algorithm.next_difficulty(a,d.Good),e.stability=this.algorithm.next_recall_stability(a,n,l,d.Good),s.difficulty=this.algorithm.next_difficulty(a,d.Easy),s.stability=this.algorithm.next_recall_stability(a,n,l,d.Easy)}next_interval(t,i,e,s,a){let n,l,o,c;n=this.algorithm.next_interval(t.stability,a),l=this.algorithm.next_interval(i.stability,a),o=this.algorithm.next_interval(e.stability,a),c=this.algorithm.next_interval(s.stability,a),n=Math.min(n,l),l=Math.max(l,n+1),o=Math.max(o,l+1),c=Math.max(c,o+1),t.scheduled_days=n,t.due=this.review_time.scheduler(n,!0),i.scheduled_days=l,i.due=this.review_time.scheduler(l,!0),e.scheduled_days=o,e.due=this.review_time.scheduler(o,!0),s.scheduled_days=c,s.due=this.review_time.scheduler(c,!0)}next_state(t,i,e,s){t.state=u.Review,i.state=u.Review,e.state=u.Review,s.state=u.Review}update_next(t,i,e,s){const a={card:t,log:this.buildLog(d.Again)},n={card:i,log:super.buildLog(d.Hard)},l={card:e,log:super.buildLog(d.Good)},o={card:s,log:super.buildLog(d.Easy)};this.next.set(d.Again,a),this.next.set(d.Hard,n),this.next.set(d.Good,l),this.next.set(d.Easy,o)}}class ht{constructor(t){_(this,"fsrs");this.fsrs=t}replay(t,i,e){return this.fsrs.next(t,i,e)}handleManualRating(t,i,e,s,a,n,l){if(typeof i>"u")throw new Error("reschedule: state is required for manual rating");let o,c;if(i===u.New)o={rating:d.Manual,state:i,due:l??e,stability:t.stability,difficulty:t.difficulty,elapsed_days:s,last_elapsed_days:t.elapsed_days,scheduled_days:t.scheduled_days,review:e},c=E(e),c.last_review=e;else{if(typeof l>"u")throw new Error("reschedule: due is required for manual rating");const f=l.diff(e,"days");o={rating:d.Manual,state:t.state,due:t.last_review||t.due,stability:t.stability,difficulty:t.difficulty,elapsed_days:s,last_elapsed_days:t.elapsed_days,scheduled_days:t.scheduled_days,review:e},c={...t,state:i,due:l,last_review:e,stability:a||t.stability,difficulty:n||t.difficulty,elapsed_days:s,scheduled_days:f,reps:t.reps+1}}return{card:c,log:o}}reschedule(t,i){const e=[];let s=E(t.due);for(const a of i){let n;if(a.review=h.time(a.review),a.rating===d.Manual){let l=0;s.state!==u.New&&s.last_review&&(l=a.review.diff(s.last_review,"days")),n=this.handleManualRating(s,a.state,a.review,l,a.stability,a.difficulty,a.due?h.time(a.due):void 0)}else n=this.replay(s,a.review,a.rating);e.push(n),s=n.card}return e}calculateManualRecord(t,i,e,s){if(!e)return null;const{card:a,log:n}=e,l=h.card(t);return l.due.getTime()===a.due.getTime()?null:(l.scheduled_days=a.due.diff(l.due,"days"),this.handleManualRating(l,a.state,h.time(i),n.elapsed_days,s?a.stability:void 0,s?a.difficulty:void 0,a.due))}}class ct extends ot{constructor(i){super(i);_(this,"Scheduler");const{enable_short_term:e}=this.parameters;this.Scheduler=e?k:H}params_handler_proxy(){const i=this;return{set:function(e,s,a){return s==="request_retention"&&Number.isFinite(a)?i.intervalModifier=i.calculate_interval_modifier(Number(a)):s==="enable_short_term"&&(i.Scheduler=a===!0?k:H),Reflect.set(e,s,a),!0}}}repeat(i,e,s){const a=this.Scheduler,n=new a(i,e,this).preview();return s&&typeof s=="function"?s(n):n}next(i,e,s,a){const n=this.Scheduler,l=new n(i,e,this),o=h.rating(s);if(o===d.Manual)throw new Error("Cannot review a manual rating");const c=l.review(o);return a&&typeof a=="function"?a(c):c}get_retrievability(i,e,s=!0){const a=h.card(i);e=e?h.time(e):new Date;const n=a.state!==u.New?Math.max(e.diff(a.last_review,"days"),0):0,l=a.state!==u.New?this.forgetting_curve(n,+a.stability.toFixed(8)):0;return s?`${(l*100).toFixed(2)}%`:l}rollback(i,e,s){const a=h.card(i),n=h.review_log(e);if(n.rating===d.Manual)throw new Error("Cannot rollback a manual rating");let l,o,c;switch(n.state){case u.New:l=n.due,o=void 0,c=0;break;case u.Learning:case u.Relearning:case u.Review:l=n.review,o=n.due,c=a.lapses-(n.rating===d.Again&&n.state===u.Review?1:0);break}const f={...a,due:l,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.last_elapsed_days,scheduled_days:n.scheduled_days,reps:Math.max(0,a.reps-1),lapses:Math.max(0,c),state:n.state,last_review:o};return s&&typeof s=="function"?s(f):f}forget(i,e,s=!1,a){const n=h.card(i);e=h.time(e);const l=n.state===u.New?0:e.diff(n.last_review,"days"),o={rating:d.Manual,state:n.state,due:n.due,stability:n.stability,difficulty:n.difficulty,elapsed_days:0,last_elapsed_days:n.elapsed_days,scheduled_days:l,review:e},c={card:{...n,due:e,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:s?0:n.reps,lapses:s?0:n.lapses,state:u.New,last_review:n.last_review},log:o};return a&&typeof a=="function"?a(c):c}reschedule(i,e=[],s={}){const{recordLogHandler:a,reviewsOrderBy:n,skipManual:l=!0,now:o=new Date,update_memory_state:c=!1}=s;n&&typeof n=="function"&&e.sort(n),l&&(e=e.filter(G=>G.rating!==d.Manual));const f=new ht(this),y=f.reschedule(s.first_card||E(),e),p=y.length,v=h.card(i),g=f.calculateManualRecord(v,o,p?y[p-1]:void 0,c);return a&&typeof a=="function"?{collections:y.map(a),reschedule_item:g?a(g):null}:{collections:y,reschedule_item:g}}}const mt=r=>new ct(r||{});export{yt as A,mt as W,S as b,d as l,u,E as w};
