import{d as $,c as k,a as m,F as h,l as A,i as y,w as q,e as w,t as C,u as d,A as N,o,_ as I,b as c,g as v,m as S,h as R,n as W,p as D,q as P,s as F,v as B,k as L,x as E,j as K}from"./index-sZE7bAWT.js";import{A as Y}from"./AppLoading-30x4pa5-.js";import{R as T,b as G,S as M,u as Q,c as z}from"./reviews-BjQG9Nhh.js";import{d as H}from"./db-CaAx7W_9.js";import{r as J,u as O}from"./kana-RsG-lPzR.js";import{K as U,_ as X,a as Z}from"./KanaTitle-DQEf728K.js";import{u as _}from"./fsrs-BAHU2VgB.js";import{u as x,a as ee}from"./kanji-re1ONLR0.js";import{p as ae}from"./CardRetrievabilityLabel-BgFlRhxu.js";import{K as ne,a as re,b as te,c as se,d as ie}from"./KanjiWordList-AtATzaQr.js";import"./decks-BkI394ym.js";import"./formats-B8hr5_5_.js";import"./decks-Dqx20Gkd.js";import"./WordWritingSelect-DjvD8_58.js";import"./kanji-components-0bMHtblv.js";import"./index-caO2MYO7.js";import"./WordListItem-9iMVk-v2.js";const oe={class:"rate-buttons"},de={class:"rate-button-content"},ue={class:"rating"},le={class:"next-review-time"},me=$({__name:"RateButtons",props:{progress:{}},emits:["rate"],setup(l,{emit:r}){const n=l,t=r,e=_(),a=k(()=>e.value.repeat(n.progress,new Date));function s(g){const b=g.last_review?.getTime()??Date.now(),f=g.due.getTime();return G(f-b)}function p(g){g!==T.Manual&&t("rate",e.value.next(n.progress,new Date,g))}return(g,b)=>(o(),m("div",oe,[(o(!0),m(h,null,A(a.value,({log:f,card:i})=>(o(),y(N,{key:f.rating,class:"rating-button","data-rating":d(T)[f.rating],onClick:u=>p(f.rating)},{default:q(()=>[w("span",de,[w("span",ue,C(d(T)[f.rating]),1),w("small",le,C(s(i)),1)])]),_:2},1032,["data-rating","onClick"]))),128))]))}}),pe=I(me,[["__scopeId","data-v-8b639bb2"]]),ce={class:"advance-buttons"},ge=$({__name:"ReviewAdvanceButtons",props:{progress:{},isRating:{type:Boolean},mode:{}},emits:["answer","rate"],setup(l){return(r,n)=>(o(),m("div",ce,[r.isRating?(o(),y(pe,{key:0,progress:r.progress,onRate:n[0]||(n[0]=t=>r.$emit("rate",t))},null,8,["progress"])):(o(),m(h,{key:1},[c(N,{filled:"",onClick:n[1]||(n[1]=t=>r.$emit("answer"))},{default:q(()=>[n[2]||(n[2]=R(" Show ",-1)),r.mode==="read"?(o(),m(h,{key:0},[R(" Reading ")],64)):(o(),m(h,{key:1},[R(" Writing ")],64))]),_:1}),"singleton"in r.$route.query&&typeof r.$route.params.kanji=="string"?(o(),y(N,{key:0,to:d(S)(r.$route.params.kanji),replace:""},{default:q(()=>[...n[3]||(n[3]=[R(" Cancel ",-1)])]),_:1},8,["to"])):v("",!0)],64))]))}}),V=I(ge,[["__scopeId","data-v-5ce12812"]]),we={key:0},ve=$({__name:"ReviewCardKana",props:{cardId:{},progress:{},isNew:{type:Boolean},isRating:{type:Boolean},mode:{}},emits:["answer","rate"],setup(l){const r=l;function n(a){return[12419,12421,12423,12515,12517,12519].includes(a)}const t=k(()=>{const{cardId:a}=r;return n(a)?J(String.fromCodePoint(a)):String.fromCodePoint(a)}),e=O(t);return(a,s)=>d(e)?(o(),m("section",we,[c(U,{kana:t.value,"kana-info":d(e),"hide-kana":!a.isRating&&!a.isNew&&a.mode==="write","hide-romaji":!a.isRating&&a.mode==="read",actions:"review",class:"title"},null,8,["kana","kana-info","hide-kana","hide-romaji"]),c(X,{class:"strokes",kana:t.value,"auto-hint":a.isNew&&!a.isRating&&a.mode==="write","practice-mode":!a.isRating&&a.mode==="write",onPracticeDone:s[0]||(s[0]=p=>a.$emit("answer"))},null,8,["kana","auto-hint","practice-mode"]),c(V,{progress:a.progress,"is-rating":a.isRating,mode:a.mode,onAnswer:s[1]||(s[1]=p=>a.$emit("answer")),onRate:s[2]||(s[2]=p=>a.$emit("rate",p))},null,8,["progress","is-rating","mode"]),d(e)?.vocab?(o(),y(Z,{key:0,vocab:d(e).vocab,"hide-romaji":!a.isRating&&a.mode==="read","hide-kana":!a.isRating&&!a.isNew&&a.mode==="write","target-kana":t.value},null,8,["vocab","hide-romaji","hide-kana","target-kana"])):v("",!0)])):v("",!0)}}),fe={key:0},ke=$({__name:"ReviewCardKanji",props:{cardId:{},progress:{},isNew:{type:Boolean},isRating:{type:Boolean},mode:{}},emits:["answer","rate"],setup(l){const r=l,n=x(()=>r.cardId),t=ee(()=>r.cardId);return ae(()=>r.cardId.toString(16).padStart(5,"0")),(e,a)=>d(n)?(o(),m("section",fe,[c(ne,{class:"title",kanji:d(n),"hide-literal":!e.isRating&&!e.isNew&&e.mode==="write","hide-meaning":!e.isRating&&e.mode==="read"},null,8,["kanji","hide-literal","hide-meaning"]),c(re,{class:"readings",kanji:d(n),"hide-readings":e.mode==="read"&&!e.isRating},null,8,["kanji","hide-readings"]),c(te,{class:"strokes",kanji:d(n).literal,"auto-hint":e.isNew&&!e.isRating&&e.mode==="write","practice-mode":!e.isRating&&e.mode==="write",onPracticeDone:a[0]||(a[0]=s=>e.$emit("answer"))},null,8,["kanji","auto-hint","practice-mode"]),c(V,{progress:e.progress,"is-rating":e.isRating,mode:e.mode,onAnswer:a[1]||(a[1]=s=>e.$emit("answer")),onRate:a[2]||(a[2]=s=>e.$emit("rate",s))},null,8,["progress","is-rating","mode"]),c(se,{class:"components",hide:!e.isRating&&!(e.mode==="write"&&e.isNew)},null,8,["hide"]),d(t)?(o(),y(ie,{key:0,class:"words","kanji-vocab":d(t),"hide-kanji":!e.isRating&&!e.isNew&&e.mode==="write","hide-reading":!e.isRating&&e.mode==="read","hide-meaning":!e.isRating&&e.mode==="read"},null,8,["kanji-vocab","hide-kanji","hide-reading","hide-meaning"])):v("",!0)])):v("",!0)}}),Re={key:0},ye=$({__name:"ReviewCard",props:{card:{},isRating:{type:Boolean}},emits:["answer","rate"],setup(l){const r=l,n=W(async()=>{const{cardId:e,cardType:a,fsrs:s}=r.card;return s||(await(await H).get("progress",[e,a]))?.fsrs},r.card.fsrs),t=k(()=>n.value?.state===M.New);return(e,a)=>d(n)?(o(),m("section",Re,[(o(),y(D(e.card.cardType.startsWith("kana-")?ve:ke),{"card-id":e.card.cardId,progress:d(n),"is-new":t.value,"is-rating":e.isRating,mode:e.card.cardType.endsWith("-write")?"write":"read",onAnswer:a[0]||(a[0]=s=>e.$emit("answer")),onRate:a[1]||(a[1]=s=>e.$emit("rate",{progress:{...e.card,fsrs:d(n)},next:s}))},null,40,["card-id","progress","is-new","is-rating","mode"]))])):v("",!0)}}),$e={key:0,class:"review-remaining-count"},je={class:"review-count"},he={class:"new-count"},Ce={class:"learning-count"},be=$({__name:"ReviewRemainCount",setup(l){const r=Q();return(n,t)=>d(r)?(o(),m("div",$e,[w("span",je,C(d(r).due),1),w("span",he,"(+ "+C(d(r).new)+")",1),w("span",Ce,C(d(r).learning),1)])):v("",!0)}}),Ie=I(be,[["__scopeId","data-v-adc21f06"]]);function Te(l){return l==="kanji-read"||l==="kanji-write"||l==="kana-read"||l==="kana-write"}const qe={class:"header"},Ne={class:"title"},Be={key:0,class:"loading"},Ke=$({__name:"ReviewView",setup(l){const r=P(null),n=F(),t=L(),e=z(),a=k(()=>{const{"card-type":i}=n.query;return typeof i!="string"||!Te(i)?null:i}),s=k(()=>{const{"card-id":i}=n.query;if(typeof i!="string")return null;const u=Number.parseInt(i);return Number.isFinite(u)?u:null}),p=k(()=>!s.value||!a.value?null:e.queue.find(u=>u.cardId===s.value&&u.cardType===a.value)??{cardId:s.value,cardType:a.value}),g=k(()=>"rating"in n.query),b=k(()=>!p.value&&e.refreshing);e.refreshQueues(),B(()=>{e.queue.length===0&&!e.refreshing&&!g.value&&!("singleton"in n.query)&&t.replace(K)}),B(()=>{if(p.value)return;const[i]=e.queue;i&&t.replace({query:{"card-id":i.cardId,"card-type":i.cardType,rating:void 0}})});function f({progress:i,next:u}){if(e.rateCard(i,u),"singleton"in n.query){i.cardType.startsWith("kanji-")?t.replace(S(String.fromCodePoint(i.cardId))):i.cardType.startsWith("kana-")&&t.replace(E(String.fromCodePoint(i.cardId)));return}const[j]=e.queue;j?(t.replace({query:{"card-id":String.fromCodePoint(j.cardId),"card-type":j.cardType,rating:void 0}}),r.value?.scrollIntoView({behavior:"instant",block:"start"})):t.replace(K)}return(i,u)=>(o(),m("article",{ref_key:"el",ref:r},[w("header",qe,[w("strong",Ne,[a.value?.endsWith("-read")?(o(),m(h,{key:0},[R(" Reading ")],64)):a.value?.endsWith("-write")?(o(),m(h,{key:1},[R(" Writing ")],64)):v("",!0),u[2]||(u[2]=R(" Review ",-1))]),c(Ie,{class:"counts"})]),b.value?(o(),m("section",Be,[u[3]||(u[3]=w("p",null,"Loading next cardâ€¦",-1)),c(Y,{class:"loading-icon"})])):p.value?(o(),y(ye,{key:1,card:p.value,"is-rating":g.value,onAnswer:u[0]||(u[0]=j=>i.$router.replace({query:{...i.$route.query,rating:""}})),onRate:u[1]||(u[1]=j=>f(j))},null,8,["card","is-rating"])):v("",!0)],512))}}),Ue=I(Ke,[["__scopeId","data-v-e5c78da6"]]);export{Ue as default};
//# sourceMappingURL=ReviewView-Cwe8jh_U.js.map
